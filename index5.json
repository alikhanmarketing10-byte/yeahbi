[
  {
    "meta": {
      "instanceId": "257476b1ef58bf3cb6a46e65fac7ee34a53a5e1a8492d5c6e4da5f87c9b82833",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "83ed351e-90e8-458f-a01b-73001ef1800f",
        "name": "Upload your file here",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          220,
          -120
        ],
        "webhookId": "82848bc4-5ea2-4e5a-8bb6-3c09b94a8c5d",
        "parameters": {
          "options": {},
          "formTitle": "Upload your data to test RAG",
          "formFields": {
            "values": [
              {
                "fieldType": "file",
                "fieldLabel": "Upload your file(s)",
                "requiredField": true,
                "acceptFileTypes": ".pdf, .csv"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "26d63e24-2592-41f9-9b4b-edab81e99f21",
        "name": "Embeddings OpenAI",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "position": [
          860,
          460
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "14",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "3a69c8a7-bf95-4de2-84b0-ae2cc3d2e4e7",
        "name": "Default Data Loader",
        "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
        "position": [
          660,
          40
        ],
        "parameters": {
          "options": {},
          "dataType": "binary"
        },
        "typeVersion": 1.1
      },
      {
        "id": "0b42832b-c9e8-4627-b36c-94fc5e242b33",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -320,
          -180
        ],
        "parameters": {
          "color": 4,
          "width": 440,
          "height": 300,
          "content": "### Readme\nLoad your data into a vector database with the üìö **Load Data** flow, and then use your data as chat context with the üêï **Retriever** flow.\n\n**Quick start**\n1. Click on the `Execute Workflow` button to run the üìö **Load Data** flow.\n2. Click on `Open Chat` button to run the üêï **Retriever** flow. Then ask a question about content from your document(s)\n\n\nFor more info, check our [docs on RAG in n8n](https://docs.n8n.io/advanced-ai/rag-in-n8n/)"
        },
        "typeVersion": 1
      },
      {
        "id": "f902ab8f-4620-4a95-86f7-c5857c4d6c4f",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          160,
          -180
        ],
        "parameters": {
          "color": 7,
          "width": 700,
          "height": 460,
          "content": "### üìö Load Data Flow"
        },
        "typeVersion": 1
      },
      {
        "id": "0f4185ea-d7a9-44a9-a824-98f9dc2c2a5d",
        "name": "Insert Data to Store",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
        "position": [
          400,
          -120
        ],
        "parameters": {
          "mode": "insert",
          "memoryKey": {
            "__rl": true,
            "mode": "list",
            "value": "vector_store_key",
            "cachedResultName": "vector_store_key"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "ce86b41b-7e1b-458f-ab13-d6b187854ae8",
        "name": "Query Data Tool",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
        "position": [
          1300,
          200
        ],
        "parameters": {
          "memoryKey": {
            "__rl": true,
            "mode": "list",
            "value": "vector_store_key"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "0039537b-558c-4fe8-9716-f8aa13676f4a",
        "name": "AI Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          1280,
          -140
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 2
      },
      {
        "id": "2669a65e-f0f3-45aa-95c0-621b15a4fc67",
        "name": "When chat message received",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          1060,
          -140
        ],
        "webhookId": "4091fa09-fb9a-4039-9411-7104d213f601",
        "parameters": {
          "options": {}
        },
        "typeVersion": 1.1
      },
      {
        "id": "3d1b3f5a-bc35-4739-a618-9c85820d39a0",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          940,
          -180
        ],
        "parameters": {
          "color": 7,
          "width": 820,
          "height": 520,
          "content": "### üêï 2. Retriever Flow"
        },
        "typeVersion": 1
      },
      {
        "id": "6553a758-c655-4196-88be-9d93187f9c7b",
        "name": "Answer questions with a vector store",
        "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
        "position": [
          1440,
          60
        ],
        "parameters": {
          "description": "The data contains custom knowledge"
        },
        "typeVersion": 1.1
      },
      {
        "id": "d43cf585-4192-4f53-9532-4677923289ba",
        "name": "Expensive model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          1060,
          80
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1",
            "cachedResultName": "gpt-4.1"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "14",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "18dcc49d-9ce0-4746-8135-7e4c77cfa501",
        "name": "Cheap Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          1600,
          200
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "14",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      }
    ],
    "pinData": {},
    "connections": {
      "Cheap Model": {
        "ai_languageModel": [
          [
            {
              "node": "Answer questions with a vector store",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Expensive model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Query Data Tool": {
        "ai_tool": [
          []
        ],
        "ai_vectorStore": [
          [
            {
              "node": "Answer questions with a vector store",
              "type": "ai_vectorStore",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI": {
        "ai_embedding": [
          [
            {
              "node": "Insert Data to Store",
              "type": "ai_embedding",
              "index": 0
            },
            {
              "node": "Query Data Tool",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Default Data Loader": {
        "ai_document": [
          [
            {
              "node": "Insert Data to Store",
              "type": "ai_document",
              "index": 0
            }
          ]
        ]
      },
      "Upload your file here": {
        "main": [
          [
            {
              "node": "Insert Data to Store",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Answer questions with a vector store": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "cb484ba7b742928a2048bf8829668bed5b5ad9787579adea888f05980292a4a7"
    },
    "nodes": [
      {
        "id": "3102dc76-7123-4e87-b30f-e15c240e77da",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          0,
          0
        ],
        "parameters": {
          "simple": false,
          "filters": {},
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "H4Vkp5Iwb0wrQOR6",
            "name": "Nik's gmail"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "1e4a55e5-289e-4d67-a161-9109bd430e75",
        "name": "Only n8n Paddle invoice mails",
        "type": "n8n-nodes-base.if",
        "position": [
          420,
          0
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "229200d1-ec13-4970-ae0e-2c8e17da0bdf",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.from.value[0].address }}",
                "rightValue": "help@paddle.com"
              },
              {
                "id": "1830d49a-5ee0-472c-bb9d-0090c0e1f5a4",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.subject }}",
                "rightValue": "Your invoice"
              }
            ]
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "a87ed337-a582-44ed-9185-ea0dd9486245",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          820,
          -120
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "link"
        },
        "typeVersion": 1
      },
      {
        "id": "3a4dd56b-3177-4364-ac48-ce9e475b773f",
        "name": "Only keep invoice link",
        "type": "n8n-nodes-base.filter",
        "position": [
          1000,
          -120
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "d8a78835-46bd-40c0-b9ef-c1a631ab0a00",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.link }}",
                "rightValue": "/receipt/"
              }
            ]
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "2da9e7c0-8954-442a-a33c-a942cd634b27",
        "name": "Do nothing on other emails",
        "type": "n8n-nodes-base.noOp",
        "position": [
          640,
          80
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "dd837661-97af-4abc-8b44-a10931cda54c",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          160,
          -280
        ],
        "parameters": {
          "height": 440,
          "content": "## Setup\n1. Setup your **Gmail** and **Google Drive** credentials\n1. Create a free account at https://pdflayer.com/\n2. Insert your **pdflayer** API key into the `Setup` node\n3. Insert the URL to the wanted drive folder into the setup node (make sure to remove everything after the `?`)"
        },
        "typeVersion": 1
      },
      {
        "id": "8de9b630-0a5f-4d2c-ac7f-e3264314a97c",
        "name": "Setup",
        "type": "n8n-nodes-base.set",
        "position": [
          220,
          0
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "86a22cf3-262a-4089-88ab-fafc01307bb4",
                "name": "api_key",
                "type": "string",
                "value": "{{ your_key_here }}"
              },
              {
                "id": "4cca07a2-6a70-4011-a025-65246e652fb9",
                "name": "url_to_drive_folder",
                "type": "string",
                "value": "{{ folder_URL }}"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "b06860a4-3895-4a28-9365-71c31f220d10",
        "name": "Download Invoice PDF from URL",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1200,
          -120
        ],
        "parameters": {
          "url": "http://api.pdflayer.com/api/convert",
          "options": {},
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "access_key",
                "value": "={{ $('Setup').first().json.api_key }}"
              },
              {
                "name": "document_url",
                "value": "={{ $json.link }}"
              },
              {
                "name": "page_size",
                "value": "A4"
              }
            ]
          }
        },
        "typeVersion": 4.2,
        "alwaysOutputData": true
      },
      {
        "id": "c2be351e-76ce-4bfa-8965-e41d59a6c49a",
        "name": "Rename file",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1580,
          -120
        ],
        "parameters": {
          "fileId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.id }}"
          },
          "options": {},
          "operation": "update",
          "newUpdatedFileName": "=n8n_cloud_invoice_{{ $now.format('yyyy-MM-dd') }}.pdf"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "jMxk7HGWZs6ucm5P",
            "name": "Nik's Google Drive"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "20b90e38-dd17-462c-8007-e83dcc2dc8df",
        "name": "Move to the correct folder",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1760,
          -120
        ],
        "parameters": {
          "fileId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.id }}"
          },
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "mode": "url",
            "value": "={{ $('Setup').item.json.url_to_drive_folder }}"
          },
          "operation": "move"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "jMxk7HGWZs6ucm5P",
            "name": "Nik's Google Drive"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "5c2930eb-90f8-4f4f-ae6a-638a01faccd3",
        "name": "Upload PDF to Drive",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1400,
          -120
        ],
        "parameters": {
          "url": "https://www.googleapis.com/upload/drive/v3/files",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "sendQuery": true,
          "contentType": "binaryData",
          "authentication": "predefinedCredentialType",
          "queryParameters": {
            "parameters": [
              {
                "name": "uploadType",
                "value": "media"
              }
            ]
          },
          "inputDataFieldName": "data",
          "nodeCredentialType": "googleDriveOAuth2Api"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "jMxk7HGWZs6ucm5P",
            "name": "Nik's Google Drive"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "1806abe4-d80e-4ab8-8303-6b92d569aac5",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1353.6776457357505,
          -255.65646735405625
        ],
        "parameters": {
          "color": 7,
          "width": 608.5129596994967,
          "height": 306.2353014680544,
          "content": "## Adjust me\nYou can adjust this part and save the file wherever you want. E.g. you could save it in your local file system by using the `Read/Write Files from Disk` node or save it in Dropbox by using the `Dropbox` node. You could even email the PDF to the right person instead."
        },
        "typeVersion": 1
      },
      {
        "id": "efa55724-3b42-4abd-a30a-ad7e9836ede5",
        "name": "Extract \"a-tags\" from email",
        "type": "n8n-nodes-base.html",
        "position": [
          640,
          -120
        ],
        "parameters": {
          "options": {},
          "operation": "extractHtmlContent",
          "dataPropertyName": "html",
          "extractionValues": {
            "values": [
              {
                "key": "link",
                "attribute": "href",
                "cssSelector": "a",
                "returnArray": true,
                "returnValue": "attribute"
              }
            ]
          }
        },
        "typeVersion": 1.2
      }
    ],
    "pinData": {
      "Gmail Trigger": [
        {
          "id": "19198ee012d8f882",
          "to": {
            "html": "<span class=\"mp_address_group\"><span class=\"mp_address_name\">Niklas Hatje</span> &lt;<a href=\"mailto:niklas@n8n.io\" class=\"mp_address_email\">niklas@n8n.io</a>&gt;</span>",
            "text": "\"Niklas Hatje\" <niklas@n8n.io>",
            "value": [
              {
                "name": "Niklas Hatje",
                "address": "niklas@n8n.io"
              }
            ]
          },
          "date": "2024-08-28T12:20:20.000Z",
          "from": {
            "html": "<span class=\"mp_address_group\"><span class=\"mp_address_name\">Niklas Hatje</span> &lt;<a href=\"mailto:niklas@n8n.io\" class=\"mp_address_email\">niklas@n8n.io</a>&gt;</span>",
            "text": "\"Niklas Hatje\" <niklas@n8n.io>",
            "value": [
              {
                "name": "Niklas Hatje",
                "address": "help@paddle.com"
              }
            ]
          },
          "html": "<div dir=\"ltr\"><br><br><div class=\"gmail_quote\"><div dir=\"ltr\" class=\"gmail_attr\">---------- Forwarded message ---------<br>From: <strong class=\"gmail_sendername\" dir=\"auto\">n8n Sandbox (via Paddle.com)</strong> <span dir=\"auto\">&lt;<a href=\"mailto:help@paddle.com\">help@paddle.com</a>&gt;</span><br>Date: Thu, Oct 12, 2023 at 3:30‚ÄØAM<br>Subject: Your invoice<br>To:  &lt;<a href=\"mailto:niklas%2B12may2023@n8n.io\">niklas+12may2023@n8n.io</a>&gt;<br></div><br><br><div class=\"msg940821289515909318\">\n        \n        \n  \n        \n        \n        \n        \n      \n      \n      \n      <div style=\"letter-spacing:0;background-color:#f5f5f8;margin:0;padding:0;font-family:Lato,Helvetica,Roboto,sans-serif\"><center style=\"margin:0\">\n    <table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"max-width:600px;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n        <tbody><tr>\n            <td height=\"100%\" width=\"100%\" style=\"padding:0\">\n                <table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-top:0\">\n                    <tbody><tr>\n                        <td height=\"30\" class=\"m_940821289515909318mJJIf\" style=\"height:30px\"></td>\n                    </tr>\n                </tbody></table>\n                <center style=\"margin:0\">\n                    <table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"max-width:600px;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                        <tbody><tr>\n                            <td height=\"100%\" width=\"100%\" style=\"padding:0\">\n                                <table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin:0;border-top:0;border-radius:0;background-color:#ffffff\" bgcolor=\"#FFFFFF\">\n                                    <tbody><tr>\n                                        <td align=\"center\" valign=\"top\">\n                                            <table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                <tbody><tr>\n                                                    <td style=\"padding:50px\" class=\"m_940821289515909318dsRHJY\">\n                                                        <table style=\"max-width:none;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\">\n                                                            <tbody><tr>\n                                                                <td align=\"center\" style=\"text-align:left\"><img height=\"70\" src=\"https://sandbox-static.paddle.com/assets/images/checkout/default_product_icon.png\" style=\"display:block;margin:auto;margin-bottom:28px\">\n                                                                    <div>\n                                                                        \n                                                                    </div>\n                                                                    <h3 style=\"font-weight:900;font-size:24px;line-height:32px;margin-bottom:12px;text-align:center;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Beleg f√ºr Ihr Cloud Pro-1-Abonnement</h3>\n                                                                    <p style=\"font-size:14px;font-weight:500;line-height:24px;margin-bottom:24px;text-align:center;margin-top:0;margin-right:0;margin-left:0;color:#73809c;font-family:Lato,Helvetica,Roboto,sans-serif\">Beleg Nr. 624743-6710887</p>\n                                                                    <table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                        <tbody><tr style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                            <td class=\"m_940821289515909318ecARAV\" style=\"vertical-align:top;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" valign=\"top\">\n                                                                                <p style=\"font-size:12px;font-weight:500;line-height:24px;margin-bottom:0;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Betrag</p>\n                                                                                <p style=\"font-size:14px;font-weight:900;line-height:24px;margin-bottom:4px;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">50,00 $</p>\n                                                                            </td>\n                                                                            <td class=\"m_940821289515909318dnuTcc\" style=\"vertical-align:top;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" valign=\"top\">\n                                                                                <p style=\"font-size:12px;font-weight:500;line-height:24px;margin-bottom:0;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Beleg Datum</p>\n                                                                                <p style=\"font-size:14px;font-weight:900;line-height:24px;margin-bottom:4px;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">12. Oktober 2023</p>\n                                                                            </td>\n                                                                            <td class=\"m_940821289515909318dnuTcc\" style=\"vertical-align:top;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" valign=\"top\">\n                                                                                <p style=\"font-size:12px;font-weight:500;line-height:24px;margin-bottom:0;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Bezahlmethode</p>\n                                                                                <table role=\"presentation\" style=\"min-width:150px\">\n                                                                                    <tbody>\n                                                                                        <tr>\n                                                                                            <td style=\"vertical-align:middle;margin-right:4px\"><img height=\"28\" src=\"https://cdn.paddle.com/email-templates/images/icon-visa.png\" alt=\"visa\" style=\"display:block\"></td>\n                                                                                            <td style=\"vertical-align:middle\"><img height=\"28\" alt=\"visa\" src=\"https://cdn.paddle.com/email-templates/images/icon-visa.png\" style=\"display:none;margin-right:4px\"></td>\n                                                                                            <td style=\"vertical-align:middle\"><img height=\"28\" alt=\"visa\" src=\"https://cdn.paddle.com/email-templates/images/icon-visa-dark-mode.png\" style=\"display:none\"></td>\n                                                                                                <td style=\"vertical-align:middle\">\n                                                                                                    <p style=\"font-size:14px;font-weight:900;line-height:24px;margin-bottom:4px;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">mit Endziffern 4242</p>\n                                                                                                </td>\n                                                                                        </tr>\n                                                                                    </tbody>\n                                                                                </table>\n                                                                            </td>\n                                                                        </tr>\n                                                                    </tbody></table>\n                                                                    <table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-top:0\">\n                                                                        <tbody><tr>\n                                                                            <td height=\"26\" class=\"m_940821289515909318bibbXQ\" style=\"height:26px\"></td>\n                                                                        </tr>\n                                                                    </tbody></table>                                                                    <table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" class=\"m_940821289515909318dNxHHs\" style=\"border:1px solid #d2d4de;border-top-right-radius:4px;border-top-left-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0;border-collapse:separate;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                        <tbody style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                                <tr style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                                    <td class=\"m_940821289515909318idljME\" style=\"color:#45567c;line-height:20px;padding:20px 28px 16px 28px;text-align:left;font-weight:900;font-size:14px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"left\">\n                                                                                        <p style=\"margin-top:0;margin-bottom:0;font-size:14px;font-weight:500;line-height:20px;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Cloud Pro-1 </p>\n                                                                                    </td>\n                                                                                    <td class=\"m_940821289515909318cwzaMf\" style=\"color:#45567c;line-height:20px;padding:20px 28px 16px 28px;text-align:right;font-weight:900;font-size:14px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"right\">\n                                                                                        <p style=\"margin-top:0;margin-bottom:0;font-size:14px;font-weight:500;line-height:20px;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">42,02 $</p>\n                                                                                    </td>\n                                                                                </tr>                                                                                \n                                                                                                                                                            \n                                                                            <tr style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                                <td class=\"m_940821289515909318joqGUf\" style=\"color:#45567c;line-height:20px;padding:20px 28px 0 28px;text-align:left;font-weight:200;font-size:11px;border-top:1px solid #d2d4de;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"left\"></td>\n                                                                                <td class=\"m_940821289515909318joqGUf\" style=\"color:#45567c;line-height:20px;padding:20px 28px 0 28px;text-align:left;font-weight:200;font-size:11px;border-top:1px solid #d2d4de;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"left\"></td>\n                                                                            </tr>\n                                                                                <tr style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                                    <td class=\"m_940821289515909318kTjnKY\" style=\"color:#45567c;line-height:20px;padding:0 28px 12px 28px;text-align:left;font-weight:500;font-size:14px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"left\">\n                                                                                        <p style=\"margin-top:0;margin-bottom:0;font-size:14px;font-weight:500;line-height:20px;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">MwSt. (19%)</p>\n                                                                                    </td>\n                                                                                    <td class=\"m_940821289515909318cGUKLL\" style=\"color:#45567c;line-height:20px;padding:0 28px 12px 28px;text-align:right;font-weight:500;font-size:14px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"right\">\n                                                                                        <p style=\"margin-top:0;margin-bottom:0;font-size:14px;font-weight:500;line-height:20px;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">7,98 $</p>\n                                                                                    </td>\n                                                                                </tr>\n                                                                            <tr style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                                <td class=\"m_940821289515909318fVuKma\" style=\"color:#45567c;line-height:20px;padding:0 28px 20px 28px;text-align:left;font-weight:500;font-size:14px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"left\">\n                                                                                    <p style=\"margin-top:0;margin-bottom:0;font-size:14px;font-weight:900;line-height:20px;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Betrag</p>\n                                                                                </td>\n                                                                                <td class=\"m_940821289515909318bWUSjt\" style=\"color:#45567c;line-height:20px;padding:0 28px 20px 28px;text-align:right;font-weight:900;font-size:14px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"right\">\n                                                                                    <p style=\"margin-top:0;margin-bottom:0;font-size:14px;font-weight:900;line-height:20px;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">50,00 $</p>\n                                                                                </td>\n                                                                            </tr>\n                                                                        </tbody>\n                                                                    </table>\n                                                                    <table style=\"border:1px solid #d2d4de;border-top-right-radius:0;border-top-left-radius:0;border-bottom-right-radius:4px;border-bottom-left-radius:4px;border-collapse:separate;margin-bottom:40px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" class=\"m_940821289515909318kpydUo\">\n                                                                        <tbody style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                            <tr style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                                <td class=\"m_940821289515909318bORRIC\" style=\"color:#45567c;line-height:20px;padding:15px;text-align:center;font-weight:200;font-size:11px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"center\">\n                                                                                    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" style=\"text-align:center;width:100%\" width=\"100%\" align=\"center\">\n                                                                                        <tbody><tr>\n                                                                                            <td style=\"border-radius:&#39;50px&#39;;text-align:&#39;center&#39;\" align=\"&#39;center&#39;\">\n                                                                                                <div>\n                                                                                                    <div>\n                                                                                                        \n                                                                                                    </div><a href=\"http://sandbox-my.paddle.com/receipt/624743-6710887/1448886-chre844ceca16cc-47fea87994\" width=\"216px\" class=\"m_940821289515909318icPhtA\" style=\"background-color:#0096ff;border:2px solid none;border-radius:4px;color:#ffffff;display:inline-block;font-size:16px;font-weight:900;line-height:44px;padding-top:0;padding-right:0;padding-left:0;padding-bottom:0;margin-bottom:0;text-align:center;text-decoration:none;width:216px;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" target=\"_blank\"><span style=\"color:#ffffff\">Beleg ansehen</span></a>\n                                                                                                </div>\n                                                                                            </td>\n                                                                                        </tr>\n                                                                                    </tbody></table>\n                                                                                        <p style=\"font-size:12px;font-weight:500;line-height:20px;margin-top:0;margin-right:0;margin-bottom:10px;margin-left:0;color:#73809c;margin:12px 13px 5px 13px;font-family:Lato,Helvetica,Roboto,sans-serif\">Die 50,00 $-Zahlung wird auf Ihrem Kontoauszug/Ihrer Kreditkartenabrechnung wie folgt angezeigt: <br><b style=\"font-weight:700\"><a href=\"http://PADDLE.NET\" target=\"_blank\">PADDLE.NET</a>* N8N STAGE</b></p>\n                                                                                </td>\n                                                                            </tr><tr style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                                                                                <td class=\"m_940821289515909318iXHUu\" style=\"color:#45567c;line-height:20px;padding:0px;text-align:left;font-weight:200;font-size:11px;border-top:0;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" align=\"left\"></td>\n                                                                            </tr>\n                                                            </tbody></table></td></tr>\n                                                            \n                                                        </tbody></table>                                                        <hr style=\"margin:40px 0;border:none;border-bottom:1px solid #a2abbd;margin-top:0;margin-bottom:10px;border-bottom-color:#d2d4de\">\n                                                        <p style=\"font-size:14px;font-weight:500;line-height:24px;margin-top:0;margin-right:0;margin-bottom:10px;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Falls Sie Hilfe mit Ihrem Cloud Pro-1-Abonnement ben√∂tigen, kontaktieren Sie uns bitte unter <a href=\"https://paddle.net?h=5ff337a9e53874c895f99e498a540988a2ce498555eb6029bc33f138f3042d3950d915ee7d8146ceaef5\" style=\"text-decoration:none;color:#3fb0ff\" target=\"_blank\">paddle.net</a> oder antworten Sie auf diese <a href=\"mailto:help@paddle.com?subject=Re:+Your++invoice\" style=\"text-decoration:none;color:#3fb0ff\" target=\"_blank\">E-Mail</a>.</p>\n                                                        <hr style=\"margin:40px 0;border:none;border-bottom:1px solid #a2abbd;margin-top:2px;margin-bottom:28px;border-bottom-color:#d2d4de\">                                                        <p style=\"font-size:14px;font-weight:500;line-height:24px;margin-bottom:0;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">Mit freundlichen Gr√º√üen,</p>\n                                                        <p style=\"font-size:14px;font-weight:500;line-height:24px;margin-bottom:0;margin-top:0;margin-right:0;margin-left:0;color:#45567c;font-family:Lato,Helvetica,Roboto,sans-serif\">n8n Sandbox</p>\n                                                    </td>\n                                                </tr>\n                                            </tbody></table>\n                                        </td>\n                                    </tr>\n                                </tbody></table>\n                            </td>\n                        </tr>\n                    </tbody></table>\n            </center></td>\n        </tr>\n    </tbody></table>\n</center>\n<table class=\"m_940821289515909318footerContainer\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin:0;border-top:0;border-radius:0;background-color:#f5f5f8\" bgcolor=\"#F5F5F8\">\n    <tbody><tr>\n        <td align=\"center\" valign=\"top\">\n            <table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\">\n                <tbody><tr>\n                    <td style=\"padding:35px\" class=\"m_940821289515909318dsRHJY\">\n                        <table style=\"max-width:none;font-family:&#39;Lato&#39;,&#39;Helvetica&#39;,&#39;Roboto&#39;,sans-serif\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\">\n                            <tbody><tr>\n                                <td align=\"center\"><img width=\"95\" height=\"30\" src=\"https://cdn.paddle.com/email-templates/images/paddle-logo-light.png\" alt=\"logo\" style=\"margin-bottom:10px\">\n                                    <div style=\"display:none\"><img width=\"95\" height=\"30\" src=\"https://cdn.paddle.com/email-templates/images/paddle-logo-light.png\" alt=\"logo\" style=\"display:none;margin-bottom:10px\"></div>\n                                    <div style=\"display:none\"><img width=\"95\" height=\"30\" src=\"https://cdn.paddle.com/email-templates/images/paddle-logo-dark.png\" alt=\"logo\" style=\"display:none;margin-bottom:10px\"></div>\n                                    <div class=\"m_940821289515909318jKMVET\" style=\"display:none\">\n                                        <p style=\"margin-bottom:0;font-weight:500;font-size:12px;line-height:20px;margin-top:0;margin-right:0;margin-left:0;color:#a2abbd;font-family:Lato,Helvetica,Roboto,sans-serif\">Paddle.com Market Ltd, Judd House, 18-29 Mora Street, London EC1V 8BT. ¬© 2023 Paddle. All rights reserved.</p>\n                                    </div>\n                                    <div class=\"m_940821289515909318hNHNzH\" style=\"display:block\">\n                                        <p style=\"margin-bottom:0;font-weight:500;font-size:12px;line-height:20px;margin-top:0;margin-right:0;margin-left:0;color:#a2abbd;font-family:Lato,Helvetica,Roboto,sans-serif\">Paddle.com Market Ltd, Judd House, 18-29 Mora Street, London EC1V 8BT </p>\n                                        <p style=\"margin-bottom:0;font-weight:500;font-size:12px;line-height:20px;margin-top:0;margin-right:0;margin-left:0;color:#a2abbd;font-family:Lato,Helvetica,Roboto,sans-serif\">¬© 2023 Paddle. All rights reserved.</p>\n                                    </div>\n                                        <table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-top:0\">\n                                            <tbody><tr>\n                                                <td height=\"10\" class=\"m_940821289515909318hSDLeU\" style=\"height:10px\"></td>\n                                            </tr>\n                                        </tbody></table>\n                                        <p id=\"m_940821289515909318order-id\" style=\"margin-bottom:0;font-weight:500;font-size:12px;line-height:20px;margin-top:0;margin-right:0;margin-left:0;color:#a2abbd;font-family:Lato,Helvetica,Roboto,sans-serif\">624743-6710887</p>\n                                    <div style=\"display:none\">\n                                        <u></u>Your invoice<u></u>\n                                        <div id=\"m_940821289515909318paddle-lang\">de</div>\n                                        <div id=\"m_940821289515909318paddle-type\">subscription-receipt</div>\n                                        <div id=\"m_940821289515909318paddle-sub-type\">recurring</div>\n                                        <div id=\"m_940821289515909318paddle-hash\">5ff337a9e53874c895f99e498a540988a2ce498555eb6029bc33f138f3042d3950d915ee7d8146ceaef5</div>\n                                    </div>\n                                </td>\n                            </tr>\n                        </tbody></table>\n                    </td>\n                </tr>\n            </tbody></table>\n        </td>\n    </tr>\n</tbody></table>\n\n\n\n<img src=\"https://ea.pstmrk.it/open?m=v3_1.qcT0BSoIS8So_NHmVqXvsQ.W2XinJpIizdNVDECCGgn99CzpHs6N8NLNJJ4IgiOd46xuf6yKLgk7mLXkeHmXAZJkNfzXusj-7f_LdlDA4qWujrr0tpiQvgZvMNBlziAzes7Ebf8RRztySfwp2x58IHuexri7mOvl2ol1Nbp7pbW5zjtkrWOEo-GHOOhNdRWcb-gx846QnXn0PqD9OZAhujKYIx2Gtb7GAmY9lOdRStvEZW_D5AS2ArYQU3voRNIsr_ZsU3wPIei-J96GzvWrG7zdSRP2kaqaY9uthTqmPcl2DeNGiespHR7e_qCwlhaeKvLUHeC7ot9Dgx6X185wbz3fCvaQebDsv9beDJHweppkc5AT0a54EqEeBW5maLWAo2RnEqIOK-icYjVgbtpKuHDdIcnFp6MqbWm6HyYQyPgy_RS6-YpzE3KUBMN77ME7o30VEA3izNgSyesQDk3JZG7zqn4ndjsTIrT0uxMXekFjNOs38vDwwJ8_1FBwokJUxZUO6JNrWTpDiXu2nDK5iH_pC8LhChw97Yo7FQA8f44ag\" width=\"1\" height=\"1\" border=\"0\" alt=\"\"></div></div></div></div>\n",
          "text": "---------- Forwarded message ---------\nFrom: n8n Sandbox (via Paddle.com) <help@paddle.com>\nDate: Thu, Oct 12, 2023 at 3:30‚ÄØAM\nSubject: Your invoice\nTo: <niklas+12may2023@n8n.io>\n\n\nBeleg f√ºr Ihr Cloud Pro-1-Abonnement\n\nBeleg Nr. 624743-6710887\n\nBetrag\n\n50,00 $\n\nBeleg Datum\n\n12. Oktober 2023\n\nBezahlmethode\n[image: visa] [image: visa] [image: visa]\n\nmit Endziffern 4242\n\nCloud Pro-1\n\n42,02 $\n\nMwSt. (19%)\n\n7,98 $\n\nBetrag\n\n50,00 $\nBeleg ansehen\n<http://sandbox-my.paddle.com/receipt/624743-6710887/1448886-chre844ceca16cc-47fea87994>\n\nDie 50,00 $-Zahlung wird auf Ihrem Kontoauszug/Ihrer Kreditkartenabrechnung\nwie folgt angezeigt:\n*PADDLE.NET <http://PADDLE.NET>* N8N STAGE*\n------------------------------\n\nFalls Sie Hilfe mit Ihrem Cloud Pro-1-Abonnement ben√∂tigen, kontaktieren\nSie uns bitte unter paddle.net\n<https://paddle.net?h=5ff337a9e53874c895f99e498a540988a2ce498555eb6029bc33f138f3042d3950d915ee7d8146ceaef5>\noder antworten Sie auf diese E-Mail\n<help@paddle.com?subject=Re:+Your++invoice>.\n------------------------------\n\nMit freundlichen Gr√º√üen,\n\nn8n Sandbox\n[image: logo]\n[image: logo]\n[image: logo]\n\nPaddle.com Market Ltd, Judd House, 18-29 Mora Street, London EC1V 8BT. ¬©\n2023 Paddle. All rights reserved.\n\nPaddle.com Market Ltd, Judd House, 18-29 Mora Street, London EC1V 8BT\n\n¬© 2023 Paddle. All rights reserved.\n\n624743-6710887\nYour invoice\nde\nsubscription-receipt\nrecurring\n5ff337a9e53874c895f99e498a540988a2ce498555eb6029bc33f138f3042d3950d915ee7d8146ceaef5\n",
          "headers": {
            "to": "To: Niklas Hatje <niklas@n8n.io>",
            "date": "Date: Wed, 28 Aug 2024 14:20:20 +0200",
            "from": "From: Niklas Hatje <niklas@n8n.io>",
            "subject": "Subject: Fwd: Your invoice",
            "message-id": "Message-ID: <CAMmGHAVOEo4znp5x=XdDHsaqsPC+Kvg70f6YqiO9DsuAS_d4Jg@mail.gmail.com>",
            "references": "References: <2a560e95-b888-44fd-99f6-3b2ef12e8d95@mtasv.net>",
            "in-reply-to": "In-Reply-To: <2a560e95-b888-44fd-99f6-3b2ef12e8d95@mtasv.net>",
            "content-type": "Content-Type: multipart/alternative; boundary=\"000000000000b159ff0620bd6127\"",
            "mime-version": "MIME-Version: 1.0"
          },
          "subject": "Fwd: Your invoice",
          "labelIds": [
            "UNREAD",
            "IMPORTANT",
            "SENT",
            "INBOX"
          ],
          "threadId": "18b21819526d9ccc",
          "inReplyTo": "<2a560e95-b888-44fd-99f6-3b2ef12e8d95@mtasv.net>",
          "messageId": "<CAMmGHAVOEo4znp5x=XdDHsaqsPC+Kvg70f6YqiO9DsuAS_d4Jg@mail.gmail.com>",
          "references": "<2a560e95-b888-44fd-99f6-3b2ef12e8d95@mtasv.net>",
          "textAsHtml": "<p>---------- Forwarded message ---------<br/>From: n8n Sandbox (via <a href=\"http://Paddle.com\">Paddle.com</a>) &lt;<a href=\"mailto:help@paddle.com\">help@paddle.com</a>&gt;<br/>Date: Thu, Oct 12, 2023 at 3:30&#x202F;AM<br/>Subject: Your invoice<br/>To: &lt;<a href=\"mailto:niklas+12may2023@n8n.io\">niklas+12may2023@n8n.io</a>&gt;</p><p>Beleg f&uuml;r Ihr Cloud Pro-1-Abonnement</p><p>Beleg Nr. 624743-6710887</p><p>Betrag</p><p>50,00 $</p><p>Beleg Datum</p><p>12. Oktober 2023</p><p>Bezahlmethode<br/>[image: visa] [image: visa] [image: visa]</p><p>mit Endziffern 4242</p><p>Cloud Pro-1</p><p>42,02 $</p><p>MwSt. (19%)</p><p>7,98 $</p><p>Betrag</p><p>50,00 $<br/>Beleg ansehen<br/>&lt;<a href=\"http://sandbox-my.paddle.com/receipt/624743-6710887/1448886-chre844ceca16cc-47fea87994\">http://sandbox-my.paddle.com/receipt/624743-6710887/1448886-chre844ceca16cc-47fea87994</a>&gt;</p><p>Die 50,00 $-Zahlung wird auf Ihrem Kontoauszug/Ihrer Kreditkartenabrechnung<br/>wie folgt angezeigt:<br/>*<a href=\"http://PADDLE.NET\">PADDLE.NET</a> &lt;<a href=\"http://PADDLE.NET\">http://PADDLE.NET</a>&gt;* N8N STAGE*<br/>------------------------------</p><p>Falls Sie Hilfe mit Ihrem Cloud Pro-1-Abonnement ben&ouml;tigen, kontaktieren<br/>Sie uns bitte unter <a href=\"http://paddle.net\">paddle.net</a><br/>&lt;<a href=\"https://paddle.net?h=5ff337a9e53874c895f99e498a540988a2ce498555eb6029bc33f138f3042d3950d915ee7d8146ceaef5\">https://paddle.net?h=5ff337a9e53874c895f99e498a540988a2ce498555eb6029bc33f138f3042d3950d915ee7d8146ceaef5</a>&gt;<br/>oder antworten Sie auf diese E-Mail<br/>&lt;<a href=\"mailto:help@paddle.com\">help@paddle.com</a>?subject=Re:+Your++invoice&gt;.<br/>------------------------------</p><p>Mit freundlichen Gr&uuml;&szlig;en,</p><p>n8n Sandbox<br/>[image: logo]<br/>[image: logo]<br/>[image: logo]</p><p><a href=\"http://Paddle.com\">Paddle.com</a> Market Ltd, Judd House, 18-29 Mora Street, London EC1V 8BT. &copy;<br/>2023 Paddle. All rights reserved.</p><p><a href=\"http://Paddle.com\">Paddle.com</a> Market Ltd, Judd House, 18-29 Mora Street, London EC1V 8BT</p><p>&copy; 2023 Paddle. All rights reserved.</p><p>624743-6710887<br/>Your invoice<br/>de<br/>subscription-receipt<br/>recurring<br/>5ff337a9e53874c895f99e498a540988a2ce498555eb6029bc33f138f3042d3950d915ee7d8146ceaef5</p>",
          "sizeEstimate": 30783
        }
      ]
    },
    "connections": {
      "Setup": {
        "main": [
          [
            {
              "node": "Only n8n Paddle invoice mails",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Only keep invoice link",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rename file": {
        "main": [
          [
            {
              "node": "Move to the correct folder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Setup",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload PDF to Drive": {
        "main": [
          [
            {
              "node": "Rename file",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Only keep invoice link": {
        "main": [
          [
            {
              "node": "Download Invoice PDF from URL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract \"a-tags\" from email": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Invoice PDF from URL": {
        "main": [
          [
            {
              "node": "Upload PDF to Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Only n8n Paddle invoice mails": {
        "main": [
          [
            {
              "node": "Extract \"a-tags\" from email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Do nothing on other emails",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "353ac65d120d2007b8a1503e85a96651a9b2cbb94b0334693ebac2129fa6a7ee",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "b4438922-5dfd-44a7-838b-1d91be3dd032",
        "name": "Container HTTP Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4220,
          240
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $json.node }}/media",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "image_url",
                "value": "={{ $json.image_url }}"
              },
              {
                "name": "caption",
                "value": "={{ $json.caption }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "9350ff43-ae98-4165-98cc-2781937ca2af",
        "name": "Container HTTP Reels",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4220,
          1500
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $json.node }}/media",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "media_type",
                "value": "=REELS"
              },
              {
                "name": "video_url",
                "value": "={{ $json.video_url }}"
              },
              {
                "name": "caption",
                "value": "={{ $json.caption }}"
              },
              {
                "name": "cover_url",
                "value": "={{ $json.cover_image }}"
              },
              {
                "name": "audio_name",
                "value": "Monody (feat. Laura Brehm)"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "4706d54a-b294-46af-b6af-ee4b751af246",
        "name": "Container FB Image",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          -4220,
          440
        ],
        "parameters": {
          "edge": "media",
          "node": "={{ $json.node }}",
          "options": {
            "queryParameters": {
              "parameter": [
                {
                  "name": "caption",
                  "value": "={{ $json.caption }}"
                },
                {
                  "name": "image_url",
                  "value": "={{ $json.image_url }}"
                }
              ]
            }
          },
          "graphApiVersion": "v22.0",
          "httpRequestMethod": "POST"
        },
        "credentials": {
          "facebookGraphApi": {
            "id": "YeGWCZ0amouHAnaI",
            "name": "IG lakshitukani Login (n8n Integration 2)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "bc067bab-2652-4667-a0bc-afe1bc009af0",
        "name": "Container FB Story Image",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          -4220,
          840
        ],
        "parameters": {
          "edge": "media",
          "node": "={{ $json.node }}",
          "options": {
            "queryParameters": {
              "parameter": [
                {
                  "name": "caption",
                  "value": "={{ $json.caption }}"
                },
                {
                  "name": "image_url",
                  "value": "={{ $json.image_url }}"
                },
                {
                  "name": "media_type",
                  "value": "STORIES"
                }
              ]
            }
          },
          "graphApiVersion": "v22.0",
          "httpRequestMethod": "POST"
        },
        "credentials": {
          "facebookGraphApi": {
            "id": "YeGWCZ0amouHAnaI",
            "name": "IG lakshitukani Login (n8n Integration 2)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "0781252a-0145-4659-9c53-7ad130842711",
        "name": "Container HTTP Story Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4220,
          680
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $json.node }}/media",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "media_type",
                "value": "=STORIES"
              },
              {
                "name": "image_url",
                "value": "={{ $json.image_url }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "f47c2dcc-e0d1-457e-8741-c5952cf61606",
        "name": "Container FB Reels",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          -4220,
          1640
        ],
        "parameters": {
          "edge": "media",
          "node": "=17841456545908024",
          "options": {
            "queryParameters": {
              "parameter": [
                {
                  "name": "caption",
                  "value": "={{ $json.caption }}"
                },
                {
                  "name": "video_url",
                  "value": "={{ $json.video_url }}"
                },
                {
                  "name": "media_type",
                  "value": "REELS"
                },
                {
                  "name": "cover_url",
                  "value": "={{ $json.cover_image }}"
                }
              ]
            }
          },
          "graphApiVersion": "v22.0",
          "httpRequestMethod": "POST"
        },
        "credentials": {
          "facebookGraphApi": {
            "id": "YeGWCZ0amouHAnaI",
            "name": "IG lakshitukani Login (n8n Integration 2)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "fa81d7f3-d5c0-402d-8741-70b09656a5fc",
        "name": "Container HTTP Story Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4220,
          1080
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $json.node }}/media",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "media_type",
                "value": "=STORIES"
              },
              {
                "name": "video_url",
                "value": "={{ $json.video_url }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "f6a8ec74-68f2-4b9e-a5dc-b3f0d7ecf5d2",
        "name": "Container FB Story Video",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          -4220,
          1240
        ],
        "parameters": {
          "edge": "media",
          "node": "={{ $json.node }}",
          "options": {
            "queryParameters": {
              "parameter": [
                {
                  "name": "video_url",
                  "value": "={{ $json.video_url }}"
                },
                {
                  "name": "media_type",
                  "value": "STORIES"
                }
              ]
            }
          },
          "graphApiVersion": "v22.0",
          "httpRequestMethod": "POST"
        },
        "credentials": {
          "facebookGraphApi": {
            "id": "YeGWCZ0amouHAnaI",
            "name": "IG lakshitukani Login (n8n Integration 2)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "43cc35cd-6f96-4db1-9b6d-11e1fa7d529b",
        "name": "Container Carousel Image 1",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4660,
          1880
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $json.node }}/media",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "image_url",
                "value": "={{ $json.image_url }}"
              },
              {
                "name": "caption",
                "value": "={{ $json.caption }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "fa54a3d6-2e93-445f-9c6c-6643eb181d07",
        "name": "Container Carousel Image 2",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4440,
          1880
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $('üîÄ Smart Content Router').item.json.node }}/media",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "image_url",
                "value": "=https://4.img-dpreview.com/files/p/TC190x190S190x190~sample_galleries/0890568360/4504013564.jpg"
              },
              {
                "name": "caption",
                "value": "={{ $('üîÄ Smart Content Router').item.json.caption }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "7f1a40cb-79b9-4af1-b41c-5eb26e19ebc7",
        "name": "Container HTTP Carousel",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4220,
          1880
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $('üîÄ Smart Content Router').item.json.node }}/media",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "children",
                "value": "={{ $('Container Carousel Image 1').item.json.id }}, {{ $json.id }}"
              },
              {
                "name": "caption",
                "value": "={{ $('üîÄ Smart Content Router').item.json.caption }}"
              },
              {
                "name": "media_type",
                "value": "CAROUSEL"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "0472b36a-76c6-4f1d-840b-1cc6d44aaeef",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4360,
          180
        ],
        "parameters": {
          "width": 400,
          "height": 420,
          "content": "## üì∏ Image Post Creation"
        },
        "typeVersion": 1
      },
      {
        "id": "9bd43a33-0ce2-4b70-a6e8-82b770388bfd",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4360,
          620
        ],
        "parameters": {
          "width": 400,
          "height": 380,
          "content": "## üì± Story Image Upload"
        },
        "typeVersion": 1
      },
      {
        "id": "1fe2c077-d86b-4ce9-b04e-b33c5f515d98",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4360,
          1020
        ],
        "parameters": {
          "width": 400,
          "height": 380,
          "content": "## üé¨ Story Video Upload"
        },
        "typeVersion": 1
      },
      {
        "id": "72c5e2d9-c8a1-45ed-9856-99cef03ee29c",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4360,
          1420
        ],
        "parameters": {
          "width": 400,
          "height": 380,
          "content": "## üéµ Instagram Reels Upload"
        },
        "typeVersion": 1
      },
      {
        "id": "0fb7ead7-7eec-40af-9242-59e514c31e3d",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4820,
          1820
        ],
        "parameters": {
          "width": 860,
          "height": 220,
          "content": "## üñºÔ∏è Carousel Post (Multiple Images)"
        },
        "typeVersion": 1
      },
      {
        "id": "9284f2a3-f2a2-4f0d-bc3a-9affaf54b871",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -5380,
          760
        ],
        "parameters": {
          "color": 3,
          "width": 840,
          "height": 640,
          "content": "## Variable and Routing Setup"
        },
        "typeVersion": 1
      },
      {
        "id": "f6c099a8-bc27-4636-b857-c380d0f99766",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3700,
          840
        ],
        "parameters": {
          "color": 6,
          "width": 1140,
          "height": 540,
          "content": "## üîÑ Container Processing Pipeline\n1. **Create Container** ‚Üí After Getting Container ID\n2. **Wait & Poll** ‚Üí Check if container processing is complete  \n3. **Status Check** ‚Üí Verify FINISHED status before publishing\n4. **Auto-Retry** ‚Üí If not ready, wait and check again"
        },
        "typeVersion": 1
      },
      {
        "id": "db361414-e90c-4a71-b353-f837a76f4b6f",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2520,
          840
        ],
        "parameters": {
          "color": 4,
          "width": 580,
          "height": 540,
          "content": "## üì§ Smart Publishing System\nRoute automatically selected based on post_type prefix:\n- http_* ‚Üí Uses HTTP Request nodes\n- fb_* ‚Üí Uses Facebook Graph API nodes"
        },
        "typeVersion": 1
      },
      {
        "id": "a27e2ffc-b8e2-4501-a9ba-bc8f31efd92e",
        "name": "‚úÖ Is Container Ready?",
        "type": "n8n-nodes-base.if",
        "position": [
          -2960,
          960
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "682def4c-2cda-4417-9329-682a8a60feed",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status_code }}",
                "rightValue": "FINISHED"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "a42df401-c1e9-4194-9c76-a03c26b1c09c",
        "name": "üîÄ HTTP vs FB API Router",
        "type": "n8n-nodes-base.if",
        "position": [
          -2460,
          1040
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "da6bcb63-632a-443a-b5b3-a8b6e1c62871",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $('üîÄ Smart Content Router').item.json.post_type.split(\"_\")[0] }}",
                "rightValue": "http"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "10905c0b-ff3c-4aed-b741-652dd1847fac",
        "name": "üì§ Publish via HTTP API",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -2240,
          940
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $('üîÄ Smart Content Router').item.json.node }}/media_publish",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "creation_id",
                "value": "={{ $json.id }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "hWVD8Wl5GEMhDj4z",
            "name": "lakshitukani IG Account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "24948258-f1b0-4e47-92b1-4282b88dbf14",
        "name": "üì§ Publish via Facebook SDK",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          -2240,
          1140
        ],
        "parameters": {
          "edge": "media_publish",
          "node": "={{ $('üîÄ Smart Content Router').item.json.node }}",
          "options": {
            "queryParameters": {
              "parameter": [
                {
                  "name": "creation_id",
                  "value": "={{ $json.id }}"
                }
              ]
            }
          },
          "graphApiVersion": "v22.0",
          "httpRequestMethod": "POST"
        },
        "credentials": {
          "facebookGraphApi": {
            "id": "YeGWCZ0amouHAnaI",
            "name": "IG lakshitukani Login (n8n Integration 2)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "90e80bc1-81ab-43dc-b764-2850284ec9e9",
        "name": "‚è∞ Initial Processing Wait",
        "type": "n8n-nodes-base.wait",
        "position": [
          -3440,
          1040
        ],
        "webhookId": "443f84eb-1e9d-4c77-9a9a-c70290333dca",
        "parameters": {},
        "typeVersion": 1.1
      },
      {
        "id": "9db2f610-29ba-46ad-858d-80f909b8ecf7",
        "name": "‚è∞ Retry Wait Loop",
        "type": "n8n-nodes-base.wait",
        "position": [
          -2740,
          1140
        ],
        "webhookId": "e9ac0c1d-b415-4160-a6b1-908d2310cb23",
        "parameters": {},
        "typeVersion": 1.1
      },
      {
        "id": "6aa81fe8-430c-4a06-a9a7-863c568390f2",
        "name": "üîç Check Processing Status",
        "type": "n8n-nodes-base.set",
        "position": [
          -3660,
          1040
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "37f96da8-a8b6-417b-b5cf-7a4df5b4610c",
                "name": "container_id",
                "type": "string",
                "value": "={{ $json.id }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "4327071b-4646-4044-8003-b16720a759be",
        "name": "üîÄ Smart Content Router",
        "type": "n8n-nodes-base.switch",
        "position": [
          -4880,
          900
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "HTTP - Image",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "ab388a77-1660-4a64-ba58-bc405444dbd5",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "http_image"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "FB - Image",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "be8816f5-ae68-48c3-869e-bc67078298d8",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "fb_image"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "HTTP - Story Img",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "663bacc8-ceeb-4f81-b058-c379eaf6e717",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "http_story_image"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "FB - Story Image",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "99441a51-906e-469a-b98e-64aa43c996ba",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "fb_story_image"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "HTTP = Story Video",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "29cfc5f8-e1ae-4c10-8961-2356d7c13195",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "http_story_video"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "FB - Story Video",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "578f5df3-23ef-4ef3-9a48-7528c826ea46",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "fb_story_video"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "HTTP - Reels",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "25e31619-4116-46e0-bfcb-a8d8a030fa68",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "http_reel"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "FB - Reels",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "cf34e931-f798-4c70-af29-9aec7aab8f6c",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "fb_reel"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "HTTP - Carousel",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "02944863-db4b-445f-9c03-382abd9525b9",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "http_carousel"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "FB - Carousel",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "0a17aaa0-8520-442f-9c3f-b4112339a08c",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.post_type }}",
                      "rightValue": "fb_carousel"
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "f27ef907-cdab-401d-b8ec-e244f63aada0",
        "name": "üöÄ Manual Trigger - Start Workflow",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -5320,
          1040
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "cb1562d5-2e46-4299-a93d-d9a283c720d3",
        "name": "‚öôÔ∏è Configure Post Settings",
        "type": "n8n-nodes-base.set",
        "position": [
          -5100,
          1040
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "217b69e3-98ec-49a2-8fde-372dd1bc1848",
                "name": "node",
                "type": "string",
                "value": "17841456545908024"
              },
              {
                "id": "2caebe7c-a2d3-428e-b129-fcfbe66854e5",
                "name": "post_type",
                "type": "string",
                "value": "http_reel"
              },
              {
                "id": "a17a5c94-d9ae-44f8-9d56-fb55d17efe5a",
                "name": "image_url",
                "type": "string",
                "value": "https://media.licdn.com/dms/image/v2/D4D03AQHf-K7ergkUwQ/profile-displayphoto-shrink_800_800/B4DZbdtDouHQAg-/0/1747476298728?e=1753920000&v=beta&t=Js1KDjpDYOgzYW4YlhwT1_ZmbggoSIxjcq3IA0rRJs0"
              },
              {
                "id": "6e2c9c54-ce2c-4ea5-8bb2-ae2ae4712427",
                "name": "caption",
                "type": "string",
                "value": "Automated Post"
              },
              {
                "id": "32aa1561-458c-4f64-a854-eab65f9ad1dd",
                "name": "video_url",
                "type": "string",
                "value": "https://videos.pexels.com/video-files/4434242/4434242-sd_360_640_24fps.mp4"
              },
              {
                "id": "c6485101-488b-43db-8708-1a1136292956",
                "name": "cover_image",
                "type": "string",
                "value": "https://cdn.pixabay.com/photo/2023/11/07/22/59/building-8373618_1280.jpg"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "38e0d117-e4b0-429d-b263-41ee141c71a2",
        "name": "üîç Check Processing Status1",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -3180,
          1040
        ],
        "parameters": {
          "url": "=https://graph.facebook.com/v22.0/{{ $('üîç Check Processing Status').item.json.container_id }}",
          "options": {},
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpQueryAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "fields",
                "value": "status_code"
              }
            ]
          }
        },
        "credentials": {
          "httpQueryAuth": {
            "id": "teNjcIVMpXV90H7T",
            "name": "IG lakshitukani (n8n integration)"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "7cfc1f61-8318-479e-b763-6d218d04be6c",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -5260,
          160
        ],
        "parameters": {
          "color": 2,
          "width": 460,
          "height": 380,
          "content": "## üë®‚Äçüíª Creator Information\n\n**Created by:** Lakshit Ukani  \nüîó **LinkedIn:** [Connect with me](https://www.linkedin.com/in/lakshit-ukani/)\nüîó **Youtube:** [Subscribe to my Channel](https://www.youtube.com/@lakshit-ukani?sub_confirmation=1)\n\n### ü§ù Community & Support\nüí¨ **Join Community:** [Skool Community Link](https://www.skool.com/ai-automation-club-7843)   \nüìö **Documentation:** [Full Guide & FAQ](https://developers.facebook.com/docs/instagram-platform/instagram-graph-api/reference/ig-user/media#creating)  \n\n### üìû Need Help?\n- **Quick Questions:** Comment on the YouTube video\n- **Workflow Issues:** Post in our community  \n- **Business Inquiries:** Connect via LinkedIn"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Container FB Image": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container FB Reels": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "‚è∞ Retry Wait Loop": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container HTTP Image": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container HTTP Reels": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container HTTP Carousel": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "‚úÖ Is Container Ready?": {
        "main": [
          [
            {
              "node": "üîÄ HTTP vs FB API Router",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "‚è∞ Retry Wait Loop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container FB Story Image": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container FB Story Video": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "üîÄ Smart Content Router": {
        "main": [
          [
            {
              "node": "Container HTTP Image",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container FB Image",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container HTTP Story Image",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container FB Story Image",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container HTTP Story Video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container FB Story Video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container HTTP Reels",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container FB Reels",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Container Carousel Image 1",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Container Carousel Image 1": {
        "main": [
          [
            {
              "node": "Container Carousel Image 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container Carousel Image 2": {
        "main": [
          [
            {
              "node": "Container HTTP Carousel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container HTTP Story Image": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Container HTTP Story Video": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "üîÄ HTTP vs FB API Router": {
        "main": [
          [
            {
              "node": "üì§ Publish via HTTP API",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "üì§ Publish via Facebook SDK",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "‚è∞ Initial Processing Wait": {
        "main": [
          [
            {
              "node": "üîç Check Processing Status1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "üîç Check Processing Status": {
        "main": [
          [
            {
              "node": "‚è∞ Initial Processing Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "üîç Check Processing Status1": {
        "main": [
          [
            {
              "node": "‚úÖ Is Container Ready?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "‚öôÔ∏è Configure Post Settings": {
        "main": [
          [
            {
              "node": "üîÄ Smart Content Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "üöÄ Manual Trigger - Start Workflow": {
        "main": [
          [
            {
              "node": "‚öôÔ∏è Configure Post Settings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "DswhuYzoemjA6iNN",
    "meta": {
      "instanceId": "a1ae5c8dc6c65e674f9c3947d083abcc749ef2546dff9f4ff01de4d6a36ebfe6",
      "templateCredsSetupCompleted": true
    },
    "name": "Scrape Books from URL with Dumpling AI, Clean HTML, Save to Sheets, Email as CSV",
    "tags": [
      {
        "id": "TlcNkmb96fUfZ2eA",
        "name": "Tutorials",
        "createdAt": "2025-04-15T17:02:00.249Z",
        "updatedAt": "2025-04-15T17:02:00.249Z"
      }
    ],
    "nodes": [
      {
        "id": "2e4f64a5-353c-4dd3-9822-62df795d4940",
        "name": "Convert to CSV File",
        "type": "n8n-nodes-base.convertToFile",
        "position": [
          1640,
          340
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 1.1
      },
      {
        "id": "472442d3-a691-4310-93f8-019579d0c473",
        "name": "Extract all books from the page",
        "type": "n8n-nodes-base.html",
        "position": [
          760,
          340
        ],
        "parameters": {
          "options": {},
          "operation": "extractHtmlContent",
          "dataPropertyName": "content",
          "extractionValues": {
            "values": [
              {
                "key": "books",
                "cssSelector": ".row > li",
                "returnArray": true,
                "returnValue": "html"
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "92765257-d64d-47c9-bd57-50914342138b",
        "name": "Sort by price",
        "type": "n8n-nodes-base.sort",
        "position": [
          1420,
          340
        ],
        "parameters": {
          "options": {},
          "sortFieldsUi": {
            "sortField": [
              {
                "order": "descending",
                "fieldName": "price"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "efc2f33f-1bef-4906-b3b7-b02868080a54",
        "name": "Extract individual book price",
        "type": "n8n-nodes-base.html",
        "position": [
          1200,
          340
        ],
        "parameters": {
          "options": {},
          "operation": "extractHtmlContent",
          "dataPropertyName": "books",
          "extractionValues": {
            "values": [
              {
                "key": "title",
                "attribute": "title",
                "cssSelector": "h3 > a",
                "returnValue": "attribute"
              },
              {
                "key": "price",
                "cssSelector": ".price_color"
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "74c7c3af-d63c-4b6c-95a0-15f45b19134b",
        "name": "Send CSV via e-mail",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1860,
          340
        ],
        "webhookId": "40f2d609-52ed-40bf-b190-1f1cebbe3fb7",
        "parameters": {
          "sendTo": "",
          "message": "Hey, here's the scraped data from the online bookstore!",
          "options": {
            "attachmentsUi": {
              "attachmentsBinary": [
                {}
              ]
            }
          },
          "subject": "bookstore csv",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "j70r3RTMED1pgN3R",
            "name": "Gmail account 2"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "95c7998b-ece0-4dea-b99e-97ac22fb8a59",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          140,
          -260
        ],
        "parameters": {
          "width": 619,
          "height": 297,
          "content": "### Scrape Books from URL with Dumpling AI, Clean HTML, Save to Sheets, Email as CSV\n\nüìå This workflow scrapes book data from a website, turns it into a CSV, saves it, and sends it by email.\n\nüîß It starts from a Google Sheets trigger, fetches the page using DumplingAI, extracts books, sorts by price, and emails the CSV.\n\n‚úÖ Make sure APIs for Gmail, Sheets & Drive are enabled in Google Cloud. Update the URL in the \"Fetch website content\" node.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "f599028a-49a9-4b85-b484-5abf1229e373",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          140,
          60
        ],
        "parameters": {
          "color": 4,
          "width": 900,
          "height": 300,
          "content": "### üîÅ Trigger to Raw Book HTML\n\n1. **Google Sheets Trigger**  \n   Watches a sheet for new row entries. Once a new URL is added, the workflow starts.\n\n2. **Fetch Website Content (Dumpling AI)**  \n   Makes an HTTP POST request to Dumpling AI to scrape and return the full HTML of the target URL.\n\n3. **Extract All Books**  \n   Uses CSS selectors to isolate the list items (`li.row > li`) containing book entries.\n\n4. **Split Out Node**  \n   Breaks the array of book HTML blocks into individual items, so each book can be processed separately in the next steps.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "bc6ab72c-de03-4e79-9da0-ca12ddf31811",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1140,
          60
        ],
        "parameters": {
          "color": 6,
          "width": 840,
          "height": 300,
          "content": "### üì¶ Parse, Sort, Export & Email\n\n5. **Extract Individual Book Data**  \n   From each book, extract the title (`<h3>a` title attribute) and price (`.price_color` content).\n\n6. **Sort by Price**  \n   Organizes the extracted data in descending order using the price field.\n\n7. **Convert to CSV File**  \n   Transforms the sorted JSON data into a downloadable CSV file format.\n\n8. **Send CSV via Gmail**  \n   Automatically sends an email with the CSV file attached to the predefined address.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "a1246b4e-212f-4bd3-970b-b0ff8db2f834",
        "name": "Trigger- Watches For new URL in Spreadsheet",
        "type": "n8n-nodes-base.googleSheetsTrigger",
        "position": [
          320,
          340
        ],
        "parameters": {
          "event": "rowAdded",
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1pb4WLqv2EruLM1z9-utehcINolSj0vlUqZionyLoRUs/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1pb4WLqv2EruLM1z9-utehcINolSj0vlUqZionyLoRUs/edit?usp=drivesdk",
            "cachedResultName": "URLs"
          }
        },
        "credentials": {
          "googleSheetsTriggerOAuth2Api": {
            "id": "qDzHSzTkclwDHpSR",
            "name": "Google Sheets Trigger account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "b19aa287-3be4-4e16-908d-b0cb484519e3",
        "name": "Scrape Website Content with Dumpling AI",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          540,
          340
        ],
        "parameters": {
          "url": "https://app.dumplingai.com/api/v1/scrape",
          "method": "POST",
          "options": {
            "allowUnauthorizedCerts": true
          },
          "jsonBody": "={\n  \"url\": \"{{ $('Trigger- Watches For new URL in Spreadsheet')}}\", \n  \"format\": \"html\",\n  \"cleaned\": \"True\"\n  }",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        },
        "credentials": {
          "httpBasicAuth": {
            "id": "mznexGH3YDtrUTAk",
            "name": "Unnamed credential"
          },
          "httpHeaderAuth": {
            "id": "xamyMqCpAech5BeT",
            "name": "Header Auth account"
          }
        },
        "typeVersion": 4.1
      },
      {
        "id": "02cbc6f9-bdcb-45fc-9973-ded42346ffbc",
        "name": "Split HTML Array into Individual Books",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          980,
          340
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "books"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "264412ff-9d74-443c-a2ff-69be1e042a82",
    "connections": {
      "Sort by price": {
        "main": [
          [
            {
              "node": "Convert to CSV File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to CSV File": {
        "main": [
          [
            {
              "node": "Send CSV via e-mail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract individual book price": {
        "main": [
          [
            {
              "node": "Sort by price",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract all books from the page": {
        "main": [
          [
            {
              "node": "Split HTML Array into Individual Books",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split HTML Array into Individual Books": {
        "main": [
          [
            {
              "node": "Extract individual book price",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scrape Website Content with Dumpling AI": {
        "main": [
          [
            {
              "node": "Extract all books from the page",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Trigger- Watches For new URL in Spreadsheet": {
        "main": [
          [
            {
              "node": "Scrape Website Content with Dumpling AI",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "qhZvZVCoV3HLjRkq",
    "meta": {
      "instanceId": "a2b23892dd6989fda7c1209b381f5850373a7d2b85609624d7c2b7a092671d44",
      "templateCredsSetupCompleted": true
    },
    "name": "Google Maps FULL",
    "tags": [],
    "nodes": [
      {
        "id": "c5d63d91-ffcc-4c05-a1ee-d78ca955fc85",
        "name": "Trigger - When User Sends Message",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          -400,
          -60
        ],
        "webhookId": "e5c0f357-c0a4-4ebc-9162-0382d8009539",
        "parameters": {
          "options": {}
        },
        "typeVersion": 1.1
      },
      {
        "id": "e422761f-a662-4fef-81fe-de42cdb350fc",
        "name": "AI Agent - Lead Collection",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -160,
          -60
        ],
        "parameters": {
          "options": {
            "systemMessage": "' UNIFIED AND OPTIMIZED PROMPT FOR DATA EXTRACTION VIA GOOGLE MAPS SCRAPER\n\n' --- 1. Task ---\n' - Collect high-quality professional leads from Google Maps, including:\n'   - Business name\n'   - Address\n'   - Phone number\n'   - Website\n'   - Email\n'   - Other relevant contact details\n' - Deliver organized, accurate, and actionable data.\n\n' --- 2. Context & Collaboration ---\n' - Tools & Sources:\n'   * Google Maps Scraper: Extracts data based on location, business type, and country code \n'     (ISO 3166 Alpha-2 in lowercase).\n'   * Website Scraper: Extracts data from provided URLs (the URL must be passed exactly as received, without quotation marks).\n'   * Google Sheets: Stores and retrieves previously extracted data.\n'   * Internet Search: Provides additional information if the scraping results are incomplete.\n' - Priorities: Accuracy and efficiency, avoiding unnecessary searches.\n\n' --- 3. Ethical Guidelines ---\n' - Only extract publicly accessible professional data.\n' - Do not collect or store personal/sensitive data.\n' - Adhere to scraping policies and data protection regulations.\n' - Error Handling:\n'   * In case of failure or incomplete results, suggest a retry, adjusted search parameters, or an alternative source.\n'   * If Google Sheets is unavailable, notify the user and propose workarounds.\n\n' --- 4. Constraints ---\n' - Country codes must follow the ISO 3166 Alpha-2 format in lowercase (e.g., \"fr\" for France).\n' - When using the Website Scraper, pass the URL exactly as provided, without quotation marks or modifications.\n' - Validate and correctly format all data (no duplicates or errors).\n' - Store results in Google Sheets in an organized and accessible manner.\n\n' --- 5. Final Requirements & Quality Checks ---\n' - Verification: Ensure the country code is always passed in lowercase to the Google Maps Scraper.\n' - URL: If a URL is provided, forward it directly to the Website Scraper without adding quotation marks.\n' - Existing Data: Check Google Sheets to see if the data is already available before performing new scraping.\n' - Supplementary: In case of partial results, propose using Internet Search to complete the information.\n\n' --- 6. Interaction ---\n' - If data already exists in Google Sheets, retrieve and present it to the user instead of launching a new scrape.\n' - If scraping fails or returns incomplete results, suggest alternative actions (e.g., web search, verifying the country code).\n\n' --- 7. Examples ---\n' BAD Example (Google Maps Scraper)\n'   User: \"Find coffee shops in Paris, France.\"\n'   AI: \"Extracting coffee shop data from Google Maps in France.\"\n'   > Issue: The country code \"fr\" was not provided.\n'\n' GOOD Example (Google Maps Scraper)\n'   User: \"Find coffee shops in Paris, France.\"\n'   AI:\n'     - \"Extracting coffee shop data from Google Maps in fr (France).\"\n'     - \"Scraped 50 businesses with names, addresses, phone numbers, and websites.\"\n'     - \"Storing results in Google Sheets under Lead_Generation_Paris_FR.\"\n'\n' BAD Example (Website Scraper)\n'   User: \"Scrape data from https://www.example.com/\"\n'   AI: \"Forwarding 'https://www.example.com/' to the Website Scraper.\"\n'   > Issue: Unnecessary quotation marks around the URL.\n'\n' GOOD Example (Website Scraper)\n'   User: \"Scrape data from https://www.example.com/\"\n'   AI:\n'     - \"Forwarding https://www.example.com to the Website Scraper.\"\n'     - \"Processing data extraction and storing results in Google Sheets.\"\n\n' --- 8. Output Format ---\n' - Responses should be concise and informative.\n' - Present data in a structured manner (e.g., business name, address, phone, website, etc.).\n' - If data already exists, clearly display the retrieved information from Google Sheets.\n\n' --- Additional Context & Details ---\n'\n' You interact with scraping APIs and databases to retrieve, update, and manage lead information.\n' Always pass country information using lowercase ISO 3166 Alpha-2 format when using the Google Maps Scraper.\n' If a URL is provided, it must be passed exactly as received, without quotation marks, to the Website Scraper.\n'\n' Known details:\n' You extract business names, addresses, phone numbers, websites, emails, and other relevant contact information.\n'\n' The URL must be passed exactly as provided (e.g., https://www.example.com/) without quotation marks or formatting changes.\n' Google Maps Scraper requires location, business type, and ISO 3166 Alpha-2 country codes to extract business listings.\n'\n' Context:\n' - System environment:\n'   You have direct integration with scraping tools, Internet search capabilities, and Google Sheets.\n'   You interact with scraping APIs and databases to retrieve, update, and manage lead information.\n'\n' Role:\n' You are a Lead Generation & Web Scraping Agent.\n' Your primary responsibility is to identify, collect, and organize relevant business leads by scraping websites, Google Maps, and performing Internet searches.\n' Ensure all extracted data is structured, accurate, and stored properly for easy access and analysis.\n' You have access to two scraping tools:\n'   1. Website Scraper ‚Äì Requires only the raw URL to extract data from a specific website.\n'      - The URL must be passed exactly as provided (e.g., https://www.example.com/) without quotation marks or formatting changes.\n'   2. Google Maps Scraper ‚Äì Requires location, business type, and ISO 3166 Alpha-2 country codes to extract business listings.\n\n' --- FINAL INSTRUCTIONS ---\n' 1. Adhere to all the directives and constraints above when extracting data from Google Maps (or other sources).\n' 2. Systematically check if data already exists in Google Sheets.\n' 3. In case of failure or partial results, propose an adjustment to the query or resort to Internet search.\n' 4. Ensure ethical compliance: only collect public data and do not store sensitive information.\n'\n' This prompt will guide the AI agent to efficiently extract and manage business data using Google Maps Scraper (and other mentioned tools)\n' while adhering to the structure, ISO country code standards, and ethical handling of information.\n"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "8469f6f8-e56e-433f-8439-ac0f568b01b1",
        "name": "GPT-4o - Generate & Process Requests",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -360,
          160
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "6h3DfVhNPw9I25nO",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "8f89996c-f5d1-48e3-8023-9c5d4c8db12a",
        "name": "Memory - Track Recent Context",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          -180,
          160
        ],
        "parameters": {
          "contextWindowLength": 50
        },
        "typeVersion": 1.3
      },
      {
        "id": "ef32b577-47a2-489f-8b5a-3640126a0ff9",
        "name": "Tool - Scrape Google Maps Business Data",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          160,
          160
        ],
        "parameters": {
          "name": "extract_google_maps",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "9rD7iD6sbXqDX44S",
            "cachedResultName": "Google Maps - sous 1 - Extract Google maps"
          },
          "description": "Extract data from hundreds of places fast. Scrape Google Maps by keyword, category, location, URLs & other filters. Get addresses, contact info, opening hours, popular times, prices, menus & more. Export scraped data, run the scraper via API, schedule and monitor runs, or integrate with other tools.",
          "workflowInputs": {
            "value": {
              "city": "={{ $fromAI('city', ``, 'string') }}",
              "search": "={{ $fromAI('search', ``, 'string') }}",
              "countryCode": "={{ $fromAI('countryCode', ``, 'string') }}",
              "state/county": "={{ $fromAI('state_county', ``, 'string') }}"
            },
            "schema": [
              {
                "id": "search",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "search",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "city",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "city",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "state/county",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "state/county",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "countryCode",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "countryCode",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "86a6eafe-9ffc-4d58-85f7-eef7171eeb8e",
        "name": "Fallback - Enrich with Google Search",
        "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
        "position": [
          -20,
          160
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "serpApi": {
            "id": "FlfGC4PlqpLMJYRU",
            "name": "SerpAPI account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "37409653-0409-4f2d-8105-9216f974f6a8",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -780,
          -200
        ],
        "parameters": {
          "width": 1300,
          "height": 540,
          "content": "# AI-Powered Lead Generation Workflow\n\nThis workflow extracts business data from Google Maps and associated websites using an AI agent.\n\n## Dependencies\n- **OpenAI API**\n- **Google Sheets API**\n- **Apify Actors**: Google Maps Scraper \n- **Apify Actors**: Website Content Crawler\n- **SerpAPI**: Used as a fallback to enrich data\n\n## External Setup Guide\n**Notion** : [Guide](https://automatisation.notion.site/GOOGLE-MAPS-SCRAPER-1cc3d6550fd98005a99cea02986e7b05)\n"
        },
        "typeVersion": 1
      },
      {
        "id": "0b42dfae-49e6-4117-8a5d-d1f396f22dcb",
        "name": "Tool - Crawl Business Website",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          340,
          160
        ],
        "parameters": {
          "name": "Website_Content_Crawler",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "I7KceT8Mg1lW7BW4",
            "cachedResultName": "Google Maps - sous 2 - Extract Google"
          },
          "description": "Crawl websites and extract text content to feed AI models, LLM applications, vector databases, or RAG pipelines. The Actor supports rich formatting using Markdown, cleans the HTML, downloads files, and integrates well with ü¶úüîó LangChain, LlamaIndex, and the wider LLM ecosystem.",
          "workflowInputs": {
            "value": {},
            "schema": [],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "8a713b20-99e6-4df1-88ce-698ffc3c1e31",
        "name": "Trigger - On Subworkflow Start",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "position": [
          -460,
          520
        ],
        "parameters": {
          "inputSource": "jsonExample",
          "jsonExample": "{\n  \"search\": \"carpenter\",\n  \"city\": \"san francisco\",\n  \"state/county\": \"california\",\n  \"countryCode\": \"us\"\n}"
        },
        "typeVersion": 1.1
      },
      {
        "id": "59af012d-de3f-4a44-b3ad-e587857b554d",
        "name": "Scrape Google Maps (via Apify)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -240,
          520
        ],
        "parameters": {
          "url": "https://api.apify.com/v2/acts/2Mdma1N6Fd0y3QEjR/run-sync-get-dataset-items",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n    \"city\": \"{{ $json.city }}\",\n    \"countryCode\": \"{{ $json.countryCode }}\",\n    \"locationQuery\": \"{{ $json.city }}\",\n    \"maxCrawledPlacesPerSearch\": 5,\n    \"searchStringsArray\": [\n        \"{{ $json.search }}\"\n    ],\n    \"skipClosedPlaces\": false\n}",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Authorization",
                "value": "Bearer <token>"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "b1c40871-aa57-4b15-9f19-34a07dc6c45f",
        "name": "Save Extracted Data to Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -20,
          520
        ],
        "parameters": {
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "",
            "cachedResultUrl": "",
            "cachedResultName": ""
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "51us92xkOlrvArhV",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.5
      },
      {
        "id": "679f2af5-0024-4a71-8c04-dcbccc8f00c8",
        "name": "Aggregate Business Listings",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          200,
          520
        ],
        "parameters": {
          "options": {},
          "aggregate": "aggregateAllItemData"
        },
        "typeVersion": 1
      },
      {
        "id": "dff1191a-b9f4-4ba6-ba42-a479fab76a5b",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -780,
          380
        ],
        "parameters": {
          "color": 4,
          "width": 1300,
          "height": 440,
          "content": "# üìç Google Maps Extractor Subworkflow\n\nThis subworkflow handles business data extraction from Google Maps using the Apify Google Maps Scraper.\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Purpose\n- Automates the collection of business leads based on:\n  - Search term (e.g., plumber, agency)\n  - City and region\n  - ISO 3166 Alpha-2 country code"
        },
        "typeVersion": 1
      },
      {
        "id": "dd691f9c-15e2-4b4a-a6eb-8765905a2cb4",
        "name": "Scrape Website Content (via Apify)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -320,
          1000
        ],
        "parameters": {
          "url": "https://api.apify.com/v2/acts/aYG0l9s7dbB7j3gbS/run-sync-get-dataset-items",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n    \"aggressivePrune\": false,\n    \"clickElementsCssSelector\": \"[aria-expanded=\\\"false\\\"]\",\n    \"clientSideMinChangePercentage\": 15,\n    \"crawlerType\": \"playwright:adaptive\",\n    \"debugLog\": false,\n    \"debugMode\": false,\n    \"expandIframes\": true,\n    \"ignoreCanonicalUrl\": false,\n    \"keepUrlFragments\": false,\n    \"proxyConfiguration\": {\n        \"useApifyProxy\": true\n    },\n    \"readableTextCharThreshold\": 100,\n    \"removeCookieWarnings\": true,\n    \"removeElementsCssSelector\": \"nav, footer, script, style, noscript, svg, img[src^='data:'],\\n[role=\\\"alert\\\"],\\n[role=\\\"banner\\\"],\\n[role=\\\"dialog\\\"],\\n[role=\\\"alertdialog\\\"],\\n[role=\\\"region\\\"][aria-label*=\\\"skip\\\" i],\\n[aria-modal=\\\"true\\\"]\",\n    \"renderingTypeDetectionPercentage\": 10,\n    \"saveFiles\": false,\n    \"saveHtml\": false,\n    \"saveHtmlAsFile\": false,\n    \"saveMarkdown\": true,\n    \"saveScreenshots\": false,\n    \"startUrls\": [\n        {\n            \"url\": \"{{ $json.query }}\",\n            \"method\": \"GET\"\n        }\n    ],\n    \"useSitemaps\": false\n}",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Authorization",
                "value": "Bearer YOUR_TOKEN_HERE"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "7cc813a7-e1a5-40fe-a76a-3e52438cf2f4",
        "name": "Save Website Data to Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -100,
          1000
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [
              {
                "id": "url",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "crawl",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "crawl",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "metadata",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "metadata",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "screenshotUrl",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "screenshotUrl",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "text",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "text",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "markdown",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "markdown",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "debug",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "debug",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "autoMapInputData",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 1886744055,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1JewfKbdS6gJhVFz0Maz6jpoDxQrByKyy77I5s7UvLD4/edit#gid=1886744055",
            "cachedResultName": "MYWEBBASE"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1JewfKbdS6gJhVFz0Maz6jpoDxQrByKyy77I5s7UvLD4",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1JewfKbdS6gJhVFz0Maz6jpoDxQrByKyy77I5s7UvLD4/edit?usp=drivesdk",
            "cachedResultName": "GoogleMaps_LEADS"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "51us92xkOlrvArhV",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.5
      },
      {
        "id": "6c20b427-48e8-4ba1-885e-7db71406a0db",
        "name": "Aggregate Website Content",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          120,
          1000
        ],
        "parameters": {
          "options": {},
          "aggregate": "aggregateAllItemData"
        },
        "typeVersion": 1
      },
      {
        "id": "7b1ff556-f212-4ab5-9995-deeb83f68da4",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -780,
          860
        ],
        "parameters": {
          "color": 5,
          "width": 1300,
          "height": 400,
          "content": "# üåê Website Content Crawler Subworkflow\n\nThis subworkflow processes URLs to extract readable website content using Apify's Website Content Crawler.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Purpose\n- Extracts detailed and structured content from business websites.\n- Enhances leads with enriched, on-site information."
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "fd75b3e6-1dba-4e01-8c95-fdd9dd07fac4",
    "connections": {
      "Memory - Track Recent Context": {
        "ai_memory": [
          [
            {
              "node": "AI Agent - Lead Collection",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Tool - Crawl Business Website": {
        "ai_tool": [
          [
            {
              "node": "AI Agent - Lead Collection",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Scrape Google Maps (via Apify)": {
        "main": [
          [
            {
              "node": "Save Extracted Data to Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Trigger - On Subworkflow Start": {
        "main": [
          [
            {
              "node": "Scrape Google Maps (via Apify)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Trigger - When User Sends Message": {
        "main": [
          [
            {
              "node": "AI Agent - Lead Collection",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Website Data to Google Sheets": {
        "main": [
          [
            {
              "node": "Aggregate Website Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scrape Website Content (via Apify)": {
        "main": [
          [
            {
              "node": "Save Website Data to Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fallback - Enrich with Google Search": {
        "ai_tool": [
          [
            {
              "node": "AI Agent - Lead Collection",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "GPT-4o - Generate & Process Requests": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent - Lead Collection",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Save Extracted Data to Google Sheets": {
        "main": [
          [
            {
              "node": "Aggregate Business Listings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tool - Scrape Google Maps Business Data": {
        "ai_tool": [
          [
            {
              "node": "AI Agent - Lead Collection",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "1eadd5bc7c3d70c587c28f782511fd898c6bf6d97963d92e836019d2039d1c79"
    },
    "nodes": [
      {
        "id": "58da2884-6dd9-446e-beca-cacae1e8df7c",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          4940,
          340
        ],
        "parameters": {
          "color": 4,
          "width": 1280,
          "height": 320,
          "content": "=======================================\n            WORKFLOW ASSISTANCE\n=======================================\nFor any questions or support, please contact:\n    Yaron@nofluff.online\n\nExplore more tips and tutorials here:\n   - YouTube: https://www.youtube.com/@YaronBeen/videos\n   - LinkedIn: https://www.linkedin.com/in/yaronbeen/\n=======================================\nBright Data Docs: https://docs.brightdata.com/introduction\n"
        },
        "typeVersion": 1
      },
      {
        "id": "d2aa5abc-6a8b-4ad3-9b87-1349f3dd80b9",
        "name": "Snapshot Progress",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          7540,
          760
        ],
        "parameters": {
          "url": "=https://api.brightdata.com/datasets/v3/progress/{{ $('HTTP Request- Post API call to Bright Data').item.json.snapshot_id }}",
          "options": {},
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer <YOUR_BRIGHT_DATA_API_KEY>"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "fba84a88-1775-4bc9-85cb-1bda621b4c2c",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          8600,
          540
        ],
        "parameters": {
          "width": 195,
          "height": 646,
          "content": "In this workflow, I use Google Sheets to store the results. \n\nYou can use my template to get started faster:\n\n1. [Click on this link to get the template](https://docs.google.com/spreadsheets/d/1IR-yMQwEFTjbTCSPvVlQ54zQsnG0IRauTjPGoBWmR8U/edit?usp=sharing)\n2. Make a copy of the Sheets\n3. Add the URL to this node \n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "4b235825-1445-42d1-a9fa-d017974819fe",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          6560,
          840
        ],
        "parameters": {
          "width": 220,
          "height": 440,
          "content": "Add your competitors Amazon link here.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "d6a75b46-e968-4dab-962d-1f81b643b768",
        "name": "HTTP Request- Post API call to Bright Data",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          6920,
          840
        ],
        "parameters": {
          "url": "https://api.brightdata.com/datasets/v3/trigger",
          "method": "POST",
          "options": {},
          "jsonBody": "=[\n  {\n    \"url\": \"{{ $json['Amazon Product URL'] }}\"\n  }\n]",
          "sendBody": true,
          "sendQuery": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "queryParameters": {
            "parameters": [
              {
                "name": "dataset_id",
                "value": "gd_le8e811kzy4ggddlq"
              },
              {
                "name": "include_errors",
                "value": "true"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer <YOUR_BRIGHT_DATA_API_KEY>"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "50a6c73a-dd82-40af-ad5a-88ef4fd5fc7c",
        "name": "Wait - Polling Bright Data",
        "type": "n8n-nodes-base.wait",
        "position": [
          7300,
          760
        ],
        "webhookId": "8005a2b3-2195-479e-badb-d90e4240e699",
        "parameters": {
          "unit": "minutes",
          "amount": 1
        },
        "executeOnce": false,
        "typeVersion": 1.1
      },
      {
        "id": "8af8f713-6d5d-4113-ad5e-86b29fc8f441",
        "name": "If - Checking status of Snapshot - if data is ready or not",
        "type": "n8n-nodes-base.if",
        "position": [
          7740,
          760
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "7932282b-71bb-4bbb-ab73-4978e554de7e",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status }}",
                "rightValue": "running"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "98166378-3766-4c69-b891-48891a18e175",
        "name": "HTTP Request - Getting data from Bright Data",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          8020,
          780
        ],
        "parameters": {
          "url": "=https://api.brightdata.com/datasets/v3/snapshot/{{ $('HTTP Request- Post API call to Bright Data').item.json.snapshot_id }}",
          "options": {},
          "sendQuery": true,
          "sendHeaders": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "format",
                "value": "json"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer <YOUR_BRIGHT_DATA_API_KEY>"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "217cc982-0550-4e27-afd5-12b46eafcd04",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          7240,
          620
        ],
        "parameters": {
          "color": 4,
          "width": 940,
          "height": 400,
          "content": "Bright Data Getting Reviews\n"
        },
        "typeVersion": 1
      },
      {
        "id": "5fd57531-25f4-4b10-9d95-bbeda1b336cf",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          9620,
          1060
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "MX2lQOZcGpmRvdVD",
            "name": "OpenAi account 2"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "d79c7504-0ccc-4491-bf7a-3697b31fa71a",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          9480,
          600
        ],
        "parameters": {
          "width": 360,
          "height": 820,
          "content": "Adjust This Prompt with:\n1. Add info about your company and offer.\n\n2. The template requires the LLM to generate a summary of recent reviews but you can adjust it\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "413669e5-2b75-499d-ba00-766b3cce0d69",
        "name": "Google Sheets - Adding All Reviews",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          8640,
          840
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [
              {
                "id": "url",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "product_name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "product_name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "product_rating",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "product_rating",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "product_rating_object",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "product_rating_object",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "product_rating_max",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "product_rating_max",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "rating",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "rating",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "author_name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "author_name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "asin",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "asin",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "product_rating_count",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "product_rating_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "review_header",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "review_header",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "review_id",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "review_id",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "review_text",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "review_text",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "author_id",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "author_id",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "author_link",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "author_link",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "badge",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "badge",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "brand",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "brand",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "review_posted_date",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "review_posted_date",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "review_country",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "review_country",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "review_images",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "review_images",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "helpful_count",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "helpful_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "is_amazon_vine",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "is_amazon_vine",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "is_verified",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "is_verified",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "variant_asin",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "variant_asin",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "variant_name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "variant_name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "videos",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "videos",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "timestamp",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "timestamp",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "input",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "input",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "autoMapInputData",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IR-yMQwEFTjbTCSPvVlQ54zQsnG0IRauTjPGoBWmR8U/edit#gid=0",
            "cachedResultName": "input"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1IR-yMQwEFTjbTCSPvVlQ54zQsnG0IRauTjPGoBWmR8U",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1IR-yMQwEFTjbTCSPvVlQ54zQsnG0IRauTjPGoBWmR8U/edit?usp=drivesdk",
            "cachedResultName": "NoFluff-N8N-Sheet-Template- AMAZON Reviews Scraping WIth Bright Data"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "4RJOMlGAcB9ZoYfm",
            "name": "Google Sheets account 2"
          }
        },
        "typeVersion": 4.3,
        "alwaysOutputData": true
      },
      {
        "id": "e1d58479-4008-4801-8523-fa2304ea9ef0",
        "name": "On form submission - Amazon Reviews",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          6620,
          980
        ],
        "webhookId": "8d0269c7-d1fc-45a1-a411-19634a1e0b82",
        "parameters": {
          "options": {},
          "formTitle": "Please Paste The URL of the Amazon Product",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Amazon Product URL",
                "placeholder": "https://www.amazon.com/Quencher-Cupholder-Compatible-Insulated-Stainless/dp/B0DCDQ1RFV",
                "requiredField": true
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "2d79e9d2-a867-447e-91f9-b90c2e56427a",
        "name": "Aggregating all reviews",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          9140,
          840
        ],
        "parameters": {
          "options": {},
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "renameField": true,
                "outputFieldName": "Aggregated_reviews",
                "fieldToAggregate": "review_text"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "937ef1c4-32b3-4966-abb4-f4ae09aa12a7",
        "name": "Basic LLM Chain - Summary of Recent reviews",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          9520,
          840
        ],
        "parameters": {
          "text": "=Read the following reviews, these are reviews of our competitors:\n{{ $json.Aggregated_reviews }}\n\n---\nAfter reading them, summarize their weakest points.\nDon't mention the competitor name.\n\n",
          "promptType": "define"
        },
        "typeVersion": 1.6
      },
      {
        "id": "2ccf1e0f-a738-44ee-bd8f-65a02a92ca91",
        "name": "OpenAI- Generating image",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          10160,
          840
        ],
        "parameters": {
          "prompt": "={\n  \"ad_dimensions\": {\n    \"width\": 1080,\n    \"height\": 1080\n  },\n  \"target_audience\": \"B2C customer\",\n  \"pain_points_source\": \"choose one pain point based on this {{ $json.text }}\",\n  \"ad_requirements\": {\n    \"image_style\": \"weird-and-fun\",\n    \"weird_objects\": [\n      \"Fruit with Faces\",\n      \"Realistic People\"\n    ],\n    \"focus\": \"address the biggest pain point of competitors\",\n    \"avoid_naming_competitors\": true,\n    \"headline\": {\n      \"position\": \"No\",\n      \"text_only\": \"No\",\n      \"other_text\": \"No\"\n    },\n    \"background\": [\n      \"bold red\",\n      \"black\"\n    ]\n  }\n}",
          "options": {},
          "resource": "image"
        },
        "credentials": {
          "openAiApi": {
            "id": "MX2lQOZcGpmRvdVD",
            "name": "OpenAi account 2"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "ebb11f25-66f5-495e-a7bc-4212c6db10d5",
        "name": "Gmail - Sending creative to Media Buyers",
        "type": "n8n-nodes-base.gmail",
        "position": [
          10580,
          840
        ],
        "webhookId": "41184a90-65fd-49a8-b0de-d838b94c790c",
        "parameters": {
          "sendTo": "yaron.been@gmail.com",
          "message": "=Hey, \n\nWe have analyzed our competitors recent reviews.\nAnalysis data:\n{{ $today }}\n\nHere's a summary:\n{{ $('Basic LLM Chain - Summary of Recent reviews').item.json.text }}\n\nPlease see attached an AI generated 1080x1080 image which you can use in Meta ads.\n\n",
          "options": {
            "attachmentsUi": {
              "attachmentsBinary": [
                {}
              ]
            }
          },
          "subject": "=Static Creatives Based on Our competitor {{ $now }}",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "TLJ5oxgGtoxdGOTZ",
            "name": "Gmail account 2"
          }
        },
        "typeVersion": 2.1
      }
    ],
    "pinData": {
      "Basic LLM Chain - Summary of Recent reviews": [
        {
          "text": "The reviews highlight several common weaknesses among the products:\n\n1. **Quality Control Issues**: Some customers reported receiving cups with dents or damages upon arrival, raising concerns about packaging and quality assurance during shipping.\n\n2. **Durability Concerns**: While many praised the durability, a few mentioned that the cups could spill if tipped over, indicating that they might not be fully leak-proof.\n\n3. **Ease of Use**: Several users experienced difficulties with lids getting stuck or indicated that the tumblers are not spill-proof, particularly when used for non-water beverages.\n\n4. **Size and Weight**: A few reviewers commented on the heaviness of larger sizes, suggesting they may not be convenient for frequent carrying, especially for those with smaller bags or during outings.\n\n5. **Cleaning Issues**: Some users noted that certain models could be challenging to clean, particularly if not hand-washed to maintain appearance.\n\n6. **Authenticity Doubts**: There were instances where customers questioned the authenticity of the product based on packaging or markings, which could affect their overall satisfaction.\n\n7. **Price**: A few reviewers mentioned that while the products are of good quality, they are considered pricey, leading to questions about whether the value matches the cost. \n\nOverall, despite many positive comments, issues related to packaging, spillability, and price emerged as notable weaknesses."
        }
      ]
    },
    "connections": {
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Basic LLM Chain - Summary of Recent reviews",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Snapshot Progress": {
        "main": [
          [
            {
              "node": "If - Checking status of Snapshot - if data is ready or not",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregating all reviews": {
        "main": [
          [
            {
              "node": "Basic LLM Chain - Summary of Recent reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI- Generating image": {
        "main": [
          [
            {
              "node": "Gmail - Sending creative to Media Buyers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait - Polling Bright Data": {
        "main": [
          [
            {
              "node": "Snapshot Progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets - Adding All Reviews": {
        "main": [
          [
            {
              "node": "Aggregating all reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On form submission - Amazon Reviews": {
        "main": [
          [
            {
              "node": "HTTP Request- Post API call to Bright Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request- Post API call to Bright Data": {
        "main": [
          [
            {
              "node": "Wait - Polling Bright Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Basic LLM Chain - Summary of Recent reviews": {
        "main": [
          [
            {
              "node": "OpenAI- Generating image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request - Getting data from Bright Data": {
        "main": [
          [
            {
              "node": "Google Sheets - Adding All Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If - Checking status of Snapshot - if data is ready or not": {
        "main": [
          [
            {
              "node": "Wait - Polling Bright Data",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request - Getting data from Bright Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "UkKQ9WAMrgGbWCJw",
    "meta": {
      "instanceId": "de822f81f3a2367cef7d9549771a77783236bc9596481be2ae65c05fbcc4b4fd",
      "templateId": "10120",
      "templateCredsSetupCompleted": true
    },
    "name": "üí• Automate Scrape Google Maps Business Leads (Email, Phone, Website) using Apify -vide II",
    "tags": [],
    "nodes": [
      {
        "id": "b15db5d0-22ad-4ec2-8c7f-45ec329e70f8",
        "name": "Get dataset items",
        "type": "@apify/n8n-nodes-apify.apify",
        "position": [
          -1440,
          4032
        ],
        "parameters": {
          "limit": {},
          "offset": {},
          "resource": "Datasets",
          "datasetId": "={{ $json.defaultDatasetId }}"
        },
        "typeVersion": 1
      },
      {
        "id": "12f5d055-2bac-4f1b-872f-5dc96016519c",
        "name": "Remove Duplicates",
        "type": "n8n-nodes-base.removeDuplicates",
        "position": [
          -1200,
          4032
        ],
        "parameters": {
          "compare": "selectedFields",
          "options": {},
          "fieldsToCompare": "title"
        },
        "typeVersion": 2
      },
      {
        "id": "6084326e-000e-49d4-8d01-939b25ff3c6d",
        "name": "Run Google Maps Scraper",
        "type": "@apify/n8n-nodes-apify.apify",
        "position": [
          -1680,
          4032
        ],
        "parameters": {
          "actorId": {
            "__rl": true,
            "mode": "list",
            "value": "nwua9Gu5YrADL7ZDj",
            "cachedResultUrl": "https://console.apify.com/actors/nwua9Gu5YrADL7ZDj/input",
            "cachedResultName": "Google Maps Scraper (compass/crawler-google-places)"
          },
          "timeout": {},
          "customBody": "={\n    \"includeWebResults\": false,\n    \"language\": \"fr\",\n    \"locationQuery\": \"\",\n    \"maxCrawledPlacesPerSearch\": {{ $('Extract Input Data').item.json.limit }},\n    \"maxImages\": 0,\n    \"maximumLeadsEnrichmentRecords\": 0,\n    \"scrapeContacts\": false,\n    \"scrapeDirectories\": false,\n    \"scrapeImageAuthors\": false,\n    \"scrapePlaceDetailPage\": false,\n    \"scrapeReviewsPersonalData\": true,\n    \"scrapeTableReservationProvider\": false,\n    \"searchStringsArray\": [\n        \"{{ $('Extract Input Data').item.json.sector }}\"\n    ],\n    \"skipClosedPlaces\": false,\n    \"startUrls\": [\n        {\n            \"url\": \"{{ $('Extract Input Data').item.json.mapsUrl }}\"\n        }\n    ]\n}"
        },
        "typeVersion": 1
      },
      {
        "id": "bddaee65-4adb-49d7-b552-1f1f007e670e",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          -800,
          4032
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "ddc329c2-3b9d-4759-827c-164040e54113",
        "name": "Google maps database",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -160,
          4048
        ],
        "parameters": {
          "columns": {
            "value": {
              "url": "={{ $('Loop Over Items').item.json.url }}",
              "city": "={{ $('Loop Over Items').item.json.city }}",
              "rank": "={{ $('Loop Over Items').item.json.rank }}",
              "phone": "={{ \"'\" + ($('Loop Over Items').item.json.phonesUncertain || $('Loop Over Items').item.json.phoneUnformatted || '') }}\n",
              "title": "={{ $('Loop Over Items').item.json.title }}",
              "street": "={{ $('Loop Over Items').item.json.street }}",
              "address": "={{ $('Loop Over Items').item.json.address }}",
              "website": "={{ $('Loop Over Items').item.json.website }}",
              "imageUrl": "={{ $('Loop Over Items').item.json.imageUrl }}",
              "scrapedAt": "={{ $('Loop Over Items').item.json.scrapedAt }}",
              "categories": "={{ $('Loop Over Items').item.json.categories }}",
              "postalcode": "={{ $('Loop Over Items').item.json.postalCode }}",
              "totalScore": "={{ $('Loop Over Items').item.json.totalScore }}",
              "countryCode": "={{ $('Loop Over Items').item.json.countryCode }}",
              "categoryName": "={{ $('Loop Over Items').item.json.categoryName }}",
              "isAdvertisement": "={{ $('Loop Over Items').item.json.isAdvertisement }}",
              "companySummaryIn": "={{ $json.message.content.companySummary }}",
              "phoneUnformatted": "={{ $('Loop Over Items').item.json.phonesUncertain || $('Loop Over Items').item.json.phoneUnformatted || 'No phone found' }}\n"
            },
            "schema": [
              {
                "id": "title",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "title",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "categoryName",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "categoryName",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "address",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "address",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "street",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "street",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "city",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "city",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "postalcode",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "postalcode",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "countryCode",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "countryCode",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "phone",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "phone",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "phoneUnformatted",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "phoneUnformatted",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "website",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "website",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Email",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "Email",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "totalScore",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "totalScore",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "categories",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "categories",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "scrapedAt",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "scrapedAt",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "url",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "rank",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "rank",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "isAdvertisement",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "isAdvertisement",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "imageUrl",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "imageUrl",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "companySummaryIn",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "companySummaryIn",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "f61891c7-41d7-419a-9bef-bbd81bc76733",
        "name": "Pause for rate limit",
        "type": "n8n-nodes-base.wait",
        "position": [
          960,
          4272
        ],
        "webhookId": "afe140e5-5f38-4efe-985b-4d023fafe372",
        "parameters": {
          "amount": 2
        },
        "typeVersion": 1.1
      },
      {
        "id": "28826c4c-ed52-4297-8856-395b51a51f15",
        "name": "Telegram Trigger",
        "type": "n8n-nodes-base.telegramTrigger",
        "position": [
          -2144,
          4032
        ],
        "webhookId": "3416d11d-1fcb-4b9c-9c24-7ca62e1f2be5",
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {}
        },
        "typeVersion": 1.2
      },
      {
        "id": "dc6d2155-a004-4253-ab0c-ea5974d9429c",
        "name": "Extract Input Data",
        "type": "n8n-nodes-base.code",
        "position": [
          -1920,
          4032
        ],
        "parameters": {
          "jsCode": "// Parse the Telegram message and extract three comma-separated values\nconst messageText = $input.first().json.message.text;\n\n// Split by commas and trim whitespace\nconst parts = messageText.split(';').map(part => part.trim());\n\n// Extract the three values\nconst sector = parts[0] || '';\nconst limit = parseInt(parts[1]) || 0;\nconst mapsUrl = parts[2] || '';\n\n// Return the parsed data as a JSON object\nreturn [\n  {\n    json: {\n      sector: sector,\n      limit: limit,\n      mapsUrl: mapsUrl\n    }\n  }\n];"
        },
        "typeVersion": 2
      },
      {
        "id": "bf177f41-a447-4334-9a5f-7dd7e08b9ea5",
        "name": "Notification message",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -784,
          4272
        ],
        "webhookId": "60352308-ab5f-4cd3-bd03-9b09c3d014b6",
        "parameters": {
          "text": "DONE",
          "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
          "additionalFields": {}
        },
        "typeVersion": 1.2
      },
      {
        "id": "6b940388-c1b4-490e-9f29-dfbbdac7d5a4",
        "name": "Extract Only Website URLs",
        "type": "n8n-nodes-base.set",
        "position": [
          128,
          4048
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "ccc11066-fad4-4931-acf6-6c45e5e7b117",
                "name": "Site internet",
                "type": "string",
                "value": "={{ $('Loop Over Items').first().json.website }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "097bdf79-90b3-4a75-9121-1f0d1b9d2016",
        "name": "Fetch Raw HTML Content from Business Website",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          384,
          4048
        ],
        "parameters": {
          "url": "={{ $json['Site internet'] }}",
          "options": {}
        },
        "typeVersion": 4.2
      },
      {
        "id": "452a2220-2f4f-4575-9da5-7661c35e7b72",
        "name": "Extract Business Email from Website HTML (GPT-4)",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          608,
          4048
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=You are analyzing the HTML content of a business website to extract the most relevant contact email address.\n\nYour task:\n\nExtract only one email address, ideally belonging to the business owner, manager, or main contact person.\n\nIf multiple emails appear, choose the most authoritative or professional one (e.g., not ‚Äúinfo@‚Äù or ‚Äúsupport@‚Äù unless it‚Äôs the only option).\n\nIf no valid email is found, return exactly:\nNull\n\nOutput rules:\n\nOutput only the email address (no explanation, no JSON, no punctuation, no quotes).\n\nThe result must be a clean, valid email format (e.g., contact@company.com).\n\nWebsite HTML content:\n{{ $json.data }}"
              }
            ]
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "26c43321-7082-4ff3-b0d7-ee93b607ea26",
        "name": "Email Update",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          960,
          4048
        ],
        "parameters": {
          "columns": {
            "value": {
              "Email": "={{ $json.message.content }}",
              "title": "={{ $('Loop Over Items').item.json.title }}"
            },
            "schema": [
              {
                "id": "title",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "title",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "categoryName",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "categoryName",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "address",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "address",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "street",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "street",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "city",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "city",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "postalcode",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "postalcode",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "countryCode",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "countryCode",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "phone",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "phone",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "phoneUnformatted",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "phoneUnformatted",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "website",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "website",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Email",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "Email",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "totalScore",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "totalScore",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "categories",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "categories",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "scrapedAt",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "scrapedAt",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "url",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "rank",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "rank",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "isAdvertisement",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "isAdvertisement",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "imageUrl",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "imageUrl",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "companySummaryIn",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "companySummaryIn",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "title"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "appendOrUpdate",
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "e46d3db1-f7f4-4606-b46d-ca9198061e17",
        "name": "Step 2 - Extract Input Data Documentation",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2208,
          3472
        ],
        "parameters": {
          "color": 7,
          "width": 1184,
          "height": 1056,
          "content": "## Step 1 - Extract Input Data and  Run Google Maps Scraper\n\n**Purpose:** Parses the Telegram message and extracts the three input parameters needed for the Google Maps scraper.\n\n**Configuration:**\n1. **Mode:** Run Once for All Items\n2. **Language:** JavaScript\n3. **Code Logic:**\n   - Splits the message by semicolons (;)\n   - Extracts three values: sector, limit, mapsUrl\n   - Returns structured JSON output\n\n\n**Purpose:** Executes the Apify Google Maps Scraper actor to collect business listings based on the provided search criteria.\n\n**Configuration:**\n1. **[API : Apify](https://www.apify.com?fpr=udemy)**\n2. **Resource:** Actors\n3. **Operation:** Run actor"
        },
        "typeVersion": 1
      },
      {
        "id": "a127a961-baea-4078-b05b-0f4e9d112847",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -976,
          3472
        ],
        "parameters": {
          "color": 6,
          "width": 2160,
          "height": 1056,
          "content": "## Step 2 - Google Maps Database and Extract Business Email\n\n**Purpose:** Appends the processed business data (including AI-generated summary) to a Google Sheet for storage and analysis.\n\n**Configuration:**\n1. **Resource:** Sheet\n2. **Operation:** Append\n3. **Document ID:** 1STVdZYYKCE5Rt3YS4xKlEiZ85FZqTkqIn3ebm8xskYU\n4. **Sheet Name:** Feuille 1\n5. **Columns Mapping Mode:** Define Below\n\n**Purpose:** Uses GPT-4o-mini to intelligently extract the business owner or primary contact email from the website HTML.\n\n**Configuration:**\n1. **Resource:** Text\n2. **Operation:** Message\n3. **Model:** GPT-4o-mini\n4. **Simplify Output:** Enabled\n5. **JSON Output:** Disabled (returns plain text email)"
        },
        "typeVersion": 1
      },
      {
        "id": "86a2c246-bdc1-41cb-880a-c31b62148f93",
        "name": "AI Company Description Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          -544,
          4048
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini",
            "cachedResultName": "GPT-4.1-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "=You are an AI assistant specialized in generating professional, concise, and natural company summaries from structured data scraped from Google Maps.\n\nYour goal is to transform the provided company information into a fluent, human-like paragraph suitable for business directories or lead databases.\n\nFollow these principles:\n\nMaintain a professional and informative tone.\n\nWrite in one coherent paragraph (no lists or bullet points).\n\nSmoothly omit any fields that are missing without mentioning it.\n\nThe final text must sound natural and ready for direct publication.\n\nOutput only the final summary paragraph ‚Äî no explanations, notes, or JSON."
              },
              {
                "content": "=Generate a clear and concise summary of the following company based on its Google Maps data:\n\nCompany Name: {{ $json.title }}\nCategory: {{ $json.categoryName }}\nAddress: {{ $json.address }}\nCity: {{ $json.city }}\nCountry: {{ $json.countryCode }}\nPhone: {{ $json.phones }}\nGoogle Maps URL: {{ $json.url }}\n\nWrite a natural paragraph like this example (without quotes):\n\nThe company name is [Name]. It is a [category] located at [address] in [city, country]. You can contact them at [phone]. For more details, visit their Google Maps page: [URL].\n\nEnsure the output flows naturally and excludes any missing information.\n\n"
              },
              {
                "content": "Output the result in the JSON format companySummary"
              }
            ]
          },
          "jsonOutput": true
        },
        "typeVersion": 1.8
      },
      {
        "id": "543493d6-db18-45af-a214-9085b31f48bf",
        "name": "Workflow Overview Documentation",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2832,
          3472
        ],
        "parameters": {
          "width": 592,
          "height": 1056,
          "content": "## üîÑ Google Maps Business Scraper with Email Enrichment\n\n@[youtube](cijBIHI6iLk)\n\n## **Global Purpose:**\nAutomated lead generation system that scrapes business listings from Google Maps, generates AI-powered summaries, extracts contact emails from websites, and stores everything in Google Sheets.\n\n**- [API : Apify](https://www.apify.com?fpr=udemy)** \n**- [Documentation : notion](https://automatisation.notion.site/Automate-Scrape-Google-Maps-Business-Leads-Email-Phone-Website-using-Apify-2a53d6550fd98118ba22e441171944dd?source=copy_link)** \n**- [Google Sheets : copy](https://docs.google.com/spreadsheets/d/1STVdZYYKCE5Rt3YS4xKlEiZ85FZqTkqIn3ebm8xskYU/copy)** \n\n1Ô∏è‚É£ **Extract Input Data and  Run Google Maps Scraper** \n   - Apify scrapes Google Maps for businesses\n   - Dataset retrieved with all business details\n   - Duplicates removed for data quality\n\n\n2Ô∏è‚É£ **Google Maps Database and Extract Business Email** \n   - Each business processed individually:\n     a) AI generates human-readable summary\n     b) Business data + summary saved to Sheet \n     c) Website URL extracted \n     d) Website HTML fetched \n     e) AI extracts email from HTML \n     f) Email updated in Sheet \n     g) 2-second pause before next business \n\n## üì¨ Need Help or Want to Customize This?\n**Contact me for consulting and support:** [LinkedIn](https://www.linkedin.com/in/dr-firas/) / [YouTube](https://www.youtube.com/@DRFIRASS)  / [üöÄ Mes Ateliers n8n  ](https://hotm.art/formation-n8n)"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {},
    "versionId": "29451a14-659f-4b24-affc-ca15bf7f31d6",
    "connections": {
      "Email Update": {
        "main": [
          [
            {
              "node": "Pause for rate limit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "Notification message",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Company Description Generator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Telegram Trigger": {
        "main": [
          [
            {
              "node": "Extract Input Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get dataset items": {
        "main": [
          [
            {
              "node": "Remove Duplicates",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Remove Duplicates": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Input Data": {
        "main": [
          [
            {
              "node": "Run Google Maps Scraper",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google maps database": {
        "main": [
          [
            {
              "node": "Extract Only Website URLs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pause for rate limit": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Run Google Maps Scraper": {
        "main": [
          [
            {
              "node": "Get dataset items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Only Website URLs": {
        "main": [
          [
            {
              "node": "Fetch Raw HTML Content from Business Website",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Company Description Generator": {
        "main": [
          [
            {
              "node": "Google maps database",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Raw HTML Content from Business Website": {
        "main": [
          [
            {
              "node": "Extract Business Email from Website HTML (GPT-4)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Business Email from Website HTML (GPT-4)": {
        "main": [
          [
            {
              "node": "Email Update",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "3c58c896c9089c8fb4d7f2b069bf3119193f239a1f538829758e2f4d6b5f5b24"
    },
    "nodes": [
      {
        "id": "9aa9fa6c-5ccb-4f2b-b6a8-2b91f4a58355",
        "name": "Setup",
        "type": "n8n-nodes-base.set",
        "position": [
          420,
          680
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "apiKey",
                "stringValue": "32aa914c947342169c4998b6701a77e0"
              },
              {
                "name": "newsAge",
                "type": "numberValue",
                "numberValue": "10"
              },
              {
                "name": "maxArticles",
                "stringValue": "20"
              },
              {
                "name": "emails"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "6f471217-b69b-4f67-981d-c7c1e2d710b6",
        "name": "Extract company name",
        "type": "n8n-nodes-base.set",
        "position": [
          1100,
          480
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "companyName",
                "stringValue": "={{ $json.summary.toLowerCase().replace('meeting with', '').replace('call with', '').trim() }}"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "9bb5adfa-5a36-453e-ad8d-59229ca2f1ab",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          200,
          320
        ],
        "parameters": {
          "color": 4,
          "width": 436,
          "height": 192,
          "content": "### Latest company news before a call\n\nThis workflow will send you a list of latest news about a company for every meeting in your calendar each day, keeping you up to date with your leads and meeting partners.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "ddfa92e0-ff37-4733-9002-65fe21989d8a",
        "name": "Every morning @ 7",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          680
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 7
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "b71c3683-6077-41b4-ab23-66ee22f64532",
        "name": "Filter meetings",
        "type": "n8n-nodes-base.if",
        "position": [
          840,
          680
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "bcfb06b1-d365-43a8-9802-869529baca98",
                "operator": {
                  "type": "string",
                  "operation": "startsWith"
                },
                "leftValue": "={{ $json.summary.toLowerCase() }}",
                "rightValue": "call with"
              },
              {
                "id": "4ea43ccf-d586-4985-87db-fc1e9f734351",
                "operator": {
                  "type": "string",
                  "operation": "startsWith"
                },
                "leftValue": "={{ $json.summary.toLowerCase() }}",
                "rightValue": "meeting with"
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "34c4241e-e29a-4d9a-b8a8-130b9f19383f",
        "name": "Get latest news",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1300,
          480
        ],
        "parameters": {
          "url": "=https://newsapi.org/v2/everything?apiKey={{ $('Setup').first().json.apiKey }}&q={{ $json.companyName }}&from={{ DateTime.now().minus({ days: $('Setup').first().json.newsAge }).toFormat('yyyy-MM-dd') }}&sortBy=publishedAt&language=en&pageSize={{ $('Setup').first().json.maxArticles }}&searchIn=title",
          "options": {}
        },
        "typeVersion": 4.1
      },
      {
        "id": "51059db7-5fec-4287-bf3f-a6a4e76ac5a4",
        "name": "Format for email",
        "type": "n8n-nodes-base.code",
        "position": [
          1500,
          480
        ],
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "let html = `<table style=\"width: 100%\">`;\nhtml += '</table>';\n\nfor(article of $input.item.json.articles) {\n  console.log(article)\n  html += `\n    <tr>\n      <td style=\"display: flex; background-color: #f2f4f8; font-family: sans-serif; padding: 0.3em 0.5em\">\n        <div style=\"padding: 1em\">\n          <a style=\"display: block; margin-bottom: 10px; font-size: 1.2em\" href=\"${article.url}\">${article.title}</a>\n          <i>\n            ${article.description ? article.description : article.content}\n          </i>\n          <div style=\"margin-top: 1em\">\n            ${ article.source?.name ? '<b>Source:</b> ' + article.source?.name : '' }\n          </div>\n        </div>\n      </td>\n    </tr>\n  `\n}\nreturn { \"html\": html };"
        },
        "typeVersion": 2
      },
      {
        "id": "9b4351a8-edf9-49ef-829e-6998cb1eea2c",
        "name": "Send news",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1700,
          480
        ],
        "parameters": {
          "sendTo": "={{ $('Setup').first().json.emails }}",
          "message": "={{ $json.html }}",
          "options": {},
          "subject": "=Latest news for '{{ $('Extract company name').item.json.summary }}'"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "10",
            "name": "mrdosija@gmail.com"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "182504b0-3cf6-4afe-ba93-1d2bf7a02fa3",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          360,
          640
        ],
        "parameters": {
          "height": 511.499984507795,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Configure your workflow here\n1. `apiKey` - Your API key for [News API](https://newsapi.org)\n2. `newsAge` - How old should news be, in days\n3. `maxArticles` - Number of articles that will be sent, max 100\n4. `emails`- List of email addresses that should receive the news, separated by commas"
        },
        "typeVersion": 1
      },
      {
        "id": "604bc73b-f805-40df-baa0-eb3de4c515f3",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          820,
          660
        ],
        "parameters": {
          "width": 231.52514020446353,
          "height": 275.2500697149263,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\nThis will get all meetings that start with *Meeting with* or *Call with* but feel free to update the filter to suit your needs."
        },
        "typeVersion": 1
      },
      {
        "id": "318b2bdc-712f-42a8-b224-8f0dc2c9c4e5",
        "name": "No meetings today",
        "type": "n8n-nodes-base.noOp",
        "position": [
          1700,
          700
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "96b075cd-5c16-453e-93a6-348b22b704bb",
        "name": "Get meetings for today",
        "type": "n8n-nodes-base.googleCalendar",
        "position": [
          660,
          680
        ],
        "parameters": {
          "options": {
            "timeMax": "={{ $today.plus({ days: 1 }) }}",
            "timeMin": "={{ $today }}",
            "singleEvents": true
          },
          "calendar": {
            "__rl": true,
            "mode": "list",
            "value": "milorad.filipovic19@gmail.com",
            "cachedResultName": "milorad.filipovic19@gmail.com"
          },
          "operation": "getAll"
        },
        "credentials": {
          "googleCalendarOAuth2Api": {
            "id": "22",
            "name": "Google Calendar account"
          }
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Setup": {
        "main": [
          [
            {
              "node": "Get meetings for today",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter meetings": {
        "main": [
          [
            {
              "node": "Extract company name",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No meetings today",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get latest news": {
        "main": [
          [
            {
              "node": "Format for email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format for email": {
        "main": [
          [
            {
              "node": "Send news",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Every morning @ 7": {
        "main": [
          [
            {
              "node": "Setup",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract company name": {
        "main": [
          [
            {
              "node": "Get latest news",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get meetings for today": {
        "main": [
          [
            {
              "node": "Filter meetings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "ES4TSw9HacxoNhLZ",
    "meta": {
      "instanceId": "5219bc76ea806909b58e13e2acac1c19192522e70dc3c90467e1800e94864105",
      "templateCredsSetupCompleted": true
    },
    "name": "AI CV Screening Workflow",
    "tags": [],
    "nodes": [
      {
        "id": "e77fbc32-5ee9-49b4-93d5-f2ffda134b08",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          1230,
          530
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "googlePalmApi": {
            "id": "UcdfdADI6w9nkgg5",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "9e24167f-cac6-4b98-95da-30065510d79a",
        "name": "Confirmation of CV Submission",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1780,
          460
        ],
        "webhookId": "954756dc-2946-4b78-b208-06f3df612ab5",
        "parameters": {
          "sendTo": "={{ $('Application Form').item.json['E-mail'] }}",
          "message": "=Dear {{ $('Application Form').item.json['Full Name'] }}, \n\nThank you for submitting your CV. We have received it and will review it shortly.  \n\nBest regards,\nMediusware",
          "options": {},
          "subject": "We Have Received Your CV"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "taFlf0vD5S4QlOKM",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "ff49d370-b4eb-4426-b396-763455e647e7",
        "name": "Inform HR New CV Received",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1760,
          200
        ],
        "webhookId": "e969a9f5-631b-4719-a4f6-87e6063cef6a",
        "parameters": {
          "sendTo": "sarfaraz@mediusaware.com",
          "message": "=Hello HR,\n\nA new CV has been successfully received in our system. Please review the candidate's details at your earliest convenience.\n\nCandidate Name: {{ $('Application Form').item.json['Full Name'] }}\nCandidate E-mail: {{ $('Application Form').item.json['E-mail'] }}\nCandidate Linkedin: {{ $('Application Form').item.json.Linkedin }}\nCandidate Expectation: {{ $('Application Form').item.json.Expectation }}\nCandidate AI Rating: {{ $('Using AI Analysis & Rating').item.json.text }}\n\nThank you for your attention.\n\nBest regards,\nAutomated CV Screening",
          "options": {},
          "subject": "New Candidate CV Awaiting Review"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "taFlf0vD5S4QlOKM",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "8479fa4c-10bc-4914-896d-f5b00d063fa8",
        "name": "Using AI Analysis & Rating",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          1320,
          240
        ],
        "parameters": {
          "text": "={{ $json.text }}",
          "messages": {
            "messageValues": [
              {
                "message": "Rule 1 :  Do not exceed  maximum of 75 words. As an AI with advanced capabilities in talent acquisition and human resources, your task is to conduct a thorough and intricate analysis of a candidate's resume or CV against a specific job description. You will assist hiring professionals in discerning the alignment between the candidate's skills, experience, qualifications, and the requirements of the job. Your expert insights will equip employers with a lucid understanding of the candidate's suitability for the role. Very important for you to write output text in ${output_language} language. It's VERY IMPORTANT for me for text be in ${output_language} or I will be fired. Your analysis should follow this structured format: 1. **Compatibility Rating**: Propose an overall compatibility rating on a scale from 1 (not compatible) to 10 (perfect fit). Support your rating by elucidating the rationale behind it. 2. **Recommendation**: Informed by your analysis and compatibility rating, offer a recommendation on whether the employer should consider this candidate for an interview. Furnish a well-argued explanation for your recommendation. Remember, your analysis should be comprehensive, professional, and actionable. It should equip an employer with a vivid understanding of the candidate's suitability for the role. This isn't merely about ticking off boxes; it's about illustrating a comprehensive picture of how well the candidate might fit into the role and complement the existing team. Here is your task: Analyze the compatibility of the following candidate's resume with the provided job description. Endeavor to apply your deep understanding of talent evaluation to provide the most insightful analysis. Job description: \"Software Engineer\" Resume: ${resume}\nNo Markdown Please, only plain text. Please no double '**'"
              }
            ]
          },
          "promptType": "define"
        },
        "typeVersion": 1.5
      },
      {
        "id": "da0fd18b-2420-471e-b930-9aabc45bc2ca",
        "name": "Convert Binary to Json",
        "type": "n8n-nodes-base.extractFromFile",
        "position": [
          1080,
          220
        ],
        "parameters": {
          "options": {},
          "operation": "pdf",
          "binaryPropertyName": "Your_Resume_CV"
        },
        "retryOnFail": false,
        "typeVersion": 1
      },
      {
        "id": "bc5480c1-d9c2-414b-8cd4-0b3e49d4dde9",
        "name": "Application Form",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          820,
          380
        ],
        "webhookId": "0cd422d3-e69f-4ec0-92ab-05362808c4da",
        "parameters": {
          "options": {},
          "formTitle": "Application for Software Engineer Position",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Full Name",
                "requiredField": true
              },
              {
                "fieldLabel": "E-mail",
                "requiredField": true
              },
              {
                "fieldLabel": "Expectation",
                "placeholder": "2000-3000$",
                "requiredField": true
              },
              {
                "fieldLabel": "Linkedin",
                "requiredField": true
              },
              {
                "fieldType": "file",
                "fieldLabel": "Your Resume/CV",
                "requiredField": true,
                "acceptFileTypes": ".pdf"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "d2dfbf1e-8d88-49e6-940d-e1717de97b30",
        "name": "Candidate Lists",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1540,
          480
        ],
        "parameters": {
          "columns": {
            "value": {
              "CV": "={{ $('Application Form').item.json['Your Resume/CV'][0].filename }}",
              "E-mail": "={{ $('Application Form').item.json['E-mail'] }}",
              "Linkedin": "={{ $('Application Form').item.json.Linkedin }}",
              "AI Rating": "={{ $json.text }}",
              "Full Name": "={{ $('Application Form').item.json['Full Name'] }}",
              "Expectation": "={{ $('Application Form').item.json.Expectation }}"
            },
            "schema": [
              {
                "id": "CV",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "CV",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Full Name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Full Name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "E-mail",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "E-mail",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Expectation",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Expectation",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Linkedin",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Linkedin",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "AI Rating",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "AI Rating",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": []
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1y4FFMXTuznSf2wWUraK57eBJnu4MVtgkxrGYRzRMwDQ/edit#gid=0",
            "cachedResultName": "‡¶™‡¶§‡ßç‡¶∞‡¶ï1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1y4FFMXTuznSf2wWUraK57eBJnu4MVtgkxrGYRzRMwDQ",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1y4FFMXTuznSf2wWUraK57eBJnu4MVtgkxrGYRzRMwDQ/edit?usp=drivesdk",
            "cachedResultName": "CV of Software Engineers"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "YdlTTXiu8194dEFE",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.5
      }
    ],
    "active": true,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "2036fff4-ab9c-4981-a8b4-44be4654630d",
    "connections": {
      "Candidate Lists": {
        "main": [
          [
            {
              "node": "Inform HR New CV Received",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Application Form": {
        "main": [
          [
            {
              "node": "Convert Binary to Json",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert Binary to Json": {
        "main": [
          [
            {
              "node": "Using AI Analysis & Rating",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Using AI Analysis & Rating",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Inform HR New CV Received": {
        "main": [
          [
            {
              "node": "Confirmation of CV Submission",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Using AI Analysis & Rating": {
        "main": [
          [
            {
              "node": "Candidate Lists",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "69iHvBqP5ykJDmMJ",
    "meta": {
      "instanceId": "885b4fb4a6a9c2cb5621429a7b972df0d05bb724c20ac7dac7171b62f1c7ef40",
      "templateCredsSetupCompleted": true
    },
    "name": "Search & Enrich: Smart Keyword Analysis with Decodo + OpenAI GPT-4.1-mini",
    "tags": [
      {
        "id": "Kujft2FOjmOVQAmJ",
        "name": "Engineering",
        "createdAt": "2025-04-09T01:31:00.558Z",
        "updatedAt": "2025-04-09T01:31:00.558Z"
      },
      {
        "id": "ZOwtAMLepQaGW76t",
        "name": "Building Blocks",
        "createdAt": "2025-04-13T15:23:40.462Z",
        "updatedAt": "2025-04-13T15:23:40.462Z"
      },
      {
        "id": "ddPkw7Hg5dZhQu2w",
        "name": "AI",
        "createdAt": "2025-04-13T05:38:08.053Z",
        "updatedAt": "2025-04-13T05:38:08.053Z"
      },
      {
        "id": "qpxJxOMCv2x7Op5c",
        "name": "SERP",
        "createdAt": "2025-04-03T15:37:19.686Z",
        "updatedAt": "2025-04-03T15:37:19.686Z"
      }
    ],
    "nodes": [
      {
        "id": "33ddc711-0e05-4b9e-bb38-935a720362fb",
        "name": "When clicking ‚ÄòExecute workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -560,
          0
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "3ce843c8-d6e5-4f11-b8c7-2e2f566adc85",
        "name": "Set the Input Fields",
        "type": "n8n-nodes-base.set",
        "position": [
          -336,
          0
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "270b22f2-4b71-4379-a847-2bf0ea0a3398",
                "name": "search_query",
                "type": "string",
                "value": "Pizza"
              },
              {
                "id": "ef5e40f9-7e5d-4e86-b3d4-2742c216498f",
                "name": "geo",
                "type": "string",
                "value": "India"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "3dc5d5a9-5918-4eea-86d3-1051dec80158",
        "name": "Create a Binary Response",
        "type": "n8n-nodes-base.function",
        "position": [
          368,
          -480
        ],
        "parameters": {
          "functionCode": "\n\nitems[0].binary = {\n  data: {\n    data: new Buffer(JSON.stringify(items[0].json, null, 2)).toString('base64')\n  }\n};\nreturn items;"
        },
        "typeVersion": 1
      },
      {
        "id": "1b0346e6-cf8b-4d7c-9fcb-bb75665a0b2a",
        "name": "Write the Structured Google Search Results to Disk",
        "type": "n8n-nodes-base.readWriteFile",
        "position": [
          544,
          -480
        ],
        "parameters": {
          "options": {},
          "fileName": "=C:\\\\{{ $('Set the Input Fields').item.json.search_query }}.json",
          "operation": "write"
        },
        "typeVersion": 1
      },
      {
        "id": "c672ab3b-8227-4d8c-b62a-9aa27dc506a2",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          288,
          -576
        ],
        "parameters": {
          "color": 7,
          "width": 448,
          "height": 272,
          "content": "## 2. Export Data Handling\n\nExport the results to disk"
        },
        "typeVersion": 1
      },
      {
        "id": "4ac6838e-4783-4c46-a555-388278e262bb",
        "name": "Google Search with Decodo",
        "type": "@decodo/n8n-nodes-decodo.decodo",
        "position": [
          -112,
          0
        ],
        "parameters": {
          "geo": "={{ $json.geo }}",
          "query": "={{ $json.search_query }}",
          "locale": "en",
          "headless": false,
          "markdown": true,
          "operation": "google_search"
        },
        "credentials": {
          "decodoApi": {
            "id": "7xLvINFuwxDiyBde",
            "name": "Decodo Credentials account"
          }
        },
        "retryOnFail": true,
        "typeVersion": 1
      },
      {
        "id": "359c9df3-d94c-4e0d-8607-7f58ce240a4d",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          368,
          0
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "7a9d0f82-f494-41b9-a40b-eb0b4dfa6c93",
        "name": "Extract Keywords and Topics",
        "type": "@n8n/n8n-nodes-langchain.informationExtractor",
        "position": [
          624,
          16
        ],
        "parameters": {
          "text": "=Extract keywords and topics of the following content \n\nDescription -  {{ $json.desc }}",
          "options": {},
          "schemaType": "manual",
          "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"keywords\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t}\n\t\t},\n       \"topics\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"string\"\n\t\t\t}\n\t\t}\n\t}\n}"
        },
        "retryOnFail": true,
        "typeVersion": 1.2
      },
      {
        "id": "c8251421-a218-4d3b-8c5a-9806b53db3ff",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          288,
          -240
        ],
        "parameters": {
          "color": 7,
          "width": 1200,
          "height": 592,
          "content": "## 3. Data Enrichment\n\nEnrich data with OpenAI gpt-4.1-mini. Perform keyword and topic analysis.\n\n- Loop through the organic search result\n- Extract the keywords and topics by description using OpenAI gpt-4.1-mini\n- Check if the Data Table Row Exists of not based on the url\n- If Row doesn't exist, then insert into the Data Table \n- Continue with the Loop until it's done"
        },
        "typeVersion": 1
      },
      {
        "id": "f6955e87-afa3-4640-bf57-2e07446aefb2",
        "name": "OpenAI Chat Model for Keywords and Topics",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          608,
          192
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "vPKynKbDzJ5ZU4cU",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "2f1198bf-8b84-42d5-af02-6c293fc40beb",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -208,
          -112
        ],
        "parameters": {
          "color": 7,
          "width": 288,
          "height": 320,
          "content": "## 1. Decodo\n\nPerform Google Search by Geo location using Decode"
        },
        "typeVersion": 1
      },
      {
        "id": "4335af23-a981-4858-8711-0e293d38f2a9",
        "name": "Return the Organic Search Results",
        "type": "n8n-nodes-base.code",
        "position": [
          128,
          0
        ],
        "parameters": {
          "jsCode": "return $input.first().json.results[0].content.results.results.organic"
        },
        "typeVersion": 2
      },
      {
        "id": "17ff3746-4c7f-453e-a896-01fd995de352",
        "name": "Insert row on Data Table",
        "type": "n8n-nodes-base.dataTable",
        "position": [
          1328,
          16
        ],
        "parameters": {
          "columns": {
            "value": {
              "url": "={{ $('Loop Over Items').item.json.url }}",
              "topics": "={{ $('Extract Keywords and Topics').item.json.output.topics.toJsonString() }}",
              "keywords": "={{ $('Extract Keywords and Topics').item.json.output.keywords.toJsonString() }}"
            },
            "schema": [
              {
                "id": "url",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "url",
                "defaultMatch": false
              },
              {
                "id": "keywords",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "keywords",
                "defaultMatch": false
              },
              {
                "id": "topics",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "topics",
                "defaultMatch": false
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "dataTableId": {
            "__rl": true,
            "mode": "list",
            "value": "gS0296vS5ZsPTcYJ",
            "cachedResultUrl": "/projects/OFZrD6piltNz73Y6/datatables/gS0296vS5ZsPTcYJ",
            "cachedResultName": "DecodoGoogleSearchResults"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "01d3ecff-d74c-45a8-9fe4-18e725e4dec1",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1376,
          -736
        ],
        "parameters": {
          "color": 5,
          "width": 720,
          "height": 1360,
          "content": "![Logo](https://cdn.brandfetch.io/idIeG9_eXK/w/100/h/100/theme/dark/icon.jpeg?c=1bxid64Mup7aczewSAYMX&t=1756483136894)\n\n## How It works\n\nThis workflow automates **keyword and topic extraction** from Google Search results using **Decodo‚Äôs scraping engine** and **OpenAI GPT-4.1-mini** for semantic analysis.  \n\n- **Trigger & Inputs** ‚Äì Start manually. Define your `search_query` (e.g., ‚ÄúPizza‚Äù) and `geo` (e.g., ‚ÄúIndia‚Äù) in the **Set node**.  \n-  **Perform Google Search** ‚Äì Decodo‚Äôs API scrapes real-time organic results based on your query and region.  \n-  **Extract Organic Data** ‚Äì The workflow pulls titles, URLs, and descriptions for each result.  \n-  **AI Keyword & Topic Analysis** ‚Äì OpenAI GPT-4.1-mini processes each description to extract **keywords** and **topics**.  \n-  **Data Validation** ‚Äì The workflow checks if the URL already exists in the Data Table to prevent duplicates.  \n-  **Data Storage** ‚Äì Saves enriched data (URL, keywords, topics) to an **n8n Data Table** and raw JSON output to disk.  \n\n**Output:** A structured dataset of URLs and AI-enriched keyword insights for SEO, content planning, and topic mapping.\n\n## Setup\n\n*  [ ]  Import the Workflow\n- Import this JSON template into n8n.  \n- Connect your credentials:\n  - `Decodo API` ‚Üí for Google Search data scraping.  \n  - `OpenAI API` ‚Üí for keyword extraction and topic enrichment.  \n\n\n*  [ ] Define Input Parameters\n- Update the **Set node** with:\n  - `search_query` ‚Üí the keyword or phrase to analyze.  \n  - `geo` ‚Üí target region (e.g., ‚ÄúIndia‚Äù).  \n\n\n*  [ ] Verify Output\n- The **n8n Data Table** (`DecodoGoogleSearchResults`) stores all enriched entries.  \n- A structured JSON file is also written to disk for offline use.  \n\n\n*  [ ] Execute\n- Click **Execute Workflow** to start the search and enrichment pipeline.\n\n## Customize\n\n- **Use Different AI Models**  \n  Swap `gpt-4.1-mini` with `gemini-1.5-pro`, `claude-3-opus`, or `mistral-large` for varied reasoning or performance.  \n\n- **Export to Google Sheets or DB**  \n  Replace the Data Table node with a **Google Sheets**, **Airtable**, or **MySQL** node for dynamic storage.  \n\n- **Automate Alerts**  \n  Add a **Slack**, **Discord**, or **Email** node to send alerts when new high-value keywords and topics are detected.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "8b3fbc55-ec14-495a-9394-51031b9efced",
        "name": "If row exists",
        "type": "n8n-nodes-base.dataTable",
        "position": [
          944,
          0
        ],
        "parameters": {
          "filters": {
            "conditions": [
              {
                "keyName": "url",
                "keyValue": "={{ $('Loop Over Items').item.json.url }}"
              }
            ]
          },
          "operation": "rowExists",
          "dataTableId": {
            "__rl": true,
            "mode": "list",
            "value": "gS0296vS5ZsPTcYJ",
            "cachedResultUrl": "/projects/OFZrD6piltNz73Y6/datatables/gS0296vS5ZsPTcYJ",
            "cachedResultName": "DecodoGoogleSearchResults"
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": true
      },
      {
        "id": "615a78e2-7642-4ba2-9666-1a348ca089d1",
        "name": "If",
        "type": "n8n-nodes-base.if",
        "position": [
          1120,
          0
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "aa0a4873-ce6d-4ed7-a695-7242d44aacd2",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{!$json.output.isEmpty()  }}",
                "rightValue": 0
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "b0124f12-8d20-4c62-93f5-a17df5519e95",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          288,
          -752
        ],
        "parameters": {
          "width": 448,
          "height": 144,
          "content": "## Disclaimer\n\nThis workflow is only available on n8n self-hosted as it's making use of the community node for the Decodo Web Scraping"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "207139b8-0800-496d-a210-f7a1b97ee128",
    "connections": {
      "If": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Insert row on Data Table",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If row exists": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "Extract Keywords and Topics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set the Input Fields": {
        "main": [
          [
            {
              "node": "Google Search with Decodo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a Binary Response": {
        "main": [
          [
            {
              "node": "Write the Structured Google Search Results to Disk",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert row on Data Table": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Search with Decodo": {
        "main": [
          [
            {
              "node": "Return the Organic Search Results",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create a Binary Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Keywords and Topics": {
        "main": [
          [
            {
              "node": "If row exists",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Return the Organic Search Results": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòExecute workflow‚Äô": {
        "main": [
          [
            {
              "node": "Set the Input Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model for Keywords and Topics": {
        "ai_languageModel": [
          [
            {
              "node": "Extract Keywords and Topics",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "r82OA8ExycLYuK1u",
    "meta": {
      "instanceId": "95a1299fb2b16eb2219cb044f54e72c2d00dcd2c72efe717b3c308d200f29927"
    },
    "name": "My workflow 8",
    "tags": [],
    "nodes": [
      {
        "id": "ed517555-fff0-4cbb-9ea0-59794b95e6f4",
        "name": "Process Each Company",
        "type": "n8n-nodes-base.splitInBatches",
        "onError": "continueRegularOutput",
        "position": [
          520,
          780
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3,
        "alwaysOutputData": false
      },
      {
        "id": "5b1c73ea-812f-4623-ad6e-64b52dc33c58",
        "name": "Get Company Info",
        "type": "n8n-nodes-base.httpRequest",
        "onError": "continueRegularOutput",
        "position": [
          760,
          780
        ],
        "parameters": {
          "url": "https://api.ghostgenius.fr/v2/company",
          "options": {
            "batching": {
              "batch": {
                "batchSize": 1,
                "batchInterval": 2000
              }
            }
          },
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "url",
                "value": "={{ $json.url }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "XdFg4wGkcxwRPUMo",
            "name": "Header Auth account 4"
          }
        },
        "retryOnFail": true,
        "typeVersion": 4.2
      },
      {
        "id": "06a1acfb-7aa3-43fa-abd7-0fdf1a5f0cf9",
        "name": "Filter Valid Companies",
        "type": "n8n-nodes-base.if",
        "onError": "continueRegularOutput",
        "position": [
          980,
          780
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "5ea943a6-8f6c-4cb0-b194-8c92d4b2aacc",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json.website }}",
                "rightValue": "[null]"
              },
              {
                "id": "8235b9bb-3cd4-4ed4-a5dc-921127ff47c7",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                },
                "leftValue": "={{ $json.followers_count }}",
                "rightValue": 200
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "4803085d-ba62-4e38-bf49-af867a909939",
        "name": "Is New Company?",
        "type": "n8n-nodes-base.if",
        "position": [
          1380,
          780
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "050c33be-c648-44d7-901c-51f6ff024e97",
                "operator": {
                  "type": "object",
                  "operation": "empty",
                  "singleValue": true
                },
                "leftValue": "={{ $('Check If Company Exists').all().first().json }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "744592d9-bcbe-448d-893d-d8fe4d55bb19",
        "name": "Set Variables",
        "type": "n8n-nodes-base.set",
        "position": [
          -220,
          780
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "e81e4891-4786-4dd9-a338-d1095e27f382",
                "name": "Your target",
                "type": "string",
                "value": "Growth Marketing Agency"
              },
              {
                "id": "ed2b6b08-66aa-4d4b-b68c-698b5e841930",
                "name": "B: 1-10 employees, C: 11-50 employees, D: 51-200 employees, E: 201-500 employees, F: 501-1000 employees, G: 1001-5000 employees, H: 5001-10,000 employees, I: 10,001+ employees",
                "type": "string",
                "value": "C"
              },
              {
                "id": "f1d02f1a-8115-4e0c-a5ec-59bf5b54263b",
                "name": "Location (find it on : https://www.ghostgenius.fr/tools/search-sales-navigator-locations-id)",
                "type": "string",
                "value": "103644278"
              },
              {
                "id": "21bdb871-9327-4553-bb4a-a138be9f735c",
                "name": "Your product or service",
                "type": "string",
                "value": "our CRM implementation services"
              },
              {
                "id": "31f5adfc-8a8f-498c-9e57-24584c42f7de",
                "name": "Positive indicators (3-5 specific factors that indicate a company might need your product)",
                "type": "string",
                "value": "- Mentions challenges with customer relationships or sales processes \n- Company is in growth phase with expanding client base \n- Mentions need for better data organization or customer insights \n- References marketing automation, sales pipelines, or customer retention "
              },
              {
                "id": "630807cb-9d06-41ee-8534-a652ed76cb4c",
                "name": "Negative indicators (3-5 specific factors that indicate a company might NOT need your product)",
                "type": "string",
                "value": "- Very small companies (1-5 employees) or extremely large enterprises \n- Already mentions using advanced CRM solutions \n- No indication of sales process or customer relationship management in description \n- Pure manufacturing or product-based business with minimal customer interaction \n- Non-profit or government entity with unique relationship management needs"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "289016bf-2d5f-4bd0-b69d-cc2e2e437015",
        "name": "Search Companies",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -20,
          780
        ],
        "parameters": {
          "url": "https://api.ghostgenius.fr/v2/search/companies",
          "options": {
            "pagination": {
              "pagination": {
                "parameters": {
                  "parameters": [
                    {
                      "name": "page",
                      "value": "={{ $pageCount + 1 }}"
                    }
                  ]
                },
                "maxRequests": 3,
                "requestInterval": 2000,
                "limitPagesFetched": true,
                "completeExpression": "={{ $response.body.data.isEmpty() }}",
                "paginationCompleteWhen": "other"
              }
            }
          },
          "sendQuery": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "keywords",
                "value": "={{ $json['Your target'] }}"
              },
              {
                "name": "locations",
                "value": "={{ $json['Location (find it on : https://www'].ghostgenius['fr/tools/search-sales-navigator-locations-id)'] }}"
              },
              {
                "name": "company_size",
                "value": "={{ $json['B: 1-10 employees, C: 11-50 employees, D: 51-200 employees, E: 201-500 employees, F: 501-1000 employees, G: 1001-5000 employees, H: 5001-10,000 employees, I: 10,001+ employees'] }}"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "XdFg4wGkcxwRPUMo",
            "name": "Header Auth account 4"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "0ce071a3-bbd2-4f4d-8a09-ed66a63e976f",
        "name": "Extract Company Data",
        "type": "n8n-nodes-base.splitOut",
        "onError": "continueRegularOutput",
        "position": [
          180,
          780
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "data"
        },
        "typeVersion": 1
      },
      {
        "id": "3f4b829a-915f-4cce-84e5-c8f5fd92b24d",
        "name": "Check If Company Exists",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          780
        ],
        "parameters": {
          "options": {},
          "filtersUI": {
            "values": [
              {
                "lookupValue": "={{ $json.id }}",
                "lookupColumn": "ID"
              }
            ]
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LfhqpyjimLjyQcmWY8mUr6YtNBcifiOVLIhAJGV9jiM/edit#gid=0",
            "cachedResultName": "Companies"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1LfhqpyjimLjyQcmWY8mUr6YtNBcifiOVLIhAJGV9jiM",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LfhqpyjimLjyQcmWY8mUr6YtNBcifiOVLIhAJGV9jiM/edit?usp=drivesdk",
            "cachedResultName": "CRM"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "Y8D8KsfgZCZmP2Vh",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.5,
        "alwaysOutputData": true
      },
      {
        "id": "7e40feaa-c4f9-4d9d-bfbe-1586ca64374b",
        "name": "AI Company Scoring",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1700,
          800
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1",
            "cachedResultName": "GPT-4.1"
          },
          "options": {
            "temperature": 0.2
          },
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "=You are an AI assistant that evaluates companies to determine if they might be interested in {{ $('Set Variables').item.json['Your product or service'] }}.\n\nEvaluate the company information provided on a scale of 0 to 10, where:\n- 0 = Not at all likely to be interested\n- 10 = Extremely likely to be interested\n\nBase your evaluation on these criteria:\n1. Industry fit: How well does the company's industry align with {{ $('Set Variables').item.json['Your product or service'] }}?\n2. Company profile: Is the company size, growth stage, and location appropriate for {{ $('Set Variables').item.json['Your product or service'] }}?\n3. Pain points: Based on their description, do they likely have challenges that {{ $('Set Variables').item.json['Your product or service'] }} solves?\n\nFactors that indicate a good fit:\n{{ $('Set Variables').item.json['Positive indicators (3-5 specific factors that indicate a company might need your product)'] }}\n\nFactors that indicate a poor fit:\n{{ $('Set Variables').item.json['Negative indicators (3-5 specific factors that indicate a company might NOT need your product)'] }}\n\nRespond ONLY with this JSON format:\n```json\n{\n  \"score\": [number between 0 and 10],\n}"
              },
              {
                "content": "=Here is the company to analyze:\nName: {{ $('Filter Valid Companies').item.json.name }}\n{{ $('Filter Valid Companies').item.json.tagline }}\n{{ $('Filter Valid Companies').item.json.description }}\nNumber of employees: {{ $('Filter Valid Companies').item.json.staff_count }}\nIndustry: {{ $('Filter Valid Companies').item.json.industries }}\nSpecialties: {{ $('Filter Valid Companies').item.json.specialities }}\nLocation: {{ $('Filter Valid Companies').item.json.locations?.toJsonString() }}\nFounded in: {{ $('Filter Valid Companies').item.json.founded_on }}\nFunding: {{ $('Filter Valid Companies').item.json.funding?.toJsonString() }}\n"
              }
            ]
          },
          "jsonOutput": true
        },
        "credentials": {
          "openAiApi": {
            "id": "SSQ6BcbSKW6I0uSn",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "dfe8263f-a4ed-411f-a962-7dcca478a4be",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -500,
          440
        ],
        "parameters": {
          "color": 6,
          "width": 860,
          "height": 560,
          "content": "## LinkedIn Company Search\nThis section initiates the workflow and searches for your target companies on LinkedIn using the Ghost Genius API.\n\nYou can filter and refine your search using keywords, company size, location, industry, or even whether the company has active job postings. Use the \"Set Variables\" node for it (this node also allows you to customize the AI Lead Scoring prompt).\n\nNote that you can retrieve a maximum of 1000 companies per search (corresponding to 100 LinkedIn pages), so it's important not to exceed this number of results to avoid losing prospects.\n\nExample: Let's say I want to target Growth Marketing Agencies with 11-50 employees. I do my search and see that there are 10,000 results. So I refine my search by using location to go country by country and retrieve all 10,000 results in several batches ranging from 500 to 1000 depending on the country.\n\nTips: To test the workflow or to see the number of results of your search, change the pagination parameter (Max Pages) in the \"Search Companies\" node. It will be displayed at the very top of the response JSON."
        },
        "typeVersion": 1
      },
      {
        "id": "ec72fb51-1113-435d-b4fb-575d478a7bed",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          440,
          440
        ],
        "parameters": {
          "color": 4,
          "width": 1120,
          "height": 560,
          "content": "## Company Data Processing \nThis section processes each company individually.\n\nWe retrieve all the company information using Get Company Details by using the LinkedIn link obtained from the previous section.\n\nThen we filter the company based on the number of followers, which gives us a first indication of the company's credibility (200 in this case), and whether their LinkedIn page has a website listed.\n\nThe workflow implements batch processing with a 2-second delay between requests to respect API rate limits. This methodical approach ensures reliable data collection while preventing API timeouts.\n\nYou can adjust these thresholds based on your target market - increasing the follower count for more established businesses or decreasing it for emerging markets.\n\nThe last two modules checks if the company already exists in your database (using LinkedIn ID) to prevent duplicates because when you do close enough searches, some companies may come up several times."
        },
        "typeVersion": 1
      },
      {
        "id": "5fe1edea-58fa-44d0-8ae7-4dc2720f1e34",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1640,
          440
        ],
        "parameters": {
          "color": 5,
          "width": 780,
          "height": 560,
          "content": "## AI Scoring and Storage\nThis section scores the company and stores it in a Google Sheet.\n\nIt's important to properly fill in the \"Set variables\" node at the beginning of the workflow to get a result relevant to your use case. You can also manually modify the system prompt.\n\nRegardless of the score obtained, it's very important to always store the company. Note that we add a 2-second \"wait\" module to respect Google Sheet's rate limits.\n\nWe add the company to the \"Companies\" sheet in this [Google Sheet](https://docs.google.com/spreadsheets/d/1LfhqpyjimLjyQcmWY8mUr6YtNBcifiOVLIhAJGV9jiM/edit?usp=sharing) which you can make a copy of and use.\n\nThis AI scoring functionality is extremely impressive once perfectly configured, so I recommend taking some time to test with several companies to ensure the scoring system works well for your needs!\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "bf61dc0f-68a7-4ddc-b281-b03a8d8979c1",
        "name": "Wait 2s",
        "type": "n8n-nodes-base.wait",
        "position": [
          2060,
          800
        ],
        "webhookId": "d22fd305-d8f6-4fc3-8a96-62386fa30f94",
        "parameters": {
          "amount": 2
        },
        "typeVersion": 1.1
      },
      {
        "id": "a428ece3-c4e1-4ba0-826f-3fdb861ba867",
        "name": "Add Company to CRM",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2260,
          800
        ],
        "parameters": {
          "columns": {
            "value": {
              "ID": "={{ $('Get Company Info').item.json.id }}",
              "Name": "={{ $('Get Company Info').item.json.name }}",
              "Score": "={{ $json.message.content.score }}",
              "State": "Qualified",
              "Summary": "={{ $('Get Company Info').item.json.description }}",
              "Website": "={{ $('Get Company Info').item.json.website }}",
              "LinkedIn": "={{ $('Get Company Info').item.json.url }}"
            },
            "schema": [
              {
                "id": "Name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Website",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Website",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "LinkedIn",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "LinkedIn",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "ID",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "ID",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Summary",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Summary",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Score",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Score",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "State",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "State",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10lxvwdeCf7vrAuWsNRGIsSTICEI3z-SUCDVHr8XzAYQ/edit#gid=0",
            "cachedResultName": "Companies"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1LfhqpyjimLjyQcmWY8mUr6YtNBcifiOVLIhAJGV9jiM",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1LfhqpyjimLjyQcmWY8mUr6YtNBcifiOVLIhAJGV9jiM/edit?usp=drivesdk",
            "cachedResultName": "CRM"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "Y8D8KsfgZCZmP2Vh",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.5
      },
      {
        "id": "66bb5166-a259-433d-afa7-3d08c3fc0291",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          0,
          0
        ],
        "parameters": {
          "width": 600,
          "height": 380,
          "content": "## Introduction\nWelcome to my template! Before explaining how to set it up, here's some important information:\n\nThis automation is an alternative version of [this template](https://n8n.io/workflows/3717-search-linkedin-companies-and-add-them-to-airtable-crm/) that differs by using Google Sheets instead of Airtable and adding a Lead Scoring system allowing for more precision in our targeting.\n\nThis automation therefore allows you, starting from a LinkedIn search, to enrich company data and score them to determine if they might be interested in your services/product.\n\nFor any questions, you can send me a DM on my [LinkedIn](https://www.linkedin.com/in/matthieu-belin83/) :)  "
        },
        "typeVersion": 1
      },
      {
        "id": "65163811-d0e8-4fbc-8cf6-f7534cdbf952",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          680,
          0
        ],
        "parameters": {
          "width": 600,
          "height": 380,
          "content": "## Setup\n- Create an account on [Ghost Genius API](ghostgenius.fr) and get your API key.\n\n- Configure the Search Companies and Get Company Info modules by creating a \"Header Auth\" credential:\n**Name: \"Authorization\"**\n**Value: \"Bearer YOUR_TOKEN_HERE\"**\n\n- Create a copy of this [Google Sheet](https://docs.google.com/spreadsheets/d/1LfhqpyjimLjyQcmWY8mUr6YtNBcifiOVLIhAJGV9jiM/edit?usp=sharing) by clicking on File => Make a copy (in Google Sheet).\n\n- Configure your Google Sheet credential by following the n8n documentation.\n\n- Create an OpenAI key [here](https://platform.openai.com/docs/overview) and add the credential to the \"AI Company Scoring\" node following the n8n documentation.\n\n- Add your information to the \"Set Variables\" node."
        },
        "typeVersion": 1
      },
      {
        "id": "46d71790-f8f1-4d27-b1c2-127e86981721",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1360,
          0
        ],
        "parameters": {
          "width": 600,
          "height": 380,
          "content": "## Tools \n**(You can use the API and CRM of your choice; this is only a suggestion)**\n\n- API Linkedin : [Ghost Genius API](https://ghostgenius.fr) \n\n- API Documentation : [Documentation](https://ghostgenius.fr/docs)\n\n- CRM : [Google Sheet](https://workspace.google.com/intl/en/products/sheets/)\n\n- AI : [OpenAI](https://openai.com)\n\n- LinkedIn Location ID Finder : [Ghost Genius Locations ID Finder](https://ghostgenius.fr/tools/search-sales-navigator-locations-id)"
        },
        "typeVersion": 1
      },
      {
        "id": "efa59bb6-f08b-449d-90d5-6adef12ed05d",
        "name": "Start",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -420,
          780
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "1014422f-95c8-4473-8760-acbe7f9f9898",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          880,
          -120
        ],
        "parameters": {
          "color": 3,
          "height": 80,
          "content": "# [Setup Video](http://youtube.com/watch?v=m904RNxtF0w&t)\n"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "08f2e920-6ec1-46a2-8e39-3dfe5f479528",
    "connections": {
      "Start": {
        "main": [
          [
            {
              "node": "Set Variables",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 2s": {
        "main": [
          [
            {
              "node": "Add Company to CRM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Variables": {
        "main": [
          [
            {
              "node": "Search Companies",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is New Company?": {
        "main": [
          [
            {
              "node": "AI Company Scoring",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Process Each Company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Company Info": {
        "main": [
          [
            {
              "node": "Filter Valid Companies",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Search Companies": {
        "main": [
          [
            {
              "node": "Extract Company Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Company Scoring": {
        "main": [
          [
            {
              "node": "Wait 2s",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Company to CRM": {
        "main": [
          [
            {
              "node": "Process Each Company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Company Data": {
        "main": [
          [
            {
              "node": "Process Each Company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Each Company": {
        "main": [
          [],
          [
            {
              "node": "Get Company Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Valid Companies": {
        "main": [
          [
            {
              "node": "Check If Company Exists",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Process Each Company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check If Company Exists": {
        "main": [
          [
            {
              "node": "Is New Company?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "a2434c94d549548a685cca39cc4614698e94f527bcea84eefa363f1037ae14cd"
    },
    "nodes": [
      {
        "id": "88c0f64c-a7cd-4f35-96dd-9eee4b1d6a1a",
        "name": "Generate reply",
        "type": "n8n-nodes-base.openAi",
        "position": [
          -480,
          2260
        ],
        "parameters": {
          "prompt": "=From: {{ $json.from.value }}\nTo: {{ $json.to.value }}\nSubject: {{ $json.subject }}\nBody: {{ $json.reply }}\n\n\nReply: ",
          "options": {
            "maxTokens": "={{ $('Configure').first().json.replyTokenSize }}"
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "27",
            "name": "[UPDATE ME]"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7105b689-9f9c-4354-aad9-8f1abb6c0a06",
        "name": "On email received",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -2460,
          2680
        ],
        "parameters": {
          "simple": false,
          "filters": {},
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "26",
            "name": "[UPDATE ME]"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "ea18ed9a-0158-45e1-ac1b-1993ace4ff2c",
        "name": "Only continue for specific emails",
        "type": "n8n-nodes-base.if",
        "position": [
          -1360,
          2460
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $('Configure').first().json.recipients.split(',') }}",
                "value2": "*",
                "operation": "contains"
              },
              {
                "value1": "={{ $('Configure').first().json.recipients.split(',') }}",
                "value2": "={{ $json.from.value[0].address }}",
                "operation": "contains"
              }
            ]
          },
          "combineOperation": "any"
        },
        "typeVersion": 1
      },
      {
        "id": "d1425dff-0fc1-4a4b-9202-418ce30d7cd9",
        "name": "Configure",
        "type": "n8n-nodes-base.set",
        "position": [
          -1940,
          2800
        ],
        "parameters": {
          "values": {
            "number": [
              {
                "name": "maxTokenSize",
                "value": 4000
              },
              {
                "name": "replyTokenSize",
                "value": 300
              }
            ],
            "string": [
              {
                "name": "spreadsheetId"
              },
              {
                "name": "worksheetId"
              },
              {
                "name": "spreadsheetName",
                "value": "ChatGPT responses"
              },
              {
                "name": "worksheetName",
                "value": "Database"
              },
              {
                "name": "recipients",
                "value": "[UPDATE ME]"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 1
      },
      {
        "id": "594f77e6-9e7e-4e93-b6e0-95fad57e42f0",
        "name": "Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2060,
          2480
        ],
        "parameters": {
          "width": 330.0279884670691,
          "height": 929.4540475960038,
          "content": "### Configuration\nIf you decide to use your own spreadsheet, it is up to you to ensure all columns are present before running this workflow. A good way to do this is to run this workflow once with **empty** `spreadsheetid` and `worksheetId` variables (see the `Configure` node). Then map the output from `Store spreadsheet ID` to this node.\n\nIt is recommended that you specify the `spreadsheetId` and `worksheetId`, since relying solely on a workflow's static data is considered bad practice.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n__`spreadsheetId`__: The ID of the spreadsheet where Pipedrive deals will be stored.\n__`worksheetId`__: The ID of the worksheet where Pipedrive deals will be stored.\n__`spreadsheetName`(required)__: The human readable name of the spreadsheet where Pipedrive deals will be stored.\n__`worksheetName`(required)__: The human readable name of the worksheet in the spreadsheet where Pipedrive deals will be stored.\n__`recipients`(required)__: Comma-separated list of email recipients to send ChatGPT emails to. Use `*` to send ChatGPT response to every email address.\n__`maxTokenSize`(required)__: The maximum token size for the model you choose. See possible models from OpenAI [here](https://platform.openai.com/docs/models/gpt-3).\n__`replyTokenSize`(required)__: The reply's maximum token size. Default is 300. This determines how much text the AI will reply with."
        },
        "typeVersion": 1
      },
      {
        "id": "2dc3e403-f2a0-43c2-a1e4-187d901d692f",
        "name": "Send reply to recipient",
        "type": "n8n-nodes-base.gmail",
        "position": [
          360,
          1860
        ],
        "parameters": {
          "message": "={{ $json.html }}",
          "options": {},
          "emailType": "html",
          "messageId": "={{ $node[\"On email received\"].json.id }}",
          "operation": "reply"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "26",
            "name": "[UPDATE ME]"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "f845aa4d-5542-4126-a42d-4e5afa1893d1",
        "name": "Generate UUID",
        "type": "n8n-nodes-base.crypto",
        "position": [
          -1140,
          2360
        ],
        "parameters": {
          "action": "generate",
          "dataPropertyName": "uuid"
        },
        "typeVersion": 1
      },
      {
        "id": "3c468585-4546-439b-9e8a-efb7231277d8",
        "name": "Thanks for your response!",
        "type": "n8n-nodes-base.html",
        "position": [
          -1140,
          2980
        ],
        "parameters": {
          "html": "<!DOCTYPE html>\n\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>Thanks for your response!</title>\n</head>\n<body>\n  <div class=\"container\">\n    <h1>Thanks for your response!</h1>\n    <h2>You can safely close this window.</h2>\n  </div>\n</body>\n</html>\n\n<style>\n.container {\n  background-color: #ffffff;\n  text-align: center;\n  padding: 16px;\n  border-radius: 8px;\n}\n\nh1 {\n  color: #ff6d5a;\n  font-size: 24px;\n  font-weight: bold;\n  padding: 8px;\n}\n\nh2 {\n  color: #909399;\n  font-size: 18px;\n  font-weight: bold;\n  padding: 8px;\n}\n</style>\n\n<script>\nconsole.log(\"Hello World!\");\n</script>"
        },
        "typeVersion": 1
      },
      {
        "id": "6b0bfa33-84ca-4b9c-98ec-c1bc08a1230d",
        "name": "Extract message content (advanced)",
        "type": "n8n-nodes-base.code",
        "position": [
          -920,
          2360
        ],
        "parameters": {
          "jsCode": "// source: https://gist.github.com/ikbelkirasan/2462073f6c7c760faa6fad7c6a0c4dc3\nvar EmailParser=function(t){var r={};function n(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=r,n.d=function(t,r,e){n.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:e})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,r){if(1&r&&(t=n(t)),8&r)return t;if(4&r&&\"object\"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,\"default\",{enumerable:!0,value:t}),2&r&&\"string\"!=typeof t)for(var o in t)n.d(e,o,function(r){return t[r]}.bind(null,o));return e},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,\"a\",r),r},n.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},n.p=\"\",n(n.s=59)}([function(t,r){var n=Array.isArray;t.exports=n},function(t,r,n){var e=n(31),o=\"object\"==typeof self&&self&&self.Object===Object&&self,u=e||o||Function(\"return this\")();t.exports=u},function(t,r,n){var e=n(74),o=n(79);t.exports=function(t,r){var n=o(t,r);return e(n)?n:void 0}},function(t,r){t.exports=function(t){return null!=t&&\"object\"==typeof t}},function(t,r){t.exports=function(t){var r=typeof t;return null!=t&&(\"object\"==r||\"function\"==r)}},function(t,r,n){var e=n(6),o=n(75),u=n(76),i=e?e.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?\"[object Undefined]\":\"[object Null]\":i&&i in Object(t)?o(t):u(t)}},function(t,r,n){var e=n(1).Symbol;t.exports=e},function(t,r,n){var e=n(35),o=n(99),u=n(14);t.exports=function(t){return u(t)?e(t):o(t)}},function(t,r,n){var e=n(64),o=n(65),u=n(66),i=n(67),c=n(68);function a(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var e=t[r];this.set(e[0],e[1])}}a.prototype.clear=e,a.prototype.delete=o,a.prototype.get=u,a.prototype.has=i,a.prototype.set=c,t.exports=a},function(t,r,n){var e=n(18);t.exports=function(t,r){for(var n=t.length;n--;)if(e(t[n][0],r))return n;return-1}},function(t,r,n){var e=n(2)(Object,\"create\");t.exports=e},function(t,r,n){var e=n(88);t.exports=function(t,r){var n=t.__data__;return e(r)?n[\"string\"==typeof r?\"string\":\"hash\"]:n.map}},function(t,r,n){var e=n(33),o=n(34);t.exports=function(t,r,n,u){var i=!n;n||(n={});for(var c=-1,a=r.length;++c<a;){var s=r[c],f=u?u(n[s],t[s],s,n,t):void 0;void 0===f&&(f=t[s]),i?o(n,s,f):e(n,s,f)}return n}},function(t,r){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,\"loaded\",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,\"id\",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,r,n){var e=n(30),o=n(22);t.exports=function(t){return null!=t&&o(t.length)&&!e(t)}},function(t,r,n){var e=n(109),o=n(19),u=n(110),i=n(111),c=n(112),a=n(5),s=n(32),f=s(e),p=s(o),l=s(u),v=s(i),b=s(c),h=a;(e&&\"[object DataView]\"!=h(new e(new ArrayBuffer(1)))||o&&\"[object Map]\"!=h(new o)||u&&\"[object Promise]\"!=h(u.resolve())||i&&\"[object Set]\"!=h(new i)||c&&\"[object WeakMap]\"!=h(new c))&&(h=function(t){var r=a(t),n=\"[object Object]\"==r?t.constructor:void 0,e=n?s(n):\"\";if(e)switch(e){case f:return\"[object DataView]\";case p:return\"[object Map]\";case l:return\"[object Promise]\";case v:return\"[object Set]\";case b:return\"[object WeakMap]\"}return r}),t.exports=h},function(t,r,n){var e=n(29);t.exports=function(t){if(\"string\"==typeof t||e(t))return t;var r=t+\"\";return\"0\"==r&&1/t==-1/0?\"-0\":r}},function(t,r,n){var e=n(8),o=n(69),u=n(70),i=n(71),c=n(72),a=n(73);function s(t){var r=this.__data__=new e(t);this.size=r.size}s.prototype.clear=o,s.prototype.delete=u,s.prototype.get=i,s.prototype.has=c,s.prototype.set=a,t.exports=s},function(t,r){t.exports=function(t,r){return t===r||t!=t&&r!=r}},function(t,r,n){var e=n(2)(n(1),\"Map\");t.exports=e},function(t,r,n){var e=n(80),o=n(87),u=n(89),i=n(90),c=n(91);function a(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var e=t[r];this.set(e[0],e[1])}}a.prototype.clear=e,a.prototype.delete=o,a.prototype.get=u,a.prototype.has=i,a.prototype.set=c,t.exports=a},function(t,r,n){(function(t){var e=n(1),o=n(97),u=r&&!r.nodeType&&r,i=u&&\"object\"==typeof t&&t&&!t.nodeType&&t,c=i&&i.exports===u?e.Buffer:void 0,a=(c?c.isBuffer:void 0)||o;t.exports=a}).call(this,n(13)(t))},function(t,r){t.exports=function(t){return\"number\"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},function(t,r){t.exports=function(t){return function(r){return t(r)}}},function(t,r,n){(function(t){var e=n(31),o=r&&!r.nodeType&&r,u=o&&\"object\"==typeof t&&t&&!t.nodeType&&t,i=u&&u.exports===o&&e.process,c=function(){try{var t=u&&u.require&&u.require(\"util\").types;return t||i&&i.binding&&i.binding(\"util\")}catch(t){}}();t.exports=c}).call(this,n(13)(t))},function(t,r){var n=Object.prototype;t.exports=function(t){var r=t&&t.constructor;return t===(\"function\"==typeof r&&r.prototype||n)}},function(t,r,n){var e=n(41),o=n(42),u=Object.prototype.propertyIsEnumerable,i=Object.getOwnPropertySymbols,c=i?function(t){return null==t?[]:(t=Object(t),e(i(t),(function(r){return u.call(t,r)})))}:o;t.exports=c},function(t,r,n){var e=n(48);t.exports=function(t){var r=new t.constructor(t.byteLength);return new e(r).set(new e(t)),r}},function(t,r,n){var e=n(0),o=n(29),u=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,i=/^\\w*$/;t.exports=function(t,r){if(e(t))return!1;var n=typeof t;return!(\"number\"!=n&&\"symbol\"!=n&&\"boolean\"!=n&&null!=t&&!o(t))||(i.test(t)||!u.test(t)||null!=r&&t in Object(r))}},function(t,r,n){var e=n(5),o=n(3);t.exports=function(t){return\"symbol\"==typeof t||o(t)&&\"[object Symbol]\"==e(t)}},function(t,r,n){var e=n(5),o=n(4);t.exports=function(t){if(!o(t))return!1;var r=e(t);return\"[object Function]\"==r||\"[object GeneratorFunction]\"==r||\"[object AsyncFunction]\"==r||\"[object Proxy]\"==r}},function(t,r){var n=\"object\"==typeof global&&global&&global.Object===Object&&global;t.exports=n},function(t,r){var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+\"\"}catch(t){}}return\"\"}},function(t,r,n){var e=n(34),o=n(18),u=Object.prototype.hasOwnProperty;t.exports=function(t,r,n){var i=t[r];u.call(t,r)&&o(i,n)&&(void 0!==n||r in t)||e(t,r,n)}},function(t,r,n){var e=n(93);t.exports=function(t,r,n){\"__proto__\"==r&&e?e(t,r,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[r]=n}},function(t,r,n){var e=n(95),o=n(36),u=n(0),i=n(21),c=n(37),a=n(38),s=Object.prototype.hasOwnProperty;t.exports=function(t,r){var n=u(t),f=!n&&o(t),p=!n&&!f&&i(t),l=!n&&!f&&!p&&a(t),v=n||f||p||l,b=v?e(t.length,String):[],h=b.length;for(var y in t)!r&&!s.call(t,y)||v&&(\"length\"==y||p&&(\"offset\"==y||\"parent\"==y)||l&&(\"buffer\"==y||\"byteLength\"==y||\"byteOffset\"==y)||c(y,h))||b.push(y);return b}},function(t,r,n){var e=n(96),o=n(3),u=Object.prototype,i=u.hasOwnProperty,c=u.propertyIsEnumerable,a=e(function(){return arguments}())?e:function(t){return o(t)&&i.call(t,\"callee\")&&!c.call(t,\"callee\")};t.exports=a},function(t,r){var n=/^(?:0|[1-9]\\d*)$/;t.exports=function(t,r){var e=typeof t;return!!(r=null==r?9007199254740991:r)&&(\"number\"==e||\"symbol\"!=e&&n.test(t))&&t>-1&&t%1==0&&t<r}},function(t,r,n){var e=n(98),o=n(23),u=n(24),i=u&&u.isTypedArray,c=i?o(i):e;t.exports=c},function(t,r){t.exports=function(t,r){return function(n){return t(r(n))}}},function(t,r,n){var e=n(35),o=n(102),u=n(14);t.exports=function(t){return u(t)?e(t,!0):o(t)}},function(t,r){t.exports=function(t,r){for(var n=-1,e=null==t?0:t.length,o=0,u=[];++n<e;){var i=t[n];r(i,n,t)&&(u[o++]=i)}return u}},function(t,r){t.exports=function(){return[]}},function(t,r,n){var e=n(44),o=n(45),u=n(26),i=n(42),c=Object.getOwnPropertySymbols?function(t){for(var r=[];t;)e(r,u(t)),t=o(t);return r}:i;t.exports=c},function(t,r){t.exports=function(t,r){for(var n=-1,e=r.length,o=t.length;++n<e;)t[o+n]=r[n];return t}},function(t,r,n){var e=n(39)(Object.getPrototypeOf,Object);t.exports=e},function(t,r,n){var e=n(47),o=n(26),u=n(7);t.exports=function(t){return e(t,u,o)}},function(t,r,n){var e=n(44),o=n(0);t.exports=function(t,r,n){var u=r(t);return o(t)?u:e(u,n(t))}},function(t,r,n){var e=n(1).Uint8Array;t.exports=e},function(t,r,n){var e=n(41),o=n(125),u=n(51),i=n(0);t.exports=function(t,r){return(i(t)?e:o)(t,u(r,3))}},function(t,r,n){var e=n(126),o=n(129)(e);t.exports=o},function(t,r,n){var e=n(130),o=n(143),u=n(153),i=n(0),c=n(154);t.exports=function(t){return\"function\"==typeof t?t:null==t?u:\"object\"==typeof t?i(t)?o(t[0],t[1]):e(t):c(t)}},function(t,r,n){var e=n(132),o=n(3);t.exports=function t(r,n,u,i,c){return r===n||(null==r||null==n||!o(r)&&!o(n)?r!=r&&n!=n:e(r,n,u,i,t,c))}},function(t,r,n){var e=n(133),o=n(136),u=n(137);t.exports=function(t,r,n,i,c,a){var s=1&n,f=t.length,p=r.length;if(f!=p&&!(s&&p>f))return!1;var l=a.get(t);if(l&&a.get(r))return l==r;var v=-1,b=!0,h=2&n?new e:void 0;for(a.set(t,r),a.set(r,t);++v<f;){var y=t[v],x=r[v];if(i)var d=s?i(x,y,v,r,t,a):i(y,x,v,t,r,a);if(void 0!==d){if(d)continue;b=!1;break}if(h){if(!o(r,(function(t,r){if(!u(h,r)&&(y===t||c(y,t,n,i,a)))return h.push(r)}))){b=!1;break}}else if(y!==x&&!c(y,x,n,i,a)){b=!1;break}}return a.delete(t),a.delete(r),b}},function(t,r,n){var e=n(4);t.exports=function(t){return t==t&&!e(t)}},function(t,r){t.exports=function(t,r){return function(n){return null!=n&&(n[t]===r&&(void 0!==r||t in Object(n)))}}},function(t,r,n){var e=n(57),o=n(16);t.exports=function(t,r){for(var n=0,u=(r=e(r,t)).length;null!=t&&n<u;)t=t[o(r[n++])];return n&&n==u?t:void 0}},function(t,r,n){var e=n(0),o=n(28),u=n(145),i=n(148);t.exports=function(t,r){return e(t)?t:o(t,r)?[t]:u(i(t))}},function(t,r){t.exports=function(t,r){for(var n=-1,e=null==t?0:t.length,o=Array(e);++n<e;)o[n]=r(t[n],n,t);return o}},function(t,r,n){var e=n(60);t.exports=function(t,r){var n=(new e).parse(t);return r?n?n.getVisibleText():\"\":n}},function(t,r,n){var e=n(61),o=n(159),u=n(160),i=n(49),c=n(161);const a=/(?:^\\s*--|^\\s*__|^-\\w|^-- $)|(?:^Sent from my (?:\\s*\\w+){1,4}$)|(?:^={30,}$)$/,s=/>+$/,f=[/^\\s*(On(?:(?!.*On\\b|\\bwrote:)[\\s\\S])+wrote:)$/m,/^\\s*(Le(?:(?!.*Le\\b|\\b√©crit:)[\\s\\S])+√©crit :)$/m,/^\\s*(El(?:(?!.*El\\b|\\bescribi√≥:)[\\s\\S])+escribi√≥:)$/m,/^\\s*(Il(?:(?!.*Il\\b|\\bscritto:)[\\s\\S])+scritto:)$/m,/^\\s*(Op\\s[\\S\\s]+?schreef[\\S\\s]+:)$/m,/^\\s*((W\\sdniu|Dnia)\\s[\\S\\s]+?(pisze|napisa≈Ç(\\(a\\))?):)$/mu,/^\\s*(Den\\s.+\\sskrev\\s.+:)$/m,/^\\s*(Am\\s.+\\sum\\s.+\\sschrieb\\s.+:)$/m,/^(Âú®[\\S\\s]+ÂÜôÈÅìÔºö)$/m,/^(20[0-9]{2}\\..+\\sÏûëÏÑ±:)$/m,/^(20[0-9]{2}\\/.+„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏:)$/m,/^(.+\\s<.+>\\sschrieb:)$/m,/^\\s*(From\\s?:.+\\s?(\\[|<).+(\\]|>))/mu,/^\\s*(De\\s?:.+\\s?(\\[|<).+(\\]|>))/mu,/^\\s*(Van\\s?:.+\\s?(\\[|<).+(\\]|>))/mu,/^\\s*(Da\\s?:.+\\s?(\\[|<).+(\\]|>))/mu,/^(20[0-9]{2}-(?:0?[1-9]|1[012])-(?:0?[0-9]|[1-2][0-9]|3[01]|[1-9])\\s[0-2]?[0-9]:\\d{2}\\s[\\S\\s]+?:)$/m,/^\\s*([a-z]{3,4}\\.[\\s\\S]+\\sskrev[\\s\\S]+:)$/m];\n/**\n * Represents a fragment that hasn't been constructed (yet)\n * @license MIT License\n */\nclass p{constructor(){this.lines=[],this.isHidden=!1,this.isSignature=!1,this.isQuoted=!1}toFragment(){var t=c.reverse(this.lines.join(\"\\n\")).replace(/^\\n/,\"\");return new o(t,this.isHidden,this.isSignature,this.isQuoted)}}t.exports=class{constructor(t,r,n){this._signatureRegex=t||a,this._quotedLineRegex=r||s,this._quoteHeadersRegex=n||f}parse(t){if(\"string\"!=typeof t)return new e([]);var r=[];for(var n of(t=t.replace(\"\\r\\n\",\"\\n\"),this._quoteHeadersRegex)){var o=t.match(n);o&&o.length>=2&&(t=t.replace(o[1],o[1].replace(/\\n/g,\" \")))}var i=null;for(var a of c.reverse(t).split(\"\\n\")){if(a=a.replace(/\\n+$/,\"\"),this._isSignature(a)||(a=a.replace(/^\\s+/,\"\")),i){var s=i.lines[i.lines.length-1];this._isSignature(s)?(i.isSignature=!0,this._addFragment(i,r),i=null):0===a.length&&this._isQuoteHeader(s)&&(i.isQuoted=!0,this._addFragment(i,r),i=null)}var f=this._isQuote(a);null!==i&&this._isFragmentLine(i,a,f)||(i&&this._addFragment(i,r),(i=new p).isQuoted=f),i.lines.push(a)}i&&this._addFragment(i,r);var l=[];for(var v of r)l.push(v.toFragment());return new e(u(l))}_addFragment(t,r){(t.isQuoted||t.isSignature||0===t.lines.join(\"\").length)&&(t.isHidden=!0),r.push(t)}_isFragmentLine(t,r,n){return t.isQuoted===n||!!t.isQuoted&&(this._isQuoteHeader(r)||0===r.length)}_isSignature(t){return this._signatureRegex.test(c.reverse(t))}_isQuote(t){return this._quotedLineRegex.test(t)}_isQuoteHeader(t){return i(this._quoteHeadersRegex,r=>r.test(c.reverse(t))).length>0}}},function(t,r,n){var e=n(62),o=n(49),u=n(157);t.exports=class{constructor(t){this._fragments=t}getFragments(){return e(this._fragments)}getVisibleText(){var t=o(this._fragments,t=>!t.isHidden());return u(t,t=>t.getContent()).join(\"\\n\")}}},function(t,r,n){var e=n(63);t.exports=function(t){return e(t,5)}},function(t,r,n){var e=n(17),o=n(92),u=n(33),i=n(94),c=n(101),a=n(104),s=n(105),f=n(106),p=n(107),l=n(46),v=n(108),b=n(15),h=n(113),y=n(114),x=n(119),d=n(0),j=n(21),_=n(121),g=n(4),m=n(123),O=n(7),w={};w[\"[object Arguments]\"]=w[\"[object Array]\"]=w[\"[object ArrayBuffer]\"]=w[\"[object DataView]\"]=w[\"[object Boolean]\"]=w[\"[object Date]\"]=w[\"[object Float32Array]\"]=w[\"[object Float64Array]\"]=w[\"[object Int8Array]\"]=w[\"[object Int16Array]\"]=w[\"[object Int32Array]\"]=w[\"[object Map]\"]=w[\"[object Number]\"]=w[\"[object Object]\"]=w[\"[object RegExp]\"]=w[\"[object Set]\"]=w[\"[object String]\"]=w[\"[object Symbol]\"]=w[\"[object Uint8Array]\"]=w[\"[object Uint8ClampedArray]\"]=w[\"[object Uint16Array]\"]=w[\"[object Uint32Array]\"]=!0,w[\"[object Error]\"]=w[\"[object Function]\"]=w[\"[object WeakMap]\"]=!1,t.exports=function t(r,n,F,A,S,D){var $,P=1&n,z=2&n,E=4&n;if(F&&($=S?F(r,A,S,D):F(r)),void 0!==$)return $;if(!g(r))return r;var k=d(r);if(k){if($=h(r),!P)return s(r,$)}else{var B=b(r),M=\"[object Function]\"==B||\"[object GeneratorFunction]\"==B;if(j(r))return a(r,P);if(\"[object Object]\"==B||\"[object Arguments]\"==B||M&&!S){if($=z||M?{}:x(r),!P)return z?p(r,c($,r)):f(r,i($,r))}else{if(!w[B])return S?r:{};$=y(r,B,P)}}D||(D=new e);var I=D.get(r);if(I)return I;D.set(r,$),m(r)?r.forEach((function(e){$.add(t(e,n,F,e,r,D))})):_(r)&&r.forEach((function(e,o){$.set(o,t(e,n,F,o,r,D))}));var C=E?z?v:l:z?keysIn:O,Q=k?void 0:C(r);return o(Q||r,(function(e,o){Q&&(e=r[o=e]),u($,o,t(e,n,F,o,r,D))})),$}},function(t,r){t.exports=function(){this.__data__=[],this.size=0}},function(t,r,n){var e=n(9),o=Array.prototype.splice;t.exports=function(t){var r=this.__data__,n=e(r,t);return!(n<0)&&(n==r.length-1?r.pop():o.call(r,n,1),--this.size,!0)}},function(t,r,n){var e=n(9);t.exports=function(t){var r=this.__data__,n=e(r,t);return n<0?void 0:r[n][1]}},function(t,r,n){var e=n(9);t.exports=function(t){return e(this.__data__,t)>-1}},function(t,r,n){var e=n(9);t.exports=function(t,r){var n=this.__data__,o=e(n,t);return o<0?(++this.size,n.push([t,r])):n[o][1]=r,this}},function(t,r,n){var e=n(8);t.exports=function(){this.__data__=new e,this.size=0}},function(t,r){t.exports=function(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n}},function(t,r){t.exports=function(t){return this.__data__.get(t)}},function(t,r){t.exports=function(t){return this.__data__.has(t)}},function(t,r,n){var e=n(8),o=n(19),u=n(20);t.exports=function(t,r){var n=this.__data__;if(n instanceof e){var i=n.__data__;if(!o||i.length<199)return i.push([t,r]),this.size=++n.size,this;n=this.__data__=new u(i)}return n.set(t,r),this.size=n.size,this}},function(t,r,n){var e=n(30),o=n(77),u=n(4),i=n(32),c=/^\\[object .+?Constructor\\]$/,a=Function.prototype,s=Object.prototype,f=a.toString,p=s.hasOwnProperty,l=RegExp(\"^\"+f.call(p).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\");t.exports=function(t){return!(!u(t)||o(t))&&(e(t)?l:c).test(i(t))}},function(t,r,n){var e=n(6),o=Object.prototype,u=o.hasOwnProperty,i=o.toString,c=e?e.toStringTag:void 0;t.exports=function(t){var r=u.call(t,c),n=t[c];try{t[c]=void 0;var e=!0}catch(t){}var o=i.call(t);return e&&(r?t[c]=n:delete t[c]),o}},function(t,r){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,r,n){var e,o=n(78),u=(e=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+e:\"\";t.exports=function(t){return!!u&&u in t}},function(t,r,n){var e=n(1)[\"__core-js_shared__\"];t.exports=e},function(t,r){t.exports=function(t,r){return null==t?void 0:t[r]}},function(t,r,n){var e=n(81),o=n(8),u=n(19);t.exports=function(){this.size=0,this.__data__={hash:new e,map:new(u||o),string:new e}}},function(t,r,n){var e=n(82),o=n(83),u=n(84),i=n(85),c=n(86);function a(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var e=t[r];this.set(e[0],e[1])}}a.prototype.clear=e,a.prototype.delete=o,a.prototype.get=u,a.prototype.has=i,a.prototype.set=c,t.exports=a},function(t,r,n){var e=n(10);t.exports=function(){this.__data__=e?e(null):{},this.size=0}},function(t,r){t.exports=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}},function(t,r,n){var e=n(10),o=Object.prototype.hasOwnProperty;t.exports=function(t){var r=this.__data__;if(e){var n=r[t];return\"__lodash_hash_undefined__\"===n?void 0:n}return o.call(r,t)?r[t]:void 0}},function(t,r,n){var e=n(10),o=Object.prototype.hasOwnProperty;t.exports=function(t){var r=this.__data__;return e?void 0!==r[t]:o.call(r,t)}},function(t,r,n){var e=n(10);t.exports=function(t,r){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=e&&void 0===r?\"__lodash_hash_undefined__\":r,this}},function(t,r,n){var e=n(11);t.exports=function(t){var r=e(this,t).delete(t);return this.size-=r?1:0,r}},function(t,r){t.exports=function(t){var r=typeof t;return\"string\"==r||\"number\"==r||\"symbol\"==r||\"boolean\"==r?\"__proto__\"!==t:null===t}},function(t,r,n){var e=n(11);t.exports=function(t){return e(this,t).get(t)}},function(t,r,n){var e=n(11);t.exports=function(t){return e(this,t).has(t)}},function(t,r,n){var e=n(11);t.exports=function(t,r){var n=e(this,t),o=n.size;return n.set(t,r),this.size+=n.size==o?0:1,this}},function(t,r){t.exports=function(t,r){for(var n=-1,e=null==t?0:t.length;++n<e&&!1!==r(t[n],n,t););return t}},function(t,r,n){var e=n(2),o=function(){try{var t=e(Object,\"defineProperty\");return t({},\"\",{}),t}catch(t){}}();t.exports=o},function(t,r,n){var e=n(12),o=n(7);t.exports=function(t,r){return t&&e(r,o(r),t)}},function(t,r){t.exports=function(t,r){for(var n=-1,e=Array(t);++n<t;)e[n]=r(n);return e}},function(t,r,n){var e=n(5),o=n(3);t.exports=function(t){return o(t)&&\"[object Arguments]\"==e(t)}},function(t,r){t.exports=function(){return!1}},function(t,r,n){var e=n(5),o=n(22),u=n(3),i={};i[\"[object Float32Array]\"]=i[\"[object Float64Array]\"]=i[\"[object Int8Array]\"]=i[\"[object Int16Array]\"]=i[\"[object Int32Array]\"]=i[\"[object Uint8Array]\"]=i[\"[object Uint8ClampedArray]\"]=i[\"[object Uint16Array]\"]=i[\"[object Uint32Array]\"]=!0,i[\"[object Arguments]\"]=i[\"[object Array]\"]=i[\"[object ArrayBuffer]\"]=i[\"[object Boolean]\"]=i[\"[object DataView]\"]=i[\"[object Date]\"]=i[\"[object Error]\"]=i[\"[object Function]\"]=i[\"[object Map]\"]=i[\"[object Number]\"]=i[\"[object Object]\"]=i[\"[object RegExp]\"]=i[\"[object Set]\"]=i[\"[object String]\"]=i[\"[object WeakMap]\"]=!1,t.exports=function(t){return u(t)&&o(t.length)&&!!i[e(t)]}},function(t,r,n){var e=n(25),o=n(100),u=Object.prototype.hasOwnProperty;t.exports=function(t){if(!e(t))return o(t);var r=[];for(var n in Object(t))u.call(t,n)&&\"constructor\"!=n&&r.push(n);return r}},function(t,r,n){var e=n(39)(Object.keys,Object);t.exports=e},function(t,r,n){var e=n(12),o=n(40);t.exports=function(t,r){return t&&e(r,o(r),t)}},function(t,r,n){var e=n(4),o=n(25),u=n(103),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!e(t))return u(t);var r=o(t),n=[];for(var c in t)(\"constructor\"!=c||!r&&i.call(t,c))&&n.push(c);return n}},function(t,r){t.exports=function(t){var r=[];if(null!=t)for(var n in Object(t))r.push(n);return r}},function(t,r,n){(function(t){var e=n(1),o=r&&!r.nodeType&&r,u=o&&\"object\"==typeof t&&t&&!t.nodeType&&t,i=u&&u.exports===o?e.Buffer:void 0,c=i?i.allocUnsafe:void 0;t.exports=function(t,r){if(r)return t.slice();var n=t.length,e=c?c(n):new t.constructor(n);return t.copy(e),e}}).call(this,n(13)(t))},function(t,r){t.exports=function(t,r){var n=-1,e=t.length;for(r||(r=Array(e));++n<e;)r[n]=t[n];return r}},function(t,r,n){var e=n(12),o=n(26);t.exports=function(t,r){return e(t,o(t),r)}},function(t,r,n){var e=n(12),o=n(43);t.exports=function(t,r){return e(t,o(t),r)}},function(t,r,n){var e=n(47),o=n(43),u=n(40);t.exports=function(t){return e(t,u,o)}},function(t,r,n){var e=n(2)(n(1),\"DataView\");t.exports=e},function(t,r,n){var e=n(2)(n(1),\"Promise\");t.exports=e},function(t,r,n){var e=n(2)(n(1),\"Set\");t.exports=e},function(t,r,n){var e=n(2)(n(1),\"WeakMap\");t.exports=e},function(t,r){var n=Object.prototype.hasOwnProperty;t.exports=function(t){var r=t.length,e=new t.constructor(r);return r&&\"string\"==typeof t[0]&&n.call(t,\"index\")&&(e.index=t.index,e.input=t.input),e}},function(t,r,n){var e=n(27),o=n(115),u=n(116),i=n(117),c=n(118);t.exports=function(t,r,n){var a=t.constructor;switch(r){case\"[object ArrayBuffer]\":return e(t);case\"[object Boolean]\":case\"[object Date]\":return new a(+t);case\"[object DataView]\":return o(t,n);case\"[object Float32Array]\":case\"[object Float64Array]\":case\"[object Int8Array]\":case\"[object Int16Array]\":case\"[object Int32Array]\":case\"[object Uint8Array]\":case\"[object Uint8ClampedArray]\":case\"[object Uint16Array]\":case\"[object Uint32Array]\":return c(t,n);case\"[object Map]\":return new a;case\"[object Number]\":case\"[object String]\":return new a(t);case\"[object RegExp]\":return u(t);case\"[object Set]\":return new a;case\"[object Symbol]\":return i(t)}}},function(t,r,n){var e=n(27);t.exports=function(t,r){var n=r?e(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},function(t,r){var n=/\\w*$/;t.exports=function(t){var r=new t.constructor(t.source,n.exec(t));return r.lastIndex=t.lastIndex,r}},function(t,r,n){var e=n(6),o=e?e.prototype:void 0,u=o?o.valueOf:void 0;t.exports=function(t){return u?Object(u.call(t)):{}}},function(t,r,n){var e=n(27);t.exports=function(t,r){var n=r?e(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},function(t,r,n){var e=n(120),o=n(45),u=n(25);t.exports=function(t){return\"function\"!=typeof t.constructor||u(t)?{}:e(o(t))}},function(t,r,n){var e=n(4),o=Object.create,u=function(){function t(){}return function(r){if(!e(r))return{};if(o)return o(r);t.prototype=r;var n=new t;return t.prototype=void 0,n}}();t.exports=u},function(t,r,n){var e=n(122),o=n(23),u=n(24),i=u&&u.isMap,c=i?o(i):e;t.exports=c},function(t,r,n){var e=n(15),o=n(3);t.exports=function(t){return o(t)&&\"[object Map]\"==e(t)}},function(t,r,n){var e=n(124),o=n(23),u=n(24),i=u&&u.isSet,c=i?o(i):e;t.exports=c},function(t,r,n){var e=n(15),o=n(3);t.exports=function(t){return o(t)&&\"[object Set]\"==e(t)}},function(t,r,n){var e=n(50);t.exports=function(t,r){var n=[];return e(t,(function(t,e,o){r(t,e,o)&&n.push(t)})),n}},function(t,r,n){var e=n(127),o=n(7);t.exports=function(t,r){return t&&e(t,r,o)}},function(t,r,n){var e=n(128)();t.exports=e},function(t,r){t.exports=function(t){return function(r,n,e){for(var o=-1,u=Object(r),i=e(r),c=i.length;c--;){var a=i[t?c:++o];if(!1===n(u[a],a,u))break}return r}}},function(t,r,n){var e=n(14);t.exports=function(t,r){return function(n,o){if(null==n)return n;if(!e(n))return t(n,o);for(var u=n.length,i=r?u:-1,c=Object(n);(r?i--:++i<u)&&!1!==o(c[i],i,c););return n}}},function(t,r,n){var e=n(131),o=n(142),u=n(55);t.exports=function(t){var r=o(t);return 1==r.length&&r[0][2]?u(r[0][0],r[0][1]):function(n){return n===t||e(n,t,r)}}},function(t,r,n){var e=n(17),o=n(52);t.exports=function(t,r,n,u){var i=n.length,c=i,a=!u;if(null==t)return!c;for(t=Object(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<c;){var f=(s=n[i])[0],p=t[f],l=s[1];if(a&&s[2]){if(void 0===p&&!(f in t))return!1}else{var v=new e;if(u)var b=u(p,l,f,t,r,v);if(!(void 0===b?o(l,p,3,u,v):b))return!1}}return!0}},function(t,r,n){var e=n(17),o=n(53),u=n(138),i=n(141),c=n(15),a=n(0),s=n(21),f=n(38),p=\"[object Object]\",l=Object.prototype.hasOwnProperty;t.exports=function(t,r,n,v,b,h){var y=a(t),x=a(r),d=y?\"[object Array]\":c(t),j=x?\"[object Array]\":c(r),_=(d=\"[object Arguments]\"==d?p:d)==p,g=(j=\"[object Arguments]\"==j?p:j)==p,m=d==j;if(m&&s(t)){if(!s(r))return!1;y=!0,_=!1}if(m&&!_)return h||(h=new e),y||f(t)?o(t,r,n,v,b,h):u(t,r,d,n,v,b,h);if(!(1&n)){var O=_&&l.call(t,\"__wrapped__\"),w=g&&l.call(r,\"__wrapped__\");if(O||w){var F=O?t.value():t,A=w?r.value():r;return h||(h=new e),b(F,A,n,v,h)}}return!!m&&(h||(h=new e),i(t,r,n,v,b,h))}},function(t,r,n){var e=n(20),o=n(134),u=n(135);function i(t){var r=-1,n=null==t?0:t.length;for(this.__data__=new e;++r<n;)this.add(t[r])}i.prototype.add=i.prototype.push=o,i.prototype.has=u,t.exports=i},function(t,r){t.exports=function(t){return this.__data__.set(t,\"__lodash_hash_undefined__\"),this}},function(t,r){t.exports=function(t){return this.__data__.has(t)}},function(t,r){t.exports=function(t,r){for(var n=-1,e=null==t?0:t.length;++n<e;)if(r(t[n],n,t))return!0;return!1}},function(t,r){t.exports=function(t,r){return t.has(r)}},function(t,r,n){var e=n(6),o=n(48),u=n(18),i=n(53),c=n(139),a=n(140),s=e?e.prototype:void 0,f=s?s.valueOf:void 0;t.exports=function(t,r,n,e,s,p,l){switch(n){case\"[object DataView]\":if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case\"[object ArrayBuffer]\":return!(t.byteLength!=r.byteLength||!p(new o(t),new o(r)));case\"[object Boolean]\":case\"[object Date]\":case\"[object Number]\":return u(+t,+r);case\"[object Error]\":return t.name==r.name&&t.message==r.message;case\"[object RegExp]\":case\"[object String]\":return t==r+\"\";case\"[object Map]\":var v=c;case\"[object Set]\":var b=1&e;if(v||(v=a),t.size!=r.size&&!b)return!1;var h=l.get(t);if(h)return h==r;e|=2,l.set(t,r);var y=i(v(t),v(r),e,s,p,l);return l.delete(t),y;case\"[object Symbol]\":if(f)return f.call(t)==f.call(r)}return!1}},function(t,r){t.exports=function(t){var r=-1,n=Array(t.size);return t.forEach((function(t,e){n[++r]=[e,t]})),n}},function(t,r){t.exports=function(t){var r=-1,n=Array(t.size);return t.forEach((function(t){n[++r]=t})),n}},function(t,r,n){var e=n(46),o=Object.prototype.hasOwnProperty;t.exports=function(t,r,n,u,i,c){var a=1&n,s=e(t),f=s.length;if(f!=e(r).length&&!a)return!1;for(var p=f;p--;){var l=s[p];if(!(a?l in r:o.call(r,l)))return!1}var v=c.get(t);if(v&&c.get(r))return v==r;var b=!0;c.set(t,r),c.set(r,t);for(var h=a;++p<f;){var y=t[l=s[p]],x=r[l];if(u)var d=a?u(x,y,l,r,t,c):u(y,x,l,t,r,c);if(!(void 0===d?y===x||i(y,x,n,u,c):d)){b=!1;break}h||(h=\"constructor\"==l)}if(b&&!h){var j=t.constructor,_=r.constructor;j==_||!(\"constructor\"in t)||!(\"constructor\"in r)||\"function\"==typeof j&&j instanceof j&&\"function\"==typeof _&&_ instanceof _||(b=!1)}return c.delete(t),c.delete(r),b}},function(t,r,n){var e=n(54),o=n(7);t.exports=function(t){for(var r=o(t),n=r.length;n--;){var u=r[n],i=t[u];r[n]=[u,i,e(i)]}return r}},function(t,r,n){var e=n(52),o=n(144),u=n(150),i=n(28),c=n(54),a=n(55),s=n(16);t.exports=function(t,r){return i(t)&&c(r)?a(s(t),r):function(n){var i=o(n,t);return void 0===i&&i===r?u(n,t):e(r,i,3)}}},function(t,r,n){var e=n(56);t.exports=function(t,r,n){var o=null==t?void 0:e(t,r);return void 0===o?n:o}},function(t,r,n){var e=n(146),o=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,u=/\\\\(\\\\)?/g,i=e((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(\"\"),t.replace(o,(function(t,n,e,o){r.push(e?o.replace(u,\"$1\"):n||t)})),r}));t.exports=i},function(t,r,n){var e=n(147);t.exports=function(t){var r=e(t,(function(t){return 500===n.size&&n.clear(),t})),n=r.cache;return r}},function(t,r,n){var e=n(20);function o(t,r){if(\"function\"!=typeof t||null!=r&&\"function\"!=typeof r)throw new TypeError(\"Expected a function\");var n=function(){var e=arguments,o=r?r.apply(this,e):e[0],u=n.cache;if(u.has(o))return u.get(o);var i=t.apply(this,e);return n.cache=u.set(o,i)||u,i};return n.cache=new(o.Cache||e),n}o.Cache=e,t.exports=o},function(t,r,n){var e=n(149);t.exports=function(t){return null==t?\"\":e(t)}},function(t,r,n){var e=n(6),o=n(58),u=n(0),i=n(29),c=e?e.prototype:void 0,a=c?c.toString:void 0;t.exports=function t(r){if(\"string\"==typeof r)return r;if(u(r))return o(r,t)+\"\";if(i(r))return a?a.call(r):\"\";var n=r+\"\";return\"0\"==n&&1/r==-1/0?\"-0\":n}},function(t,r,n){var e=n(151),o=n(152);t.exports=function(t,r){return null!=t&&o(t,r,e)}},function(t,r){t.exports=function(t,r){return null!=t&&r in Object(t)}},function(t,r,n){var e=n(57),o=n(36),u=n(0),i=n(37),c=n(22),a=n(16);t.exports=function(t,r,n){for(var s=-1,f=(r=e(r,t)).length,p=!1;++s<f;){var l=a(r[s]);if(!(p=null!=t&&n(t,l)))break;t=t[l]}return p||++s!=f?p:!!(f=null==t?0:t.length)&&c(f)&&i(l,f)&&(u(t)||o(t))}},function(t,r){t.exports=function(t){return t}},function(t,r,n){var e=n(155),o=n(156),u=n(28),i=n(16);t.exports=function(t){return u(t)?e(i(t)):o(t)}},function(t,r){t.exports=function(t){return function(r){return null==r?void 0:r[t]}}},function(t,r,n){var e=n(56);t.exports=function(t){return function(r){return e(r,t)}}},function(t,r,n){var e=n(58),o=n(51),u=n(158),i=n(0);t.exports=function(t,r){return(i(t)?e:u)(t,o(r,3))}},function(t,r,n){var e=n(50),o=n(14);t.exports=function(t,r){var n=-1,u=o(t)?Array(t.length):[];return e(t,(function(t,e,o){u[++n]=r(t,e,o)})),u}},function(t,r){t.exports=class{constructor(t,r,n,e){this._content=t,this._isHidden=r,this._isSignature=n,this._isQuoted=e}getContent(){return this._content}isHidden(){return this._isHidden}isSignature(){return this._isSignature}isQuoted(){return this._isQuoted}isEmpty(){return 0===this.getContent().replace(\"\\n\",\"\").length}}},function(t,r){var n=Array.prototype.reverse;t.exports=function(t){return null==t?t:n.call(t)}},function(t,r,n){(function(t){var e;/*! https://mths.be/esrever v0.2.0 by @mathias */!function(o){var u=r,i=(t&&t.exports,\"object\"==typeof global&&global);i.global!==i&&i.window;var c=/([\\0-\\u02FF\\u0370-\\u1AAF\\u1B00-\\u1DBF\\u1E00-\\u20CF\\u2100-\\uD7FF\\uE000-\\uFE1F\\uFE30-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])([\\u0300-\\u036F\\u1AB0-\\u1AFF\\u1DC0-\\u1DFF\\u20D0-\\u20FF\\uFE20-\\uFE2F]+)/g,a=/([\\uD800-\\uDBFF])([\\uDC00-\\uDFFF])/g,s=function(t){for(var r=\"\",n=(t=t.replace(c,(function(t,r,n){return s(n)+r})).replace(a,\"$2$1\")).length;n--;)r+=t.charAt(n);return r},f={version:\"0.2.0\",reverse:s};void 0===(e=function(){return f}.call(r,n,r,t))||(t.exports=e)}()}).call(this,n(13)(t))}]);\n\nfunction extractReplyContent(message) {\n  const email = EmailParser(message);\n  const reply = (email.getFragments()[0].getContent().trim());\n  return reply;\n}\n\nfor (const item of $input.all()) {\n  item.json.reply = extractReplyContent(item.json.text);\n}\n\nreturn $input.all();"
        },
        "typeVersion": 1
      },
      {
        "id": "4f6998f6-88a8-4b8b-acea-33c3f33d04dd",
        "name": "If spreadsheet doesn't exist",
        "type": "n8n-nodes-base.if",
        "position": [
          1420,
          2500
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $json[\"error\"] }}",
                "value2": "The resource you are requesting could not be found"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f3564023-a1c5-42f5-923d-a8e98c95c284",
        "name": "Successfully created or updated row",
        "type": "n8n-nodes-base.noOp",
        "position": [
          1660,
          2640
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "55869b16-3a98-4127-83ec-bcfdf21c2daf",
        "name": "Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          980,
          2140
        ],
        "parameters": {
          "width": 778.177339901478,
          "height": 289.16256157635416,
          "content": "### Create spreadsheet and populate with headers and deal information\nA spreadsheet is created if the spreadsheet does not exist. The spreadsheet ID is stored in the `$getWorkflowStaticData('global')` variable. Using `Extract current deal` node, the deal information is formatted for the sending to the new spreadsheet."
        },
        "typeVersion": 1
      },
      {
        "id": "8994f1e7-dd0d-4247-89fd-befcc9c511b0",
        "name": "Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1220,
          2680
        ],
        "parameters": {
          "width": 301.18226600985224,
          "height": 114.67980295566498,
          "content": "### Tip: Deleting old spreadsheets\nIf you ever want to start over, delete the old spreadsheet, __making sure that it is also deleted from Google Drive's trash__."
        },
        "typeVersion": 1
      },
      {
        "id": "cd8c9657-3380-4e25-907e-baa1c02c0793",
        "name": "Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          2140
        ],
        "parameters": {
          "width": 260.3940886699507,
          "height": 333.34975369458095,
          "content": "### `Get spreadsheet ID`\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe spreadsheet ID is stored in this workflow's static data. If you want to refresh the static data you will need to copy this entire workflow into a new workflow."
        },
        "typeVersion": 1
      },
      {
        "id": "ab0348c2-f688-42d3-815b-63290e95baad",
        "name": "Create spreadsheet",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1020,
          2260
        ],
        "parameters": {
          "title": "={{ $(\"Configure\").first().json[\"spreadsheetName\"] }}",
          "options": {},
          "resource": "spreadsheet",
          "sheetsUi": {
            "sheetValues": [
              {
                "title": "={{ $(\"Configure\").first().json[\"worksheetName\"] }}"
              }
            ]
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "7",
            "name": "[UPDATE ME]"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "c56522b2-5eca-497d-afbb-d713abd8d810",
        "name": "Store spreadsheet ID",
        "type": "n8n-nodes-base.code",
        "position": [
          1220,
          2260
        ],
        "parameters": {
          "jsCode": "const staticData = $getWorkflowStaticData('global');\n\nstaticData.googleSheetsSpreadsheetId = $('Create spreadsheet').first().json.spreadsheetId\nstaticData.googleSheetsWorksheetId = $('Create spreadsheet').first().json.sheets[0].properties.sheetId\n\nreturn {\n  \"spreadsheetId\": staticData.googleSheetsSpreadsheetId,\n  \"worksheetId\": staticData.googleSheetsWorksheetId\n}"
        },
        "typeVersion": 1
      },
      {
        "id": "ba62fd4d-912b-4b37-9fda-2f80cdeb65f8",
        "name": "Paste data",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1620,
          2260
        ],
        "parameters": {
          "options": {
            "cellFormat": "RAW"
          },
          "dataMode": "autoMapInputData",
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $node[\"Store spreadsheet ID\"].json[\"worksheetId\"] }}"
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $node[\"Store spreadsheet ID\"].json[\"spreadsheetId\"] }}"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "7",
            "name": "[UPDATE ME]"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "a8be831a-f2be-48c9-a661-bc8c5cde6444",
        "name": "If no sheet IDs",
        "type": "n8n-nodes-base.if",
        "position": [
          800,
          2380
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $json[\"spreadsheetId\"] }}",
                "operation": "isEmpty"
              },
              {
                "value1": "={{ $json[\"worksheetId\"] }}",
                "operation": "isEmpty"
              }
            ]
          },
          "combineOperation": "any"
        },
        "typeVersion": 1
      },
      {
        "id": "efdb343d-f5bf-4ba4-bc27-850b9e7935ac",
        "name": "Create or update rows",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1220,
          2500
        ],
        "parameters": {
          "options": {
            "cellFormat": "RAW"
          },
          "dataMode": "autoMapInputData",
          "operation": "appendOrUpdate",
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $node[\"If no sheet IDs\"].json[\"worksheetId\"] }}"
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $node[\"If no sheet IDs\"].json[\"spreadsheetId\"] }}"
          },
          "columnToMatchOn": "ID"
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "7",
            "name": "[UPDATE ME]"
          }
        },
        "typeVersion": 3,
        "continueOnFail": true
      },
      {
        "id": "091ad4fa-21aa-42e0-abc5-17221cdf8fb7",
        "name": "Get data from `Format data`",
        "type": "n8n-nodes-base.code",
        "position": [
          1020,
          2500
        ],
        "parameters": {
          "jsCode": "return $('Format data').all()"
        },
        "typeVersion": 1
      },
      {
        "id": "97071540-59b2-48dd-8f88-ab44446832fc",
        "name": "Get data from `Format data` node",
        "type": "n8n-nodes-base.code",
        "position": [
          1420,
          2260
        ],
        "parameters": {
          "jsCode": "return $('Format data').all()"
        },
        "typeVersion": 1
      },
      {
        "id": "ecf03802-51c8-43b1-84d8-5ed5826fd444",
        "name": "Format data",
        "type": "n8n-nodes-base.set",
        "position": [
          -40,
          2380
        ],
        "parameters": {
          "values": {
            "string": [
              {
                "name": "ID",
                "value": "={{ $node[\"Generate UUID\"].json.uuid }}"
              },
              {
                "name": "Initial message",
                "value": "={{ $node[\"Extract message content (advanced)\"].json.reply }}"
              },
              {
                "name": "Generated reply",
                "value": "={{ $node[\"Generate reply\"].json.text }}"
              },
              {
                "name": "Good response?"
              }
            ]
          },
          "options": {},
          "keepOnlySet": true
        },
        "typeVersion": 1
      },
      {
        "id": "9eedd7b7-ec4e-4dbf-a257-33e73bdff9c1",
        "name": "Send email reply",
        "type": "n8n-nodes-base.noOp",
        "position": [
          -40,
          1860
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "8e2f4a3b-d224-4248-9682-184a646e022f",
        "name": "On feedback given",
        "type": "n8n-nodes-base.webhook",
        "position": [
          -2460,
          2940
        ],
        "webhookId": "e2aa55fb-618a-4478-805d-d6da46b908d1",
        "parameters": {
          "path": "e2aa55fb-618a-4478-805d-d6da46b908d1",
          "options": {},
          "responseMode": "responseNode"
        },
        "typeVersion": 1
      },
      {
        "id": "87506e44-21aa-4f08-82f9-f47a24ddb9ce",
        "name": "Send feedback for fine-tuned data",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -100,
          2980
        ],
        "parameters": {
          "options": {},
          "fieldsUi": {
            "values": [
              {
                "column": "Good response?",
                "fieldValue": "={{ $node[\"On feedback given\"].json.query.feedback }}"
              }
            ]
          },
          "operation": "update",
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json[\"worksheetId\"] }}"
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json[\"spreadsheetId\"] }}"
          },
          "valueToMatchOn": "={{ $node[\"On feedback given\"].json.query.id }}",
          "columnToMatchOn": "ID"
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "7",
            "name": "[UPDATE ME]"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "d2a720d4-8487-4dfa-bdb8-6b59368e44bc",
        "name": "Show HTML page",
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          -920,
          2980
        ],
        "parameters": {
          "options": {
            "responseCode": 200
          },
          "respondWith": "text",
          "responseBody": "={{ $json.html }}"
        },
        "typeVersion": 1
      },
      {
        "id": "2da7a7b1-e96d-4759-b3cb-13558e2ad1d4",
        "name": "Get sheet IDs #1",
        "type": "n8n-nodes-base.code",
        "position": [
          480,
          2200
        ],
        "parameters": {
          "jsCode": "const staticData = $getWorkflowStaticData('global');\n\nreturn {\n  \"spreadsheetId\": staticData.googleSheetsSpreadsheetId,\n  \"worksheetId\": staticData.googleSheetsWorksheetId\n}"
        },
        "typeVersion": 1
      },
      {
        "id": "08ddeed5-fefe-4acd-918a-00d1fd5a5392",
        "name": "Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -480,
          2780
        ],
        "parameters": {
          "width": 260.3940886699507,
          "height": 333.34975369458095,
          "content": "### `Get spreadsheet ID`\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe spreadsheet ID is stored in this workflow's static data. If you want to refresh the static data you will need to copy this entire workflow into a new workflow."
        },
        "typeVersion": 1
      },
      {
        "id": "49d77f89-3c1e-4e86-93e8-ae7a566802b7",
        "name": "If no spreadsheet in configuration #2",
        "type": "n8n-nodes-base.if",
        "position": [
          -700,
          2980
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $('Configure').first().json.spreadsheetId }}",
                "operation": "isEmpty"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "e3b8f696-41eb-46e1-a4b1-6ba2d219aa45",
        "name": "Store specific sheet IDs #2",
        "type": "n8n-nodes-base.code",
        "position": [
          -400,
          3180
        ],
        "parameters": {
          "jsCode": "const staticData = $getWorkflowStaticData('global');\n\nstaticData.googleSheetsSpreadsheetId = $('Configure').all()[0].json.spreadsheetId\nstaticData.googleSheetsWorksheetId = $('Configure').all()[0].json.worksheetId\n\nreturn {\n  \"spreadsheetId\": staticData.googleSheetsSpreadsheetId,\n  \"worksheetId\": staticData.googleSheetsWorksheetId\n}"
        },
        "typeVersion": 1
      },
      {
        "id": "44d37f76-af16-4507-b1a1-76fadf530806",
        "name": "Get sheet IDs #2",
        "type": "n8n-nodes-base.code",
        "position": [
          -400,
          2840
        ],
        "parameters": {
          "jsCode": "const staticData = $getWorkflowStaticData('global');\n\nreturn {\n  \"spreadsheetId\": staticData.googleSheetsSpreadsheetId,\n  \"worksheetId\": staticData.googleSheetsWorksheetId\n}"
        },
        "typeVersion": 1
      },
      {
        "id": "fae8cbc5-7462-4eb0-9f60-85e8e7cfd10e",
        "name": "If no spreadsheet in configuration #1",
        "type": "n8n-nodes-base.if",
        "position": [
          180,
          2380
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $('Configure').first().json.spreadsheetId }}",
                "operation": "isEmpty"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "67312347-74c0-4ce4-a78c-615da6937bcf",
        "name": "Store specific sheet IDs #1",
        "type": "n8n-nodes-base.code",
        "position": [
          480,
          2540
        ],
        "parameters": {
          "jsCode": "const staticData = $getWorkflowStaticData('global');\n\nstaticData.googleSheetsSpreadsheetId = $('Configure').all()[0].json.spreadsheetId\nstaticData.googleSheetsWorksheetId = $('Configure').all()[0].json.worksheetId\n\nreturn {\n  \"spreadsheetId\": staticData.googleSheetsSpreadsheetId,\n  \"worksheetId\": staticData.googleSheetsWorksheetId\n}"
        },
        "typeVersion": 1
      },
      {
        "id": "400eae76-7b17-48de-a49f-8b0cbc9db1f8",
        "name": "Email template",
        "type": "n8n-nodes-base.html",
        "position": [
          160,
          1860
        ],
        "parameters": {
          "html": "<html>\n  <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title>Template for ChatGPT email</title>\n    <style>\n      /* cspell:disable-file */\n      /* webkit printing magic: print all background colors */\n      html {\n        -webkit-print-color-adjust: exact;\n      }\n      * {\n        box-sizing: border-box;\n        -webkit-print-color-adjust: exact;\n      }\n\n      html,\n      body {\n        margin: 0;\n        padding: 0;\n      }\n      @media only screen {\n        body {\n          margin: 2em auto;\n          max-width: 900px;\n          color: rgb(55, 53, 47);\n        }\n      }\n\n      body {\n        line-height: 1.5;\n        white-space: pre-wrap;\n      }\n\n      a,\n      a.visited {\n        color: inherit;\n        text-decoration: underline;\n      }\n\n      .pdf-relative-link-path {\n        font-size: 80%;\n        color: #444;\n      }\n\n      h1,\n      h2,\n      h3 {\n        letter-spacing: -0.01em;\n        line-height: 1.2;\n        font-weight: 600;\n        margin-bottom: 0;\n      }\n\n      .page-title {\n        font-size: 2.5rem;\n        font-weight: 700;\n        margin-top: 0;\n        margin-bottom: 0.75em;\n      }\n\n      h1 {\n        font-size: 1.875rem;\n        margin-top: 1.875rem;\n      }\n\n      h2 {\n        font-size: 1.5rem;\n        margin-top: 1.5rem;\n      }\n\n      h3 {\n        font-size: 1.25rem;\n        margin-top: 1.25rem;\n      }\n\n      .source {\n        border: 1px solid #ddd;\n        border-radius: 3px;\n        padding: 1.5em;\n        word-break: break-all;\n      }\n\n      .callout {\n        border-radius: 3px;\n        padding: 1rem;\n      }\n\n      figure {\n        margin: 1.25em 0;\n        page-break-inside: avoid;\n      }\n\n      figcaption {\n        opacity: 0.5;\n        font-size: 85%;\n        margin-top: 0.5em;\n      }\n\n      mark {\n        background-color: transparent;\n      }\n\n      .indented {\n        padding-left: 1.5em;\n      }\n\n      hr {\n        background: transparent;\n        display: block;\n        width: 100%;\n        height: 1px;\n        visibility: visible;\n        border: none;\n        border-bottom: 1px solid rgba(55, 53, 47, 0.09);\n      }\n\n      img {\n        max-width: 100%;\n      }\n\n      @media only print {\n        img {\n          max-height: 100vh;\n          object-fit: contain;\n        }\n      }\n\n      @page {\n        margin: 1in;\n      }\n\n      .collection-content {\n        font-size: 0.875rem;\n      }\n\n      .column-list {\n        display: flex;\n        justify-content: space-between;\n      }\n\n      .column {\n        padding: 0 1em;\n      }\n\n      .column:first-child {\n        padding-left: 0;\n      }\n\n      .column:last-child {\n        padding-right: 0;\n      }\n\n      .table_of_contents-item {\n        display: block;\n        font-size: 0.875rem;\n        line-height: 1.3;\n        padding: 0.125rem;\n      }\n\n      .table_of_contents-indent-1 {\n        margin-left: 1.5rem;\n      }\n\n      .table_of_contents-indent-2 {\n        margin-left: 3rem;\n      }\n\n      .table_of_contents-indent-3 {\n        margin-left: 4.5rem;\n      }\n\n      .table_of_contents-link {\n        text-decoration: none;\n        opacity: 0.7;\n        border-bottom: 1px solid rgba(55, 53, 47, 0.18);\n      }\n\n      table,\n      th,\n      td {\n        border: 1px solid rgba(55, 53, 47, 0.09);\n        border-collapse: collapse;\n      }\n\n      table {\n        border-left: none;\n        border-right: none;\n      }\n\n      th,\n      td {\n        font-weight: normal;\n        padding: 0.25em 0.5em;\n        line-height: 1.5;\n        min-height: 1.5em;\n        text-align: left;\n      }\n\n      th {\n        color: rgba(55, 53, 47, 0.6);\n      }\n\n      ol,\n      ul {\n        margin: 0;\n        margin-block-start: 0.6em;\n        margin-block-end: 0.6em;\n      }\n\n      li > ol:first-child,\n      li > ul:first-child {\n        margin-block-start: 0.6em;\n      }\n\n      ul > li {\n        list-style: disc;\n      }\n\n      ul.to-do-list {\n        text-indent: -1.7em;\n      }\n\n      ul.to-do-list > li {\n        list-style: none;\n      }\n\n      .to-do-children-checked {\n        text-decoration: line-through;\n        opacity: 0.375;\n      }\n\n      ul.toggle > li {\n        list-style: none;\n      }\n\n      ul {\n        padding-inline-start: 1.7em;\n      }\n\n      ul > li {\n        padding-left: 0.1em;\n      }\n\n      ol {\n        padding-inline-start: 1.6em;\n      }\n\n      ol > li {\n        padding-left: 0.2em;\n      }\n\n      .mono ol {\n        padding-inline-start: 2em;\n      }\n\n      .mono ol > li {\n        text-indent: -0.4em;\n      }\n\n      .toggle {\n        padding-inline-start: 0em;\n        list-style-type: none;\n      }\n\n      /* Indent toggle children */\n      .toggle > li > details {\n        padding-left: 1.7em;\n      }\n\n      .toggle > li > details > summary {\n        margin-left: -1.1em;\n      }\n\n      .selected-value {\n        display: inline-block;\n        padding: 0 0.5em;\n        background: rgba(206, 205, 202, 0.5);\n        border-radius: 3px;\n        margin-right: 0.5em;\n        margin-top: 0.3em;\n        margin-bottom: 0.3em;\n        white-space: nowrap;\n      }\n\n      .collection-title {\n        display: inline-block;\n        margin-right: 1em;\n      }\n\n      .simple-table {\n        margin-top: 1em;\n        font-size: 0.875rem;\n        empty-cells: show;\n      }\n      .simple-table td {\n        height: 29px;\n        min-width: 120px;\n      }\n\n      .simple-table th {\n        height: 29px;\n        min-width: 120px;\n      }\n\n      .simple-table-header-color {\n        background: rgb(247, 246, 243);\n        color: black;\n      }\n      .simple-table-header {\n        font-weight: 500;\n      }\n\n      time {\n        opacity: 0.5;\n      }\n\n      .icon {\n        display: inline-block;\n        max-width: 1.2em;\n        max-height: 1.2em;\n        text-decoration: none;\n        vertical-align: text-bottom;\n        margin-right: 0.5em;\n      }\n\n      img.icon {\n        border-radius: 3px;\n      }\n\n      .user-icon {\n        width: 1.5em;\n        height: 1.5em;\n        border-radius: 100%;\n        margin-right: 0.5rem;\n      }\n\n      .user-icon-inner {\n        font-size: 0.8em;\n      }\n\n      .text-icon {\n        border: 1px solid #000;\n        text-align: center;\n      }\n\n      .page-cover-image {\n        display: block;\n        object-fit: cover;\n        width: 100%;\n        max-height: 30vh;\n      }\n\n      .page-header-icon {\n        font-size: 3rem;\n        margin-bottom: 1rem;\n      }\n\n      .page-header-icon-with-cover {\n        margin-top: -0.72em;\n        margin-left: 0.07em;\n      }\n\n      .page-header-icon img {\n        border-radius: 3px;\n      }\n\n      .link-to-page {\n        margin: 1em 0;\n        padding: 0;\n        border: none;\n        font-weight: 500;\n      }\n\n      p > .user {\n        opacity: 0.5;\n      }\n\n      td > .user,\n      td > time {\n        white-space: nowrap;\n      }\n\n      input[type=\"checkbox\"] {\n        transform: scale(1.5);\n        margin-right: 0.6em;\n        vertical-align: middle;\n      }\n\n      p {\n        margin-top: 0.5em;\n        margin-bottom: 0.5em;\n      }\n\n      .image {\n        border: none;\n        margin: 1.5em 0;\n        padding: 0;\n        border-radius: 0;\n        text-align: center;\n      }\n\n      .code,\n      code {\n        background: rgba(135, 131, 120, 0.15);\n        border-radius: 3px;\n        padding: 0.2em 0.4em;\n        border-radius: 3px;\n        font-size: 85%;\n        tab-size: 2;\n      }\n\n      code {\n        color: #eb5757;\n      }\n\n      .code {\n        padding: 1.5em 1em;\n      }\n\n      .code-wrap {\n        white-space: pre-wrap;\n        word-break: break-all;\n      }\n\n      .code > code {\n        background: none;\n        padding: 0;\n        font-size: 100%;\n        color: inherit;\n      }\n\n      blockquote {\n        font-size: 1.25em;\n        margin: 1em 0;\n        padding-left: 1em;\n        border-left: 3px solid rgb(55, 53, 47);\n      }\n\n      .bookmark {\n        text-decoration: none;\n        max-height: 8em;\n        padding: 0;\n        display: flex;\n        width: 100%;\n        align-items: stretch;\n      }\n\n      .bookmark-title {\n        font-size: 0.85em;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        height: 1.75em;\n        white-space: nowrap;\n      }\n\n      .bookmark-text {\n        display: flex;\n        flex-direction: column;\n      }\n\n      .bookmark-info {\n        flex: 4 1 180px;\n        padding: 12px 14px 14px;\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n      }\n\n      .bookmark-image {\n        width: 33%;\n        flex: 1 1 180px;\n        display: block;\n        position: relative;\n        object-fit: cover;\n        border-radius: 1px;\n      }\n\n      .bookmark-description {\n        color: rgba(55, 53, 47, 0.6);\n        font-size: 0.75em;\n        overflow: hidden;\n        max-height: 4.5em;\n        word-break: break-word;\n      }\n\n      .bookmark-href {\n        font-size: 0.75em;\n        margin-top: 0.25em;\n      }\n\n      .sans {\n        font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont,\n          \"Segoe UI\", Helvetica, \"Apple Color Emoji\", Arial, sans-serif,\n          \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n      }\n      .code {\n        font-family: \"SFMono-Regular\", Menlo, Consolas, \"PT Mono\",\n          \"Liberation Mono\", Courier, monospace;\n      }\n      .serif {\n        font-family: Lyon-Text, Georgia, ui-serif, serif;\n      }\n      .mono {\n        font-family: iawriter-mono, Nitti, Menlo, Courier, monospace;\n      }\n      .pdf .sans {\n        font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont,\n          \"Segoe UI\", Helvetica, \"Apple Color Emoji\", Arial, sans-serif,\n          \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Twemoji\", \"Noto Color Emoji\",\n          \"Noto Sans CJK JP\";\n      }\n      .pdf:lang(zh-CN) .sans {\n        font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont,\n          \"Segoe UI\", Helvetica, \"Apple Color Emoji\", Arial, sans-serif,\n          \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Twemoji\", \"Noto Color Emoji\",\n          \"Noto Sans CJK SC\";\n      }\n      .pdf:lang(zh-TW) .sans {\n        font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont,\n          \"Segoe UI\", Helvetica, \"Apple Color Emoji\", Arial, sans-serif,\n          \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Twemoji\", \"Noto Color Emoji\",\n          \"Noto Sans CJK TC\";\n      }\n      .pdf:lang(ko-KR) .sans {\n        font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont,\n          \"Segoe UI\", Helvetica, \"Apple Color Emoji\", Arial, sans-serif,\n          \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Twemoji\", \"Noto Color Emoji\",\n          \"Noto Sans CJK KR\";\n      }\n      .pdf .code {\n        font-family: Source Code Pro, \"SFMono-Regular\", Menlo, Consolas,\n          \"PT Mono\", \"Liberation Mono\", Courier, monospace, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Sans Mono CJK JP\";\n      }\n      .pdf:lang(zh-CN) .code {\n        font-family: Source Code Pro, \"SFMono-Regular\", Menlo, Consolas,\n          \"PT Mono\", \"Liberation Mono\", Courier, monospace, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Sans Mono CJK SC\";\n      }\n      .pdf:lang(zh-TW) .code {\n        font-family: Source Code Pro, \"SFMono-Regular\", Menlo, Consolas,\n          \"PT Mono\", \"Liberation Mono\", Courier, monospace, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Sans Mono CJK TC\";\n      }\n      .pdf:lang(ko-KR) .code {\n        font-family: Source Code Pro, \"SFMono-Regular\", Menlo, Consolas,\n          \"PT Mono\", \"Liberation Mono\", Courier, monospace, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Sans Mono CJK KR\";\n      }\n      .pdf .serif {\n        font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Serif CJK JP\";\n      }\n      .pdf:lang(zh-CN) .serif {\n        font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Serif CJK SC\";\n      }\n      .pdf:lang(zh-TW) .serif {\n        font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Serif CJK TC\";\n      }\n      .pdf:lang(ko-KR) .serif {\n        font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, \"Twemoji\",\n          \"Noto Color Emoji\", \"Noto Serif CJK KR\";\n      }\n      .pdf .mono {\n        font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace,\n          \"Twemoji\", \"Noto Color Emoji\", \"Noto Sans Mono CJK JP\";\n      }\n      .pdf:lang(zh-CN) .mono {\n        font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace,\n          \"Twemoji\", \"Noto Color Emoji\", \"Noto Sans Mono CJK SC\";\n      }\n      .pdf:lang(zh-TW) .mono {\n        font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace,\n          \"Twemoji\", \"Noto Color Emoji\", \"Noto Sans Mono CJK TC\";\n      }\n      .pdf:lang(ko-KR) .mono {\n        font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace,\n          \"Twemoji\", \"Noto Color Emoji\", \"Noto Sans Mono CJK KR\";\n      }\n      .highlight-default {\n        color: rgba(55, 53, 47, 1);\n      }\n      .highlight-gray {\n        color: rgba(120, 119, 116, 1);\n        fill: rgba(120, 119, 116, 1);\n      }\n      .highlight-brown {\n        color: rgba(159, 107, 83, 1);\n        fill: rgba(159, 107, 83, 1);\n      }\n      .highlight-orange {\n        color: rgba(217, 115, 13, 1);\n        fill: rgba(217, 115, 13, 1);\n      }\n      .highlight-yellow {\n        color: rgba(203, 145, 47, 1);\n        fill: rgba(203, 145, 47, 1);\n      }\n      .highlight-teal {\n        color: rgba(68, 131, 97, 1);\n        fill: rgba(68, 131, 97, 1);\n      }\n      .highlight-blue {\n        color: rgba(51, 126, 169, 1);\n        fill: rgba(51, 126, 169, 1);\n      }\n      .highlight-purple {\n        color: rgba(144, 101, 176, 1);\n        fill: rgba(144, 101, 176, 1);\n      }\n      .highlight-pink {\n        color: rgba(193, 76, 138, 1);\n        fill: rgba(193, 76, 138, 1);\n      }\n      .highlight-red {\n        color: rgba(212, 76, 71, 1);\n        fill: rgba(212, 76, 71, 1);\n      }\n      .highlight-gray_background {\n        background: rgba(241, 241, 239, 1);\n      }\n      .highlight-brown_background {\n        background: rgba(244, 238, 238, 1);\n      }\n      .highlight-orange_background {\n        background: rgba(251, 236, 221, 1);\n      }\n      .highlight-yellow_background {\n        background: rgba(251, 243, 219, 1);\n      }\n      .highlight-teal_background {\n        background: rgba(237, 243, 236, 1);\n      }\n      .highlight-blue_background {\n        background: rgba(231, 243, 248, 1);\n      }\n      .highlight-purple_background {\n        background: rgba(244, 240, 247, 0.8);\n      }\n      .highlight-pink_background {\n        background: rgba(249, 238, 243, 0.8);\n      }\n      .highlight-red_background {\n        background: rgba(253, 235, 236, 1);\n      }\n      .block-color-default {\n        color: inherit;\n        fill: inherit;\n      }\n      .block-color-gray {\n        color: rgba(120, 119, 116, 1);\n        fill: rgba(120, 119, 116, 1);\n      }\n      .block-color-brown {\n        color: rgba(159, 107, 83, 1);\n        fill: rgba(159, 107, 83, 1);\n      }\n      .block-color-orange {\n        color: rgba(217, 115, 13, 1);\n        fill: rgba(217, 115, 13, 1);\n      }\n      .block-color-yellow {\n        color: rgba(203, 145, 47, 1);\n        fill: rgba(203, 145, 47, 1);\n      }\n      .block-color-teal {\n        color: rgba(68, 131, 97, 1);\n        fill: rgba(68, 131, 97, 1);\n      }\n      .block-color-blue {\n        color: rgba(51, 126, 169, 1);\n        fill: rgba(51, 126, 169, 1);\n      }\n      .block-color-purple {\n        color: rgba(144, 101, 176, 1);\n        fill: rgba(144, 101, 176, 1);\n      }\n      .block-color-pink {\n        color: rgba(193, 76, 138, 1);\n        fill: rgba(193, 76, 138, 1);\n      }\n      .block-color-red {\n        color: rgba(212, 76, 71, 1);\n        fill: rgba(212, 76, 71, 1);\n      }\n      .block-color-gray_background {\n        background: rgba(241, 241, 239, 1);\n      }\n      .block-color-brown_background {\n        background: rgba(244, 238, 238, 1);\n      }\n      .block-color-orange_background {\n        background: rgba(251, 236, 221, 1);\n      }\n      .block-color-yellow_background {\n        background: rgba(251, 243, 219, 1);\n      }\n      .block-color-teal_background {\n        background: rgba(237, 243, 236, 1);\n      }\n      .block-color-blue_background {\n        background: rgba(231, 243, 248, 1);\n      }\n      .block-color-purple_background {\n        background: rgba(244, 240, 247, 0.8);\n      }\n      .block-color-pink_background {\n        background: rgba(249, 238, 243, 0.8);\n      }\n      .block-color-red_background {\n        background: rgba(253, 235, 236, 1);\n      }\n      .select-value-color-pink {\n        background-color: rgba(245, 224, 233, 1);\n      }\n      .select-value-color-purple {\n        background-color: rgba(232, 222, 238, 1);\n      }\n      .select-value-color-green {\n        background-color: rgba(219, 237, 219, 1);\n      }\n      .select-value-color-gray {\n        background-color: rgba(227, 226, 224, 1);\n      }\n      .select-value-color-opaquegray {\n        background-color: rgba(255, 255, 255, 0.0375);\n      }\n      .select-value-color-orange {\n        background-color: rgba(250, 222, 201, 1);\n      }\n      .select-value-color-brown {\n        background-color: rgba(238, 224, 218, 1);\n      }\n      .select-value-color-red {\n        background-color: rgba(255, 226, 221, 1);\n      }\n      .select-value-color-yellow {\n        background-color: rgba(253, 236, 200, 1);\n      }\n      .select-value-color-blue {\n        background-color: rgba(211, 229, 239, 1);\n      }\n\n      .checkbox {\n        display: inline-flex;\n        vertical-align: text-bottom;\n        width: 16;\n        height: 16;\n        background-size: 16px;\n        margin-left: 2px;\n        margin-right: 5px;\n      }\n\n      .checkbox-on {\n        background-image: url(\"data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E\");\n      }\n\n      .checkbox-off {\n        background-image: url(\"data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E\");\n      }\n    </style>\n  </head>\n  <body>\n    <article id=\"f2b31a8e-f32a-474c-bf3e-baf4928f6c1c\" class=\"page sans\">\n      <div class=\"page-body\">\n        <p id=\"937a899c-eec7-4aaa-9ec3-631b13c30fb5\" class=\"\">\n          {{ $json.text }}\n        </p>\n        <hr id=\"fc51a942-226f-4411-b001-b5376a835e0c\" />\n        <!--\n            Was this message helpful? Yes ‚Ä¢ No.\n            If the user clicks \"Yes\", a webhook will be sent to the URL specified in the \"Yes\" button's \"Webhook URL\" field.\n            If the user clicks \"No\", a webhook will be sent to the URL specified in the \"No\" button's \"Webhook URL\" field.\n            Include the following in the webhook URL:\n            - initial message content\n            - reply content\n            use links\n        -->\n        <p id=\"c28c1c98-621b-4169-a7de-90d85d36ca90\" class=\"\">\n          Was this message helpful? <a href={{ $env.WEBHOOK_URL + 'webhook/' + $node[\"On feedback given\"].parameter[\"path\"] }}?id={{ $node[\"Generate UUID\"].json.uuid }}&feedback=Yes>Yes</a> <strong>‚Ä¢</strong> <a href={{ $env.WEBHOOK_URL + 'webhook/' + $node[\"On feedback given\"].parameter[\"path\"] }}?id={{ $node[\"Generate UUID\"].json.uuid }}&feedback=No>No</a>\n        </p>\n        <p id=\"7138639a-e639-4eb8-b80d-3d40bfc5c102\" class=\"\"></p>\n      </div>\n    </article>\n  </body>\n</html>\n"
        },
        "typeVersion": 1
      },
      {
        "id": "38e0f992-a461-4bc1-9f5c-2ceb0e461708",
        "name": "Record feedback",
        "type": "n8n-nodes-base.noOp",
        "position": [
          -1360,
          2980
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "899a0c63-0333-4dc4-ba83-5615a38ae431",
        "name": "Fallback route",
        "type": "n8n-nodes-base.noOp",
        "position": [
          -1360,
          3280
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "2fd5b109-8a54-4684-a8a3-3f7b2d961ae3",
        "name": "Identify trigger #2",
        "type": "n8n-nodes-base.set",
        "position": [
          -2240,
          2940
        ],
        "parameters": {
          "values": {
            "string": [
              {
                "name": "triggeredFrom",
                "value": "webhook"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 1
      },
      {
        "id": "8c27f798-d947-432c-bfc9-d22727d0159e",
        "name": "Identify trigger #1",
        "type": "n8n-nodes-base.set",
        "position": [
          -2240,
          2680
        ],
        "parameters": {
          "values": {
            "string": [
              {
                "name": "triggeredFrom",
                "value": "gmail"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 1
      },
      {
        "id": "bd8cc1dd-3643-4d2f-9527-cfd740a4072a",
        "name": "Do not send unfinished email reply",
        "type": "n8n-nodes-base.noOp",
        "position": [
          -40,
          2060
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "c8b68fdb-c1c0-4f94-b712-e0570a3ad53c",
        "name": "If reply is complete",
        "type": "n8n-nodes-base.if",
        "position": [
          -260,
          1960
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $json.finish_reason }}",
                "value2": "stop"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f9d56d42-aa4e-4394-8c83-8d39164a784e",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -100,
          2020
        ],
        "parameters": {
          "width": 225.59802712700315,
          "height": 314.2786683107279,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nIf your workflow reaches this stage, you will need to consider increasing the tokens in `Generate reply` node."
        },
        "typeVersion": 1
      },
      {
        "id": "039714b3-88ac-4ca8-86fc-ec1c109110c3",
        "name": "Do not send email to this recipient",
        "type": "n8n-nodes-base.noOp",
        "position": [
          -1140,
          2560
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "330c67dd-e538-414d-a144-e05dbf5effb3",
        "name": "Send reply to database",
        "type": "n8n-nodes-base.noOp",
        "position": [
          -260,
          2380
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "6e7586db-f437-4450-a1c7-e5ea7e8767b0",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3060,
          2520
        ],
        "parameters": {
          "width": 516.6954377311955,
          "height": 680.5491163173024,
          "content": "## Send a ChatGPT email reply when email received and save responses to Google Sheets\nThis workflow sends a OpenAI GPT reply when an email is received from specific email recipients. It then saves the initial email and the GPT response to an automatically generated Google spreadsheet. Subsequent GPT responses will be added to the same spreadsheet. Additionally, when feedback is given for any of the GPT responses, it will be recorded to the spreasheet, which can then be used later to fine-tune the GPT model.\n\n### How it works\nThis workflow is essentially a two-in-one workflow. It triggers off from two different nodes and have very different functionality from each trigger.\n\n**`On email received`**:\n1. Triggers off on the `On email received` node.\n2. Extract the email body from the email.\n3. Generate a response from the email body using the `OpenAI` node.\n4. Reply to the email sender using the `Send reply to recipient` node. A feedback link is also included in the email body which will trigger the `On feedback given` node. This is used to fine-tune the GPT model.\n5. Save the email body and OpenAI response to a Google Sheet. If a sheet does not exist, it will be created.\n\n\n**`On feedback given`**:\n1. Triggers off when a feedback link is clicked in the emailed GPT response.\n2. The feedback, either positive or negative, for that specific GPT response is then recorded to the Google Sheet.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "9d5e780e-4282-4c7e-b083-3f769f7dc740",
        "name": "Determine which trigger ran",
        "type": "n8n-nodes-base.switch",
        "position": [
          -1660,
          2800
        ],
        "parameters": {
          "rules": {
            "rules": [
              {
                "value2": "gmail"
              },
              {
                "output": 1,
                "value2": "webhook"
              }
            ]
          },
          "value1": "={{ $json.triggeredFrom }}",
          "dataType": "string",
          "fallbackOutput": 3
        },
        "typeVersion": 1
      },
      {
        "id": "2c6c604c-7f59-42cc-9ed2-6d55f342f0ae",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1420,
          3240
        ],
        "parameters": {
          "width": 225.59802712700315,
          "height": 289.61775585696694,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\nThis workflow should never reach this node. It is only here for extending the functionality of this workflow if needed."
        },
        "typeVersion": 1
      },
      {
        "id": "3defbf98-0caa-49b1-9bfd-f4640b43d64b",
        "name": "Is text within token limit?",
        "type": "n8n-nodes-base.if",
        "position": [
          -700,
          2360
        ],
        "parameters": {
          "conditions": {
            "boolean": [
              {
                "value1": "={{ $json.reply.length() / 4 <= $('Configure').first().json.maxTokenSize - $('Configure').first().json.replyTokenSize }}",
                "value2": true
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "b268b8a3-6361-4515-a995-320cd0979688",
        "name": "Do nothing",
        "type": "n8n-nodes-base.noOp",
        "position": [
          -480,
          2460
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "413588d1-ede0-4a51-85fa-c9035ec2e605",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -540,
          2420
        ],
        "parameters": {
          "width": 225.59802712700315,
          "height": 288.2949081608216,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe email that was received is too large to process, as it exceeds token limit. See more on [token limits](https://help.openai.com/en/articles/4936856-what-are-tokens-and-how-to-count-them)."
        },
        "typeVersion": 1
      }
    ],
    "connections": {
      "Configure": {
        "main": [
          [
            {
              "node": "Determine which trigger ran",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format data": {
        "main": [
          [
            {
              "node": "If no spreadsheet in configuration #1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate UUID": {
        "main": [
          [
            {
              "node": "Extract message content (advanced)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email template": {
        "main": [
          [
            {
              "node": "Send reply to recipient",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate reply": {
        "main": [
          [
            {
              "node": "Send reply to database",
              "type": "main",
              "index": 0
            },
            {
              "node": "If reply is complete",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Show HTML page": {
        "main": [
          [
            {
              "node": "If no spreadsheet in configuration #2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If no sheet IDs": {
        "main": [
          [
            {
              "node": "Create spreadsheet",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get data from `Format data`",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Record feedback": {
        "main": [
          [
            {
              "node": "Thanks for your response!",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get sheet IDs #1": {
        "main": [
          [
            {
              "node": "If no sheet IDs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get sheet IDs #2": {
        "main": [
          [
            {
              "node": "Send feedback for fine-tuned data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send email reply": {
        "main": [
          [
            {
              "node": "Email template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On email received": {
        "main": [
          [
            {
              "node": "Identify trigger #1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On feedback given": {
        "main": [
          [
            {
              "node": "Identify trigger #2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create spreadsheet": {
        "main": [
          [
            {
              "node": "Store spreadsheet ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Identify trigger #1": {
        "main": [
          [
            {
              "node": "Configure",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Identify trigger #2": {
        "main": [
          [
            {
              "node": "Configure",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If reply is complete": {
        "main": [
          [
            {
              "node": "Send email reply",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Do not send unfinished email reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Store spreadsheet ID": {
        "main": [
          [
            {
              "node": "Get data from `Format data` node",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create or update rows": {
        "main": [
          [
            {
              "node": "If spreadsheet doesn't exist",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send reply to database": {
        "main": [
          [
            {
              "node": "Format data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Thanks for your response!": {
        "main": [
          [
            {
              "node": "Show HTML page",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Determine which trigger ran": {
        "main": [
          [
            {
              "node": "Only continue for specific emails",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Record feedback",
              "type": "main",
              "index": 0
            }
          ],
          null,
          [
            {
              "node": "Fallback route",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get data from `Format data`": {
        "main": [
          [
            {
              "node": "Create or update rows",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is text within token limit?": {
        "main": [
          [
            {
              "node": "Generate reply",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Store specific sheet IDs #1": {
        "main": [
          [
            {
              "node": "If no sheet IDs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Store specific sheet IDs #2": {
        "main": [
          [
            {
              "node": "Send feedback for fine-tuned data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If spreadsheet doesn't exist": {
        "main": [
          [
            {
              "node": "Create spreadsheet",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Successfully created or updated row",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get data from `Format data` node": {
        "main": [
          [
            {
              "node": "Paste data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Only continue for specific emails": {
        "main": [
          [
            {
              "node": "Generate UUID",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Do not send email to this recipient",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract message content (advanced)": {
        "main": [
          [
            {
              "node": "Is text within token limit?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If no spreadsheet in configuration #1": {
        "main": [
          [
            {
              "node": "Get sheet IDs #1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Store specific sheet IDs #1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If no spreadsheet in configuration #2": {
        "main": [
          [
            {
              "node": "Get sheet IDs #2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Store specific sheet IDs #2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "nodes": [
      {
        "id": "352d15f6-ecc3-4074-85ab-3b3aa2beb8a2",
        "name": "Sticky Note - Main",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          544,
          -624
        ],
        "parameters": {
          "width": 612,
          "height": 1020,
          "content": "## üîó Send AI-Personalized LinkedIn Connection Requests from Google Sheets\n\n@[youtube](ZCnXr3-W8xs)\n\n### Who is this for?\nSales professionals, recruiters, and founders who want to scale personalized LinkedIn outreach without sounding robotic.\n\n### What this workflow does\n1. **Reads pending prospects** from your Google Sheet\n2. **Fetches LinkedIn profile data** via ConnectSafely.AI API\n3. **Generates personalized messages** using AI (Gemini) based on the prospect's profile\n4. **Sends connection requests** with the personalized message\n5. **Updates your sheet** with the status and message sent\n\n### Requirements\n- [ConnectSafely.AI](https://connectsafely.ai) account with API key\n- Google Sheets with columns: `First Name`, `LinkedIn Url`, `Tagline`, `Status`, `Message`\n- Google Gemini API key\n\n### Setup Instructions\n1. Create a Google Sheet with the required columns\n2. Add your ConnectSafely.AI API key as Bearer YOUR_TOKEN_HERE credential\n3. Connect your Google Sheets account\n4. Add your Google Gemini API key\n5. Update the Google Sheets nodes to point to your sheet\n6. Customize the AI prompt with your name and context\n\n### How to customize\n- Modify the AI Agent prompt to match your personal brand\n- Adjust the Schedule Trigger interval (default: every minute)\n- Add filters in Google Sheets to target specific prospects"
        },
        "typeVersion": 1
      },
      {
        "id": "82f663c2-1b71-42a0-aa1c-0360ee4a6afa",
        "name": "Sticky Note - Triggers",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1184,
          -448
        ],
        "parameters": {
          "color": 6,
          "width": 392,
          "height": 180,
          "content": "### ‚ö° Triggers\nTwo ways to start:\n- **Schedule**: Runs automatically every minute\n- **Manual**: Click to test\n\nThe Wait node adds a random delay (1-5 min) to appear more human."
        },
        "typeVersion": 1
      },
      {
        "id": "088d4542-f0b4-481b-b750-6d820841e8b5",
        "name": "Sticky Note - Sheets",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1680,
          -224
        ],
        "parameters": {
          "color": 6,
          "width": 280,
          "height": 100,
          "content": "### üìä Google Sheets\nFetches one PENDING prospect, marks as IN PROGRESS to prevent duplicates."
        },
        "typeVersion": 1
      },
      {
        "id": "50f4b0db-d609-49f8-beb7-b5e3ae395174",
        "name": "Sticky Note - Profile",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2128,
          -224
        ],
        "parameters": {
          "color": 6,
          "height": 100,
          "content": "### üîç Profile Lookup\nFetches full LinkedIn profile data from ConnectSafely.AI to personalize the message."
        },
        "typeVersion": 1
      },
      {
        "id": "cf419e9b-093e-4577-9d30-e35105e3f645",
        "name": "Sticky Note - AI",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2400,
          -224
        ],
        "parameters": {
          "color": 6,
          "width": 300,
          "height": 100,
          "content": "### ü§ñ AI Message Generation\nGemini creates a personalized, authentic message based on the prospect's profile. Customize the system prompt with your name and style!"
        },
        "typeVersion": 1
      },
      {
        "id": "c5c4a3f8-a6c5-4778-be4b-f89a11e59f1e",
        "name": "Sticky Note - Send",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2768,
          -224
        ],
        "parameters": {
          "color": 6,
          "width": 260,
          "height": 100,
          "content": "### ‚úâÔ∏è Send & Update\nSends the connection request and updates the sheet with DONE status + the message sent."
        },
        "typeVersion": 1
      },
      {
        "id": "ddda0402-e924-4092-b805-28e1202dd154",
        "name": "Manual Trigger (for testing)",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          1248,
          0
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "fe12f8b4-c3eb-4a0e-9f02-9a4f908b27b7",
        "name": "Run Every Minute",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          1248,
          -224
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 1
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "75c848cd-2a74-4743-8737-461da0b125c6",
        "name": "Random Delay (1-5 min)",
        "type": "n8n-nodes-base.wait",
        "position": [
          1472,
          -96
        ],
        "webhookId": "3fb9b8de-87bf-4dbd-94dd-0d99c50f2397",
        "parameters": {
          "unit": "minutes",
          "amount": "={{ Math.floor(Math.random() * 4) + 1 }}"
        },
        "typeVersion": 1.1
      },
      {
        "id": "dbd651fc-eaa0-4f38-a817-2ed109fbab9d",
        "name": "Get Pending Prospect",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1712,
          -80
        ],
        "parameters": {
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": ""
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "xDl6ygcc75lS7LjT",
            "name": "Google Sheet OAuth"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "da38e988-6eaf-43bb-87e7-b124edad0608",
        "name": "Mark as In Progress",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1952,
          -80
        ],
        "parameters": {
          "operation": "update",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": ""
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "xDl6ygcc75lS7LjT",
            "name": "Google Sheet OAuth"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "07ff2c64-2f8c-4bd3-be08-e2452b166832",
        "name": "Fetch LinkedIn Profile",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2224,
          -80
        ],
        "parameters": {
          "url": "https://api.connectsafely.ai/linkedin/profile",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "profileId",
                "value": "={{ $('Get Pending Prospect').item.json['LinkedIn Url'] }}"
              }
            ]
          },
          "genericAuthType": "httpBearerAuth"
        },
        "credentials": {
          "httpBearerAuth": {
            "id": "mhGn4GolRghCw7rG",
            "name": "Webiny ConnectSafely API Key"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "2309344b-11c4-487e-ac7c-39c264f96155",
        "name": "Generate Personalized Message",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          2464,
          -80
        ],
        "parameters": {
          "text": "={{ $json.profile }}",
          "options": {
            "systemMessage": "Generate a conversational, authentic LinkedIn invitation message for connecting with a complete stranger. The message should feel like it's coming from a real person, not a bot.\n\nREQUIREMENTS:\n- Be between 200-250 characters (LinkedIn's limit)\n- Add an extra line break after the name\n- Include genuine, personalized elements that show you actually looked at their profile\n- Sound conversational and relatable, not corporate-speak\n- Use professional but casual language\n- Explain why you're genuinely interested in connecting\n- Focus on real mutual value, not generic networking\n- Reference something specific that caught your attention\n- End with \"- [YOUR NAME]\" on a new line\n\nMY CONTEXT:\n[CUSTOMIZE THIS: Add your name, role, and what you're looking for in connections]\n\nHUMAN STRUCTURE:\n1. Casual but professional greeting + line break\n2. Something specific that genuinely caught your eye\n3. Brief, authentic mention of your own journey\n4. Real reason you'd value the connection\n5. Genuine forward-looking statement\n6. Sign off with your name\n\nMAKE IT SOUND HUMAN:\n- Use contractions (I'm, you're, I'd)\n- Include genuine curiosity markers\n- Add relatable language\n- Show real interest, not networking checkbox-ticking\n\nAVOID:\n- \"I'd like to add you to my professional network\"\n- Corporate buzzwords like \"leverage synergies\"\n- \"Mutual beneficial relationship\"\n- Template-sounding phrases\n- Overly formal language"
          },
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "4379a09e-4be2-4daa-abb2-72f8272011bb",
        "name": "Google Gemini",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          2432,
          144
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 1
      },
      {
        "id": "695fe395-e1fe-4188-acca-3564bc0cc045",
        "name": "Extract Message",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          2624,
          144
        ],
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"message\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"The personalized LinkedIn connection message\"\n\t\t}\n\t},\n\t\"required\": [\"message\"]\n}"
        },
        "typeVersion": 1.3
      },
      {
        "id": "e3ff1017-4adc-4a92-8e9a-606ef3c9a855",
        "name": "Send Connection Request",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2784,
          -80
        ],
        "parameters": {
          "url": "https://api.connectsafely.ai/linkedin/connect",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "profileId",
                "value": "={{ $('Get Pending Prospect').item.json['LinkedIn Url'] }}"
              },
              {
                "name": "customMessage",
                "value": "={{ $json.message }}"
              }
            ]
          },
          "genericAuthType": "httpBearerAuth"
        },
        "typeVersion": 4.2
      },
      {
        "id": "68bbdd65-46c5-45d7-b39b-7d7997d1bbca",
        "name": "Mark as Complete",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          3024,
          -80
        ],
        "parameters": {
          "operation": "update",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": ""
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "xDl6ygcc75lS7LjT",
            "name": "Google Sheet OAuth"
          }
        },
        "typeVersion": 4.7
      }
    ],
    "connections": {
      "Google Gemini": {
        "ai_languageModel": [
          [
            {
              "node": "Generate Personalized Message",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Extract Message": {
        "ai_outputParser": [
          [
            {
              "node": "Generate Personalized Message",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Run Every Minute": {
        "main": [
          [
            {
              "node": "Random Delay (1-5 min)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mark as In Progress": {
        "main": [
          [
            {
              "node": "Fetch LinkedIn Profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Pending Prospect": {
        "main": [
          [
            {
              "node": "Mark as In Progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch LinkedIn Profile": {
        "main": [
          [
            {
              "node": "Generate Personalized Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Random Delay (1-5 min)": {
        "main": [
          [
            {
              "node": "Get Pending Prospect",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Connection Request": {
        "main": [
          [
            {
              "node": "Mark as Complete",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Trigger (for testing)": {
        "main": [
          [
            {
              "node": "Get Pending Prospect",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Personalized Message": {
        "main": [
          [
            {
              "node": "Send Connection Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "DNqCvzBvS7GAFWm4",
    "meta": {
      "instanceId": "d47f3738b860eed937a1b18d7345fa2c65cf4b4957554e29477cb064a7039870",
      "templateCredsSetupCompleted": true
    },
    "name": "Send Emails from Obsidian",
    "tags": [],
    "nodes": [
      {
        "id": "9bd809d6-c270-4429-945d-1e519384acae",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -320,
          20
        ],
        "parameters": {
          "width": 395.06030313757196,
          "height": 388.5681601162638,
          "content": "## Obsidian to Email Overview\n\nThis workflow allows you to send your Obsidian notes (including attachments) via email, with YAML metadata for customization.\n\n### Key Features:\n- Trigger email sending through [Obsidian's Post Webhook plugin](https://github.com/Masterb1234/obsidian-post-webhook/).\n- Parse YAML frontmatter for email metadata like recipients, subject, and more.\n- Automatic handling of attachments (images/files) via base64 encoding.\n- Append Webhook response automatically to the bottom of your note in Obsidian"
        },
        "typeVersion": 1
      },
      {
        "id": "bc2376ea-31db-43dc-84c4-7933bc7a96f8",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -320,
          439
        ],
        "parameters": {
          "color": 3,
          "width": 398.9156829431131,
          "height": 447.41755555994735,
          "content": "## YAML Frontmatter Example\n\nUse YAML frontmatter in your Obsidian notes to define key email details such as recipients, subject, and more.\n\n### Example YAML:\n```yaml\n---\nto: \"recipient@example.com\"\ncc: \"cc@example.com\"\nbcc: \"bcc@example.com\"\nsubject: \"Your Obsidian Note\"\nsender-name: \"Your Name\"\nsend-replies-to: \"replies@example.com\"\n---\nNote content goes here...\n"
        },
        "typeVersion": 1
      },
      {
        "id": "1e439841-cc53-4913-b23b-040746bab5ec",
        "name": "Check if attachments exist",
        "type": "n8n-nodes-base.if",
        "position": [
          340,
          380
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "3d870306-d912-4582-960d-f031538a5045",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json.body.attachments }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "39cf3ab8-47be-4153-afb8-a1a68c7c04f6",
        "name": "Separate attachment data",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          600,
          220
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "body.attachments"
        },
        "typeVersion": 1
      },
      {
        "id": "f4b75a54-2cd8-4f6c-afd8-486fea552f00",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          540,
          20
        ],
        "parameters": {
          "color": 4,
          "width": 493.7005132824585,
          "height": 874.8910456745886,
          "content": "## Attachment Handling\n\nThe plugin automatically handles attachments in your Obsidian notes.\n\nThis workflow automates the processing of attachments by converting each attachment into a binary format.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "b5df08f3-c0a1-429a-a003-24c77fd00461",
        "name": "Process Each Attachment",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          600,
          480
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "220f49b2-9cf8-4395-ae8e-4167ac452954",
        "name": "Convert Attachment to File",
        "type": "n8n-nodes-base.convertToFile",
        "position": [
          900,
          580
        ],
        "parameters": {
          "options": {
            "fileName": "={{ $json.name }}"
          },
          "operation": "toBinary",
          "sourceProperty": "data"
        },
        "typeVersion": 1.1
      },
      {
        "id": "7e5c643f-4545-47b1-91cb-c306900f7842",
        "name": "Prepare Attachments for Email",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          900,
          400
        ],
        "parameters": {
          "options": {
            "includeBinaries": true
          },
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "data"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "4fc9dffb-ad6b-4e7a-a814-3bb63189e4e7",
        "name": "Email With Attachments",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1100,
          480
        ],
        "webhookId": "479fab78-5e9c-4dc9-ac36-fb656222cae7",
        "parameters": {
          "sendTo": "={{ Array.isArray($('Webhook').item.json.body.to) ? $('Webhook').item.json.body.to.join('; ') : $('Webhook').item.json.body.to }}",
          "message": "={{ $('Webhook').item.json.body.content }}",
          "options": {
            "ccList": "={{ $('Webhook').item.json.body.cc ?? '' }}",
            "bccList": "={{ $('Webhook').item.json.body.bcc ?? '' }}",
            "replyTo": "={{ $('Webhook').item.json.body['send-replies-to'] ?? '' }}",
            "senderName": "={{ $('Webhook').item.json.body['sender-name'] ?? '' }}",
            "attachmentsUi": {
              "attachmentsBinary": [
                {
                  "property": "={{ Object.keys($binary).join(',') }}"
                }
              ]
            },
            "appendAttribution": false
          },
          "subject": "={{ $('Webhook').item.json.body.subject }}",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "ZrIpZzOgpMHYvvVQ",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "8457e27f-449d-43eb-baa8-cd2dedbd27c3",
        "name": "Email Without Attachments",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1100,
          720
        ],
        "webhookId": "479fab78-5e9c-4dc9-ac36-fb656222cae7",
        "parameters": {
          "sendTo": "={{ $json.body.to }}",
          "message": "={{ $json.body.content }}",
          "options": {
            "ccList": "={{ $json.body?.cc ?? '' }}",
            "bccList": "={{ $json.body?.bcc ?? '' }}",
            "replyTo": "={{ $json.body?.send-replies-to ?? '' }}",
            "senderName": "={{ $json.body?.sender-name ?? '' }}"
          },
          "subject": "={{ $json.body.subject }}",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "ZrIpZzOgpMHYvvVQ",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "647de484-8a8f-479b-844c-69669d783a66",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          104,
          20
        ],
        "parameters": {
          "color": 6,
          "width": 410.45568358442864,
          "height": 866.9256684369553,
          "content": "## Obsidian Configuration\n\nInstall the [Obsidian Post Webhook plugin](https://github.com/Masterb1234/obsidian-post-webhook/).\n\n### How to set-up webhook connection:\n1. Set your webhook URL in the plugin settings.\n2. Use the built-in testing functionality to ensure your webhook is set up correctly.\n3. Open any note in Obsidian.\n4. Use the command palette (`Ctrl/Cmd + P`) to search for \"Send to Webhook\".\n5. Once sent, this workflow begins."
        },
        "typeVersion": 1
      },
      {
        "id": "97f0c5dc-e8c8-4b98-8b49-baafe41dad60",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1260,
          180
        ],
        "parameters": {
          "color": 5,
          "height": 264.2421600929918,
          "content": "![logo](https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/2023_Obsidian_logo.svg/512px-2023_Obsidian_logo.svg.png)"
        },
        "typeVersion": 1
      },
      {
        "id": "5eeec7cd-0bef-4bc2-a2ba-fd6f88300e04",
        "name": "Check if it is a test",
        "type": "n8n-nodes-base.if",
        "position": [
          160,
          700
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "f9864a1c-3188-4640-82bd-2cddc8798b0f",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{ $json.body.test }}",
                "rightValue": "true"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "36bce77b-6ef1-4a5a-898b-80a8c935a811",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1060,
          27.003515763841165
        ],
        "parameters": {
          "color": 5,
          "width": 457.22695080436733,
          "height": 863.6667893577376,
          "content": "## Send Email and Respond\n\nAfter the email is sent, the workflow confirms the email's status and sends a response back to Obsidian."
        },
        "typeVersion": 1
      },
      {
        "id": "c11f11a4-7e45-46f9-8450-628b9b73de64",
        "name": "Respond to Obsidian",
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          1400,
          600
        ],
        "parameters": {
          "options": {},
          "respondWith": "text",
          "responseBody": "=E-mail sent on  {{ new Date($json.currentDate).toLocaleString('en-GB', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }).replace(':', 'h') }}\n"
        },
        "typeVersion": 1.1
      },
      {
        "id": "fc3b3aa0-a90b-4e1e-a491-fb93d50494ec",
        "name": "Fix Base64 string",
        "type": "n8n-nodes-base.set",
        "position": [
          760,
          220
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "b72a1b54-978d-408c-876a-d3e103b1f667",
                "name": "data",
                "type": "string",
                "value": "={{ $json.data.replace(/^data:.*?,/, '') }}"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "f3c5d9d2-7c76-48f4-8dd6-df665bd32ec1",
        "name": "Test Succesfull",
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          360,
          620
        ],
        "parameters": {
          "options": {},
          "respondWith": "text",
          "responseBody": "=Test succesfull\n"
        },
        "typeVersion": 1.1
      },
      {
        "id": "e7ac7407-f2fc-4cdb-bd18-97f746335103",
        "name": "Get date",
        "type": "n8n-nodes-base.dateTime",
        "position": [
          1260,
          600
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 2
      },
      {
        "id": "4be431e2-e21b-48bd-8425-eac17e3174c8",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "position": [
          140,
          380
        ],
        "webhookId": "e634d721-48b0-4985-8a57-62ca4c7b3cfb",
        "parameters": {
          "path": "e634d721-48b0-4985-8a57-62ca4c7b3cfb",
          "options": {
            "allowedOrigins": "*"
          },
          "httpMethod": "POST",
          "responseMode": "responseNode"
        },
        "typeVersion": 2
      }
    ],
    "active": true,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "20900eaa-66cf-4e40-9cdf-fa224b991e86",
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Check if attachments exist",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get date": {
        "main": [
          [
            {
              "node": "Respond to Obsidian",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix Base64 string": {
        "main": [
          [
            {
              "node": "Process Each Attachment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check if it is a test": {
        "main": [
          [
            {
              "node": "Test Succesfull",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Email Without Attachments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email With Attachments": {
        "main": [
          [
            {
              "node": "Get date",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Each Attachment": {
        "main": [
          [
            {
              "node": "Prepare Attachments for Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Convert Attachment to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Separate attachment data": {
        "main": [
          [
            {
              "node": "Fix Base64 string",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email Without Attachments": {
        "main": [
          [
            {
              "node": "Get date",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check if attachments exist": {
        "main": [
          [
            {
              "node": "Separate attachment data",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Check if it is a test",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert Attachment to File": {
        "main": [
          [
            {
              "node": "Process Each Attachment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Attachments for Email": {
        "main": [
          [
            {
              "node": "Email With Attachments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "nodes": [
      {
        "id": "3a0ba7f4-ac41-49b0-a055-b993c82f2680",
        "name": "Every day at 9 am",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          340,
          1280
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "5fa47f36-3206-44b9-965a-0d27b10acc21",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          740,
          980
        ],
        "parameters": {
          "width": 348.2877732355713,
          "height": 595.2986206729652,
          "content": "## Search for all contacts that last contact date for is known\n\n1. Setup Oauth2 creds using n8n docs\nhttps://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.hubspottrigger/\n\n### Be careful with scopes. Scopes must be exactly as defined in the n8n docs\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### To make this more effective, we sort ascending by last contact date."
        },
        "typeVersion": 1
      },
      {
        "id": "16b6fadf-ff1d-4670-b148-151cfbd242d5",
        "name": "Send outreach email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2040,
          1060
        ],
        "parameters": {
          "sendTo": "={{ $json.to }}",
          "message": "={{ $json.html }}",
          "options": {
            "senderName": "Mutasem from n8n",
            "appendAttribution": false
          },
          "subject": "={{ $json.subject }}"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "rd2agqPeJBD2377h",
            "name": "Work Gmail"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "a89ec3bd-7bb0-4dde-a9eb-800842073fc9",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2000,
          1300
        ],
        "parameters": {
          "color": 3,
          "width": 289.74216745960825,
          "height": 402.1775107197669,
          "content": "## Record engagement in Hubspot\n\nOnce engagement is added, last contact date is updated and won't show up in search results for another month.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "687509ed-4d25-4597-bade-1802348e42c9",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          260,
          980
        ],
        "parameters": {
          "color": 5,
          "width": 407.25356360335365,
          "height": 242.51175804432177,
          "content": "## Send followup email using Gmail to Hubspot contacts \n\nFollowing up at the right time is one of the most important parts of sales. This workflow uses Gmail to send outreach emails to Hubspot contacts that have already been contacted only once more than a month ago, and records the engagement in Hubspot. "
        },
        "typeVersion": 1
      },
      {
        "id": "e66f48c9-0e19-4089-a4a4-d9e87b56898a",
        "name": "Record engagement in HubSpot",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          2080,
          1500
        ],
        "parameters": {
          "type": "email",
          "metadata": {
            "html": "={{ $json.html }}",
            "subject": "={{ $json.subject }}",
            "toEmail": [
              "={{ $json.to }}"
            ],
            "firstName": "Mutasem",
            "fromEmail": "mutasem@n8n.io"
          },
          "resource": "engagement",
          "authentication": "oAuth2",
          "additionalFields": {
            "associations": {
              "contactIds": "={{ $json.id }}"
            }
          }
        },
        "credentials": {
          "hubspotOAuth2Api": {
            "id": "Gxwfj6z9NwaEC3P5",
            "name": "HubSpot account 3"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "f90770cf-aa6c-4148-b471-2b28ed978f72",
        "name": "Get previously HubSpot contacts",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          840,
          1280
        ],
        "parameters": {
          "operation": "search",
          "authentication": "oAuth2",
          "filterGroupsUi": {
            "filterGroupsValues": [
              {
                "filtersUi": {
                  "filterValues": [
                    {
                      "operator": "HAS_PROPERTY",
                      "propertyName": "notes_last_contacted|datetime"
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {
            "sortBy": "notes_last_contacted",
            "direction": "ASCENDING",
            "properties": [
              "firstname",
              "lastname",
              "email",
              "notes_last_contacted"
            ]
          }
        },
        "credentials": {
          "hubspotOAuth2Api": {
            "id": "Gxwfj6z9NwaEC3P5",
            "name": "HubSpot account 3"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "751fd345-9fec-4c7c-b20b-1db86ce6df10",
        "name": "if last contacted before a month",
        "type": "n8n-nodes-base.if",
        "position": [
          1120,
          1280
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "8d9ad7ef-6e1a-486c-9fac-419ad2660ace",
                "operator": {
                  "type": "dateTime",
                  "operation": "before"
                },
                "leftValue": "={{ $json.properties.notes_last_contacted }}",
                "rightValue": "={{ DateTime.now().minus({days: 30}) }}"
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "52596987-ef7f-4dd7-98e7-6c3aaf6c2853",
        "name": "Get Hubspot Contact to engagement",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1340,
          1280
        ],
        "parameters": {
          "url": "=https://api.hubapi.com/crm-associations/v1/associations/{{ $json.id }}/HUBSPOT_DEFINED/9",
          "options": {},
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubspotOAuth2Api"
        },
        "credentials": {
          "hubspotOAuth2Api": {
            "id": "Gxwfj6z9NwaEC3P5",
            "name": "HubSpot account 3"
          }
        },
        "typeVersion": 4.1
      },
      {
        "id": "fe0bc120-8bee-41fa-a896-3c9ff8cf3a29",
        "name": "if there has been only one engagement",
        "type": "n8n-nodes-base.if",
        "position": [
          1560,
          1280
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "07c7e29c-eed1-4872-a9f7-b833bb0cafca",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.results.length }}",
                "rightValue": 1
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "512909c7-104b-4507-b91e-aa5b5a9410e5",
        "name": "Set email keys",
        "type": "n8n-nodes-base.set",
        "position": [
          1820,
          1280
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "f3ecc873-2d60-4f2d-bc40-81f9379c725b",
                "name": "html",
                "type": "string",
                "value": "=Hey {{ $json.properties.firstname }},\n\nJust want to follow up on my previous email, since I have not \n heard from you. Have you had the chance to consider n8n? \n\nCheers,\n\nMutasem"
              },
              {
                "id": "9f4f5b68-984b-415e-a110-a35ded22dd41",
                "name": "subject",
                "type": "string",
                "value": "Follow up on n8n"
              },
              {
                "id": "5362aa67-f3fa-4a6e-b6e8-4c50cc7a3192",
                "name": "to",
                "type": "string",
                "value": "={{ $('Get previously HubSpot contacts').item.json.properties.email }}"
              },
              {
                "id": "5b11e503-868d-4fca-bb44-59bb44d597a8",
                "name": "id",
                "type": "string",
                "value": "={{ $('Get previously HubSpot contacts').item.json.id }}"
              }
            ]
          }
        },
        "typeVersion": 3.3
      },
      {
        "id": "c0e5472d-5208-4df7-89e8-380c2dab9642",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1300,
          1060
        ],
        "parameters": {
          "color": 4,
          "width": 490.3275896931988,
          "height": 496.3776986502359,
          "content": "## Get pervious engagements. Avoid sending follow ups if first eng\n\n### Here we simply follow up if there has only been outreach email before.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### We could the engagements here and their types and perform more advanced filtering. "
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Set email keys": {
        "main": [
          [
            {
              "node": "Record engagement in HubSpot",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send outreach email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Every day at 9 am": {
        "main": [
          [
            {
              "node": "Get previously HubSpot contacts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get previously HubSpot contacts": {
        "main": [
          [
            {
              "node": "if last contacted before a month",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "if last contacted before a month": {
        "main": [
          [
            {
              "node": "Get Hubspot Contact to engagement",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Hubspot Contact to engagement": {
        "main": [
          [
            {
              "node": "if there has been only one engagement",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "if there has been only one engagement": {
        "main": [
          [
            {
              "node": "Set email keys",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "FmBx6nhuF6oBguoL",
    "meta": {
      "instanceId": "28a947b92b197fc2524eaba16e57560338657b2b0b5796300b2f1cedc1d0d355",
      "templateCredsSetupCompleted": true
    },
    "name": "Send LinkedIn Connection Request",
    "tags": [],
    "nodes": [
      {
        "id": "887e533f-8c7e-410f-a1c0-6efa71afbfe1",
        "name": "On form submission",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -460,
          -200
        ],
        "webhookId": "03fb9147-76e2-4734-983d-ea6e3e31adeb",
        "parameters": {
          "options": {},
          "formTitle": "LinkedIn connection requests",
          "formFields": {
            "values": [
              {
                "fieldLabel": "LinkedIn URL",
                "requiredField": true
              },
              {
                "fieldLabel": "Airtop Profile (connected to Linkedin)",
                "requiredField": true
              },
              {
                "fieldType": "textarea",
                "fieldLabel": "Message"
              }
            ]
          },
          "formDescription": "=<p>This automation checks whether a person is a contact on LinkedIn.</p>\n\n<p>If the person is not connected, the automation will send a connection request automatically.</p>\n\n<p>The automation requires an Airtop Profile that is authenticated on LinkedIn. Don't have one? Create a free profile and log in to LinkedIn at <a href=\"https://portal.airtop.ai/browser-profiles\">https://portal.airtop.ai/browser-profiles</a>.</p>\n"
        },
        "typeVersion": 2.2
      },
      {
        "id": "61a37f6b-a032-407e-b10c-070685902136",
        "name": "When Executed by Another Workflow",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "position": [
          -460,
          0
        ],
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "airtop_profile"
              },
              {
                "name": "linked_url"
              },
              {
                "name": "message"
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "99ed7cb1-2b89-4b04-9cb4-e57040a9804c",
        "name": "Switch1",
        "type": "n8n-nodes-base.switch",
        "position": [
          1300,
          -240
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "28a7e0bb-72a4-43bf-b62b-6136a705c489",
                      "operator": {
                        "type": "string",
                        "operation": "empty",
                        "singleValue": true
                      },
                      "leftValue": "={{ $('Unify Params').item.json.message }}",
                      "rightValue": ""
                    }
                  ]
                }
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "cbd885ba-776c-4425-8213-9b74ac1af647",
                      "operator": {
                        "type": "string",
                        "operation": "notEmpty",
                        "singleValue": true
                      },
                      "leftValue": "={{ $('Unify Params').item.json.message }}",
                      "rightValue": ""
                    }
                  ]
                }
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "291b375d-e7e5-4248-a518-1f8d94f973f8",
        "name": "Unify Params",
        "type": "n8n-nodes-base.set",
        "position": [
          -240,
          -100
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "362c7a61-fa44-4ba0-8045-ff66ab37cd3b",
                "name": "linkedin_url",
                "type": "string",
                "value": "={{ $json.linkedin_url || $json['LinkedIn URL']}}"
              },
              {
                "id": "8ad1abd4-34d1-4d55-ae83-1320d41967b2",
                "name": "airtop_profile",
                "type": "string",
                "value": "={{ $json.airtop_profile || $json['Airtop Profile (connected to Linkedin)']}}"
              },
              {
                "id": "09630ef2-3561-40bb-aeb7-19feb8c5a8a5",
                "name": "message",
                "type": "string",
                "value": "={{ $json.message || $json['Message']}}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "401038a9-24ef-4705-b80b-4cfd83bf1a89",
        "name": "Click on connect",
        "type": "n8n-nodes-base.airtop",
        "position": [
          1080,
          -240
        ],
        "parameters": {
          "resource": "interaction",
          "windowId": "={{ $json.windowId }}",
          "sessionId": "={{ $json.sessionId }}",
          "additionalFields": {
            "visualScope": "viewport"
          },
          "elementDescription": "Connect"
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "19225625-1941-4f59-bd9b-b3b9b7e9b1ca",
        "name": "Send connection w/out message",
        "type": "n8n-nodes-base.airtop",
        "position": [
          1840,
          -300
        ],
        "parameters": {
          "resource": "interaction",
          "windowId": "={{ $('Click on connect').item.json.windowId }}",
          "sessionId": "={{ $('Click on connect').item.json.sessionId }}",
          "additionalFields": {
            "visualScope": "viewport"
          },
          "elementDescription": "Send without a note"
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f73c4d2e-6484-4406-a387-ba2bbe7bb946",
        "name": "Click add a note",
        "type": "n8n-nodes-base.airtop",
        "position": [
          1480,
          -20
        ],
        "parameters": {
          "resource": "interaction",
          "windowId": "={{ $('Click on connect').item.json.windowId }}",
          "sessionId": "={{ $('Click on connect').item.json.sessionId }}",
          "additionalFields": {
            "visualScope": "viewport"
          },
          "elementDescription": "Add a note"
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "897ef0b7-dd75-45ed-9e9d-b9b00e7d8855",
        "name": "Type the message",
        "type": "n8n-nodes-base.airtop",
        "position": [
          1700,
          -20
        ],
        "parameters": {
          "text": "={{ $('Unify Params').item.json.message }}",
          "resource": "interaction",
          "windowId": "={{ $json.windowId }}",
          "operation": "type",
          "sessionId": "={{ $json.sessionId }}",
          "additionalFields": {
            "visualScope": "viewport"
          }
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "743a2347-fd6c-4327-af41-5872ff9f8bca",
        "name": "Send connection w/ message",
        "type": "n8n-nodes-base.airtop",
        "position": [
          1900,
          -20
        ],
        "parameters": {
          "resource": "interaction",
          "windowId": "={{ $json.windowId }}",
          "sessionId": "={{ $json.sessionId }}",
          "additionalFields": {
            "visualScope": "viewport"
          },
          "elementDescription": "Send"
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "adba0046-7288-46ec-8c13-c76760c44edd",
        "name": "Create a Session",
        "type": "n8n-nodes-base.airtop",
        "position": [
          -20,
          -100
        ],
        "parameters": {
          "profileName": "={{ $json.airtop_profile }}",
          "additionalFields": {},
          "saveProfileOnTermination": true
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f081e081-9525-4d31-bc56-9be6123e81d2",
        "name": "Create a window",
        "type": "n8n-nodes-base.airtop",
        "position": [
          200,
          -100
        ],
        "parameters": {
          "url": "={{ $('Unify Params').item.json.linkedin_url }}",
          "resource": "window",
          "getLiveView": true,
          "additionalFields": {}
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "ab766028-e576-49aa-8bdc-9615ed403282",
        "name": "Click More button",
        "type": "n8n-nodes-base.airtop",
        "position": [
          420,
          -100
        ],
        "parameters": {
          "resource": "interaction",
          "additionalFields": {
            "visualScope": "viewport"
          },
          "elementDescription": "More button"
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "66bebc96-fb99-445b-b0a4-b05b3a2f6980",
        "name": "Is a connection?",
        "type": "n8n-nodes-base.switch",
        "position": [
          860,
          -100
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "b798dcb0-1ab0-486e-8d46-1707f4f45737",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      },
                      "leftValue": "={{ $json.data.modelResponse }}",
                      "rightValue": "Connect"
                    }
                  ]
                }
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "9a21639a-ff59-40c5-9dc2-a77a212c3d19",
                      "operator": {
                        "type": "string",
                        "operation": "notContains"
                      },
                      "leftValue": "={{ $json.data.modelResponse }}",
                      "rightValue": "Connect"
                    }
                  ]
                }
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "9ff5f293-1c49-455d-b7bb-260bc88585e4",
        "name": "Terminate session",
        "type": "n8n-nodes-base.airtop",
        "position": [
          1080,
          0
        ],
        "parameters": {
          "operation": "terminate",
          "sessionId": "={{ $json.sessionId }}"
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "5e525111-b621-47ed-b5a6-4041f7e9eb86",
        "name": "Terminate session1",
        "type": "n8n-nodes-base.airtop",
        "position": [
          2360,
          -120
        ],
        "parameters": {
          "operation": "terminate"
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "0a483ecb-6967-4f47-8716-df8d218d40b1",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -520,
          -320
        ],
        "parameters": {
          "width": 440,
          "height": 480,
          "content": "## Input Parameters\nRun this workflow using a form or another workflow"
        },
        "typeVersion": 1
      },
      {
        "id": "bf0c6f69-b175-4c3f-ac1a-09fd9fda014c",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -60,
          -320
        ],
        "parameters": {
          "color": 4,
          "width": 1040,
          "height": 480,
          "content": "## LinkedIn Connection Checker\nVerifies whether a specified individual is a first-degree connection on LinkedIn using Airtop"
        },
        "typeVersion": 1
      },
      {
        "id": "f0d42603-d85b-4bea-9edd-950decaab8dd",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1000,
          -320
        ],
        "parameters": {
          "color": 5,
          "width": 1100,
          "height": 480,
          "content": "## Send connection request\n"
        },
        "typeVersion": 1
      },
      {
        "id": "26a9ce2e-31e1-4f3c-a0ea-033cbe28c108",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1000,
          -80
        ],
        "parameters": {
          "color": 3,
          "width": 300,
          "height": 240,
          "content": "## End Airtop session \nThe user is already a connection"
        },
        "typeVersion": 1
      },
      {
        "id": "041c730f-3e1c-4b40-a0c1-af8041166839",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2340,
          -320
        ],
        "parameters": {
          "color": 3,
          "width": 210,
          "height": 480,
          "content": "## End Airtop session "
        },
        "typeVersion": 1
      },
      {
        "id": "47a7face-b181-4975-9c52-dd4a88f76c40",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1440,
          -320
        ],
        "parameters": {
          "color": 6,
          "width": 640,
          "height": 200,
          "content": "## Send request without a note\nIf a message is not provided, \nthe request is send without a note"
        },
        "typeVersion": 1
      },
      {
        "id": "19ae1946-161c-4696-bdec-309cdeda56a1",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1440,
          -100
        ],
        "parameters": {
          "width": 640,
          "height": 260,
          "content": "##                    Send request with a note\nIf a message is provided, the request is send with a note"
        },
        "typeVersion": 1
      },
      {
        "id": "676c1d9f-5478-4c59-9764-4a2d8336d46d",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1240,
          -620
        ],
        "parameters": {
          "width": 700,
          "height": 1080,
          "content": "README\n\n# Automating LinkedIn Connection Requests\n\n## Use Case\n\nAutomatically sending LinkedIn connection requests to prospects can significantly streamline your outreach process. This automation ensures you only send requests to users you're not already connected with, and can optionally include a personalized message.\n\n## What This Automation Does\n\nThis automation sends a LinkedIn connection request using the following input parameters:\n\n- **linked_url**: The LinkedIn profile URL of the person you want to connect with.\n- **airtop_profile**: The name of your [Airtop Profile](https://portal.airtop.ai/browser-profiles) authenticated on LinkedIn.\n- **message** *(optional)*: The note you want to include with your connection request.\n\n## How It Works\n\n1. Starts an Airtop browser session using your authenticated profile.\n2. Opens the target LinkedIn profile in a new browser window.\n3. Detects if you're already connected or if a connection request is pending.\n4. If the \"Connect\" button is available:\n   - If no message is provided, clicks \"Connect\" and sends the request without a note.\n   - If a message is provided, clicks \"Add a note\", types the message, and sends the request.\n5. Terminates the browser session.\n\n## Setup Requirements\n\n1. [Airtop API Key](https://portal.airtop.ai/api-keys) ‚Äî free to generate.\n2. An [Airtop Profile](https://portal.airtop.ai/browser-profiles) logged in to LinkedIn (requires one-time authentication).\n\n## Next Steps\n\n- **Pair with People Enrichment**: Use with the [LinkedIn Profile Finder](https://www.airtop.ai/blog/find-linkedin-profile-from-email) to generate URLs before sending requests.\n- **CRM Integration**: Log connection attempts and responses in your CRM.\n- **Campaign Sequencing**: Combine with message follow-up automations for a complete outreach flow.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "ace44b2d-dbb7-4525-80b0-0d720b19815e",
        "name": "Check connection status",
        "type": "n8n-nodes-base.airtop",
        "position": [
          640,
          -100
        ],
        "parameters": {
          "prompt": "=This is a LinkedIn profile page. Please perform the following actions based on the presence of specific elements in the top profile box:\n\n- Reply \"Connect\" if a \"Connect\" button is present.\n- Reply \"Pending\" if a \"Pending\" message is present.\n- Reply \"1st degree\" if this person is a first-degree connection, indicated by \"1st\" near the name.\n\nDo not reply with anything else.\n\nFor example:\n- If the \"Connect\" button is present, the output should be: \"Connect\"\n- If the \"Pending\" message is present, the output should be: \"Pending\"\n- If the person is a first-degree connection, the output should be: \"1st degree\"",
          "resource": "extraction",
          "operation": "query",
          "additionalFields": {}
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "8c0f7084-04ac-4b58-a44c-cce663de1b68",
        "name": "Airtop",
        "type": "n8n-nodes-base.airtop",
        "position": [
          2160,
          -120
        ],
        "parameters": {
          "resource": "window",
          "operation": "takeScreenshot",
          "outputImageAsBinary": true
        },
        "credentials": {
          "airtopApi": {
            "id": "Yi4YPNnovLVUjFn5",
            "name": "Airtop Official Org"
          }
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "callerPolicy": "workflowsFromSameOwner",
      "errorWorkflow": "jOzgI7as1gGhlZ91",
      "executionOrder": "v1"
    },
    "versionId": "2e66163a-0490-4e6f-99f0-939f3e26e6b3",
    "connections": {
      "Airtop": {
        "main": [
          [
            {
              "node": "Terminate session1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Send connection w/out message",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Click add a note",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Unify Params": {
        "main": [
          [
            {
              "node": "Create a Session",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a window": {
        "main": [
          [
            {
              "node": "Click More button",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Click add a note": {
        "main": [
          [
            {
              "node": "Type the message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Click on connect": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a Session": {
        "main": [
          [
            {
              "node": "Create a window",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is a connection?": {
        "main": [
          [
            {
              "node": "Click on connect",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Terminate session",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Type the message": {
        "main": [
          [
            {
              "node": "Send connection w/ message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Click More button": {
        "main": [
          [
            {
              "node": "Check connection status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On form submission": {
        "main": [
          [
            {
              "node": "Unify Params",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check connection status": {
        "main": [
          [
            {
              "node": "Is a connection?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send connection w/ message": {
        "main": [
          [
            {
              "node": "Airtop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send connection w/out message": {
        "main": [
          [
            {
              "node": "Airtop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Unify Params",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "257476b1ef58bf3cb6a46e65fac7ee34a53a5e1a8492d5c6e4da5f87c9b82833",
      "templateId": "2088"
    },
    "nodes": [
      {
        "id": "0e4c65ce-95e9-4a32-bc5c-0461cb339764",
        "name": "Filter Status (Waiting for sending)",
        "type": "n8n-nodes-base.filter",
        "position": [
          1670,
          1110
        ],
        "parameters": {
          "options": {
            "looseTypeValidation": true
          },
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "401b79a0-a079-4ea0-805b-a963d9206031",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.Status }}",
                "rightValue": "Waiting for sending"
              },
              {
                "id": "74ec18c7-e4cc-4d82-ba05-0ec4781cbb9f",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.Title }}",
                "rightValue": ""
              },
              {
                "id": "6e293a16-48cd-40bb-9882-09b456a97d58",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.Subject }}",
                "rightValue": ""
              },
              {
                "id": "a02d2518-e979-4a17-ab00-dda6723d9945",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.Email }}",
                "rightValue": ""
              },
              {
                "id": "bea4e49e-cf8a-4f05-bd6f-bdce0c5d8533",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.Name }}",
                "rightValue": ""
              },
              {
                "id": "e33eb064-34c6-4dea-b454-10f4fb7fe630",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.Date }}",
                "rightValue": ""
              },
              {
                "id": "1abe48e3-ba4d-4318-900d-fd58097d55ec",
                "operator": {
                  "type": "dateTime",
                  "operation": "equals"
                },
                "leftValue": "={{ DateTime.fromFormat($json[\"Date\"], 'yyyy/MM/dd').startOf('day')}}",
                "rightValue": "={{ $now.startOf('day')}}"
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "27f33448-a016-4ac8-aea3-2ca267fb1628",
        "name": "Set data",
        "type": "n8n-nodes-base.set",
        "position": [
          2290,
          1090
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "email",
                "stringValue": "={{ $json.Email }}"
              },
              {
                "name": "name",
                "stringValue": "={{ $json.Name }}"
              },
              {
                "name": "ID",
                "stringValue": "={{ $json.ID }}"
              }
            ]
          },
          "include": "selected",
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "badf1d45-21e0-40a5-bcc4-c434f43c04d4",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          390,
          250
        ],
        "parameters": {
          "width": 922.8914139860617,
          "height": 1171.2381808131183,
          "content": "# Node Descriptions\n\n## Retrieve Customer Messages Data (Google Sheets Node ):\n**Purpose and Use Cases:**\nThe primary purpose of this node is to retrieve data from a Google Sheets document that contains information about messages to customers. This could be used in various scenarios, such as:\n\n- Compiling a list of customer contacts for outreach campaigns.\n- Gathering feedback or responses stored in a spreadsheet.\n- Automating the process of updating customer records or tracking communications.\n\n\n## Filter Items by Current Date Node:\n- **Purpose:** Filters input items based on comparison with the current date.\n- **Parameters:**\n  - **JavaScript Code:** Compares item dates with the current date for filtering.\n- **Functionality:** Ensures only items with dates matching the current date are passed along.\n\n ### Note : The date format should be in this form (year/month/day) to be accepted.\n\n## Gmail Node:\n- **Purpose:** Likely sends emails using Gmail based on filtered items.\n- **Parameters:**\n  - **Recipient:** Extracted from input data.\n  - **Subject:** Extracted from input data.\n  - **Email Content:** Extracted from input data.\n\n## Update Message Status(Google Sheets Node ):\n- **Purpose:** Updates specific columns in the Google Sheets document.\n- **Parameters:**\n  - **Operation:** Update mode.\n  - **Columns:** Defines which columns to update with values from input data.\n\n## Filter Status (Waiting for sending) Node:\n- **Purpose:** Filters items based on specific status criteria.\n- **Parameters:**\n  - **Conditions:** Filters based on status, title, subject, email, name, and date.\n\n## Set data Node:\n- **Purpose:** Sets specified fields with extracted values from input data.\n\n## Merge feild Node:\n- **Purpose:** Merges fields from different sources based on position.\n\nFeel free to utilize these detailed descriptions to understand and enhance the workflow further.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "0f1cd01b-4cf0-4998-9c51-02c2c9c4aa2b",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1330,
          870
        ],
        "parameters": {
          "width": 1386.7301333853884,
          "height": 539.317352764935,
          "content": "# The Workflow"
        },
        "typeVersion": 1
      },
      {
        "id": "421b47fd-4707-41ec-97e4-7256be22b75d",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          380,
          240
        ],
        "parameters": {
          "color": 7,
          "width": 2358.9018586668417,
          "height": 1194.0044652590357,
          "content": "\n"
        },
        "typeVersion": 1
      },
      {
        "id": "dfb3d998-14fc-4d2a-af9e-19c7da8060f9",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1330,
          255
        ],
        "parameters": {
          "width": 342.9710297084147,
          "height": 601.2740375761717,
          "content": "## Copy this template to get started :\n- [Google Sheets](https://docs.google.com/spreadsheets/d/1efCCzfeUX0AETz2wsULQN90OBCOKK-gBoDaptzcBHdE/edit?usp=sharing)\n\n## Workflow Nodes Documentation:\n\n1. [Schedule Trigger](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.scheduletrigger/)\n2. [Filter Items by Current Date](https://docs.n8n.io/nodes/n8n-nodes-base.code.html)\n3. [Gmail](https://docs.n8n.io/nodes/n8n-nodes-base.gmail.html)\n4. [Google Sheets](https://docs.n8n.io/nodes/n8n-nodes-base.googleSheets.html)\n5. [Filter Status (Waiting for sending)](https://docs.n8n.io/nodes/n8n-nodes-base.filter.html)\n6. [Set data](https://docs.n8n.io/nodes/n8n-nodes-base.set.html)\n7. [Merge feild](https://docs.n8n.io/nodes/n8n-nodes-base.merge.html)\n"
        },
        "typeVersion": 1
      },
      {
        "id": "4ed5a195-fd49-465e-9a14-fa64cd96056b",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1690,
          250
        ],
        "parameters": {
          "width": 1024.157503378047,
          "height": 602.8437691253422,
          "content": "## Workflow Overview:\n\nThe workflow begins with the \"Google Sheets Trigger\" node, which monitors a specified Google Sheet for new row additions. Upon detection of a new row, the workflow progresses to the \"Filter Status (Waiting for sending)\" node, where items are filtered based on specific conditions.\n\nSubsequently, the workflow moves to the \"Filter Items by Current Date\" node, which filters items based on the current date. Items matching the current date are then processed further.\n\nThe filtered items are then forwarded to the \"Gmail\" node, where personalized emails are composed and sent to recipients based on the Google Sheet data. Finally, the workflow updates the Google Sheet using the \"Google Sheets\" node with the status of the sent emails and other relevant information."
        },
        "typeVersion": 1
      },
      {
        "id": "d156f0da-53e7-499b-b652-5ca0c3c9e237",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          1350,
          1110
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 1
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "e398e809-b00f-4edb-af94-d236cfb80703",
        "name": "Retrieve Customer Messages Data",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1510,
          1110
        ],
        "parameters": {
          "options": {},
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/126qQdkEWt_4Vkxvu6G80rBeFdIp_a8ISMz-898fa2D4/edit#gid=0",
            "cachedResultName": "Page"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "126qQdkEWt_4Vkxvu6G80rBeFdIp_a8ISMz-898fa2D4",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/126qQdkEWt_4Vkxvu6G80rBeFdIp_a8ISMz-898fa2D4/edit?usp=drivesdk",
            "cachedResultName": "Copy of Sending Messages to Customers"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "9",
            "name": "Nik's Google"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "6de55876-3924-4fdc-aae7-b901a2ce72be",
        "name": "Update Message Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2490,
          1090
        ],
        "parameters": {
          "columns": {
            "value": {
              "ID": "={{ $json.ID }}",
              "Status": "Sent successfully"
            },
            "schema": [
              {
                "id": "ID",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "ID",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Name",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "Name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Email",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "Email",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Date",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "Date",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Status",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "Status",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Title",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "Title",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Subject",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "Subject",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": true,
                "required": false,
                "displayName": "row_number",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "ID"
            ]
          },
          "options": {},
          "operation": "update",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/126qQdkEWt_4Vkxvu6G80rBeFdIp_a8ISMz-898fa2D4/edit#gid=0",
            "cachedResultName": "Page"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "126qQdkEWt_4Vkxvu6G80rBeFdIp_a8ISMz-898fa2D4",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/126qQdkEWt_4Vkxvu6G80rBeFdIp_a8ISMz-898fa2D4/edit?usp=drivesdk",
            "cachedResultName": "Copy of Sending Messages to Customers"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "9",
            "name": "Nik's Google"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "0401bfe7-de72-407a-a7f7-70b7da52e9c9",
        "name": "Send a message (Gmail)",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1900,
          980
        ],
        "parameters": {
          "sendTo": "={{ $json.Email }}",
          "message": "={{ $json.Subject }}",
          "options": {},
          "subject": "={{ $json.Title }}",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "3",
            "name": "Gmail account"
          }
        },
        "notesInFlow": false,
        "typeVersion": 2.1,
        "alwaysOutputData": false
      },
      {
        "id": "94ff4e81-41c6-479e-bcb5-c9786935a954",
        "name": "Merge fields",
        "type": "n8n-nodes-base.merge",
        "position": [
          2110,
          1090
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "combinationMode": "mergeByPosition"
        },
        "typeVersion": 2.1
      }
    ],
    "pinData": {},
    "connections": {
      "Set data": {
        "main": [
          [
            {
              "node": "Update Message Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge fields": {
        "main": [
          [
            {
              "node": "Set data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Retrieve Customer Messages Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send a message (Gmail)": {
        "main": [
          [
            {
              "node": "Merge fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retrieve Customer Messages Data": {
        "main": [
          [
            {
              "node": "Filter Status (Waiting for sending)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Status (Waiting for sending)": {
        "main": [
          [
            {
              "node": "Merge fields",
              "type": "main",
              "index": 1
            },
            {
              "node": "Send a message (Gmail)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "257476b1ef58bf3cb6a46e65fac7ee34a53a5e1a8492d5c6e4da5f87c9b82833",
      "templateId": "2112"
    },
    "nodes": [
      {
        "id": "99d9377f-263b-4deb-8450-6f9ca17d77c7",
        "name": "Send outreach email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1420,
          320
        ],
        "parameters": {
          "sendTo": "={{ $json.properties.email }}",
          "message": "={{ $json.html }}",
          "options": {
            "senderName": "Mutasem from n8n",
            "appendAttribution": false
          },
          "subject": "={{ $json.subject }}"
        },
        "typeVersion": 2.1
      },
      {
        "id": "aa2d7d84-66e1-4df3-9244-9a9182cd2eb7",
        "name": "Get uncontacted HubSpot contacts",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          960,
          540
        ],
        "parameters": {
          "operation": "search",
          "authentication": "oAuth2",
          "filterGroupsUi": {
            "filterGroupsValues": [
              {
                "filtersUi": {
                  "filterValues": [
                    {
                      "operator": "NOT_HAS_PROPERTY",
                      "propertyName": "notes_last_contacted|datetime"
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {}
        },
        "typeVersion": 2
      },
      {
        "id": "cecf3de5-43d8-4d63-a557-adbd1d7d0e81",
        "name": "Every day at 9 am",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          460,
          540
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "faa91fac-7a22-440d-8575-a9f6ef858641",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          820,
          240
        ],
        "parameters": {
          "width": 348.2877732355713,
          "height": 526.4585335073351,
          "content": "## Search for all contacts that last contact date for is unknown\n\n1. Setup Oauth2 creds using n8n docs\nhttps://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.hubspottrigger/\n\n### Be careful with scopes. Scopes must be exactly as defined in the n8n docs"
        },
        "typeVersion": 1
      },
      {
        "id": "edf7e39d-efc7-405c-a610-0b098f86de07",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1380,
          560
        ],
        "parameters": {
          "color": 3,
          "width": 289.74216745960825,
          "height": 402.1775107197669,
          "content": "## Record outreach in Hubspot\n\nOnce outreach is added, last contact date is updated and won't be contacted again\n"
        },
        "typeVersion": 1
      },
      {
        "id": "07dc70c8-bf11-4dbd-9f99-1dad8d233e70",
        "name": "Set keys",
        "type": "n8n-nodes-base.set",
        "position": [
          1200,
          540
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "f3ecc873-2d60-4f2d-bc40-81f9379c725b",
                "name": "html",
                "type": "string",
                "value": "=Hey {{ $json.properties.firstname }},\n\nI'm with n8n, and we work with organizations like yours to empower you to automate away boring and difficult tasks with ease.\n\nCan you point me towards the right person on your team to chat with about this?\n\nCheers,\n\nMutasem"
              },
              {
                "id": "9f4f5b68-984b-415e-a110-a35ded22dd41",
                "name": "subject",
                "type": "string",
                "value": "Why n8n?"
              },
              {
                "id": "5362aa67-f3fa-4a6e-b6e8-4c50cc7a3192",
                "name": "to",
                "type": "string",
                "value": "={{ $json.properties.email }}"
              },
              {
                "id": "5b11e503-868d-4fca-bb44-59bb44d597a8",
                "name": "id",
                "type": "string",
                "value": "={{ $json.id }}"
              }
            ]
          }
        },
        "typeVersion": 3.3
      },
      {
        "id": "506b5b31-8aec-4f74-b194-474c9b09c3f1",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          380,
          240
        ],
        "parameters": {
          "color": 5,
          "width": 407.25356360335365,
          "height": 242.51175804432177,
          "content": "## Send outreach/cold email using Gmail to new Hubspot contacts\n\nThis workflow uses Gmail to send outreach emails to Hubspot contacts that have yet to contacted (usually unknown contacts), and records the engagement in Hubspot. "
        },
        "typeVersion": 1
      },
      {
        "id": "89afc291-e706-4930-bee7-114d556b4c59",
        "name": "Record engagement in HubSpot",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          1460,
          760
        ],
        "parameters": {
          "type": "email",
          "metadata": {
            "html": "={{ $json.html }}",
            "subject": "={{ $json.subject }}",
            "toEmail": [
              "={{ $json.to }}"
            ],
            "firstName": "Mutasem",
            "fromEmail": "mutasem@n8n.io"
          },
          "resource": "engagement",
          "authentication": "oAuth2",
          "additionalFields": {
            "associations": {
              "contactIds": "={{ $json.id }}"
            }
          }
        },
        "typeVersion": 2
      }
    ],
    "pinData": {},
    "connections": {
      "Set keys": {
        "main": [
          [
            {
              "node": "Send outreach email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Record engagement in HubSpot",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Every day at 9 am": {
        "main": [
          [
            {
              "node": "Get uncontacted HubSpot contacts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get uncontacted HubSpot contacts": {
        "main": [
          [
            {
              "node": "Set keys",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "nodes": [
      {
        "id": "bf8e54e6-3ea5-41d1-8870-deb3493e4b26",
        "name": "Form Trigger",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -3040,
          16
        ],
        "webhookId": "auto-connect-commenters",
        "parameters": {
          "path": "auto-connect-commenters",
          "options": {},
          "formTitle": "üîó LinkedIn Post Engagement Automation",
          "formFields": {
            "values": [
              {
                "fieldLabel": "LinkedIn Post URL",
                "requiredField": true
              }
            ]
          },
          "formDescription": "Enter your LinkedIn post URL below to automatically send personalized connection requests to commenters"
        },
        "typeVersion": 2
      },
      {
        "id": "7203c1f6-bc1a-4966-8334-d3daf6decce9",
        "name": "Split Commenters",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -2480,
          16
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "comments"
        },
        "typeVersion": 1
      },
      {
        "id": "c3ccc9da-3af2-420a-a6f2-93ff979a3c0b",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          -2256,
          16
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "020ec569-c6f8-4fdd-9f72-aef8deba38d3",
        "name": "Should Send?",
        "type": "n8n-nodes-base.if",
        "position": [
          -1664,
          -80
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 1,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "condition1",
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.connected }}",
                "rightValue": false
              },
              {
                "id": "condition2",
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.invitationSent }}",
                "rightValue": false
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "b115ff85-bd9b-4669-803d-dbd17dc82acd",
        "name": "Generate Message",
        "type": "n8n-nodes-base.code",
        "position": [
          -1328,
          -96
        ],
        "parameters": {
          "jsCode": "// Spin text template - customize with your name and style\nconst spinTextTemplate = `{Thanks for|Really appreciate|Awesome to see|Loved seeing|Grateful for} {your|you taking a moment to|you recently} {comment on|engaging with|reaction to|thoughts on|feedback on} {my|our|the} {post|recent post|latest update|content|recent article}.\n\n{Would love to|Happy to|Let's definitely|Open to|Excited to} connect {and|so we can|to} {exchange ideas|share insights|continue the conversation|explore synergies|stay in touch}. {Always enjoy connecting with|Always excited to meet|Love meeting|Great connecting with} {like-minded professionals|people in the space|others exploring similar topics|fellow thought leaders}.\n\n{Cheers|Best regards|Thanks again|Looking forward|Talk soon},\nAmaan sarfaraz`;\n\n// Parse spin text to generate unique variations\nfunction parseSpinText(text) {\n  return text.replace(/\\{([^}]+)\\}/g, (match, options) => {\n    const choices = options.split('|');\n    return choices[Math.floor(Math.random() * choices.length)];\n  });\n}\n\nconst generatedMessage = parseSpinText(spinTextTemplate);\nconst commenterData = $('Loop Over Items').item.json;\nconst commenterName = commenterData.author?.firstName || 'there';\nconst finalMessage = `Hi ${commenterName},\\n\\n${generatedMessage}`;\n\n// Keep under LinkedIn's 300 character limit\nconst trimmedMessage = finalMessage.length > 300 \n  ? finalMessage.substring(0, 297) + '...'\n  : finalMessage;\n\nreturn {\n  generatedMessage: trimmedMessage,\n  commenterName: commenterName,\n  commenterProfileId: commenterData.author?.publicIdentifier,\n  commentText: commenterData.commentText\n};"
        },
        "typeVersion": 2
      },
      {
        "id": "4d1d6b90-c134-4ebc-a147-a65bce3ba57f",
        "name": "Wait 1-2 Hours",
        "type": "n8n-nodes-base.wait",
        "position": [
          -800,
          -96
        ],
        "webhookId": "rate-limit-wait",
        "parameters": {
          "unit": "hours",
          "amount": 1
        },
        "typeVersion": 1.1
      },
      {
        "id": "ecacadcc-730e-470d-b740-a9e3ce04692d",
        "name": "Log Success",
        "type": "n8n-nodes-base.code",
        "position": [
          -544,
          -96
        ],
        "parameters": {
          "jsCode": "const commenterData = $('Loop Over Items').item.json;\nconst message = $('Generate Message').first().json;\n\nreturn {\n  success: true,\n  commenterName: message.commenterName,\n  commenterProfileId: message.commenterProfileId,\n  messageSent: message.generatedMessage,\n  timestamp: new Date().toISOString(),\n  commentText: message.commentText\n};"
        },
        "typeVersion": 2
      },
      {
        "id": "c01eaab7-af5f-4ea5-bf20-116370465b40",
        "name": "Log Skipped",
        "type": "n8n-nodes-base.code",
        "position": [
          -656,
          400
        ],
        "parameters": {
          "jsCode": "const relationshipData = $('Check Relationship').first().json;\nconst commenterData = $('Loop Over Items').item.json;\n\nreturn {\n  skipped: true,\n  reason: relationshipData.isConnected ? 'Already connected' : 'Pending invitation',\n  commenterName: commenterData.author?.firstName || 'Unknown',\n  commenterProfileId: commenterData.author?.publicIdentifier,\n  isConnected: relationshipData.isConnected,\n  invitationSent: relationshipData.invitationSent,\n  timestamp: new Date().toISOString()\n};"
        },
        "typeVersion": 2
      },
      {
        "id": "ac686743-19b1-4bf9-a64a-4ad237adcf4d",
        "name": "Merge Results",
        "type": "n8n-nodes-base.merge",
        "position": [
          -224,
          16
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "mergeByFields": {
            "values": [
              {}
            ]
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "b79bff65-d269-40b8-bcaf-93308e0179ee",
        "name": "Generate Summary",
        "type": "n8n-nodes-base.code",
        "position": [
          0,
          16
        ],
        "parameters": {
          "jsCode": "const allItems = $input.all();\nconst successfulRequests = allItems.filter(item => item.json.success === true);\nconst skippedRequests = allItems.filter(item => item.json.skipped === true);\n\nconst summary = {\n  totalCommenters: allItems.length,\n  connectionRequestsSent: successfulRequests.length,\n  skippedConnections: skippedRequests.length,\n  skippedReasons: {\n    alreadyConnected: skippedRequests.filter(item => item.json.reason === 'Already connected').length,\n    pendingInvitation: skippedRequests.filter(item => item.json.reason === 'Pending invitation').length\n  },\n  processedAt: new Date().toISOString(),\n  successRate: allItems.length > 0 \n    ? ((successfulRequests.length / allItems.length) * 100).toFixed(2) + '%'\n    : '0%'\n};\n\nreturn {\n  summary,\n  successfulRequests: successfulRequests.map(item => ({\n    name: item.json.commenterName,\n    profileId: item.json.commenterProfileId,\n    messageSent: item.json.messageSent\n  })),\n  skippedRequests: skippedRequests.map(item => ({\n    name: item.json.commenterName,\n    profileId: item.json.commenterProfileId,\n    reason: item.json.reason\n  }))\n};"
        },
        "typeVersion": 2
      },
      {
        "id": "d2edcbd9-0524-40ad-bf09-34f79abda698",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3744,
          -720
        ],
        "parameters": {
          "width": 584,
          "height": 753,
          "content": "## Auto-Connect with LinkedIn Post Commenters\n\n**What it does:**\nAutomatically sends personalized connection requests to people who comment on your LinkedIn posts. Turns post engagement into meaningful professional connections.\n\n**How it works:**\n1. Paste your LinkedIn post URL into the form\n2. Fetches all commenters from that post\n3. Checks if you're already connected to each person\n4. Generates unique, personalized messages using spin text\n5. Sends connection requests with 1-2 hour delays for safety\n6. Provides a summary report of sent vs. skipped requests\n\n**Key features:**\n- Smart filtering: Never sends duplicates or spams existing connections\n- Personalized messages: Each request uses unique variations\n- Account safety: Built-in rate limiting protects your LinkedIn account\n- Detailed tracking: Know exactly who received requests and who was skipped\n\n**Setup required:**\n1. Install n8n-nodes-connectsafely-ai community node\n2. Add your ConnectSafely.AI API credentials\n3. Customize the message template with your name\n4. Adjust wait time based on your account age (new accounts: 2-3 hours, established: 1 hour)\n\n**Perfect for:** Content creators, founders, sales professionals, and anyone building their LinkedIn network through authentic engagement.\n\n**Important:** Start with small tests (5-10 commenters) and never exceed 30-40 requests per day."
        },
        "typeVersion": 1
      },
      {
        "id": "9aecd70a-a71f-4dee-9907-e00e5a6e1a53",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2928,
          -256
        ],
        "parameters": {
          "color": 5,
          "width": 272.5857281975757,
          "height": 172.6366186489118,
          "content": "## Data Collection\nCapture the post URL and fetch all commenters from that LinkedIn post."
        },
        "typeVersion": 1
      },
      {
        "id": "e16d1a46-9473-4631-b9c1-a7338089dbb7",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2384,
          -256
        ],
        "parameters": {
          "color": 5,
          "width": 272.85714285714283,
          "height": 176.66336134453746,
          "content": "## Process Loop\nHandle each commenter one by one. The loop continues until all commenters are processed, then moves to final reporting."
        },
        "typeVersion": 1
      },
      {
        "id": "3b6e08e0-6701-444f-a8da-1da9fc7e684f",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2064,
          336
        ],
        "parameters": {
          "color": 5,
          "width": 468.4285714285714,
          "height": 174.54677419354834,
          "content": "## Smart Filtering\nCheck relationship status and skip anyone you're already connected with or have a pending invitation to."
        },
        "typeVersion": 1
      },
      {
        "id": "1dfb56f0-f40b-4af9-9cbf-e8be46b1f580",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1232,
          -352
        ],
        "parameters": {
          "color": 5,
          "width": 396,
          "height": 165,
          "content": "## Send Requests\nGenerate personalized messages and send connection requests with rate limiting to protect your account."
        },
        "typeVersion": 1
      },
      {
        "id": "1ff07abd-8ac3-4a90-94fc-4d0f810591f6",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1776,
          -304
        ],
        "parameters": {
          "color": 5,
          "width": 273.109243697479,
          "height": 158.9915966386554,
          "content": "## Tracking\nLog skipped connections (already connected or pending) to avoid duplicate requests."
        },
        "typeVersion": 1
      },
      {
        "id": "153e6d43-f278-41f8-94a4-44094d4f215d",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -672,
          -352
        ],
        "parameters": {
          "color": 5,
          "width": 456.42857142857144,
          "height": 172.6366186489118,
          "content": "## Final Report\nCombine all results and generate a summary showing total commenters, requests sent, and skip reasons."
        },
        "typeVersion": 1
      },
      {
        "id": "80330cc3-ccad-4dc8-9867-8aaadd1a0753",
        "name": "ConnectSafely LinkedIn",
        "type": "n8n-nodes-connectsafely-ai.connectSafelyLinkedIn",
        "position": [
          -2784,
          16
        ],
        "parameters": {
          "postUrl": "={{ $json['LinkedIn Post URL'] }}",
          "accountId": "68ecc8f6ae3fb53989597a55",
          "operation": "getAllPostComments"
        },
        "credentials": {
          "connectSafelyApi": {
            "id": "lFgrYYztvy5497E2",
            "name": "ConnectSafely account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "1692038c-026e-455b-902b-100dbaadff04",
        "name": "ConnectSafely LinkedIn1",
        "type": "n8n-nodes-connectsafely-ai.connectSafelyLinkedIn",
        "position": [
          -1936,
          160
        ],
        "parameters": {
          "accountId": "68ecc8f6ae3fb53989597a55",
          "operation": "checkRelationship",
          "profileId": "={{ $json.publicIdentifier }}"
        },
        "credentials": {
          "connectSafelyApi": {
            "id": "lFgrYYztvy5497E2",
            "name": "ConnectSafely account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "c9619764-7402-4dba-88ce-b2bbbe0dca9c",
        "name": "ConnectSafely LinkedIn2",
        "type": "n8n-nodes-connectsafely-ai.connectSafelyLinkedIn",
        "position": [
          -1072,
          -96
        ],
        "parameters": {
          "accountId": "68ecc8f6ae3fb53989597a55",
          "operation": "sendConnectionRequest",
          "profileId": "={{ $('Should Send?').item.json.accountId }}",
          "profileUrn": "={{ $('Should Send?').item.json.profileUrn }}",
          "customMessage": "={{ $json.generatedMessage }}"
        },
        "credentials": {
          "connectSafelyApi": {
            "id": "lFgrYYztvy5497E2",
            "name": "ConnectSafely account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "386331a1-5e1e-4d7e-84b8-3d2a65f34d0b",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3072,
          -16
        ],
        "parameters": {
          "color": 7,
          "width": 720,
          "height": 208,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "6a0c1977-077a-4f50-89f3-9fba9997f7b2",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1696,
          -128
        ],
        "parameters": {
          "color": 7,
          "width": 784,
          "height": 192,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "44173815-1c82-4a5a-9174-94efbc25e5e7",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2288,
          -16
        ],
        "parameters": {
          "color": 7,
          "width": 576,
          "height": 320,
          "content": ""
        },
        "typeVersion": 1
      }
    ],
    "connections": {
      "Log Skipped": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge Results",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Log Success": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Form Trigger": {
        "main": [
          [
            {
              "node": "ConnectSafely LinkedIn",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Send?": {
        "main": [
          [
            {
              "node": "Generate Message",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Skipped",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Results": {
        "main": [
          [
            {
              "node": "Generate Summary",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 1-2 Hours": {
        "main": [
          [
            {
              "node": "Log Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "Should Send?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ConnectSafely LinkedIn1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Message": {
        "main": [
          [
            {
              "node": "ConnectSafely LinkedIn2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Commenters": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ConnectSafely LinkedIn": {
        "main": [
          [
            {
              "node": "Split Commenters",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ConnectSafely LinkedIn1": {
        "main": [
          [
            {
              "node": "Should Send?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ConnectSafely LinkedIn2": {
        "main": [
          [
            {
              "node": "Wait 1-2 Hours",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "KKQJKkfiLQQ48JSW",
    "meta": {
      "instanceId": "68ab8a7bd891eafb85f915471f38591da0135936f93fdf7e27d0ebea24fea950"
    },
    "name": "Send Postcards to Contacts Automatically using CentralStationCRM and EchtPost",
    "tags": [],
    "nodes": [
      {
        "id": "f22c8bec-268f-46d5-844d-61870dfcf208",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          320,
          -140
        ],
        "parameters": {
          "width": 400,
          "height": 920,
          "content": "![CSCRM Logo](https://s3.42he.com/cscrm-marketing-page-production/Logo_Central_Station_CRM_0dd02e23d2.jpeg)\n\n# Send Postcards to Contacts Automatically using CentralStationCRM and EchtPost\n\nIn this workflow, you send a **postcard** to a person newly created in CentralStationCRM.\n\n* the workflow is triggered when a person is updated in the CRM\n* the blue set node filters the data required for EchtPost\n* the green if node checks whether the word ‚ÄúEchtPost‚Äù appears in the tags\n* if yes, a card is sent via the EchtPost API\n\n\n\n\n\n\n*To edit the nodes in steps 2 and 5: Simply double-click!*\n\n*At the very end: Set the workflow switch to Active!*\n\n*Don't forget to save your work!*"
        },
        "typeVersion": 1
      },
      {
        "id": "b59e4c49-c129-42bb-a64c-7a282d8e69d6",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1600,
          -140
        ],
        "parameters": {
          "color": 7,
          "width": 440,
          "height": 680,
          "content": "## 3. get EchtPost API key\n* Log in to EchtPost\n* Click on the cogwheel at the top right\n![API EchtPost](https://s3.42he.com/cscrm-marketing-page-production/Echt_Post_API_Schluessel_24d1c6be44.png)\n* Click on \"Create API key\n* Enter description (e.g. \"n8n\")\n* Copy API key\n\n## 4. get EchtPost template ID\n![EchtPost Navbar](https://s3.42he.com/cscrm-marketing-page-production/Echt_Post_Vorlagen_1592063ee7.png)\n* Click on the desired template\n* Copy the number after ?template_id= in the URL"
        },
        "typeVersion": 1
      },
      {
        "id": "06574510-ef2e-4b29-9bce-33cca25c6f5c",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2080,
          -140
        ],
        "parameters": {
          "color": 7,
          "width": 500,
          "height": 840,
          "content": "## 5. Configure EchtPost API Node\n* Double-click node\n* METHOD: POST\n* https://api.echtpost.de/v1/cards\n* Authentication: none\n* SEND BODY: True\n* Body Content Type: JSON\n* Specify Body: Using JSON\n\nJSON Code (Important: Switch to \"Expression\"!)\n* Replace key, template ID and mail with your own values\n\n\n{\n \"apikey\": \"ENTER HERE-API-KEY\",\n \"card\": {\n \"template_id\": \"HERE-TEMPLATE-ID\",\n \"deliver_at\": \"3-days-from-now\", \"\n \" \"notification_type\": \"before_send\",\n \"notification_email\": \"YOUR EMAIL\",\n \"contacts_attributes\": [\n {\n \"company_name\": \"{{ $json.body.record.companies[0].name }}\",\n \"street\": \"{{ $json.body.record.addrs[0].street }}\",\n \"zip\": \"{{ $json.body.record.addrs[0].zip }}\", \"\n city\": \"{{ $json.body.record.addrs[0].city }}\", \"\n country_code\": \"{{ $json.body.record.addrs[0].country_code }}\"\n      }\n    ]\n  }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "d97824f2-b8fa-4097-8a68-1d116fbd76b1",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          760,
          -20
        ],
        "parameters": {
          "color": 7,
          "width": 420,
          "height": 960,
          "content": "## 2. set up CentralStationCRM Webhook\n* log in to CentralStationCRM\n* click on the gear wheel at the top right\n\n![Account settings](https://s3.42he.com/cscrm-marketing-page-production/CSCRM_Settings_edb73dede7.jpg)\n![Webhook](https://s3.42he.com/cscrm-marketing-page-production/CSCRM_Settings_Webhook_0b20350753.jpg)\n* click \"Create webhook\"\n* enter password\n* \"Monitored object type\": Person\n* \"Monitored event\": Update\n* for \"Endpoint URL\" enter webhook URL\n* enter the following for \"Nested objects\":\ntags, addrs, companies\n* enter name and description (e.g. n8n Test)\n* set status to active and save"
        },
        "typeVersion": 1
      },
      {
        "id": "5ad18049-d75e-4f30-a4bb-0767c0f24c8a",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1220,
          -140
        ],
        "parameters": {
          "color": 7,
          "width": 340,
          "height": 1080,
          "content": "## 2. Set up n8n webhook trigger\n* double-click node\n* HTTP Method: POST\n* Authentication: none\n\n### For testing: \nTag a person in CentralStationCRM with \"EchtPost\" and click on \"Listen for Test Event\" on the node shortly beforehand. The webhook should be triggered and the data transferred to the node.\n\n### For operation:\n* Switch from \"Test URL\" to \"Production URL\"\n* Copy new webhook URL (click on it)\n* Enter new URL under \"Endpoint URL\" in the CentralStationCRM webhook created in step 2"
        },
        "typeVersion": 1
      },
      {
        "id": "d62b9617-88a2-4512-bfca-47fe2e924be3",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          320,
          820
        ],
        "parameters": {
          "width": 400,
          "height": 120,
          "content": "### Tools in this workflow\n* [CentralStationCRM](https://centralstationcrm.de) - the simple and intuitive CRM for small teams.\n* [EchtPost](https://echtpost.de) - send postcards online"
        },
        "typeVersion": 1
      },
      {
        "id": "34c8516a-1201-4e95-9789-8ff2e33b56b6",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          760,
          -140
        ],
        "parameters": {
          "color": 7,
          "width": 420,
          "height": 100,
          "content": "## 1. get webhook URL from n8n\n* Double-click the first node in the workflow\n* Click once on the url next to POST"
        },
        "typeVersion": 1
      },
      {
        "id": "c76bf839-75d8-4224-9ed6-f5c21d33ba2d",
        "name": "Person is updated in CentralStationCRM",
        "type": "n8n-nodes-base.webhook",
        "position": [
          1320,
          640
        ],
        "webhookId": "aa45aef4-1eff-46b8-9b72-4240a40b2f6c",
        "parameters": {
          "path": "aa45aef4-1eff-46b8-9b72-4240a40b2f6c",
          "options": {},
          "httpMethod": "POST"
        },
        "typeVersion": 2
      },
      {
        "id": "41c8b450-e3db-481d-ba09-2dc266e4afdb",
        "name": "Set fields needed for EchtPost",
        "type": "n8n-nodes-base.set",
        "position": [
          1640,
          640
        ],
        "parameters": {
          "include": "selected",
          "options": {},
          "includeFields": "body.record.companies[0].name, body.record.addrs[0].street, body.record.addrs[0].zip, body.record.addrs[0].city, body.record.addrs[0].country_code, body.record.taggings",
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "f7516740-bad6-4070-be78-d354a7d92581",
        "name": "Is \"EchtPost\" included in \"taggings\"?",
        "type": "n8n-nodes-base.if",
        "position": [
          1860,
          640
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "877d4a0a-805a-4884-ae82-cc63978b02ba",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.taggings }}",
                "rightValue": "\"EchtPost\""
              }
            ]
          },
          "looseTypeValidation": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "7f7d46d7-3d20-4f1b-8f3f-cdc5dd072dc5",
        "name": "Do nothing",
        "type": "n8n-nodes-base.noOp",
        "position": [
          2260,
          780
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "e6f0d1ca-c04b-4e07-bea5-046ac92d1010",
        "name": "Send postcard with EchtPost",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2260,
          520
        ],
        "parameters": {
          "url": "https://api.echtpost.de/v1/cards",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n  \"apikey\": \"HIER-API-KEY-EINTRAGEN\",\n  \"card\": {\n    \"template_id\": \"HIER-TEMPLATE-ID\",\n    \"deliver_at\": \"3-days-from-now\",\n    \"notification_type\": \"before_send\",\n    \"notification_email\": \"EMAIL EINTRAGEN\",\n    \"contacts_attributes\": [\n      {\n        \"company_name\": \"{{ $json.name }}\",\n        \"street\": \"{{ $json.street }}\",\n        \"zip\": \"{{ $json.zip }}\",\n        \"city\": \"{{ $json.city }}\",\n        \"country_code\": \"{{ $json.country_code }}\"\n      }\n    ]\n  }\n}",
          "sendBody": true,
          "specifyBody": "json"
        },
        "typeVersion": 4.2
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "152242be-1fe6-4528-999d-993fb0593528",
    "connections": {
      "Set fields needed for EchtPost": {
        "main": [
          [
            {
              "node": "Is \"EchtPost\" included in \"taggings\"?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is \"EchtPost\" included in \"taggings\"?": {
        "main": [
          [
            {
              "node": "Send postcard with EchtPost",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Person is updated in CentralStationCRM": {
        "main": [
          [
            {
              "node": "Set fields needed for EchtPost",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "a2434c94d549548a685cca39cc4614698e94f527bcea84eefa363f1037ae14cd"
    },
    "nodes": [
      {
        "id": "deafa2e8-af41-4f11-92e0-09992f6c6970",
        "name": "Read PDF",
        "type": "n8n-nodes-base.readPDF",
        "position": [
          860,
          1420
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "8e3ddbb1-83a1-4f79-9464-61d5a20f0427",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -760,
          1300
        ],
        "parameters": {
          "width": 444.034812880766,
          "height": 599.5274151436035,
          "content": "## Send specific PDF attachments from Gmail to Google Drive using OpenAI\n\n_**DISCLAIMER**: You may have varying success when using this workflow so be prepared to validate the correctness of OpenAI's results._\n\nThis workflow reads PDF textual content and sends the text to OpenAI. Attachments of interest will then be uploaded to a specified Google Drive folder. For example, you may wish to send invoices received from an email to an inbox folder in Google Drive for later processing. This workflow has been designed to easily change the search term to match your needs. See the workflow for more details.\n\n### How it works\n1. Triggers off on the `On email received` node.\n2. Iterates over the attachments in the email.\n3. Uses the `OpenAI` node to filter out the attachments that do not match the search term set in the `Configure` node. You could match on various PDF files (i.e. invoice, receipt, or contract).\n4. If the PDF attachment matches the search term, the workflow uses the `Google Drive` node to upload the PDF attachment to a specific Google Drive folder.\n\n\nWorkflow written by [David Sha](https://davidsha.me)."
        },
        "typeVersion": 1
      },
      {
        "id": "fb2c3697-a92f-4be1-b9a6-0326f87de70b",
        "name": "Configure",
        "type": "n8n-nodes-base.set",
        "position": [
          -20,
          1520
        ],
        "parameters": {
          "values": {
            "number": [
              {
                "name": "maxTokenSize",
                "value": 4000
              },
              {
                "name": "replyTokenSize",
                "value": 50
              }
            ],
            "string": [
              {
                "name": "Match on",
                "value": "payslip"
              },
              {
                "name": "Google Drive folder to upload matched PDFs",
                "value": "https://drive.google.com/drive/u/0/folders/1SKdHTnYoBNlnhF_QJ-Zyepy-3-WZkObo"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 1
      },
      {
        "id": "792c49f4-06e3-4d77-a31f-1513f70abf32",
        "name": "Is PDF",
        "type": "n8n-nodes-base.if",
        "position": [
          640,
          1520
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $binary.data.fileExtension }}",
                "value2": "pdf"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "82be9111-665d-41c6-8190-2247acdb749b",
        "name": "Not a PDF",
        "type": "n8n-nodes-base.noOp",
        "position": [
          860,
          1620
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "c2ac155f-38ee-46f2-8a24-5614e3c32ff5",
        "name": "Is matched",
        "type": "n8n-nodes-base.if",
        "position": [
          1720,
          1480
        ],
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $json[\"text\"] }}",
                "value2": "true"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "4a8f15b8-c153-493d-9a2a-d63d911d642d",
        "name": "This is a matched PDF",
        "type": "n8n-nodes-base.noOp",
        "position": [
          1940,
          1380
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "89601591-5c7b-461c-859b-25c7c1f0c2e6",
        "name": "This is not a matched PDF",
        "type": "n8n-nodes-base.noOp",
        "position": [
          1940,
          1580
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "ac517c4a-83b8-441f-b14c-c927c18f8012",
        "name": "Iterate over email attachments",
        "type": "n8n-nodes-base.code",
        "position": [
          420,
          1420
        ],
        "parameters": {
          "jsCode": "// https://community.n8n.io/t/iterating-over-email-attachments/13588/3\nlet results = [];\n\nfor (const item of $input.all()) {\n  for (key of Object.keys(item.binary)) {\n        results.push({\n            json: {},\n            binary: {\n                data: item.binary[key],\n            }\n        });\n    }\n}\n\nreturn results;"
        },
        "typeVersion": 1
      },
      {
        "id": "79fdf2de-42fe-4ebb-80fb-cc80dcd284f9",
        "name": "OpenAI matches PDF textual content",
        "type": "n8n-nodes-base.openAi",
        "position": [
          1300,
          1340
        ],
        "parameters": {
          "prompt": "=Does this PDF file look like a {{ $(\"Configure\").first().json[\"Match on\"] }}? Return \"true\" if it is a {{ $(\"Configure\").first().json[\"Match on\"] }} and \"false\" if not. Only reply with lowercase letters \"true\" or \"false\".\n\nThis is the PDF filename:\n```\n{{ $binary.data.fileName }}\n```\n\nThis is the PDF text content:\n```\n{{ $json.text }}\n```",
          "options": {
            "maxTokens": "={{ $('Configure').first().json.replyTokenSize }}",
            "temperature": 0.1
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "30",
            "name": "REPLACE ME"
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": false
      },
      {
        "id": "8bdb3263-40f2-4277-8cc0-f6edef90a1cd",
        "name": "Merge",
        "type": "n8n-nodes-base.merge",
        "position": [
          1500,
          1480
        ],
        "parameters": {
          "mode": "combine",
          "options": {
            "clashHandling": {
              "values": {
                "resolveClash": "preferInput1"
              }
            }
          },
          "combinationMode": "mergeByPosition"
        },
        "typeVersion": 2
      },
      {
        "id": "8e68e725-b2df-4c0c-8b17-e0cd4610714d",
        "name": "Upload file to folder",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          2160,
          1380
        ],
        "parameters": {
          "name": "={{ $binary.data.fileName }}",
          "options": {},
          "parents": [
            "={{ $('Configure').first().json[\"Google Drive folder to upload matched PDFs\"].split(\"/\").at(-1) }}"
          ],
          "binaryData": true
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "32",
            "name": "REPLACE ME"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "bda00901-5ade-471c-b6f9-a18ef4d71589",
        "name": "On email received",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -240,
          1520
        ],
        "parameters": {
          "simple": false,
          "filters": {},
          "options": {
            "downloadAttachments": true,
            "dataPropertyAttachmentsPrefixName": "attachment_"
          },
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "31",
            "name": "REPLACE ME"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "b2ff4774-336b-47a3-af3f-ada809ed9b8a",
        "name": "Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -100,
          1440
        ],
        "parameters": {
          "width": 259.0890718059702,
          "height": 607.9684549079709,
          "content": "### Configuration\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n__`Match on`(required)__: What should OpenAI's search term be? Examples: invoice, callsheet, receipt, contract, payslip.\n__`Google Drive folder to upload matched PDFs`(required)__: Paste the link of the GDrive folder, an example has been provided but will need to change to a folder you own.\n__`maxTokenSize`(required)__: The maximum token size for the model you choose. See possible models from OpenAI [here](https://platform.openai.com/docs/models/gpt-3).\n__`replyTokenSize`(required)__: The reply's maximum token size. Default is 300. This determines how much text the AI will reply with."
        },
        "typeVersion": 1
      },
      {
        "id": "beb571fe-e7a3-4f3c-862b-dc01821e5f3f",
        "name": "Ignore large PDFs",
        "type": "n8n-nodes-base.noOp",
        "position": [
          1300,
          1620
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "f3c4f249-08a7-4e5e-8f46-e07393ac10b5",
        "name": "Is text within token limit?",
        "type": "n8n-nodes-base.if",
        "position": [
          1080,
          1520
        ],
        "parameters": {
          "conditions": {
            "boolean": [
              {
                "value1": "={{ $json.text.length() / 4 <= $('Configure').first().json.maxTokenSize - $('Configure').first().json.replyTokenSize }}",
                "value2": true
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "93b6fb96-3e0e-4953-bd09-cf882d2dc69c",
        "name": "Has attachments?",
        "type": "n8n-nodes-base.if",
        "position": [
          200,
          1520
        ],
        "parameters": {
          "conditions": {
            "boolean": [
              {
                "value1": "={{ $('On email received').item.binary.isNotEmpty() }}",
                "value2": true
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "554d415e-a965-46be-8442-35c4cb6b005c",
        "name": "There are no attachments",
        "type": "n8n-nodes-base.noOp",
        "position": [
          420,
          1620
        ],
        "parameters": {},
        "typeVersion": 1
      }
    ],
    "connections": {
      "Merge": {
        "main": [
          [
            {
              "node": "Is matched",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is PDF": {
        "main": [
          [
            {
              "node": "Read PDF",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Not a PDF",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read PDF": {
        "main": [
          [
            {
              "node": "Is text within token limit?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Configure": {
        "main": [
          [
            {
              "node": "Has attachments?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is matched": {
        "main": [
          [
            {
              "node": "This is a matched PDF",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "This is not a matched PDF",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has attachments?": {
        "main": [
          [
            {
              "node": "Iterate over email attachments",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "There are no attachments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On email received": {
        "main": [
          [
            {
              "node": "Configure",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "This is a matched PDF": {
        "main": [
          [
            {
              "node": "Upload file to folder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is text within token limit?": {
        "main": [
          [
            {
              "node": "OpenAI matches PDF textual content",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ],
          [
            {
              "node": "Ignore large PDFs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Iterate over email attachments": {
        "main": [
          [
            {
              "node": "Is PDF",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI matches PDF textual content": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "370f0437fbf8d71caf7e9230e115239afcf5012c55ac368aa9dee29869df4a6b",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "31722179-ef48-4a85-9a0c-ffc824e59493",
        "name": "WooCommerce Trigger",
        "type": "n8n-nodes-base.wooCommerceTrigger",
        "position": [
          -120,
          -20
        ],
        "webhookId": "6fc419e7-2af4-44e0-af83-b4f0a408138b",
        "parameters": {
          "event": "order.created"
        },
        "credentials": {
          "wooCommerceApi": {
            "id": "7FzoXyPl8TAUChEg",
            "name": "WooCommerce account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "6564d1a2-87b0-4ffb-bc60-54256a85058f",
        "name": "Telegram",
        "type": "n8n-nodes-base.telegram",
        "position": [
          100,
          -20
        ],
        "webhookId": "7ff0563d-eb68-4e68-a32a-54bdeab7c7ed",
        "parameters": {
          "text": "=üõí New Order Received!\n\nüÜî Order #: {{$json.id}}  \nüí∞ Total: {{$json.total}} USD  \nüìÖ Date: {{$json.date_created}}  \nüîñ Status: {{$json.status}}  \n\nüõçÔ∏è Products:\n{{ $json.line_items.map(item => `- ${item.name} √ó ${item.quantity} = ${item.total} USD`).join('\\n') }}\n\nüëÅÔ∏è‚Äçüó®Ô∏è Click the button below to view this order.",
          "chatId": "8025476048",
          "replyMarkup": "inlineKeyboard",
          "inlineKeyboard": {
            "rows": [
              {
                "row": {
                  "buttons": [
                    {
                      "text": "üîó View Order",
                      "additionalFields": {
                        "web_app": {
                          "url": "={{ $json.payment_url }}"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {}
        },
        "credentials": {
          "telegramApi": {
            "id": "QCMzalgAAwQJ4qi4",
            "name": "n8nlearncombot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "b5e0a35b-f794-4f0a-b76e-f63ac8eddc7b",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -880,
          -360
        ],
        "parameters": {
          "width": 680,
          "height": 560,
          "content": "## üõ† Setup Instructions\n\n### üîß Configuration Steps\n- **Replace** the `chatId` field in the Telegram node with your own Telegram **user ID** or **group ID**.\n- **Make sure** your Telegram bot is added to the group/channel if you're using one.\n- **Update** the WooCommerce API credentials with your **Consumer Key**, **Secret**, and **Base URL**.\n- **Ensure** your WooCommerce site allows external REST API access.\n- The order button uses `{{$json.payment_url}}`, so you **don‚Äôt need to hardcode your domain**.\n\n### üíµ Currency\n- The total amount and product prices are shown in **USD** for international compatibility.\n- You can change it to another currency if needed.\n\n---\n\n### ‚úÖ What This Workflow Does\n- Triggers when a **new order** is placed in WooCommerce.\n- Sends a **Telegram message** to the admin.\n- Includes:\n  - Order ID, date, status, and total\n  - List of products\n  - **Button** to view the order in WooCommerce\n\n---\n"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "WooCommerce Trigger": {
        "main": [
          [
            {
              "node": "Telegram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "GrGmuKzZAsCkd4bt",
    "meta": {
      "instanceId": "a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462",
      "templateCredsSetupCompleted": true
    },
    "name": "Send TTS (Text-to-speech) voice calls",
    "tags": [],
    "nodes": [
      {
        "id": "2b14ce1c-5213-4684-90a6-ef8b6885f2ef",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -300,
          -520
        ],
        "parameters": {
          "width": 440,
          "height": 180,
          "content": "## STEP 1\n[Register here to ClickSend](https://clicksend.com/?u=586989) and obtain your API Key and 2 ‚Ç¨ of free credits\n\nIn the node \"Send Voice\" create a \"Basic Auth\" with the username you registered and the API Key provided as your password"
        },
        "typeVersion": 1
      },
      {
        "id": "b3931dc5-7021-4ca2-ae73-8bf670a56cb7",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -300,
          -300
        ],
        "parameters": {
          "width": 440,
          "content": "## STEP 2\n\nSubmit the form and you will receive a call to the phone number you entered where the selected voice will tell you the content of the text you wrote."
        },
        "typeVersion": 1
      },
      {
        "id": "a548f92d-199e-4cd2-ae34-742617484831",
        "name": "Send Voice",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -40,
          -100
        ],
        "parameters": {
          "url": "https://rest.clicksend.com/v3/voice/send",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n  \"messages\": [\n    {\n      \"source\": \"n8n\",\n      \"body\": \"{{ $json.Body }}\",\n      \"to\": \"{{ $json.To }}\",\n      \"voice\": \"{{ $json.Voice }}\",\n      \"lang\": \"{{ $json.Lang }}\",\n      \"machine_detection\": 1\n    }\n  ]\n}",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": " application/json"
              }
            ]
          }
        },
        "credentials": {
          "httpBasicAuth": {
            "id": "UwsDe2JxT39eWIvY",
            "name": "ClickSend API"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "ffc2cbe9-6e31-4d54-8e6a-26e94ec50ef4",
        "name": "On form submission",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -300,
          -100
        ],
        "webhookId": "8bfdf9f3-9323-4295-ab96-f9852d5981d5",
        "parameters": {
          "options": {},
          "formTitle": "Send Voice Message",
          "formFields": {
            "values": [
              {
                "fieldType": "textarea",
                "fieldLabel": "Body",
                "placeholder": "Body (max. 600 chars)",
                "requiredField": true
              },
              {
                "fieldLabel": "To",
                "placeholder": "+39xxxxxxxxxx",
                "requiredField": true
              },
              {
                "fieldType": "dropdown",
                "fieldLabel": "Voice",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "male"
                    },
                    {
                      "option": "female"
                    }
                  ]
                },
                "requiredField": true
              },
              {
                "fieldType": "dropdown",
                "fieldLabel": "Lang",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "en-us \t"
                    },
                    {
                      "option": "it-it"
                    },
                    {
                      "option": "en-au"
                    },
                    {
                      "option": "en-gb"
                    },
                    {
                      "option": "de-de"
                    },
                    {
                      "option": "es-es"
                    },
                    {
                      "option": "fr-fr"
                    },
                    {
                      "option": "is-is"
                    },
                    {
                      "option": "da-dk"
                    },
                    {
                      "option": "nl-nl"
                    },
                    {
                      "option": "pl-pl"
                    },
                    {
                      "option": "pt-br"
                    },
                    {
                      "option": "ru-ru"
                    }
                  ]
                },
                "requiredField": true
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "397e0b9f-7407-47d6-b242-1b87955a701b",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -300,
          -720
        ],
        "parameters": {
          "color": 3,
          "width": 440,
          "content": "## Automate text-to-speech voice calls\nThis workflow is a simple yet powerful way to automate text-to-speech voice calls using the ClickSend API. It‚Äôs ideal for notifications, reminders, or any scenario where voice communication is needed."
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "1ad6da32-7197-4f64-b770-88dae8348db2",
    "connections": {
      "On form submission": {
        "main": [
          [
            {
              "node": "Send Voice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "nEADiHBUjZQOL5Ro",
    "meta": {
      "instanceId": "ac2da03b571df9a735ad2de1e61d5f202359008d03eb1b0f3a16081cfda79307",
      "templateCredsSetupCompleted": true
    },
    "name": "Beex First Contact for HubSpot (WhatsApp)",
    "tags": [],
    "nodes": [
      {
        "id": "989de3cd-3c38-41c5-acc2-810dd27c317f",
        "name": "Get Contact",
        "type": "n8n-nodes-base.hubspot",
        "notes": "HubSpot",
        "position": [
          -1248,
          -1376
        ],
        "parameters": {
          "contactId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.body[0].objectId }}"
          },
          "operation": "get",
          "authentication": "appToken",
          "additionalFields": {
            "propertiesCollection": {
              "propertiesValues": {
                "properties": [
                  "email",
                  "phone",
                  "hs_whatsapp_phone_number",
                  "firstname"
                ],
                "propertyMode": "valueOnly"
              }
            }
          }
        },
        "credentials": {
          "hubspotAppToken": {
            "id": "DRSjPV5XYVRTd596",
            "name": "MasterClass 03 - HubSpot"
          }
        },
        "notesInFlow": true,
        "typeVersion": 2.2
      },
      {
        "id": "d0f4f123-dd48-4fb3-86dd-3ecfa9ea8205",
        "name": "Send Template",
        "type": "n8n-nodes-beex.beex",
        "notes": "WhatsApp",
        "position": [
          -576,
          -1376
        ],
        "parameters": {
          "queue_id": "38",
          "resource": "templates",
          "operation": "post",
          "code_country": "={{ $json.country_code }}",
          "phone_number": "={{ $json.phone_number }}",
          "template_name": "={{ $json.template_name }}",
          "template_values": "={{ $json.associated_values }}",
          "additionalFields": {}
        },
        "credentials": {
          "beexApi": {
            "id": "STHQ33JPErGZaiyK",
            "name": "MasterClass 03"
          }
        },
        "notesInFlow": true,
        "typeVersion": 1
      },
      {
        "id": "7b3b8ea3-ab3d-486f-977f-100a657c83cd",
        "name": "Validate Contact",
        "type": "n8n-nodes-base.filter",
        "notes": "Filter",
        "position": [
          -1024,
          -1376
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "51ab152e-99cc-48a4-b33c-918d8331c635",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{    \n  $json.properties   \n  .email.value  \n}}",
                "rightValue": ""
              },
              {
                "id": "4d37451f-27ef-4916-8ee1-abc12065a214",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{    \n  $json.properties.   \n  hs_calculated_phone_number.value  \n}}",
                "rightValue": ""
              },
              {
                "id": "ff701d37-8a51-41e2-a41a-0d8a0b44d5a8",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ \n  $json.properties\n  .email.value \n}}",
                "rightValue": ""
              },
              {
                "id": "b6378ec3-c433-4799-86b4-ab891f2fe2db",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ \n  $json.properties.\n  hs_calculated_phone_number.value \n}}",
                "rightValue": ""
              }
            ]
          }
        },
        "notesInFlow": true,
        "typeVersion": 2.2
      },
      {
        "id": "07b78bba-4bd7-493c-8a35-4ac667e6fbfc",
        "name": "Set Fields",
        "type": "n8n-nodes-base.set",
        "position": [
          -800,
          -1376
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "7c008509-c454-4e63-b8fd-a16f12826033",
                "name": "country_code",
                "type": "string",
                "value": "={{  \n    $json.properties.hs_calculated_phone_number\n    .value.slice(1,3) \n}}"
              },
              {
                "id": "fff55f5c-9161-486c-b99c-f0495c644d26",
                "name": "phone_number",
                "type": "string",
                "value": "={{ \n  $json.properties.hs_calculated_phone_number\n  .value.slice(3) \n}}"
              },
              {
                "id": "b51ade5a-433a-4a70-9632-cdf81eb71f73",
                "name": "template_name",
                "type": "string",
                "value": "n8n_beex"
              },
              {
                "id": "464d6f01-56a8-40ff-ab1a-8cb5f009972f",
                "name": "associated_values",
                "type": "string",
                "value": "=[\"{{ $json.properties.firstname.value }}\"]"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "bf98b76b-708e-4bff-bb77-f2e570d6bb1c",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2224,
          -2000
        ],
        "parameters": {
          "width": 592,
          "height": 1376,
          "content": "## Beex First Contact for HubSpot (WhatsApp)\n\n> **Note:** This workflow requires the community node `n8n-nodes-beex`.\n\n### Watch This Tutorial\n@[youtube](oX6UxcBDlI0)\n\n\n### Overview\n\nThis workflow listens for HubSpot contact creation events via a webhook, standardizes the data, and sends a WhatsApp message using a predefined template.\n\n### How it Works\n\n1. **Webhook**  \n   Receives the contact creation event from HubSpot (configured through a custom app).\n\n2. **Get Contact**  \n   Uses the received contact ID to fetch key properties such as email and phone number.\n\n3. **Validate Contact**  \n   Ensures the contact meets the minimum requirements (valid phone number and email).\n\n4. **Set Fields**  \n   Normalizes the fields needed for the WhatsApp message. Make sure to correctly configure `country_code` and `phone_number` based on your region.\n\n5. **Send Template**  \n   Sends the WhatsApp template (e.g., template_name ‚Üí `n8n_beex`) using the processed fields.\n\n### Requirements\n\n- **HubSpot account** with an app token and read permissions for Contacts.\n- **Beex account** with permission to send message templates.\n- **Valid Beex bearer token** configured in the Beex node (`YOUR_TOKEN_HERE`).\n\n### Usage\n\n- Configure the webhook in your HubSpot custom app to notify contact creation events.\n- Ensure all contacts include an email address and phone number.\n- Adjust the fields in the **Set Fields** node according to your region and workflow logic."
        },
        "typeVersion": 1
      },
      {
        "id": "cb9c4c2e-ee1b-4f3c-a6be-0b3b6d0332c0",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -656,
          -1472
        ],
        "parameters": {
          "color": 3,
          "width": 256,
          "height": 256,
          "content": "## Warning\n- Configure template in Beex"
        },
        "typeVersion": 1
      },
      {
        "id": "595dd782-facb-4cb7-81a7-71124d8a01b6",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -880,
          -1600
        ],
        "parameters": {
          "color": 5,
          "width": 480,
          "height": 384,
          "content": "## Set Fields\n- The contact fields are extracted and transformed as needed for use in the template submission node."
        },
        "typeVersion": 1
      },
      {
        "id": "cbe3c81b-7f10-4319-a939-eb2404ea8dd3",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1536,
          -1600
        ],
        "parameters": {
          "color": 7,
          "width": 672,
          "height": 384,
          "content": "## Trigger Node (HubSpot Webhook + Get Data)\n- Link the webhook **URL** on the CRM HubSpot\n- Get HubSpot contact properties by ID\n- Validate contact (email and phone number)\n"
        },
        "typeVersion": 1
      },
      {
        "id": "483f6d1f-8cc7-4deb-a276-895ac9b866de",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "notes": "On Contact Created",
        "position": [
          -1472,
          -1376
        ],
        "webhookId": "3757267f-2176-4a9c-b564-9615d4574262",
        "parameters": {
          "path": "3757267f-2176-4a9c-b564-9615d4574262",
          "options": {},
          "httpMethod": "POST"
        },
        "notesInFlow": true,
        "typeVersion": 2.1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "1558ee3e-5aa5-42e5-9894-375a9c79c641",
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Get Contact",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Fields": {
        "main": [
          [
            {
              "node": "Send Template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Contact": {
        "main": [
          [
            {
              "node": "Validate Contact",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Template": {
        "main": [
          []
        ]
      },
      "Validate Contact": {
        "main": [
          [
            {
              "node": "Set Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "175",
    "name": "Get messages with a certain label, remove the label, and add a new one",
    "nodes": [
      {
        "name": "On clicking 'execute'",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          250,
          300
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "name": "Gmail",
        "type": "n8n-nodes-base.gmail",
        "position": [
          450,
          300
        ],
        "parameters": {
          "resource": "message",
          "operation": "getAll",
          "additionalFields": {
            "format": "full",
            "labelIds": [
              "Label_103811885290186237"
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": "Gmail"
        },
        "typeVersion": 1
      },
      {
        "name": "Gmail1",
        "type": "n8n-nodes-base.gmail",
        "position": [
          650,
          300
        ],
        "parameters": {
          "labelIds": [
            "Label_103811885290186237"
          ],
          "resource": "messageLabel",
          "messageId": "={{$node[\"Gmail\"].json[\"id\"]}}",
          "operation": "remove"
        },
        "credentials": {
          "gmailOAuth2": "Gmail"
        },
        "typeVersion": 1
      },
      {
        "name": "Gmail2",
        "type": "n8n-nodes-base.gmail",
        "position": [
          850,
          300
        ],
        "parameters": {
          "labelIds": [
            "Label_140673791182006844"
          ],
          "resource": "messageLabel",
          "messageId": "={{$node[\"Gmail\"].json[\"id\"]}}"
        },
        "credentials": {
          "gmailOAuth2": "Gmail"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "settings": {},
    "connections": {
      "Gmail": {
        "main": [
          [
            {
              "node": "Gmail1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail1": {
        "main": [
          [
            {
              "node": "Gmail2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On clicking 'execute'": {
        "main": [
          [
            {
              "node": "Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "5aaf4236c70e34e423fbdb2c7b754d19253a933bb1476d548f75848a01e473cf"
    },
    "nodes": [
      {
        "id": "ac23a49a-4fc6-468a-ba0f-c520a4feb396",
        "name": "No Operation, do nothing",
        "type": "n8n-nodes-base.noOp",
        "position": [
          40,
          1540
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "f3c6e47e-6784-47d8-a7a7-30f4c11e9ff3",
        "name": "New Shopify Order",
        "type": "n8n-nodes-base.shopifyTrigger",
        "position": [
          -720,
          1260
        ],
        "webhookId": "2969c4e3-fcbb-45d7-b783-256b55cf8088",
        "parameters": {
          "topic": "orders/create",
          "authentication": "accessToken"
        },
        "typeVersion": 1
      },
      {
        "id": "a694a77c-a1eb-4053-bc69-4f7048a1abbc",
        "name": "If",
        "type": "n8n-nodes-base.if",
        "position": [
          -280,
          1260
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "c2b8d86f-a356-4ea4-b516-56abfeb2570f",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                },
                "leftValue": "={{ $json.total_price }}",
                "rightValue": 200
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "1a22c0cd-d1b1-45a7-8fc6-78ef21edb762",
        "name": "Fetch Customer Order History",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          40,
          1100
        ],
        "parameters": {
          "url": "=https://your-store.myshopify.com/admin/api/2023-07/orders.json?customer_id={{ $('New Shopify Order').item.json.id }}",
          "options": {},
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-Shopify-Access-Token",
                "value": "shpat_abc123xyz..."
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "cfbfb38c-53b9-4c25-8eda-2090c4ef0738",
        "name": "Type conversion (Array to String)",
        "type": "n8n-nodes-base.set",
        "position": [
          260,
          1100
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "3f2f5ff0-4bf6-4f2e-aecf-6de16ec91cf4",
                "name": "orders",
                "type": "string",
                "value": "={{ $json.orders }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "79f49ac3-b559-48e8-826b-ee7ae58dbe5f",
        "name": "Type conversion (String to Number)",
        "type": "n8n-nodes-base.set",
        "position": [
          -500,
          1260
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "9c3375fe-5ad9-46df-b892-f1e6696d1b0e",
                "name": "total_price",
                "type": "number",
                "value": "={{ $json.total_price }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "b69c46f9-67dd-4eec-a94e-72cc9a03ebbf",
        "name": "Summarize Order History",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          520,
          1100
        ],
        "parameters": {
          "text": "=Summarize the customer's order history for Slack. Here is their order data:\n{{ $json.orders }}",
          "options": {
            "systemMessage": "You are a helpful assistant"
          },
          "promptType": "define"
        },
        "typeVersion": 1.9
      },
      {
        "id": "f4812abe-d29d-4fc6-b9ea-705437c90d82",
        "name": "Send Slack Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          880,
          1100
        ],
        "webhookId": "577b78c7-df10-46f6-9025-8c5e64c332fe",
        "parameters": {
          "text": "=üö® High-Value Order Alert!  \nCustomer: {{ $('New Shopify Order').item.json.billing_address.first_name }} {{ $('New Shopify Order').item.json.billing_address.last_name }}\nOrder Total: ${{ $('New Shopify Order').item.json.total_price }}  \nCustomer Order history Summary: {{ $json.output }}",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "C08TTV0CC3E",
            "cachedResultName": "all-nathing"
          },
          "otherOptions": {
            "includeLinkToWorkflow": false
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "aa297625-1574-4105-a480-ace06e258cc3",
        "name": "Ignore Low-Value Order",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          460,
          1300
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "typeVersion": 1.2
      },
      {
        "id": "2ef2e96b-b299-43d6-92b1-65206d1a53b6",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2540,
          1340
        ],
        "parameters": {
          "color": 4,
          "width": 1289,
          "height": 2238,
          "content": "# üîî High-Value Order Alert Workflow\n\n**Description:**  \nThis workflow is designed to monitor incoming orders from a Shopify store. When an order exceeds $200, it automatically fetches the customer's order history, summarizes it using AI, and sends a personalized alert to a Slack channel. This ensures that high-value customers receive attention from the sales or support team in real-time.\n\n---\n\n## üü¢ Section 1: Shopify Order Trigger & Pre-Processing\n\nThis section initiates the workflow whenever a new order is placed in the Shopify store. The first step is detecting the new order event using the Shopify integration. Once an order is detected, the workflow proceeds to extract essential fields such as the order total and the customer ID.\n\nThe extracted order total is then evaluated against a threshold. If the amount is greater than $200, the workflow proceeds to the next section. Otherwise, it is terminated early to avoid unnecessary operations on low-value orders.\n\nThis section helps focus the workflow only on high-priority events and minimizes overhead by filtering out low-impact transactions.\n\n---\n\n## üß† Section 3: Customer Insights via AI\n\nOnce a high-value order is confirmed, this section is responsible for gathering historical context about the customer. The process begins with fetching the customer‚Äôs past order history from Shopify or a connected database using their unique customer ID.\n\nThe raw data containing previous order details‚Äîsuch as dates, product categories, and order amounts‚Äîis then cleaned and formatted into a prompt. This structured prompt is designed to be fed into an AI model for summarization.\n\nAn OpenAI chat model processes the prompt and generates a concise summary of the customer's purchasing behavior. This might include insights like frequency of purchases, favorite product categories, and overall customer lifetime value.\n\nThis AI-generated summary equips the team with actionable insights at a glance, enabling better personalization and response when the order alert is sent.\n\n---\n\n## üì£ Final Step: Slack Notification\n\nThe final section of the workflow sends a message to a designated Slack channel. The alert includes key details of the new high-value order along with the AI-generated summary of the customer. This ensures the team receives the context they need in real time, without having to dig through customer records manually.\n\n---\n\n## ‚õî Fallback: Low-Value Order\n\nIf the order total is $200 or less, the workflow ends here. No further action is taken. This fallback ensures that only orders worthy of escalation are processed, keeping the workflow efficient and focused.\n\n---\n\n## üîÅ Full Workflow Logic Overview\n\n1. Detect a new order in Shopify.\n2. Extract order details including total amount and customer ID.\n3. Check if the order total exceeds $200.\n4. If yes:\n   - Fetch the customer‚Äôs past order history.\n   - Format the data for AI.\n   - Use OpenAI to summarize the customer‚Äôs behavior.\n   - Send a detailed alert to Slack.\n5. If not:\n   - Terminate the workflow without sending an alert.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "b97d2bcb-56da-4973-8c51-f71f199bf67c",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2540,
          1000
        ],
        "parameters": {
          "color": 4,
          "width": 1300,
          "height": 320,
          "content": "=======================================\n            WORKFLOW ASSISTANCE\n=======================================\nFor any questions or support, please contact:\n    Yaron@nofluff.online\n\nExplore more tips and tutorials here:\n   - YouTube: https://www.youtube.com/@YaronBeen/videos\n   - LinkedIn: https://www.linkedin.com/in/yaronbeen/\n=======================================\n"
        },
        "typeVersion": 1
      },
      {
        "id": "3f072968-adae-412e-aad3-0244555e9732",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -760,
          500
        ],
        "parameters": {
          "width": 420,
          "height": 940,
          "content": "üü¢ Shopify Order Trigger & Pre-Processing\nüéØ Purpose:\nTo detect new incoming orders from the Shopify store and extract key data, especially the order total, for conditional routing.\n\nüß© Nodes Involved:\nNew Shopify Order\n\nType: Trigger Node\n\nFunction: Listens for new orders placed on the Shopify store.\n\nData Pulled: Order ID, Customer ID, Order Total, Line Items, etc.\n\nExtract Order Amount\n\nType: Field Editing Node\n\nFunction: Parses the incoming Shopify payload to isolate the order total and other relevant fields.\n\nOutput: Cleaned-up JSON or structured data (e.g., { customer_id: ..., total_amount: 215.00 })\n\nüîÑ Workflow Flow:\nA new order triggers the workflow.\n\nThe order's total amount is extracted and passed to the next stage for conditional evaluation.\n\n‚úÖ Why It Matters:\nExtracting the order amount early allows the workflow to make a smart decision: continue only for high-value transactions, saving processing resources and avoiding noise."
        },
        "typeVersion": 1
      },
      {
        "id": "8a494e6b-b7d8-473d-aca9-959ad758c769",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          0,
          0
        ],
        "parameters": {
          "color": 5,
          "width": 1060,
          "height": 1440,
          "content": "üß† Customer Insights via AI\nüéØ Purpose:\nTo provide context on the customer's past purchase behavior using AI-generated summaries, so that the team receiving the alert understands the customer profile instantly.\n\nüß© Nodes Involved:\nFetch Customer Order History\n\nType: HTTP Request\n\nFunction: Sends a request to your database or Shopify API to retrieve past orders for the customer.\n\nInput: Customer ID\n\nOutput: List of past orders with dates, values, and product categories.\n\nPrepare Order History Summary\n\nType: Edit Fields Node\n\nFunction: Formats and filters the fetched data into a prompt-friendly format for the AI model.\n\nExample Output:\n\nCustomer 123 has made 4 purchases:\n- $120 on June 10 (Shoes)\n- $75 on July 2 (Accessories)\n- $199 on August 15 (Electronics)\n- $240 on September 5 (Apparel)\nSummarize Order History\n\nType: OpenAI Chat Model\n\nFunction: Uses a language model (like GPT-4) to create a summary of the customer‚Äôs purchasing behavior.\n\nPrompt Example:\n\n\"Summarize this customer's buying behavior in 1‚Äì2 sentences. Highlight their spending habits and preferences.\"\n\nAI Summary Generator\n\nType: Tools Agent\n\nFunction: Manages the interaction between the workflow and the OpenAI model, ensuring context is handled correctly (e.g., memory or tools if needed).\n\nüìã Example Output:\n‚ÄúThis customer frequently purchases high-end fashion and electronics, with an increasing order value trend over the last 3 months.‚Äù\n\n‚úÖ Why It Matters:\nGives your sales or support team instant, intelligent insights.\n\nSaves time and reduces manual lookup of customer history.\n\nHelps personalize responses and identify VIP customers."
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "If": {
        "main": [
          [
            {
              "node": "Fetch Customer Order History",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "New Shopify Order": {
        "main": [
          [
            {
              "node": "Type conversion (String to Number)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ignore Low-Value Order": {
        "ai_languageModel": [
          [
            {
              "node": "Summarize Order History",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Summarize Order History": {
        "main": [
          [
            {
              "node": "Send Slack Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Customer Order History": {
        "main": [
          [
            {
              "node": "Type conversion (Array to String)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Type conversion (Array to String)": {
        "main": [
          [
            {
              "node": "Summarize Order History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Type conversion (String to Number)": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "OUOrcdfuTg2evIu0",
    "meta": {
      "instanceId": "96b96d0aa1e4ff5d5b6779332b149e3ef3364191562d79083d0309cf3ddfa53e",
      "templateCredsSetupCompleted": true
    },
    "name": "Simple Social: Instagram single image post with Facebook API",
    "tags": [
      {
        "id": "A0lOPfxLjZ8WmT1S",
        "name": "social",
        "createdAt": "2024-10-25T12:53:04.687Z",
        "updatedAt": "2024-10-25T12:53:04.687Z"
      },
      {
        "id": "jbFbEJV1RM8avhpH",
        "name": "shared on n8n",
        "createdAt": "2024-11-12T06:53:57.894Z",
        "updatedAt": "2024-11-12T06:53:57.894Z"
      }
    ],
    "nodes": [
      {
        "id": "ff1d20ec-2801-4c38-b71f-e0745b22a68c",
        "name": "Instagram prepare media",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          0,
          0
        ],
        "parameters": {
          "edge": "media",
          "node": "={{ $json.instagram_business_account_id }}",
          "options": {
            "queryParameters": {
              "parameter": [
                {
                  "name": "image_url",
                  "value": "={{ $json.image_url }}"
                },
                {
                  "name": "caption",
                  "value": "={{ $json.instagram_post_caption }}"
                }
              ]
            }
          },
          "graphApiVersion": "v20.0",
          "httpRequestMethod": "POST"
        },
        "typeVersion": 1
      },
      {
        "id": "ae418ed8-47f7-4042-aa4d-abfbba12c580",
        "name": "Instagram publish media",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          540,
          -80
        ],
        "parameters": {
          "edge": "media_publish",
          "node": "={{ $('Instagram params').item.json.instagram_business_account_id }}",
          "options": {
            "queryParameters": {
              "parameter": [
                {
                  "name": "creation_id",
                  "value": "={{ $json.id }}"
                }
              ]
            }
          },
          "graphApiVersion": "v20.0",
          "httpRequestMethod": "POST"
        },
        "typeVersion": 1
      },
      {
        "id": "b4bd1064-606d-4e31-8904-1f86a6f960a1",
        "name": "When clicking ‚ÄòTest workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -440,
          0
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "b0fdc882-298c-4208-9935-d17f86b266dd",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -500,
          -77.62658687843901
        ],
        "parameters": {
          "height": 248.90655871788812,
          "content": "Choose the trigger you want for example trigger this workflow from another one"
        },
        "typeVersion": 1
      },
      {
        "id": "c395b60d-2423-415b-a6ef-1ce03c4d55a3",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -51,
          -140.74317176338093
        ],
        "parameters": {
          "color": 4,
          "width": 1329.8249455924943,
          "height": 430.4091991661993,
          "content": "Add your credential"
        },
        "typeVersion": 1
      },
      {
        "id": "5e872d97-b19f-4dce-91dc-e18aee3bcdca",
        "name": "Instagram params",
        "type": "n8n-nodes-base.set",
        "position": [
          -200,
          0
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "225df266-bf29-4415-b04c-2750cef4506a",
                "name": "image_url",
                "type": "string",
                "value": "Your image url"
              },
              {
                "id": "1e380c14-e908-4eeb-90e0-957a422829d0",
                "name": "instagram_business_account_id",
                "type": "string",
                "value": "Your instagram business id"
              },
              {
                "id": "f35e3093-1bff-4cc6-a6c4-909dca314cc7",
                "name": "instagram_post_caption",
                "type": "string",
                "value": "Here your Text of instagram post"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "256566bb-cb69-430e-ac94-ef2fd533f9ef",
        "name": "Node just for retrive id of instagram page",
        "type": "n8n-nodes-base.facebookGraphApi",
        "disabled": true,
        "position": [
          -240,
          -360
        ],
        "parameters": {
          "node": "=me",
          "options": {
            "fields": {
              "field": [
                {
                  "name": "name"
                },
                {
                  "name": "connected_instagram_account"
                }
              ]
            }
          },
          "graphApiVersion": "v20.0"
        },
        "typeVersion": 1
      },
      {
        "id": "52fa439f-a456-4d93-8f1e-b4c4141d32ee",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -340,
          -460
        ],
        "parameters": {
          "color": 5,
          "width": 318,
          "height": 289,
          "content": "You can use this node if you want to retrieve the instagram id. \n\nAdd it to the workflow ore use manually"
        },
        "typeVersion": 1
      },
      {
        "id": "2a72a21f-d3d7-4788-978b-8868f50f1108",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -248,
          -140
        ],
        "parameters": {
          "color": 3,
          "width": 188,
          "height": 310,
          "content": "Here we have all parameters for posting in instagram image url, caption and instagram business profile id"
        },
        "typeVersion": 1
      },
      {
        "id": "63f6b3b2-4aaa-487c-8eae-e6ed39d77ddc",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -500,
          180
        ],
        "parameters": {
          "color": 7,
          "width": 439.10253951549294,
          "height": 792,
          "content": "## Permissions\nPublishing relies on a combination of the following permissions. The exact combination depends on which endpoints your app uses. Refer to our endpoint references to determine which permissions each endpoint requires.\n\nads_management\nbusiness_management\ninstagram_basic\ninstagram_content_publish\npages_read_engagement\nIf your app will be used by app users who do not have a role on your app or a role in a Business that has claimed your app, you must request approval for each permission via App Review before non-role app users can grant them to your app.\n\n## Limitations\nJPEG is the only image format supported. Extended JPEG formats such as MPO and JPS are not supported.\nShopping tags are not supported.\nBranded content tags are not supported.\nFilters are not supported.\nPublishing to Instagram TV is not supported.\nFor additional limitations, refer to each endpoint's reference.\n\n## Rate Limit\nInstagram accounts are limited to 50 API-published posts within a rolling 24-hour period. Carousels count as a single post. This limit is enforced on the POST /{ig-user-id}/media_publish endpoint when attempting to publish a media container. We recommend that your app also enforce the publishing rate limit, especially if your app allows app users to schedule posts to be published in the future.\n\nTo check an Instagram Professional account's current rate limit usage, query the GET /{ig-user-id}/content_publishing_limit endpoint."
        },
        "typeVersion": 1
      },
      {
        "id": "336f8d20-ce1c-4097-91ba-1cf7cdd4f8d0",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -920,
          -320
        ],
        "parameters": {
          "color": 2,
          "width": 365.0530681548117,
          "height": 232.74275402436496,
          "content": "## Instagram single image Post Workflow with Facebook API\n\nthis is a workflow for post a single image on instagram\n\n\nP.S: if you want use instagram API you need just change the default url in node with graph.instagram.com"
        },
        "typeVersion": 1
      },
      {
        "id": "03ef7207-aa48-4c31-b5c2-91bb2436f68b",
        "name": "Instagram check status of media uploaded before",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          180,
          0
        ],
        "parameters": {
          "node": "={{ $json.id }}",
          "options": {
            "fields": {
              "field": [
                {
                  "name": "id"
                },
                {
                  "name": "status"
                },
                {
                  "name": "status_code"
                }
              ]
            }
          },
          "graphApiVersion": "v20.0"
        },
        "typeVersion": 1
      },
      {
        "id": "3ba33f4a-e89b-40b1-98ec-c658a99777b8",
        "name": "If media status is finished",
        "type": "n8n-nodes-base.if",
        "position": [
          340,
          0
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "0304efee-33b2-499e-bad1-9238c1fc2999",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status_code }}",
                "rightValue": "FINISHED"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "fe72d3b7-4a8f-4b2d-9af7-d057da11fc88",
        "name": "Instagram check status of media published before",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          740,
          -80
        ],
        "parameters": {
          "node": "={{ $('Instagram check status of media uploaded before').item.json.id }}",
          "options": {
            "fields": {
              "field": [
                {
                  "name": "id"
                },
                {
                  "name": "status"
                },
                {
                  "name": "status_code"
                }
              ]
            }
          },
          "graphApiVersion": "v20.0"
        },
        "typeVersion": 1
      },
      {
        "id": "4dd7347e-7a41-4cb0-ae2e-93a019ae4497",
        "name": "If media status is finished1",
        "type": "n8n-nodes-base.if",
        "position": [
          940,
          -80
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "0304efee-33b2-499e-bad1-9238c1fc2999",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status_code }}",
                "rightValue": "PUBLISHED"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "7dec948d-7ce0-4a68-acfb-cc9ab8e26f3e",
        "name": "Send Email",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          540,
          140
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 2.1
      },
      {
        "id": "2c95dafb-f087-45ee-8e1f-3efdacd3ab6c",
        "name": "Send Email1",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          1160,
          -120
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 2.1
      },
      {
        "id": "c04c8441-6935-4bce-a358-4bba69d5b30b",
        "name": "Send Email2",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          1160,
          40
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 2.1
      },
      {
        "id": "74f0c188-03ce-49a6-9004-ee0720f9e4df",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          480,
          300
        ],
        "parameters": {
          "color": 3,
          "height": 102.11100456713636,
          "content": "You can send email for unsuccessful upload or what you want, you can trigger another workflow or another node"
        },
        "typeVersion": 1
      },
      {
        "id": "127813b3-2cfd-40b9-a4d9-c88c5927f4f1",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1340,
          40
        ],
        "parameters": {
          "color": 3,
          "height": 112.31608359812239,
          "content": "You can send email for unsuccessful publishing or what you want, you can trigger another workflow or another node"
        },
        "typeVersion": 1
      },
      {
        "id": "f156294d-cf7b-4638-ac00-87ea30f846a0",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1340,
          -120
        ],
        "parameters": {
          "color": 3,
          "height": 112.31608359812239,
          "content": "You can send email for successfull publishing or what you want, you can trigger another workflow or another node"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "ea4a1249-35d3-4037-a4f9-451ccc2ec698",
    "connections": {
      "Instagram params": {
        "main": [
          [
            {
              "node": "Instagram prepare media",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Instagram prepare media": {
        "main": [
          [
            {
              "node": "Instagram check status of media uploaded before",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Instagram publish media": {
        "main": [
          [
            {
              "node": "Instagram check status of media published before",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If media status is finished": {
        "main": [
          [
            {
              "node": "Instagram publish media",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If media status is finished1": {
        "main": [
          [
            {
              "node": "Send Email1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Email2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòTest workflow‚Äô": {
        "main": [
          [
            {
              "node": "Instagram params",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Instagram check status of media uploaded before": {
        "main": [
          [
            {
              "node": "If media status is finished",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Instagram check status of media published before": {
        "main": [
          [
            {
              "node": "If media status is finished1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "nodes": [
      {
        "id": "2bdfeaf7-f4db-446d-84bc-68e914138e28",
        "name": "Structured Output Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          -112,
          192
        ],
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"subject\": {\n      \"type\": \"string\",\n      \"description\": \"The subject line for the email\"\n    },\n    \"body\": {\n      \"type\": \"string\",\n      \"description\": \"The full, complete body of the email, formatted in Markdown\"\n    }\n  },\n  \"required\": [\"subject\", \"body\"]\n}"
        },
        "typeVersion": 1.2
      },
      {
        "id": "46c35571-3823-4cb9-8e07-df85c8fd6a2f",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2368,
          240
        ],
        "parameters": {
          "color": 6,
          "width": 368,
          "height": 212,
          "content": "## Contact me\n- If you need any modification to this workflow\n- if you need some help with this workflow\n- Or if you need any workflow in n8n, Make, or Langchain / Langgraph\n\nWrite to me: [thomas@pollup.net](mailto:thomas@pollup.net)\n\n**Take a look at my others workflows [here](https://n8n.io/creators/zeerobug/)**\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "3d3a2b5f-c5cd-4fdc-bc1d-55956b6b7809",
        "name": "If Deal Is Won",
        "type": "n8n-nodes-base.if",
        "position": [
          -1824,
          -32
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "b70f4699-008f-4924-8e69-af4fa69422a5",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{ $(\"Trigger: Deal Is 'Closed Won'\").item.json.body[0].propertyValue }}",
                "rightValue": "contact.creation"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "3b7f2eb6-c57f-454e-8bca-dece1d7ac508",
        "name": "Configure Template Variables",
        "type": "n8n-nodes-base.set",
        "position": [
          -2048,
          -32
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "11a8b9e9-a7ed-454a-9aef-a9137c0e17ea",
                "name": "company_name",
                "type": "string",
                "value": "Your Company Name"
              },
              {
                "id": "f2dcfe2e-3145-4a30-9731-0a8d02c7aa9a",
                "name": "sender_name",
                "type": "string",
                "value": "Your Sender Name"
              },
              {
                "id": "18b5c0bd-4e75-4b98-92fc-5fca90a8b680",
                "name": "sender_email",
                "type": "string",
                "value": "your-email@example.com"
              }
            ]
          }
        },
        "notesInFlow": true,
        "typeVersion": 3.4
      },
      {
        "id": "e26d9e1d-de10-445d-bbc7-aa20753c3bbb",
        "name": "If Role is 'Champion'",
        "type": "n8n-nodes-base.if",
        "position": [
          -480,
          -32
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "90d9c369-80df-4938-adac-af3b452f97ca",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.properties.hs_buying_role.value }}",
                "rightValue": "CHAMPION"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "e22c6e48-5899-4f13-b857-65d499e296ca",
        "name": "HubSpot: Get Deal Details",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          -1152,
          -32
        ],
        "parameters": {
          "dealId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $(\"Trigger: Deal Is 'Closed Won'\").item.json.body[0].objectId }}"
          },
          "filters": {},
          "resource": "deal",
          "operation": "get",
          "authentication": "oAuth2"
        },
        "typeVersion": 2.2
      },
      {
        "id": "8f569481-1ee0-4441-8269-a0630cb116d3",
        "name": "Split Contact IDs",
        "type": "n8n-nodes-base.code",
        "position": [
          -928,
          -32
        ],
        "parameters": {
          "jsCode": "// Get the list of contact IDs\nconst vids = $('HubSpot: Get Deal Details').first().json.associations.associatedVids;\n\n// Make sure it's always a list (even if there's only one)\nconst vidsList = [].concat(vids);\n\n// Return each ID as a separate item for the next node to process\nreturn vidsList.map(id => {\n  return {\n    json: {\n      contactId: id\n    }\n  };\n});"
        },
        "typeVersion": 2
      },
      {
        "id": "7ccef67d-88ba-4ee2-88b8-ea0888b57319",
        "name": "HubSpot: Get Contact Details",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          -704,
          -32
        ],
        "parameters": {
          "contactId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.contactId }}"
          },
          "operation": "get",
          "authentication": "oAuth2",
          "additionalFields": {
            "propertiesCollection": {
              "propertiesValues": {
                "properties": [
                  "hs_buying_role"
                ],
                "propertyMode": "valueOnly"
              }
            }
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "8f0f446d-2705-4e0b-a982-76a04c9010ca",
        "name": "AI: Write Welcome Email",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -256,
          -32
        ],
        "parameters": {
          "text": "=Your task is to write a warm, personalized welcome email to a new customer.\n\n## Content to Include\n- Congratulate them on their purchase.\n- Welcome them to the [Your Company Name] family.\n- Let them know that their new Customer Success Manager will be in touch shortly to schedule a kickoff call.\n- Provide a link to a \"Getting Started\" video: [Link to Your Video]\n- Provide a link to a \"Help Documentation\" page: [Link to Your Help Doc]\n\n## Rules\n- Be professional, enthusiastic, and welcoming.\n- You are writing on behalf of the sender.\n\n## Use the variables below\nSender's name:  {{ $('Configure Template Variables').item.json.sender_name }}\nSender's email: {{ $('Configure Template Variables').item.json.sender_email }}\nSender's company name: {{ $('Configure Template Variables').item.json.company_name }}\nRecipient's first name: {{ $('HubSpot: Get Contact Details').item.json.properties.firstname.value }}\nRecipient's last name: {{ $('HubSpot: Get Contact Details').item.json.properties.lastname.value }}\nRecipient's email: {{ $('HubSpot: Get Contact Details').item.json.properties.email.value }}",
          "options": {
            "systemMessage": "=# Overview\nYou are a professional Customer Success Manager.\n"
          },
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 1.9
      },
      {
        "id": "c3795f85-b2cf-4baf-86f5-7919234d1cad",
        "name": "AI Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -256,
          192
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "gpt-4o-mini"
          },
          "options": {}
        },
        "typeVersion": 1.2
      },
      {
        "id": "7262a3e6-dae7-4011-ab90-54897deb9f19",
        "name": "Util: Markdown to HTML",
        "type": "n8n-nodes-base.markdown",
        "position": [
          96,
          -32
        ],
        "parameters": {
          "mode": "markdownToHtml",
          "options": {},
          "markdown": "={{ $json.output.body }}"
        },
        "typeVersion": 1
      },
      {
        "id": "366e7c5d-f6df-4896-bd32-ae1fba5b4f49",
        "name": "Gmail: Send Welcome Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          320,
          -32
        ],
        "webhookId": "600dd71c-272e-4300-8f5a-7e5bbf7eb9fe",
        "parameters": {
          "sendTo": "={{ $('HubSpot: Get Contact Details').item.json.properties.email.value }}",
          "message": "={{ $json.data }}",
          "options": {},
          "subject": "={{ $json.output.subject }}"
        },
        "typeVersion": 2.1
      },
      {
        "id": "1033acf3-11d8-4ea2-89f2-13ceda2e9f8d",
        "name": "HubSpot: Assign Contact Owner",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          544,
          -32
        ],
        "parameters": {
          "email": "={{ $('HubSpot: Get Contact Details').item.json.properties.email.value }}",
          "options": {},
          "authentication": "oAuth2",
          "additionalFields": {
            "contactOwner": "={{ $('Find Least Busy CSM').item.json.csm_id }}"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "cb68f201-669e-4f65-a065-93e1e1586fd5",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2368,
          -1104
        ],
        "parameters": {
          "width": 768,
          "height": 656,
          "content": "# Automate a CSM assignment and email send from a HubSpot onboarding\n\nThis workflow triggers when a HubSpot deal is marked `Closed Won`, assigns the **least busy CSM based on a Data Table**, and sends a personalized welcome email generated by AI.\n\n## How to Set Up\n1.  **Create CSM Data Table:** You must first create an n8n Data Table with the following setup:\n    * **Name:** `csm_assignments`\n    * **Columns:** `csm_id` (String) and `deal_count` (Number)\n    * **Data:** Add one row for each CSM, putting their HubSpot Owner ID in `csm_id` and `0` in `deal_count`.\n2.  **Link Data Table Nodes:** Open the `Get CSM List` and `Increment CSM Deal Count` nodes. In the **Table** field, select the `csm_assignments` table you just created.\n3.  **Configure Variables:** Open the **`Configure Template Variables`** node and fill in your sender info (`company_name`, `sender_name`, and `sender_email`).\n4.  **Add Credentials:** Add your credentials to all other required nodes:\n    * `Trigger: Deal Is 'Closed Won'`\n    * `HubSpot: Get Deal Details`\n    * `HubSpot: Get Contact Details`\n    * `HubSpot: Assign Contact Owner`\n    * `AI Model` (This node is connected to the AI agent and holds the credentials)\n    * `Gmail: Send Welcome Email`\n5.  **Customize AI Prompt:** Open the **`AI: Write Welcome Email`** node (the node you posted) and edit the prompt to match your company's tone.\n6.  **Activate Workflow:** Save and activate the workflow."
        },
        "typeVersion": 1
      },
      {
        "id": "c1c64eb1-7108-4579-8b77-3cadb79fab4d",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2464,
          -352
        ],
        "parameters": {
          "color": 7,
          "width": 352,
          "height": 480,
          "content": "This node is the **live** trigger for the workflow.\n\n* **Action:** It watches for changes to the \"Is closed won\" property on a HubSpot deal.\n* **Heads Up:** This trigger will fire when the property changes to **True** *and* when it changes back to **False**.\n* **Filtering:** The `If Deal Is Won` node downstream is essential, as it filters for the **True** case, allowing the rest of the workflow to run only when a deal is won.\n* **Credential:** This node requires a **\"HubSpot Developer API\"** credential to function."
        },
        "typeVersion": 1
      },
      {
        "id": "d1cc6510-b720-4076-910a-b528a72b6f62",
        "name": "Trigger: Deal Is 'Closed Won'",
        "type": "n8n-nodes-base.hubspotTrigger",
        "position": [
          -2272,
          -32
        ],
        "webhookId": "b7a996ff-1c3b-417f-be7f-190ec04405b9",
        "parameters": {
          "eventsUi": {
            "eventValues": [
              {
                "name": "deal.propertyChange",
                "property": "=hs_is_closed_won"
              }
            ]
          },
          "additionalFields": {
            "maxConcurrentRequests": 5
          }
        },
        "typeVersion": 1
      },
      {
        "id": "04545ef6-cae4-4c4e-bf96-ea4ac26be3ad",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -304,
          -352
        ],
        "parameters": {
          "color": 7,
          "width": 336,
          "height": 672,
          "content": "### AI Email Writer\n* Uses AI to write a personalized Welcome Email.\n* Requires OpenAI credentials.\n* You can customize the prompt in the `AI: Write Welcome Email` node."
        },
        "typeVersion": 1
      },
      {
        "id": "7d1fd6d1-7ded-4760-8158-55f9e9f4d209",
        "name": "Get CSM List",
        "type": "n8n-nodes-base.dataTable",
        "position": [
          -1600,
          -32
        ],
        "parameters": {
          "operation": "get",
          "returnAll": true,
          "dataTableId": {
            "__rl": true,
            "mode": "id",
            "value": ""
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f5774385-f71b-4b5c-bf67-54d8f184af06",
        "name": "Find Least Busy CSM",
        "type": "n8n-nodes-base.code",
        "position": [
          -1376,
          -32
        ],
        "parameters": {
          "jsCode": "// Get the list of CSMs from the previous node\nconst csmList = $input.all();\n\n// Check if the table is empty\nif (csmList.length === 0) {\n  throw new Error(\"CSM assignment table is empty. Please add CSMs to the Data Table.\");\n}\n\n// Sort the list to find the CSM with the lowest deal_count\n// The input item looks like: { json: { csm_id: '123', deal_count: 0 }, row_id: 'abc' }\nconst sortedList = csmList.sort((a, b) => {\n  return a.json.deal_count - b.json.deal_count;\n});\n\n// The least busy CSM is the first one in the sorted list\nconst leastBusyCsm = sortedList[0];\n\n// Return the data needed for the next nodes\nreturn {\n  csm_id: leastBusyCsm.json.csm_id,\n  row_id_to_update: leastBusyCsm.json.id,\n  current_count: leastBusyCsm.json.deal_count\n};"
        },
        "typeVersion": 2
      },
      {
        "id": "46936c4a-7dcf-4cc0-bce9-6f06d230ee92",
        "name": "Increment CSM Deal Count",
        "type": "n8n-nodes-base.dataTable",
        "position": [
          768,
          -32
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "filters": {
            "conditions": [
              {
                "keyValue": "={{ $('Find Least Busy CSM').item.json.row_id_to_update }}"
              }
            ]
          },
          "options": {},
          "operation": "update",
          "dataTableId": {
            "__rl": true,
            "mode": "id",
            "value": ""
          }
        },
        "typeVersion": 1
      },
      {
        "id": "426da06b-eb9f-4a6d-8b13-a2cffd6dd6ba",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1664,
          -352
        ],
        "parameters": {
          "color": 7,
          "width": 432,
          "height": 480,
          "content": "### Least-Busy CSM Assignment\n\nThese nodes find the CSM with the lowest `deal_count` from the `csm_assignments` Data Table, assign them the new deal, and then add 1 to their count to keep the table in sync."
        },
        "typeVersion": 1
      },
      {
        "id": "e9606b09-3cbc-4f51-a1e9-23ba1a617aa4",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          704,
          -352
        ],
        "parameters": {
          "color": 7,
          "width": 544,
          "height": 512,
          "content": "This node updates the CSM's deal count.\n\n**After you select your `csm_assignments` table:**\n1.  Go to the \"Fields to Update\" section.\n2.  Click **Add Field**.\n3.  **Field:** Select `deal_count`.\n4.  **Value:** Switch to expression mode (`f(x)`) and paste:\n    `{{ $('Find Least Busy CSM').item.json.current_count + 1 }}`"
        },
        "typeVersion": 1
      }
    ],
    "connections": {
      "AI Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI: Write Welcome Email",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Get CSM List": {
        "main": [
          [
            {
              "node": "Find Least Busy CSM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Deal Is Won": {
        "main": [
          [
            {
              "node": "Get CSM List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Contact IDs": {
        "main": [
          [
            {
              "node": "HubSpot: Get Contact Details",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Find Least Busy CSM": {
        "main": [
          [
            {
              "node": "HubSpot: Get Deal Details",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Role is 'Champion'": {
        "main": [
          [
            {
              "node": "AI: Write Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Util: Markdown to HTML": {
        "main": [
          [
            {
              "node": "Gmail: Send Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI: Write Welcome Email": {
        "main": [
          [
            {
              "node": "Util: Markdown to HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI: Write Welcome Email",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Gmail: Send Welcome Email": {
        "main": [
          [
            {
              "node": "HubSpot: Assign Contact Owner",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HubSpot: Get Deal Details": {
        "main": [
          [
            {
              "node": "Split Contact IDs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Configure Template Variables": {
        "main": [
          [
            {
              "node": "If Deal Is Won",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HubSpot: Get Contact Details": {
        "main": [
          [
            {
              "node": "If Role is 'Champion'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HubSpot: Assign Contact Owner": {
        "main": [
          [
            {
              "node": "Increment CSM Deal Count",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Trigger: Deal Is 'Closed Won'": {
        "main": [
          [
            {
              "node": "Configure Template Variables",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "dd130a849d7b29e5541b05d2f7f86a4acd4f1ec598c1c9438783f56bc4f0ff80",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "e563eef6-39c4-4859-b23a-db096e7f8717",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -1300,
          -60
        ],
        "parameters": {
          "simple": false,
          "filters": {},
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyHour"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "umlWq7xPmamha8HX",
            "name": "Gmail account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "068c250f-84b0-41e4-b48a-6a5260b7a24a",
        "name": "Text Classifier",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "position": [
          -660,
          0
        ],
        "parameters": {
          "options": {},
          "inputText": "={{ $('Gmail Trigger').item.json.subject }}\n{{ $('Gmail Trigger').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Guest Post",
                "description": "The inquiry is about the collaboration on guest post inquiry, blog post on syncbricks.com or any other website. "
              },
              {
                "category": "Youtube",
                "description": "The inquiry is about adding review video on our youtube channel"
              },
              {
                "category": "Udemy Courses",
                "description": "Training and Courses related to Various Technology, AI Etc"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "036d86c2-0375-4f44-a14f-4f20d17eb048",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          -640,
          200
        ],
        "parameters": {
          "options": {},
          "modelName": "models/gemini-2.0-flash-exp"
        },
        "credentials": {
          "googlePalmApi": {
            "id": "othBMxlMTTDAVGQ9",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "6ca6adeb-fdf4-4e4c-83f2-e2b28548b33e",
        "name": "GuestPost Inquiry",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          -80,
          -180
        ],
        "webhookId": "880024c2-f011-4385-b0f9-25ce08c5bd1b",
        "parameters": {
          "html": "=<!DOCTYPE html>\n<html>\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\n\n<p>Hello,</p>\n\n<p>Thank you for reaching out! We‚Äôre thrilled to help you gain exposure through guest posting on our diverse platforms. Here‚Äôs everything you need to know to get started:</p>\n\n<p><strong>Pricing & Options:</strong></p>\n<ul>\n    <li><strong>Guest Post:</strong> $0 per post. Bulk discounts are available for multiple submissions.</li>\n    <li><strong>Link Insertion:</strong> $0 per link in an existing post.</li>\n</ul>\n<p>Both options come with do-follow backlinks, ensuring long-term SEO benefits for your website.</p>\n\n<p><strong>Why Partner with Us?</strong></p>\n<ul>\n    <li><strong>Reach:</strong> Gain exposure to niche-specific, engaged audiences.</li>\n    <li><strong>Quick Turnaround:</strong> Publication within 3 business days for a seamless experience.</li>\n    <li><strong>Diverse Niches:</strong> Choose from a variety of topics to suit your content needs.</li>\n</ul>\n\n<p><strong>Choose the Right Platform:</strong></p>\n<p>Our websites span various niches, so you can select the one that best matches your content. Explore them here:</p>\n<ul>\n    <li><a href=\"https://syncbricks.com\" target=\"_blank\">syncbricks.com</a></li>\n    <li><a href=\"https://s4stechnology.com\" target=\"_blank\">s4stechnology.com</a></li>\n    <li><a href=\"https://shukranoman.com\" target=\"_blank\">shukranoman.com</a></li>\n    <li><a href=\"https://brenttechnologies.com\" target=\"_blank\">brenttechnologies.com</a></li>\n    <li><a href=\"https://mairimanzil.com\" target=\"_blank\">mairimanzil.com</a></li>\n    <li><a href=\"https://techfeed.com.au\" target=\"_blank\">techfeed.com.au</a></li>\n    <li><a href=\"https://tuts.plus\" target=\"_blank\">tuts.plus</a></li>\n    <li><a href=\"https://swifttapper.com\" target=\"_blank\">swifttapper.com</a></li>\n    <li><a href=\"https://amjidali.com\" target=\"_blank\">amjidali.com</a></li>\n    <li><a href=\"https://hamid.com.au\" target=\"_blank\">hamid.com.au</a></li>\n    <li><a href=\"https://cio.guru\" target=\"_blank\">cio.guru</a></li>\n</ul>\n\n<p><strong>Submission Guidelines:</strong></p>\n<ul>\n    <li><strong>Original Content:</strong> Submissions must be high-quality, unpublished, and niche-relevant.</li>\n    <li><strong>Minimum Word Count:</strong> 300 words.</li>\n    <li><strong>Formatting:</strong> Use headings, subheadings, and bullet points for readability.</li>\n    <li><strong>Backlinks:</strong> One do-follow backlink is permitted per post.</li>\n    <li><strong>Images:</strong> Unique and relevant images are encouraged.</li>\n</ul>\n\n<p><strong>How to Submit:</strong></p>\n<p>Reply to this email with your completed guest post and any supporting materials. We‚Äôll review your submission and get back to you within 3 business days.</p>\n\n<p><strong>Payment Information:</strong></p>\n<p>Once your guest post or link insertion request is approved, we‚Äôll provide you with payment details. We accept payments through:</p>\n<ul>\n    <li>PayPal</li>\n    <li>Bank Transfer</li>\n    <li>Other methods (upon request)</li>\n</ul>\n<p>Please let us know your preferred method, and we‚Äôll share the necessary information.</p>\n\n<p><strong>Questions?</strong></p>\n<p>If you need further assistance or guidance, feel free to reach out. We‚Äôre here to help!</p>\n\n<p>Best regards, <br>\n<strong>Sophia Mitchell</strong> <br>\nOutreach Manager | <a href=\"https://syncbricks.com\" target=\"_blank\">syncbricks.com</a> <br>\nWhatsApp: +1</p>\n\n<p style=\"font-size: 12px; color: #888;\">¬© 2025 SyncBricks. All rights reserved.</p>\n\n</body>\n</html>\n",
          "options": {
            "appendAttribution": false
          },
          "subject": "=Re: {{ $('Gmail Trigger').item.json.subject }}",
          "toEmail": "={{ $json.from.value[0].name }} <{{ $json.from.value[0].address }}>",
          "fromEmail": "Sophia Mitchell <info@syncbricks.com>"
        },
        "credentials": {
          "smtp": {
            "id": "AOPfJVssrSFm0US1",
            "name": "SMTP account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "41f06728-3bac-4fc2-ab20-d16f3fd9a936",
        "name": "Youtube Video Inquiry",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          -80,
          0
        ],
        "webhookId": "d33a7f20-dca8-4622-b421-b92697fdffd8",
        "parameters": {
          "html": "=<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            margin: 0;\n            padding: 0;\n        }\n        .container {\n            width: 100%;\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .header {\n            background-color: #f4f4f4;\n            padding: 10px 20px;\n            text-align: center;\n            border-bottom: 1px solid #ddd;\n        }\n        .header h1 {\n            margin: 0;\n            color: #555;\n        }\n        .content {\n            padding: 20px;\n        }\n        .content h2 {\n            color: #555;\n            font-size: 18px;\n        }\n        .content p {\n            margin-bottom: 15px;\n        }\n        .content ul {\n            list-style: disc;\n            padding-left: 20px;\n        }\n        .content ul li {\n            margin-bottom: 10px;\n        }\n        .content a {\n            color: #007BFF;\n            text-decoration: none;\n        }\n        .content a:hover {\n            text-decoration: underline;\n        }\n        .video-thumbnail {\n            text-align: center;\n            margin: 20px 0;\n        }\n        .video-thumbnail img {\n            width: 100%;\n            max-width: 560px;\n            border-radius: 5px;\n            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        }\n        .footer {\n            text-align: center;\n            font-size: 12px;\n            color: #888;\n            margin-top: 20px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>YouTube Review Video Inquiry</h1>\n        </div>\n        <div class=\"content\">\n            <p>Hello {{ $json.Name }},</p>\n            <p>Thank you for reaching out to inquire about our YouTube review video services! We are thrilled to collaborate with you and showcase your product or service to our engaged audience on our YouTube channel, **SyncBricks**.</p>\n            <h2>What We Offer:</h2>\n            <ul>\n                <li><strong>Comprehensive Review Video (10 Minutes):</strong> $1  \n                    <ul>\n                        <li>Detailed review and hands-on demonstration.</li>\n                        <li>Professional editing with a focus on your product's highlights.</li>\n                        <li>Includes a do-follow backlink placement on our website.</li>\n                    </ul>\n                </li>\n                <li><strong>Short Follow-Up Video:</strong> $7  \n                    <ul>\n                        <li>Quick review or update video.</li>\n                        <li>Focus on specific features or updates.</li>\n                        <li>Also includes a do-follow backlink placement on our website.</li>\n                    </ul>\n                </li>\n            </ul>\n            <h2>Sample Video:</h2>\n            <p>Here‚Äôs an example of our work to help you understand the quality and style of our reviews:</p>\n            <div class=\"video-thumbnail\">\n                <a href=\"https://youtu.be/-5bI45z4Ozo?si=hkGNnTgtH1quOfH2\" target=\"_blank\">\n                    <img src=\"https://img.youtube.com/vi/-5bI45z4Ozo/maxresdefault.jpg\" alt=\"Sample Video Thumbnail\">\n                </a>\n            </div>\n            <p>Watch it here: <a href=\"https://youtu.be/-5bI45z4Ozo?si=hkGNnTgtH1quOfH2\" target=\"_blank\">https://youtu.be/-5bI45z4Ozo</a></p>\n            <h2>Why Choose Us?</h2>\n            <ul>\n                <li>Professional video production and editing to highlight your product's key features.</li>\n                <li>Engaged audience focused on IT and technology-related content.</li>\n                <li>Comprehensive reviews that provide value to both viewers and sponsors.</li>\n            </ul>\n            <h2>How to Proceed:</h2>\n            <p>To book a review video, please reply to this email with the following details:</p>\n            <ul>\n                <li>Your product/service name and a brief description.</li>\n                <li>Any specific features or aspects you want us to highlight.</li>\n                <li>Preferred review type (Comprehensive or Short Follow-Up).</li>\n            </ul>\n            <p>Once we have your details, we will share the payment instructions and the next steps to get started.</p>\n            <h2>Questions?</h2>\n            <p>If you have any questions or need further clarification, feel free to ask. We‚Äôre here to assist you!</p>\n            <p>Best regards,<br><strong>Sophia Mitchell</strong><br>Outreach Manager | <a href=\"https://syncbricks.com\" target=\"_blank\">syncbricks.com</a><br>WhatsApp: +1 </p>\n        </div>\n        <div class=\"footer\">\n            <p>¬© 2025 SyncBricks. All rights reserved.</p>\n        </div>\n    </div>\n</body>\n</html>\n",
          "options": {
            "appendAttribution": false
          },
          "subject": "=Re: {{ $('Gmail Trigger').item.json.subject }}",
          "toEmail": "={{ $json.from.value[0].name }} <{{ $json.from.value[0].address }}>",
          "fromEmail": "Sophia Mitchell <info@syncbricks.com>"
        },
        "credentials": {
          "smtp": {
            "id": "AOPfJVssrSFm0US1",
            "name": "SMTP account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "e42754e8-a594-4ea8-b9a8-9e47ffdacd72",
        "name": "Send Email",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          -80,
          180
        ],
        "webhookId": "3a0ca27f-1ff9-4c59-b17f-0523c58f70d1",
        "parameters": {
          "html": "=<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            margin: 0;\n            padding: 0;\n        }\n        .container {\n            width: 100%;\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .header {\n            background-color: #f4f4f4;\n            padding: 10px 20px;\n            text-align: center;\n            border-bottom: 1px solid #ddd.\n        }\n        .header h1 {\n            margin: 0;\n            color: #555;\n        }\n        .content {\n            padding: 20px;\n        }\n        .content h2 {\n            color: #555;\n            font-size: 18px;\n        }\n        .content p {\n            margin-bottom: 15px;\n        }\n        .content ul {\n            list-style: disc;\n            padding-left: 20px;\n        }\n        .content ul li {\n            margin-bottom: 10px;\n        }\n        .content a {\n            color: #007BFF;\n            text-decoration: none;\n        }\n        .content a:hover {\n            text-decoration: underline;\n        }\n        .footer {\n            text-align: center;\n            font-size: 12px;\n            color: #888;\n            margin-top: 20px.\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>Course Inquiry</h1>\n        </div>\n        <div class=\"content\">\n            <p>Hello,</p>\n            <p>Thank you for your interest in our online courses! At **SyncBricks**, we offer a variety of high-quality courses designed to enhance your skills in IT, automation, network security, and more.</p>\n            <h2>Our Featured Courses:</h2>\n            <ul>\n                <li><strong><a href=\"https://www.udemy.com/course/ai-automation-mastery-build-intelligent-agents-with-lowcode/?referralCode=0062E7C1D64784AB70CA\" target=\"_blank\">AI Automation Mastery: Build Intelligent Agents</a></strong>  \n                    Learn how to leverage low-code platforms for workflow automation and build AI-driven solutions.\n                </li>\n                <li><strong><a href=\"https://www.udemy.com/course/microsoft-power-bi-advanced-course-desktop-dax/?referralCode=1B754977728785DC48C9\" target=\"_blank\">Advanced Power BI: Master Desktop & DAX</a></strong>  \n                    Master data visualization, dashboard creation, and DAX in Power BI.\n                </li>\n                <li><strong><a href=\"https://www.udemy.com/course/proxmox-virtualization-environment-complete-training/?referralCode=8E7EAFD11C2389F89C11\" target=\"_blank\">Proxmox VE: Complete Virtualization Guide</a></strong>  \n                    Dive into Proxmox VE for advanced virtualization techniques and management.\n                </li>\n                <li><strong><a href=\"https://www.udemy.com/course/pfsense-network-security-and-firewall-management/?referralCode=866D4839516374C77ACE\" target=\"_blank\">pfSense Network Security & Firewall Management</a></strong>  \n                    Learn how to secure networks with advanced firewall configurations.\n                </li>\n                <li><strong><a href=\"https://www.udemy.com/course/human-resource-management-with-erpnext-onboarding-to-exit/?referralCode=B3C64C3925EC62F42052\" target=\"_blank\">ERPNext for HR Management: Onboarding to Exit</a></strong>  \n                    Manage HR processes efficiently using ERPNext.\n                </li>\n            </ul>\n            <h2>Free Learning Resources:</h2>\n            <p>Explore a wealth of free material on our YouTube channel, **SyncBricks**, including tutorials, reviews, and how-to videos. Check it out here:</p>\n            <p><a href=\"https://www.youtube.com/channel/UC1ORA3oNGYuQ8yQHrC7MzBg?sub_confirmation=1\" target=\"_blank\">Visit Our YouTube Channel</a></p>\n            <h2>Why Choose Our Courses?</h2>\n            <ul>\n                <li>High-quality, industry-relevant content curated by experts.</li>\n                <li>Practical, hands-on projects to enhance learning.</li>\n                <li>Lifetime access to course materials for continuous learning.</li>\n                <li>Affordable pricing with discounts on certain platforms.</li>\n            </ul>\n            <h2>Browse All Courses</h2>\n            <p>Explore our full catalog on <a href=\"https://lms.syncbricks.com/\" target=\"_blank\">SyncBricks LMS</a> for more learning opportunities.</p>\n            <h2>Have Questions?</h2>\n            <p>If you‚Äôre unsure which course is the best fit or need assistance enrolling, let us know! We‚Äôre happy to guide you based on your interests and goals.</p>\n            <p>Best regards,<br><strong>Sophia Mitchell</strong><br>Outreach Manager | <a href=\"https://syncbricks.com\" target=\"_blank\">syncbricks.com</a><br>WhatsApp: +1 (810) 214-4375</p>\n        </div>\n        <div class=\"footer\">\n            <p>¬© 2025 SyncBricks. All rights reserved.</p>\n        </div>\n    </div>\n</body>\n</html>\n",
          "options": {
            "appendAttribution": false
          },
          "subject": "=Re:  {{ $('Gmail Trigger').item.json.Subject }}",
          "toEmail": "={{ $json.from.value[0].name }} <{{ $json.from.value[0].address }}>",
          "fromEmail": "Sophia Mitchell <info@syncbricks.com>"
        },
        "credentials": {
          "smtp": {
            "id": "AOPfJVssrSFm0US1",
            "name": "SMTP account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "a12e47bb-540b-4d42-b4fa-d27237964022",
        "name": "Mark as Read",
        "type": "n8n-nodes-base.gmail",
        "position": [
          360,
          0
        ],
        "webhookId": "066a871a-9801-4814-8ba5-238abe493cbb",
        "parameters": {
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "operation": "markAsRead"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "umlWq7xPmamha8HX",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "06deb7fa-0169-46c3-b673-f35b476ef6a5",
        "name": "Apply Label",
        "type": "n8n-nodes-base.gmail",
        "position": [
          660,
          200
        ],
        "webhookId": "066a871a-9801-4814-8ba5-238abe493cbb",
        "parameters": {
          "labelIds": [
            "Label_6332648012153150222"
          ],
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "operation": "addLabels"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "umlWq7xPmamha8HX",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "a3a38697-87ff-4954-aafe-c548425a84eb",
        "name": "Create Contact in Brevo",
        "type": "n8n-nodes-base.sendInBlue",
        "position": [
          640,
          -140
        ],
        "parameters": {
          "email": "={{ $('Text Classifier').item.json.from.value[0].address }}",
          "resource": "contact",
          "operation": "upsert",
          "requestOptions": {}
        },
        "credentials": {
          "sendInBlueApi": {
            "id": "tBNcyqgGWcRE4o8a",
            "name": "Brevo account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "99d8d741-4c7b-4795-958b-18116f9f7f96",
        "name": "Emails from Existing Contracts",
        "type": "n8n-nodes-base.if",
        "position": [
          -1120,
          -60
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "7cffe101-333d-4ec2-a822-181fe421745b",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.headers.from }}",
                "rightValue": "@syncbricks.com"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "538b53ef-05cd-4f08-83d7-5218b8492036",
        "name": "Reply",
        "type": "n8n-nodes-base.if",
        "position": [
          -980,
          100
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "07a6d5e2-ffc5-41d8-b69a-abd6860879c0",
                "operator": {
                  "type": "string",
                  "operation": "notStartsWith"
                },
                "leftValue": "={{ $json.subject }}",
                "rightValue": "Re:"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "28f5e0eb-e3ad-4d34-89c6-c1571521f283",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2060,
          -300
        ],
        "parameters": {
          "color": 4,
          "width": 715,
          "height": 716,
          "content": "## Developed by Amjid Ali\n\nThank you for using this workflow template. It has taken me countless hours of hard work, research, and dedication to develop, and I sincerely hope it adds value to your work.\n\nIf you find this template helpful, I kindly ask you to consider supporting my efforts. Your support will help me continue improving and creating more valuable resources.\n\nBuy N8N Mastery Book : https://www.amazon.com/dp/B0F23GYCFW\n\n\nFor Full Course about ERPNext or Automation using AI follow below link\n\nhttp://lms.syncbricks.com\n\nAdditionally, when sharing this template, I would greatly appreciate it if you include my original information to ensure proper credit is given.\n\nThank you for your generosity and support!\nEmail : amjid@amjidali.com\nhttps://linkedin.com/in/amjidali\nhttps://syncbricks.com\nhttps://youtube.com/@syncbricks"
        },
        "typeVersion": 1
      },
      {
        "id": "8c105698-d989-44c3-ad8e-4bdda5c01715",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1320,
          -300
        ],
        "parameters": {
          "width": 520,
          "height": 720,
          "content": "## Get the and Validate  New Email"
        },
        "typeVersion": 1
      },
      {
        "id": "cbb2e328-35b3-4ec9-9470-254666e40400",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -780,
          -300
        ],
        "parameters": {
          "color": 3,
          "width": 520,
          "height": 720,
          "content": "## Classify the Email"
        },
        "typeVersion": 1
      },
      {
        "id": "0b5584cb-1002-46f5-9ac0-bcd816998534",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -240,
          -300
        ],
        "parameters": {
          "color": 5,
          "width": 520,
          "height": 720,
          "content": "## Email Templates for Services"
        },
        "typeVersion": 1
      },
      {
        "id": "406f5793-6b54-4008-89e5-0b878aef9806",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          300,
          -300
        ],
        "parameters": {
          "color": 4,
          "width": 520,
          "height": 720,
          "content": "## mark as read, apply label and add to contact\n"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Reply": {
        "main": [
          [
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Mark as Read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mark as Read": {
        "main": [
          [
            {
              "node": "Apply Label",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create Contact in Brevo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Emails from Existing Contracts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "GuestPost Inquiry",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Youtube Video Inquiry",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GuestPost Inquiry": {
        "main": [
          [
            {
              "node": "Mark as Read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Youtube Video Inquiry": {
        "main": [
          [
            {
              "node": "Mark as Read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Emails from Existing Contracts": {
        "main": [
          [],
          [
            {
              "node": "Reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "TXzwSeIj2lNw8Pr7",
    "meta": {
      "instanceId": "dd69efaf8212c74ad206700d104739d3329588a6f3f8381a46a481f34c9cc281",
      "templateCredsSetupCompleted": true
    },
    "name": "Smart Email Draft Generator",
    "tags": [],
    "nodes": [
      {
        "id": "2f4d2db0-f825-4064-b9c4-059570ca28e8",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          840,
          -20
        ],
        "parameters": {
          "content": "This workflow triggers from Mail (IMAP), processes text with Basic LLM or Ollama Model, sets up an email field, and saves it as a draft."
        },
        "typeVersion": 1
      },
      {
        "id": "8cc89e3d-ab69-4c3e-8753-ef79a105fd62",
        "name": "Check New Email (IMAP)",
        "type": "n8n-nodes-base.emailReadImap",
        "position": [
          500,
          220
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "imap": {
            "id": "D3nLrSlP1dHWcIDE",
            "name": "IMAP account"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "d4098fe8-b946-441a-8f7d-1aada1cb6625",
        "name": "Process Email with AI",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          700,
          220
        ],
        "parameters": {
          "text": "={{ $json.textPlain }}",
          "messages": {
            "messageValues": [
              {
                "message": "=this is email\n\n{{ $json.textPlain }}\n\ni need reply of this "
              }
            ]
          },
          "promptType": "define"
        },
        "typeVersion": 1.6
      },
      {
        "id": "1bb72900-6d50-449a-bf8a-49cbeb0cfc86",
        "name": "Custom AI Model",
        "type": "@n8n/n8n-nodes-langchain.lmOllama",
        "position": [
          700,
          420
        ],
        "parameters": {
          "model": "llama3.2-16000:latest",
          "options": {}
        },
        "credentials": {
          "ollamaApi": {
            "id": "h9CEBFmYALm3FvZf",
            "name": "Ollama account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "2308c0c8-c232-4560-b120-598addd7e4c5",
        "name": "Prepare Email Content",
        "type": "n8n-nodes-base.set",
        "position": [
          1100,
          220
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "7d428c48-4809-45d8-ba1e-c96d68c02c07",
                "name": "from",
                "type": "string",
                "value": "={{ $('Check New Email (IMAP)').first().json.from }}"
              },
              {
                "id": "63b99545-3d2d-4563-b9d7-078cbc20dbcc",
                "name": "subject",
                "type": "string",
                "value": "=Re: {{ $('Check New Email (IMAP)').first().json.subject }}"
              },
              {
                "id": "11d94d3f-2170-4b54-b5f9-b85bb95ad472",
                "name": "text",
                "type": "string",
                "value": "={{ $json.text }} "
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "f2c81d97-0b15-4fbb-a050-4f2750b1af9c",
        "name": "Save as Gmail Draft",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1320,
          220
        ],
        "webhookId": "18c29d10-9bf5-4678-b6ba-c93ed6865317",
        "parameters": {
          "message": "={{ $json.text }}",
          "options": {},
          "subject": "={{ $json.subject }}",
          "resource": "draft"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "by23DyfIoJ8iWfSI",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "66359f5c-1ada-4470-bc27-4796360c2fe8",
    "connections": {
      "Custom AI Model": {
        "ai_languageModel": [
          [
            {
              "node": "Process Email with AI",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Save as Gmail Draft": {
        "main": [
          []
        ]
      },
      "Prepare Email Content": {
        "main": [
          [
            {
              "node": "Save as Gmail Draft",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Email with AI": {
        "main": [
          [
            {
              "node": "Prepare Email Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check New Email (IMAP)": {
        "main": [
          [
            {
              "node": "Process Email with AI",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "1RHsJldA8GlWFp1E",
    "meta": {
      "instanceId": "c3caf872897344ae9095ede706e2c19a32f712f120ab7f143e26125462303491",
      "templateId": "3277",
      "templateCredsSetupCompleted": true
    },
    "name": "Smart Email Auto-Responder",
    "tags": [],
    "nodes": [
      {
        "id": "e485ab21-6c33-4cb1-9bd1-3fea3a1d431a",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          1480,
          220
        ],
        "parameters": {
          "simple": false,
          "filters": {
            "labelIds": [
              "Label_43975351283257832"
            ]
          },
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyHour"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "cvHi0AAN9bE3lcij",
            "name": "Gmail account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "d52b02ce-95aa-495f-a6b4-d5dd791f2808",
        "name": "Text Classifier",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "position": [
          1820,
          400
        ],
        "parameters": {
          "options": {},
          "inputText": "={{ $('Gmail Trigger').item.json.subject }}\n{{ $('Gmail Trigger').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Questions",
                "description": "Use this category when the email is asking for information about our company, products, processes, pricing, timelines, legal terms or any other general inquiry that expects a factual explanation or guidance."
              },
              {
                "category": "Project Update",
                "description": "Choose this category when the sender is notifying us about progress or changes: signing the agreement, submitting or revising scripts, updating requirements, sharing evaluation results, or any status report that moves an ongoing project forward"
              },
              {
                "category": "Feedback",
                "description": "Select this category when the email contains compliments, complaints, suggestions, or any qualitative feedback about our service, product, communication or overall experience"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "adfca78f-9ce5-4345-baaa-017538e433be",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          1840,
          680
        ],
        "parameters": {
          "options": {},
          "modelName": "models/gemini-2.0-flash-exp"
        },
        "credentials": {
          "googlePalmApi": {
            "id": "vNACKKKe3OF1uS3Y",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "e7c91741-20d6-4c54-8dd5-efec164c29b3",
        "name": "Youtube Video Inquiry",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          2260,
          580
        ],
        "webhookId": "120f4cfb-cfd3-4792-b5f5-146e9f495f73",
        "parameters": {
          "html": "=<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body{font-family:Arial,sans-serif;line-height:1.6;color:#333;margin:0;padding:0;}\n    .container{width:100%;max-width:600px;margin:0 auto;padding:20px;}\n    .header{background:#f4f4f4;padding:10px 20px;text-align:center;border-bottom:1px solid #ddd;}\n    .header h1{margin:0;color:#555;}\n    .content{padding:20px;}\n    .content h2{color:#555;font-size:18px;margin:20px 0 10px;}\n    .content p{margin-bottom:15px;}\n    .content ul{list-style:disc;padding-left:20px;}\n    .content ul li{margin-bottom:10px;}\n    .content a{color:#007BFF;text-decoration:none;}\n    .content a:hover{text-decoration:underline;}\n    .footer{text-align:center;font-size:12px;color:#888;margin-top:20px;}\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Project Update Acknowledgement</h1>\n    </div>\n\n    <div class=\"content\">\n      <p>\n        Hi {{ $json.from.value[0].name || $('Gmail Trigger').item.json.headers.from.split('<')[0].trim() || 'there' }},\n      </p>\n\n      <p>\n        Thank you for your recent update on the project. We‚Äôve reviewed the information you provided and have logged it in our system.\n      </p>\n\n      <h2>What we received:</h2>\n      <ul>\n        <li>Signed agreement / contract confirmation.</li>\n        <li>Revised requirements or scope changes.</li>\n        <li>Draft scripts or other deliverables for review.</li>\n        <li>Evaluation results or performance reports.</li>\n      </ul>\n\n      <h2>Next steps:</h2>\n      <ul>\n        <li>Our team will review the materials and integrate any changes within <strong>2‚Äì3 business days</strong>.</li>\n        <li>If clarifications are needed, we‚Äôll reach out via email or schedule a quick call.</li>\n        <li>You‚Äôll receive the updated project timeline once the review is complete.</li>\n      </ul>\n\n      <p>\n        If you have additional files or questions, feel free to reply directly to this email.\n      </p>\n\n      <p>\n        We appreciate your prompt communication and look forward to moving the project ahead smoothly.\n      </p>\n\n      <p>\n        Best regards,<br>\n        <strong>Sophia Mitchell</strong><br>\n        Project Coordinator | <a href=\"https://syncbricks.com\" target=\"_blank\">syncbricks.com</a><br>\n        WhatsApp: +1 &nbsp;\n      </p>\n    </div>\n\n    <div class=\"footer\">\n      ¬© 2025 SyncBricks. All rights reserved.\n    </div>\n  </div>\n</body>\n</html>\n",
          "options": {
            "appendAttribution": false
          },
          "subject": "=Re: {{ $('Gmail Trigger').item.json.subject }}",
          "toEmail": "={{ $json.from.value[0].name }} <{{ $json.from.value[0].address }}>",
          "fromEmail": "kulankur.work@gmail.com"
        },
        "credentials": {
          "smtp": {
            "id": "rSVeHz6kjwDIBOZ7",
            "name": "SMTP account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "61243957-40d1-4fb2-ad0a-6f923587c4db",
        "name": "Send Email",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          2260,
          760
        ],
        "webhookId": "700cb9ed-bd54-4e96-8121-98a5dcffeebf",
        "parameters": {
          "html": "=<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body{font-family:Arial,sans-serif;line-height:1.6;color:#333;margin:0;padding:0;}\n    .container{width:100%;max-width:600px;margin:0 auto;padding:20px;}\n    .header{background:#f4f4f4;padding:10px 20px;text-align:center;border-bottom:1px solid #ddd;}\n    .header h1{margin:0;color:#555;}\n    .content{padding:20px;}\n    .content h2{color:#555;font-size:18px;margin:20px 0 10px;}\n    .content p{margin-bottom:15px;}\n    .content ul{list-style:disc;padding-left:20px;}\n    .content ul li{margin-bottom:10px;}\n    .content a{color:#007BFF;text-decoration:none;}\n    .content a:hover{text-decoration:underline;}\n    .footer{text-align:center;font-size:12px;color:#888;margin-top:20px;}\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Thank You for Your Feedback</h1>\n    </div>\n\n    <div class=\"content\">\n      <p>\n        Hi {{ $json.from.value?.[0]?.name || $('Gmail Trigger').item.json.headers.from.split('<')[0].trim() || 'there' }},\n      </p>\n\n      <p>\n        Thank you for taking the time to share your feedback about SyncBricks. We truly value every comment‚Äîwhether a\n        compliment, suggestion, or concern‚Äîbecause it helps us improve.\n      </p>\n\n      <h2>What happens next:</h2>\n      <ul>\n        <li>Your message has been logged in our system&nbsp;(<strong>Reference ID:</strong>\n          {{ $json.id.slice(-6) }}).</li>\n        <li>Our team will review it within <strong>1 business day</strong>.</li>\n        <li>If an action is required, the appropriate team member will follow up directly with you.</li>\n      </ul>\n\n      <p>\n        If you need to add more details, simply reply to this email‚Äîyour message wil\n",
          "options": {
            "appendAttribution": false
          },
          "subject": "=Re:  {{ $('Gmail Trigger').item.json.Subject }}",
          "toEmail": "={{ $json.from.value[0].name }} <{{ $json.from.value[0].address }}>",
          "fromEmail": "kulankur.work@gmail.com"
        },
        "credentials": {
          "smtp": {
            "id": "rSVeHz6kjwDIBOZ7",
            "name": "SMTP account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "a2542d02-4018-45e5-a8f2-875e669c77a3",
        "name": "Mark as Read",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2780,
          460
        ],
        "webhookId": "a5bea8d3-719e-4b2b-a43d-4c6248796267",
        "parameters": {
          "messageId": "={{ $('Gmail Trigger').all()[0].json.id }}\n",
          "operation": "markAsRead"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "cvHi0AAN9bE3lcij",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "0a1d79a3-91cf-4bf6-93bb-1482549a74dd",
        "name": "Apply Label",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2960,
          460
        ],
        "webhookId": "c3a2fc4e-d90c-463a-a356-db530e1b91b0",
        "parameters": {
          "labelIds": [
            "CATEGORY_UPDATES"
          ],
          "messageId": "={{ $('Gmail Trigger').all()[0].json.id }}\n",
          "operation": "addLabels"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "cvHi0AAN9bE3lcij",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "28467e9f-a730-4545-89cb-7d2c629edd71",
        "name": "Emails from Existing Contracts",
        "type": "n8n-nodes-base.if",
        "position": [
          1640,
          220
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "7cffe101-333d-4ec2-a822-181fe421745b",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.headers.from }}",
                "rightValue": "@syncbricks.com"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "b150ab4d-dcbb-4ae6-9503-5914e39f41ac",
        "name": "Reply",
        "type": "n8n-nodes-base.if",
        "position": [
          1640,
          460
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "07a6d5e2-ffc5-41d8-b69a-abd6860879c0",
                "operator": {
                  "type": "string",
                  "operation": "notStartsWith"
                },
                "leftValue": "={{ $json.subject }}",
                "rightValue": "Re:"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "1f043246-cbd0-466d-bbfd-b13131a66f03",
        "name": "QuestionsReply",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          2720,
          160
        ],
        "webhookId": "ed01c3d4-1fad-4098-b431-4bc3d5e05434",
        "parameters": {
          "html": "=<p>\n  Hi {{ $json.senderName }} <{{ $json.senderEmail }}>,\n</p>\n\n<p>Thanks for reaching out with your questions. I‚Äôd love to cover everything face-to-face.</p>\n\n<p><strong>Location:</strong><br>\n123 Main St<br>\nLos Angeles, CA 90089\n</p>\n\n<p>We just sent you three calendar invitations for these time slots:</p>\n\n<ul>\n  {{ $json.slotTimes.map(t => `<li>${t}</li>`).join('') }}\n</ul>\n\n<p>\n  Click <em>Yes</em> on the invite that works best for you.  \n  Google will reserve that slot automatically; the other two will stay open.\n</p>\n\n<p>\n  If none of the times work, reply with a couple of alternatives and I‚Äôll find something that fits.\n</p>\n\n<p>Looking forward to meeting you!<br>‚Äî Corvin</p>\n",
          "options": {
            "appendAttribution": false
          },
          "subject": "=Re: {{ $json.originalSub }}",
          "toEmail": "={{ $json.senderName }} <{{ $json.senderEmail }}>",
          "fromEmail": "kulankur.work@gmail.com"
        },
        "credentials": {
          "smtp": {
            "id": "rSVeHz6kjwDIBOZ7",
            "name": "SMTP account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "60d50fdc-4e7f-4ab1-a240-1be4c8ae7520",
        "name": "Google Calendar",
        "type": "n8n-nodes-base.googleCalendar",
        "position": [
          2100,
          160
        ],
        "parameters": {
          "limit": 3,
          "options": {
            "query": "Available ‚Äì Office Visit",
            "orderBy": "startTime",
            "recurringEventHandling": "expand"
          },
          "timeMax": "=",
          "calendar": {
            "__rl": true,
            "mode": "list",
            "value": "37f51d1c36997a7dacbba1d1470fe5f0213699c4d926e7a3104c35f1cb79cb75@group.calendar.google.com",
            "cachedResultName": "Meeting slots"
          },
          "operation": "getAll"
        },
        "credentials": {
          "googleCalendarOAuth2Api": {
            "id": "De5XvcvX90kFuzvb",
            "name": "Google Calendar account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "48a8b613-54e3-4002-8830-1726a23d24aa",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          2280,
          160
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "de676780-43c8-476d-ab8a-a692ffe4e65f",
        "name": "Google Calendar1",
        "type": "n8n-nodes-base.googleCalendar",
        "position": [
          2520,
          300
        ],
        "parameters": {
          "eventId": "={{$json.id}}",
          "calendar": {
            "__rl": true,
            "mode": "list",
            "value": "37f51d1c36997a7dacbba1d1470fe5f0213699c4d926e7a3104c35f1cb79cb75@group.calendar.google.com",
            "cachedResultName": "Meeting slots"
          },
          "operation": "update",
          "updateFields": {
            "attendeesUi": {
              "values": {
                "attendees": [
                  "={{ $(\"Gmail Trigger\").item.json.from.value[0].address }}\n"
                ]
              }
            },
            "sendUpdates": "all"
          }
        },
        "credentials": {
          "googleCalendarOAuth2Api": {
            "id": "De5XvcvX90kFuzvb",
            "name": "Google Calendar account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "df5552fc-910b-4b13-81fa-0c9d98ce82d7",
        "name": "Code",
        "type": "n8n-nodes-base.code",
        "position": [
          2520,
          140
        ],
        "parameters": {
          "jsCode": "const triggerJson = $('Gmail Trigger').item.json;\nconst headersFrom  = triggerJson.headers.from;      // \"Name <addr@example.com>\"\n\n// Split into name and address\nconst namePart = headersFrom.split('<')[0].replace(/^From:\\s*/i, '').trim();\nconst emailPart = headersFrom.match(/<([^>]+)>/)?.[1] || headersFrom;\n\nconst slotTimes = items.map(i =>\n  new Date(i.json.start.dateTime || i.json.start.date).toLocaleString(\n    'en-US',\n    { weekday:'short', month:'short', day:'numeric', hour:'numeric',\n      minute:'2-digit', hour12:true }\n  )\n);\n\nreturn [{\n  json: {\n    slotTimes,\n    senderName:  namePart,\n    senderEmail: emailPart,\n    originalSub: triggerJson.subject               // pass the subject along\n  }\n}];\n"
        },
        "typeVersion": 2
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "2b74a94c-8a92-4a15-b0a4-5590afba0f39",
    "connections": {
      "Code": {
        "main": [
          [
            {
              "node": "QuestionsReply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reply": {
        "main": [
          [
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Mark as Read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mark as Read": {
        "main": [
          [
            {
              "node": "Apply Label",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Emails from Existing Contracts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "QuestionsReply": {
        "main": [
          [
            {
              "node": "Mark as Read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Calendar": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "Code",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Google Calendar1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "Google Calendar",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Youtube Video Inquiry",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Calendar1": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Youtube Video Inquiry": {
        "main": [
          [
            {
              "node": "Mark as Read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Emails from Existing Contracts": {
        "main": [
          [],
          [
            {
              "node": "Reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "d1786ab0d745a7498abf13a9c2cdabb1374c006e889b79eef64ce0386b8f8a41"
    },
    "nodes": [
      {
        "id": "ebb9a336-a28d-4896-b997-46c9fa963127",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          280,
          400
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes"
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "f3099bfa-ff5d-42ea-88db-f4ac5206b21b",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          720,
          420
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "d05201ee-55d4-4e27-b31e-6c588ee224ae",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          940,
          640
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-5",
            "cachedResultName": "gpt-5"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "MGwGMKEkdcjzlYCw",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "1503f20c-7b39-4b47-8d80-ffcafea8d004",
        "name": "Add Label (High Priority)",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1440,
          260
        ],
        "webhookId": "78527ed1-4494-4a9a-994b-a417a3c45ac1",
        "parameters": {
          "labelIds": [
            "IMPORTANT"
          ],
          "resource": "thread",
          "threadId": "={{ $json.threadId }}",
          "operation": "addLabels"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "CeBpTZBQSAMKVKJY",
            "name": "Gmail account (Billy Email 2)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "1cf7e5f2-d95d-4716-92b8-25fb873c5279",
        "name": "Add Label (Personal)",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1440,
          460
        ],
        "webhookId": "78527ed1-4494-4a9a-994b-a417a3c45ac1",
        "parameters": {
          "labelIds": [
            "CATEGORY_PERSONAL"
          ],
          "resource": "thread",
          "threadId": "={{ $json.threadId }}",
          "operation": "addLabels"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "CeBpTZBQSAMKVKJY",
            "name": "Gmail account (Billy Email 2)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "c6bf0b6d-07b8-4db6-a23c-e016e922ae6a",
        "name": "Add Label (Promotions)",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1440,
          680
        ],
        "webhookId": "78527ed1-4494-4a9a-994b-a417a3c45ac1",
        "parameters": {
          "labelIds": [
            "CATEGORY_PROMOTIONS"
          ],
          "resource": "thread",
          "threadId": "={{ $json.threadId }}",
          "operation": "addLabels"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "CeBpTZBQSAMKVKJY",
            "name": "Gmail account (Billy Email 2)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "96a7c0e2-8cbc-4b6f-bad4-890c22f49c41",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -180,
          320
        ],
        "parameters": {
          "color": 4,
          "width": 400,
          "height": 300,
          "content": "## SETUP REQUIRED\n\nWorkflow Configurations:\n- Update the Text Classifier and adjust the labels based on your use case.\n- Add/Remove the Gmail addLabels node to match your use case.\n\nRequired Credentials:\n- Gmail Credential\n- OpenAI API Key"
        },
        "typeVersion": 1
      },
      {
        "id": "356a4f13-5e7e-4867-ae9d-e7b668fc000d",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -180,
          960
        ],
        "parameters": {
          "color": 4,
          "width": 680,
          "height": 400,
          "content": "## üìã WORKFLOW PROCESS OVERVIEW\n\nStep 1: ‚è∞ Schedule Trigger executes the workflow every 5 minutes automatically\nStep 2: üì® Gmail Fetch retrieves up to 10 recent emails from the last 5 minutes using Gmail API\nStep 3: üîÑ Loop Over Items processes each email individually through a batch splitting mechanism\nStep 4: ü§ñ Text Classifier (AI Agent) analyzes email subject and body content using OpenAI to categorize emails\nStep 5: üè∑Ô∏è Add Labels applies the appropriate Gmail label based on classification: (below is an example only, adjust to your own use case)\n  - High Priority emails ‚Üí \"IMPORTANT\" label\n  - Personal emails ‚Üí \"CATEGORY_PERSONAL\" label  \n  - Promotional emails ‚Üí \"CATEGORY_PROMOTIONS\" label\n\n\nStep 6: ‚Ü©Ô∏è Loop Back continues processing remaining emails until all are classified and labeled"
        },
        "typeVersion": 1
      },
      {
        "id": "caac34f4-9c3f-498c-851e-0f3c8aa47b59",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -180,
          660
        ],
        "parameters": {
          "color": 4,
          "width": 680,
          "height": 280,
          "content": "## üìß Smart Gmail Labeling Automation with Text Classifier and GPT-5\n\nWhat This Template Does:\n\n- Runs every 5 minutes to automatically fetch recent emails from your Gmail inbox\n- Retrieves up to 10 emails received within the last 5 minutes\n- Uses OpenAI's Model to intelligently classify each email into predefined categories\n- Automatically applies appropriate Gmail labels based on AI classification results\n- Organizes your inbox by categorizing emails as High Priority, Personal, or Promotional content\n- Processes emails individually through a batch loop to ensure accurate classification"
        },
        "typeVersion": 1
      },
      {
        "id": "59f3ef25-86a1-4353-b52a-17ef8437d014",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1360,
          80
        ],
        "parameters": {
          "color": 4,
          "width": 280,
          "height": 860,
          "content": "## Add Label Nodes\n\nAdd Label Nodes based on your use case. For example, if you have 5 labels, then you can add 5 nodes and adjust the label names on each node.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "90022931-b5a3-459f-8007-0828ef195cc3",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          940,
          280
        ],
        "parameters": {
          "color": 4,
          "width": 320,
          "height": 320,
          "content": "## Label Classifier\n\nAdjust the categories based on your use case. Also, add a description to each category for maximum results.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "f73aa2ef-317d-44bf-a04c-7cc40a823328",
        "name": "Label Classifier",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "position": [
          960,
          460
        ],
        "parameters": {
          "options": {
            "fallback": "other"
          },
          "inputText": "=Email Subject:\n{{ $json.headers.subject }}\n\nEmail Body:\n{{ $json.text }}",
          "categories": {
            "categories": [
              {
                "category": "High Priority",
                "description": "Emails that require immediate attention or urgent action."
              },
              {
                "category": "Personal",
                "description": "Personal refers to activities or matters related to private life, self, or non-work interests."
              },
              {
                "category": "Promotions",
                "description": "Promotions refer to marketing messages or activities that advertise products, services, or offers"
              }
            ]
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": false
      },
      {
        "id": "c27d9b65-e31a-483e-beba-70af54e287fd",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          380,
          240
        ],
        "parameters": {
          "color": 4,
          "width": 320,
          "height": 320,
          "content": "## Gmail - Get Emails\n\nGet all messages received within the last 5 minutes.  \nYou can adjust the time range and the email limit here.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "4b8a92f1-4894-43cd-a647-7efebd253e64",
        "name": "Gmail - Get Emails",
        "type": "n8n-nodes-base.gmail",
        "position": [
          480,
          400
        ],
        "webhookId": "9777ca5f-5226-4fc8-b93b-a3344f890dd3",
        "parameters": {
          "limit": 10,
          "simple": false,
          "filters": {
            "receivedAfter": "={{ $now.minus({ minutes: 50000 }).toMillis() }}"
          },
          "options": {},
          "operation": "getAll"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "CeBpTZBQSAMKVKJY",
            "name": "Gmail account (Billy Email 2)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "f8aeeec3-e0d7-44a9-ad67-6c2735a63a6e",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1680,
          120
        ],
        "parameters": {
          "color": 4,
          "width": 380,
          "height": 760,
          "content": "# üëã Hi, I‚Äôm Billy\n![My Photo](https://i.ibb.co/Gvn63Bzc/Billy-Christi-AI-Automation.jpg)\nI help businesses build **n8n workflows** & **AI automation projects**.  \nNeed help with n8n or AI Automation projects? \nContact me and let‚Äôs build your automation together.\n\nüì© **Email:** billychartanto@gmail.com  \nü§ù **n8n Creator:** [n8n.io/creators/billy](https://n8n.io/creators/billy/)\nüåê **My n8n Projects:** [billychristi.com/n8n](https://www.billychristi.com/n8n)  \n\n\n\n---\nüí° Feel free to get in touch if you‚Äôd like help on your next automation project or if you have any feedback or thoughts to share.\n"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "Label Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Label Classifier": {
        "main": [
          [
            {
              "node": "Add Label (High Priority)",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Add Label (Personal)",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Add Label (Promotions)",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Gmail - Get Emails",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Label Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Gmail - Get Emails": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Label (Personal)": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Label (Promotions)": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Label (High Priority)": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "5aaf4236c70e34e423fbdb2c7b754d19253a933bb1476d548f75848a01e473cf"
    },
    "nodes": [
      {
        "id": "ecbb99d3-d896-48cc-b6b1-72e178329a3c",
        "name": "Generate Recovery Email",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          100,
          500
        ],
        "parameters": {
          "text": "=Write a friendly and persuasive abandoned cart recovery email for a customer named {{ $json.checkouts[0].customer.first_name }} {{ $json.checkouts[0].customer.last_name }}. The cart contains: {{ $json.checkouts }}. Encourage them to complete their purchase with a subtle reminder and optionally a discount. do not include subject and don't add extra stuff\n",
          "options": {},
          "promptType": "define"
        },
        "typeVersion": 1.9
      },
      {
        "id": "0b156bce-50ec-4e56-9c67-be4b34791b3e",
        "name": "Email Writer",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          40,
          700
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "typeVersion": 1.2
      },
      {
        "id": "49b21bce-bece-40a3-b9c0-86e4adc3e167",
        "name": "Log Email Activity",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          740,
          500
        ],
        "parameters": {
          "columns": {
            "value": {
              "email": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].email }}",
              "customer": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].customer.first_name }} {{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].customer.last_name }}",
              "GPT response": "={{ $('Generate Recovery Email').item.json.output }}"
            },
            "schema": [
              {
                "id": "customer",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "customer",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "email",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "email",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "GPT response",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "GPT response",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1H83mXsl_gjgwOWrwNYak6ISihoWsgx-EFxSbPlvQx7M/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1H83mXsl_gjgwOWrwNYak6ISihoWsgx-EFxSbPlvQx7M",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1H83mXsl_gjgwOWrwNYak6ISihoWsgx-EFxSbPlvQx7M/edit?usp=drivesdk",
            "cachedResultName": "Shopify abandoned checkout"
          }
        },
        "typeVersion": 4.5
      },
      {
        "id": "e55ea939-10fd-423b-99ef-90a89b0effc8",
        "name": "Send Email to Customer",
        "type": "n8n-nodes-base.gmail",
        "position": [
          520,
          500
        ],
        "webhookId": "fb71183d-2a4d-4eca-a73b-225d4cfa4d2d",
        "parameters": {
          "sendTo": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].email }}",
          "message": "={{ $json.output }}",
          "options": {},
          "subject": "=You left something behind, {{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].customer.first_name }}"
        },
        "typeVersion": 2.1
      },
      {
        "id": "b5a6e9ac-6d54-4d6f-bf4d-ced260eecd00",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -680,
          400
        ],
        "parameters": {
          "color": 3,
          "width": 420,
          "height": 520,
          "content": "üîç Section 3: Conditional Decision\n5. Is Customer Still Abandoned?\nNode Type: Conditional (If Statement).\n\nLogic: Compares the initial abandoned list with the new one using Customer ID.\n\nOutcome:\n\n‚úÖ Yes ‚Äì customer is still in the abandoned list ‚Üí proceed to email.\n\n‚ùå No ‚Äì customer has completed checkout ‚Üí do nothing."
        },
        "typeVersion": 1
      },
      {
        "id": "5462049f-2c8d-4f94-9475-33b16cbf4074",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          0,
          0
        ],
        "parameters": {
          "color": 5,
          "width": 920,
          "height": 840,
          "content": "üìß Section 4: Recovery Email Flow\n6. Create Personalized Recovery Email\nNode Type: AI Content Generation (GPT-based).\n\nInput: Customer name, product(s) left in cart, etc.\n\nOutput: A personalized recovery email message.\n\nPurpose: Increases the chances of recovery through customized messaging.\n\n7. Send Recovery Email\nNode Type: Email Action (e.g., Gmail, SMTP).\n\nPurpose: Sends the generated email to the customer.\n\n8. Log Email Sent\nNode Type: Spreadsheet Append (Google Sheets, etc.).\n\nPurpose: Logs customer email, customer name and Response.\n\nHelps With: Tracking open rates, click-throughs, and future optimizations."
        },
        "typeVersion": 1
      },
      {
        "id": "ef86a495-60f4-49c0-a5ca-bbc4b36724b8",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3520,
          300
        ],
        "parameters": {
          "color": 4,
          "width": 1300,
          "height": 320,
          "content": "=======================================\n            WORKFLOW ASSISTANCE\n=======================================\nFor any questions or support, please contact:\n    Yaron@nofluff.online\n\nExplore more tips and tutorials here:\n   - YouTube: https://www.youtube.com/@YaronBeen/videos\n   - LinkedIn: https://www.linkedin.com/in/yaronbeen/\n=======================================\n"
        },
        "typeVersion": 1
      },
      {
        "id": "0f722fcc-e05a-4b9d-9250-487a049779eb",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3520,
          640
        ],
        "parameters": {
          "color": 4,
          "width": 1289,
          "height": 2238,
          "content": "Here's a full, polished write-up of your **Abandoned Checkout Recovery Workflow** following the format of your **High-Value Order Alert Workflow** example:\n\n---\n\n# üõí Abandoned Checkout Recovery Workflow\n\n**Description:**\nThis workflow helps recover lost sales by identifying customers who abandon their checkout process. It begins by fetching abandoned cart data from a store, waits for a specific duration (1 hour), and rechecks to see if the customer has still not completed the purchase. If abandonment persists, the workflow generates a personalized recovery email using AI and sends it to the customer. This increases the chance of conversion and improves overall sales recovery rates.\n\n---\n\n## üü¢ Section 1: Checkout Monitoring & Initial Data Fetch\n\nThe workflow is initiated manually or on a scheduled basis to scan for abandoned checkouts via an API call to the store. This request returns a list of customers who added products to their cart but did not complete the purchase.\n\nThis initial fetch sets the baseline for comparison. The data includes essential customer identifiers and cart details, which will be used later to determine if the customer has recovered on their own.\n\nThis step ensures that the workflow only targets genuine abandonment scenarios and avoids acting on transient or temporary cases.\n\n---\n\n## ‚è±Ô∏è Section 2: Grace Period Wait\n\nAfter the initial abandoned checkout list is retrieved, the workflow pauses for **1 hour**. This buffer period gives customers time to complete their checkout naturally, without being nudged prematurely.\n\nThis approach respects customer autonomy and avoids sending unnecessary reminders, thereby reducing the risk of annoying users or cluttering inboxes.\n\n---\n\n## üîÑ Section 3: Rechecking Abandonment Status\n\nOnce the wait time has elapsed, the workflow makes a second HTTP request to fetch the latest list of abandoned checkouts. It then uses a conditional check to determine if a particular customer from the initial list still appears in the updated data.\n\n* **If the customer is still present** in the new list, they are considered to still be in an abandoned state.\n* **If the customer is not present**, it is assumed that they completed their purchase and no further action is taken.\n\nThis section acts as a smart filter to prevent sending recovery emails unnecessarily.\n\n---\n\n## ‚úâÔ∏è Section 4: Personalized Recovery Email Flow\n\nIf the customer is confirmed to still have an abandoned cart, the workflow proceeds to engage them with a recovery email.\n\nAn AI email writer generates a **personalized email** based on the abandoned cart data. The message can include specific products, a friendly reminder, and optional incentives such as discounts.\n\nThe email is then sent to the customer via an integrated email service provider. Immediately after, the workflow logs the email activity to a spreadsheet or database for tracking purposes. This helps monitor campaign effectiveness and customer engagement over time.\n\n---\n\n## üõë Fallback: Customer Completed Purchase\n\nIf the customer is **not found** in the second check, it means they successfully completed the checkout during the wait period. In this case, the workflow follows a \"do nothing\" path ‚Äî no email is sent, and the process ends gracefully.\n\nThis fallback mechanism ensures customers aren't contacted unnecessarily, maintaining a respectful user experience.\n\n---\n\n## üîÅ Full Workflow Logic Overview\n\n1. Start the workflow manually or on a schedule.\n2. Fetch a list of current abandoned checkouts.\n3. Wait for 1 hour.\n4. Fetch updated abandoned checkout data.\n5. Compare both datasets:\n\n   * If customer still appears:\n\n     * Use AI to generate a personalized recovery email.\n     * Send the email to the customer.\n     * Log the activity.\n   * If customer no longer appears:\n\n     * End the workflow without taking action.\n\n---\n\nLet me know if you‚Äôd like this converted into a PDF or added to a documentation system!\n"
        },
        "typeVersion": 1
      },
      {
        "id": "7a5fce94-6ae8-43a3-9e45-b15e1d6ecf61",
        "name": "No Operation, do nothing",
        "type": "n8n-nodes-base.noOp",
        "position": [
          100,
          1060
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "e8966160-eb7b-470c-9754-52048cb01551",
        "name": "Start Workflow",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -1720,
          720
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "7ac542e0-5379-4416-a33e-c2ba13947a30",
        "name": "Get Initial Abandoned Checkout",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -1420,
          720
        ],
        "parameters": {
          "url": "https://your-store.myshopify.com/admin/api/2023-10/checkouts.json",
          "options": {},
          "sendQuery": true,
          "sendHeaders": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "status",
                "value": "abandoned"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "X-Shopify-Access-Token",
                "value": "your-access-token"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "2409af7c-7df8-4825-b31a-7d2f4bb84a59",
        "name": "Wait 1 Hour",
        "type": "n8n-nodes-base.wait",
        "position": [
          -1120,
          720
        ],
        "webhookId": "12d15136-8aa1-4177-a572-04da4b88b28c",
        "parameters": {
          "unit": "hours",
          "amount": 1
        },
        "typeVersion": 1.1
      },
      {
        "id": "449c40d4-e1fa-4984-9b3b-c9dd6863e71a",
        "name": "Recheck Abandoned Checkouts",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -900,
          720
        ],
        "parameters": {
          "url": "https://your-store.myshopify.com/admin/api/2023-10/checkouts.json",
          "options": {},
          "sendQuery": true,
          "sendHeaders": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "status",
                "value": "abandoned"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "X-Shopify-Access-Token",
                "value": "your-access-token"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "023ea763-155f-4c3c-8c3b-d7de0ef1687a",
        "name": "Is Customer Still Abandoned?",
        "type": "n8n-nodes-base.if",
        "position": [
          -620,
          720
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "8119001f-78d5-40b4-bcd7-8f13495b6d51",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].id }}",
                "rightValue": "={{ $json.checkouts[0].id }}"
              },
              {
                "id": "229cf7e1-5490-4bd0-9004-2baadbe15b4f",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].id }}",
                "rightValue": "={{ $json.checkouts[1].id }}"
              },
              {
                "id": "163c04b1-6e4b-42da-9a5f-2168c4148023",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].id }}",
                "rightValue": "={{ $json.checkouts[2].id }}"
              },
              {
                "id": "42461258-29f4-4dc2-9c34-598654debaa6",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].id }}",
                "rightValue": "={{ $json.checkouts[3].id }}"
              },
              {
                "id": "a0c9d76f-66fc-454b-b59c-990291c85ebf",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $('Get Initial Abandoned Checkout').item.json.checkouts[0].id }}",
                "rightValue": "={{ $json.checkouts[4].id }}"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "c0a92444-8d4d-4eeb-8c8f-7757d90dff2c",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1760,
          320
        ],
        "parameters": {
          "width": 520,
          "height": 600,
          "content": "üîÅ Section 1: Initialization & First Abandoned Checkout Fetch\n1. Start Abandoned Checkout Recovery\nPurpose: Triggers the workflow.\n\nTrigger Type: Manual or Scheduled.\n\nWhen: Could be set to run periodically (e.g., every hour).\n\n2. Get Initial Abandoned Checkouts\nNode Type: HTTP Request (GET).\n\nURL: https://your_store.myshopify.com/admin/api/...\n\nPurpose: Fetches the list of all abandoned checkouts at the start of the workflow.\n\nOutput: A list of abandoned carts with customer ID."
        },
        "typeVersion": 1
      },
      {
        "id": "4748bf2d-732b-48f5-a506-01ab5f5ebbe8",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1180,
          320
        ],
        "parameters": {
          "width": 460,
          "height": 600,
          "content": "‚è≥ Section 2: Wait and Re-evaluation\n3. Wait 1 Hour\nNode Type: Wait.\n\nDuration: 1 hour.\n\nPurpose: Gives the customer a grace period to complete the checkout naturally before initiating any recovery steps.\n\n4. Recheck Abandoned Checkouts\nNode Type: HTTP Request (GET).\n\nURL: Same as the initial fetch.\n\nPurpose: Fetches the updated list of abandoned checkouts.\n\nOutput: A new list of customer IDs who still haven‚Äôt completed their checkout."
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Wait 1 Hour": {
        "main": [
          [
            {
              "node": "Recheck Abandoned Checkouts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email Writer": {
        "ai_languageModel": [
          [
            {
              "node": "Generate Recovery Email",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Start Workflow": {
        "main": [
          [
            {
              "node": "Get Initial Abandoned Checkout",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email to Customer": {
        "main": [
          [
            {
              "node": "Log Email Activity",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Recovery Email": {
        "main": [
          [
            {
              "node": "Send Email to Customer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Recheck Abandoned Checkouts": {
        "main": [
          [
            {
              "node": "Is Customer Still Abandoned?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Customer Still Abandoned?": {
        "main": [
          [
            {
              "node": "Generate Recovery Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Initial Abandoned Checkout": {
        "main": [
          [
            {
              "node": "Wait 1 Hour",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "cN01cF1imXdMQfro",
    "meta": {
      "instanceId": "adebbe2592e5612173c7a1dda20af6cbd944e35e3d0414c25474c49218afc346",
      "templateCredsSetupCompleted": true
    },
    "name": "Smarter RAG Agents with Enriched Retrieval, Filters & Memory - by ascuncia",
    "tags": [],
    "nodes": [
      {
        "id": "6052b910-009b-4db5-a956-096758e7cc07",
        "name": "Default Data Loader",
        "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
        "position": [
          320,
          704
        ],
        "parameters": {
          "options": {
            "metadata": {
              "metadataValues": [
                {
                  "name": "=doc_id",
                  "value": "={{ $('Set File Data').item.json.doc_id }}"
                },
                {
                  "name": "doc_title",
                  "value": "={{ $('Set File Data').item.json.doc_title }}"
                },
                {
                  "name": "doc_type",
                  "value": "={{ $('Set File Data').item.json.doc_type }}"
                },
                {
                  "name": "source",
                  "value": "={{ $('Set File Data').item.json.source }}"
                },
                {
                  "name": "processed",
                  "value": "false"
                }
              ]
            }
          },
          "jsonData": "={{ $('Extract from File').item.json.text }}",
          "jsonMode": "expressionData"
        },
        "typeVersion": 1
      },
      {
        "id": "c777cf9b-4048-4889-98e1-da1c38aaeb50",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1040,
          448
        ],
        "parameters": {
          "color": 5,
          "width": 1751,
          "height": 672,
          "content": "## File Ingestion pipeline"
        },
        "typeVersion": 1
      },
      {
        "id": "cb389645-8257-4542-9255-ada92122865f",
        "name": "Recursive Character Text Splitter",
        "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
        "position": [
          400,
          912
        ],
        "parameters": {
          "options": {},
          "chunkSize": 1500,
          "chunkOverlap": 150
        },
        "typeVersion": 1
      },
      {
        "id": "a034b27b-f602-43b4-a588-c284610a0b90",
        "name": "Delete Old Doc Rows",
        "type": "n8n-nodes-base.supabase",
        "position": [
          -256,
          768
        ],
        "parameters": {
          "tableId": "documents",
          "operation": "delete",
          "filterType": "string",
          "filterString": "=metadata->>doc_id=eq.{{ $('On form submission').item.json.File[0].filename }}"
        },
        "credentials": {
          "supabaseApi": {
            "id": "CJBJzRJNUpKL96fh",
            "name": "Supabase - RAG-DB"
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": true
      },
      {
        "id": "95aeede8-3cd7-489b-ae0e-f197af68fdde",
        "name": "When chat message received",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          -736,
          -32
        ],
        "webhookId": "f3071b55-8fd9-4aea-ba97-8aeaaa6cf953",
        "parameters": {
          "public": true,
          "options": {}
        },
        "typeVersion": 1.1
      },
      {
        "id": "2a479838-750b-4a07-b58b-629040fef5f3",
        "name": "Insert into Supabase Vectorstore",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "position": [
          224,
          480
        ],
        "parameters": {
          "mode": "insert",
          "options": {
            "queryName": "match_documents"
          },
          "tableName": {
            "__rl": true,
            "mode": "list",
            "value": "documents",
            "cachedResultName": "documents"
          }
        },
        "credentials": {
          "supabaseApi": {
            "id": "CJBJzRJNUpKL96fh",
            "name": "Supabase - RAG-DB"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "d3adc752-00a4-4e06-9d8b-93975b6248c2",
        "name": "Embeddings Google Gemini1",
        "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
        "position": [
          192,
          704
        ],
        "parameters": {},
        "credentials": {
          "googlePalmApi": {
            "id": "qiYf0c3QAERXYWhH",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "9b02b9e2-1883-4c81-bf70-0d07aafd8c4d",
        "name": "On form submission",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -928,
          672
        ],
        "webhookId": "6c4668b3-6d00-4902-ace7-a9155048779a",
        "parameters": {
          "options": {},
          "formTitle": "Archivo",
          "formFields": {
            "values": [
              {
                "fieldType": "file",
                "fieldLabel": "File",
                "multipleFiles": false,
                "requiredField": true,
                "acceptFileTypes": ".pdf"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "1545a027-fa95-4344-84eb-54da0b454285",
        "name": "Extract from File",
        "type": "n8n-nodes-base.extractFromFile",
        "position": [
          -704,
          672
        ],
        "parameters": {
          "options": {},
          "operation": "pdf",
          "binaryPropertyName": "File"
        },
        "typeVersion": 1
      },
      {
        "id": "495722e8-2746-40ec-8793-667ab334bd89",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          -512,
          1360
        ],
        "parameters": {
          "options": {},
          "batchSize": 5
        },
        "typeVersion": 3
      },
      {
        "id": "202868eb-6fab-4d39-a3c6-cdc0601abf86",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1040,
          1136
        ],
        "parameters": {
          "width": 1751,
          "height": 672,
          "content": "## Enrichment Pipeline"
        },
        "typeVersion": 1
      },
      {
        "id": "177b1443-2e70-40e0-9a5b-2885e0a95f85",
        "name": "Get many rows",
        "type": "n8n-nodes-base.supabase",
        "position": [
          -736,
          1360
        ],
        "parameters": {
          "limit": 150,
          "tableId": "documents",
          "operation": "getAll",
          "filterType": "string",
          "filterString": "metadata->>processed=not.eq.true"
        },
        "credentials": {
          "supabaseApi": {
            "id": "CJBJzRJNUpKL96fh",
            "name": "Supabase - RAG-DB"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "6cb4273c-9f85-46bf-aae6-5d1a7b33321a",
        "name": "Update a row",
        "type": "n8n-nodes-base.supabase",
        "position": [
          320,
          1360
        ],
        "parameters": {
          "filters": {
            "conditions": [
              {
                "keyName": "=id",
                "keyValue": "={{ $('Edit Fields').item.json.row_id }}",
                "condition": "eq"
              }
            ]
          },
          "tableId": "documents",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "metadata",
                "fieldValue": "={{ JSON.stringify(\n  (() => {\n    const prev = $item(0).$node[\"Get many rows\"].json.metadata || {};\n    let enriched = {};\n    try {\n      const raw = $('Metadata Obtention').item.json.content?.parts?.[0]?.text || \"{}\";\n      enriched = JSON.parse(raw);\n    } catch(_) {}\n    return {\n      ...prev,\n      ...enriched,\n      processed: true,\n      enricher_version: \"v2-generic-2025-08\",\n      enriched_at: new Date().toISOString(),\n    };\n  })()\n) }}\n"
              }
            ]
          },
          "matchType": "allFilters",
          "operation": "update"
        },
        "credentials": {
          "supabaseApi": {
            "id": "CJBJzRJNUpKL96fh",
            "name": "Supabase - RAG-DB"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "8f6c4eef-8e8a-4149-8547-d5154fc68348",
        "name": "Merge",
        "type": "n8n-nodes-base.merge",
        "position": [
          -32,
          688
        ],
        "parameters": {
          "mode": "chooseBranch"
        },
        "typeVersion": 3.2
      },
      {
        "id": "ec4628dc-0b9b-416a-b9d8-bf5999828382",
        "name": "Wait",
        "type": "n8n-nodes-base.wait",
        "position": [
          512,
          1360
        ],
        "webhookId": "f99c8e49-43ad-4b63-b788-2c91981647e7",
        "parameters": {},
        "typeVersion": 1.1
      },
      {
        "id": "05d41aff-ac21-4f17-a807-485a8c6a58ba",
        "name": "Set File Data",
        "type": "n8n-nodes-base.set",
        "position": [
          -480,
          672
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
                "name": "doc_id",
                "type": "string",
                "value": "={{ $('On form submission').item.json.File.filename }}"
              },
              {
                "id": "d75d991a-98ce-4070-943d-22e555a074c5",
                "name": "doc_title",
                "type": "string",
                "value": "={{ $json.info.Title || $json.data.filename }}"
              },
              {
                "id": "d7cff574-0e40-4d67-9c88-dacb8e97c45e",
                "name": "doc_type",
                "type": "string",
                "value": "={{ \"guide\" }}"
              },
              {
                "id": "82b5bfb4-f33d-4268-b9d4-8dd3c2f0f097",
                "name": "source",
                "type": "string",
                "value": "={{ \"uploaded_pdf\" }}"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "74925cc0-31fb-4ff5-9dea-9af6b155ad63",
        "name": "Metadata Obtention",
        "type": "@n8n/n8n-nodes-langchain.googleGemini",
        "onError": "continueErrorOutput",
        "position": [
          -32,
          1360
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "models/gemma-3-12b-it",
            "cachedResultName": "models/gemma-3-12b-it"
          },
          "options": {
            "temperature": 0.1,
            "maxOutputTokens": 512
          },
          "messages": {
            "values": [
              {
                "content": "=You are a metadata enricher for arbitrary business documents (guides, manuals, best practices, policies, FAQs, playbooks).\n\nTASK\nAnalyze the provided TEXT CHUNK and return a SINGLE-LINE, MINIFIED JSON object (no backticks, no prose). Use ONLY what is explicitly present or safely implied by the chunk. If a field does not apply, use null or [] accordingly.\n\nINPUTS\n- chunk_text: {{ $json.content }}\n- file metadata (for disambiguation only; DO NOT copy values if not present in the chunk):\n  - doc_title: {{ $json.metadata.doc_title }}\n  - doc_type: {{ $json.metadata.doc_type }}\n\nOUTPUT SCHEMA (exact keys; keep values short and consistent):\n{\n  \"topics\": [\"keyword1\",\"keyword2\"],             // up to 8\n  \"feature\": \"short_tag\",                         // e.g., \"workspaces\", \"databases\", \"onboarding\", \"security\"\n  \"use_case\": \"short_tag\",                        // e.g., \"workspace_structure\", \"communication\", \"setup\", \"policy\"\n  \"audience\": \"beginner|intermediate|advanced|null\",\n  \"section\": \"section_or_heading_if_any\",\n  \"entities\": [\"product|role|team|concept\"],      // proper names or domain terms\n  \"key_recommendations\": [\"bullet1\",\"bullet2\"],   // up to 5 concise, actionable bullets\n  \"risks_or_pitfalls\": [\"risk1\",\"risk2\"],         // up to 5; [] if none\n  \"examples_present\": true,                       // whether the chunk includes an example\n  \"language\": \"auto_detected_iso_639_1\",          // e.g., \"en\", \"es\", \"pt\", \"it\"; infer from chunk_text\n  \"chunk_summary\": \"1-2 sentence neutral summary\" // plain, factual, grounded in the chunk\n}\n\nGUIDELINES\n- Prefer concrete nouns/verbs over vague words.\n- Do not invent entities or recommendations; keep them grounded in the text.\n- If multiple candidates exist, choose the most central one (or null).\n- Deduplicate arrays; keep strings on a single line; no trailing punctuation in bullets.\n\nRETURN ONLY THE MINIFIED JSON, ONE LINE.\n"
              }
            ]
          }
        },
        "credentials": {
          "googlePalmApi": {
            "id": "qiYf0c3QAERXYWhH",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "retryOnFail": true,
        "typeVersion": 1,
        "waitBetweenTries": 5000
      },
      {
        "id": "507d8646-ef0b-442a-a887-496dcec2dbd2",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -960,
          1360
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 25
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "a61859c2-872f-4510-a43f-c8490a76b938",
        "name": "Edit Fields",
        "type": "n8n-nodes-base.set",
        "position": [
          -256,
          1360
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "ea722112-aad6-419d-b187-f40044bf3b8a",
                "name": "row_id",
                "type": "number",
                "value": "={{$json.id}}"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "63388b99-9d84-41cf-b8c6-94186db049b2",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1040,
          -384
        ],
        "parameters": {
          "color": 4,
          "width": 1744,
          "height": 800,
          "content": "## RAG Chat Agent"
        },
        "typeVersion": 1
      },
      {
        "id": "1689c6a8-ba5f-493b-b31b-718bf7ce2ada",
        "name": "Query Builder",
        "type": "@n8n/n8n-nodes-langchain.googleGemini",
        "position": [
          -512,
          -32
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "models/gemma-3n-e2b-it",
            "cachedResultName": "models/gemma-3n-e2b-it"
          },
          "options": {
            "temperature": 0.1,
            "maxOutputTokens": 128
          },
          "messages": {
            "values": [
              {
                "content": "=You are a query builder for a document retrieval system (RAG). \nYour task: analyze the user‚Äôs question and output ONE SINGLE-LINE, MINIFIED JSON. No prose.\n\nOUTPUT SCHEMA (always valid JSON, one line):\n{\n  \"keywords\": [\"k1\",\"k2\",\"k3\"],          // up to 6 short terms from the question\n    \"filters\": {                           // OPTIONAL filters; include only if clearly implied, domain specific - do not include\n  }\n}\n\nRULES\n- Keep keywords concise; avoid stop-words or full sentences.\n- Only add filters if the intent is clear from the question.\n- If the user just greets or provides no query, return {\"keywords\":[]} with no filters.\n\n\nOUTPUT\n- Output ONLY valid JSON, minified, one single line.\n- Do NOT add ```json, code fences, or any text before/after.\n- Do NOT include newlines.\n\nINPUT\n{{ $json.chatInput }}\n\nNOTE\n- Domain-specific logic (e.g., mapping to product features, principles, policies) can be added here in future.\n"
              }
            ]
          }
        },
        "credentials": {
          "googlePalmApi": {
            "id": "qiYf0c3QAERXYWhH",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "dee30e44-bd9b-421f-b9d0-5365ca8813bf",
        "name": "RAG Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -96,
          -240
        ],
        "parameters": {
          "text": "={{ $('When chat message received').item.json.chatInput }}",
          "options": {
            "systemMessage": "=You are a friendly but objective RAG assistant. You may only answer using passages returned by the tool \"Supabase Vector Store\". \nIf in this turn you did not call the tool at least once, reply:\n\"I don't have enough evidence in the indexed documents to answer this.\"\n\nLANGUAGE\n- Always answer in the user's language. Detect automatically from the user message.\n\nRECOVERY QUERY\n- Use the JSON line produced by \"Query Builder\". If it contains multiple keywords or filters, pass them to the retrieval tool.\n- If the query is ambiguous, still retrieve with general keywords and let the reranker select the best contexts.\n\nANSWER RULES\n\"\n- Prefer 2‚Äì4 distinct passages. If only 1 is available, say evidence is limited. Always form a concrete answer with the passages, not lost sentences.\n- Do NOT import outside knowledge. If relevant passages are weak or missing, say so and suggest a clearer question.\n- If the user's message is just a greeting (e.g., \"hi\"), do NOT call tools. Respond with a short greeting and invite a question.\n\nOUTPUT STYLE\n- Concise, friendly but objective.\n- Add a section below with References, with the format\n  \"Source: <doc_title> ‚Äî <section>. Use a title for the section and bullets.\n- No hallucinations; everything must be grounded in retrieved text.\n\nFAILSAFE\n- If retrieval returns authors/topics unrelated to the user's intent, ignore them and state that no relevant evidence was found.\n"
          },
          "promptType": "define"
        },
        "typeVersion": 2
      },
      {
        "id": "14f8779d-043a-4b3b-8f96-ff6a0f5c1026",
        "name": "Reranker",
        "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
        "position": [
          240,
          192
        ],
        "parameters": {
          "topN": 8
        },
        "credentials": {
          "cohereApi": {
            "id": "nqvzqvHfJbmT7AS2",
            "name": "CohereApi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "024e08cb-30a6-4a1d-804c-f715b77ab220",
        "name": "Google Gemini 2.0 Flash",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          -160,
          -16
        ],
        "parameters": {
          "options": {
            "temperature": 0.2
          },
          "modelName": "models/gemini-2.0-flash"
        },
        "credentials": {
          "googlePalmApi": {
            "id": "qiYf0c3QAERXYWhH",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "af9307db-b459-4ce2-8dd6-c4207edfdc16",
        "name": "Postgres Chat Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "position": [
          -32,
          -16
        ],
        "parameters": {},
        "credentials": {
          "postgres": {
            "id": "DjwLcr6VNmIxcuo8",
            "name": "Postgres account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "ddc2ba09-f1bf-40e3-a48a-1cb08962279d",
        "name": "Embeddings Google Gemini",
        "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
        "position": [
          112,
          192
        ],
        "parameters": {},
        "credentials": {
          "googlePalmApi": {
            "id": "qiYf0c3QAERXYWhH",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "3fa897aa-3299-4198-9ed1-05808311e6dc",
        "name": "Supabase Vector Store",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "position": [
          112,
          -16
        ],
        "parameters": {
          "mode": "retrieve-as-tool",
          "topK": 48,
          "options": {
            "metadata": {
              "metadataValues": [
                {
                  "name": "doc_type",
                  "value": "={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.doc_type) } catch(e){ return undefined } })() }}"
                },
                {
                  "name": "feature",
                  "value": "={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.feature) } catch(e){ return undefined } })() }}"
                },
                {
                  "name": "use_case",
                  "value": "={{ (() => { try { return (JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.use_case) } catch(e){ return undefined } })() }}"
                },
                {
                  "name": "topics",
                  "value": "={{ (() => { try { const t = JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.topics; return Array.isArray(t) && t.length ? t : undefined } catch(e){ return undefined } })() }}"
                },
                {
                  "name": "entities",
                  "value": "={{ (() => { try { const t = JSON.parse(($('Query Builder').item.json.content?.parts?.[0]?.text || '{}')).filters?.entities; return Array.isArray(t) && t.length ? t : undefined } catch(e){ return undefined } })() }}"
                }
              ]
            }
          },
          "tableName": {
            "__rl": true,
            "mode": "list",
            "value": "documents",
            "cachedResultName": "documents"
          },
          "useReranker": true,
          "toolDescription": "=Semantic retrieval tool. Queries the \"documents\" table and returns passages with metadata.\n\nUsage by the agent:\n- Always use the JSON line produced by the Query Builder to form keywords and (optional) metadata filters.\n- If scope is \"multi_document\", allow results from multiple documents; otherwise bias to a single document if clearly implied.\nOutput: fragments with metadata.doc_title, section (if any), feature, use_case, topics, chunk_summary.\n"
        },
        "credentials": {
          "supabaseApi": {
            "id": "CJBJzRJNUpKL96fh",
            "name": "Supabase - RAG-DB"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "84305b9d-2042-4f61-8d87-0208675d2d58",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1424,
          480
        ],
        "parameters": {
          "width": 272,
          "height": 256,
          "content": "## üü© File Ingestion Pipeline\n\nExtracts and chunks uploaded PDFs.\nEmbeds content and stores it in Supabase vector DB.\nClean and modular, ready for other sources (Notion, Drive, etc)."
        },
        "typeVersion": 1
      },
      {
        "id": "2eb9bc0a-08dc-468e-88d4-fafb76dddbbb",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1408,
          1152
        ],
        "parameters": {
          "width": 272,
          "height": 256,
          "content": "## üü® Enrichment Pipeline (Async)\n\nEnriches chunks with semantic metadata using a lightweight LLM.\nImproves retrieval and enables filters like audience, use_case, risks.\nRuns asynchronously to reduce cost ‚Äî ideal for free-tier models."
        },
        "typeVersion": 1
      },
      {
        "id": "a8e76143-cb9f-412e-96c3-e9f5cfbf4e17",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1408,
          -384
        ],
        "parameters": {
          "width": 272,
          "height": 288,
          "content": "## üü¶ RAG Agent Pipeline\n\nHandles user questions with memory, filtering, reranking, and references.\nPowered by a Query Builder + Cohere Reranker + Gemini LLM.\nAnswers only with retrieved content ‚Äî safe, explainable, production-grade."
        },
        "typeVersion": 1
      },
      {
        "id": "315431cf-6b7f-43e9-ac3a-a3b2bd1280d7",
        "cid": "Ikx1Y2FzIFBleXJpbiI",
        "name": "Sticky Note26",
        "type": "n8n-nodes-base.stickyNote",
        "notes": "¬© 2025 Lucas Peyrin",
        "creator": "Lucas Peyrin",
        "position": [
          -2672,
          -48
        ],
        "parameters": {
          "color": 2,
          "width": 832,
          "height": 1568,
          "content": "## üß© Prepare the Database (SQL)\n\nNow we‚Äôll build the foundation that powers search, enrichment, and retrieval ‚Äî think of it as creating the ‚Äúsemantic filing system‚Äù for your document library.\n\n### ‚úÖ **Action Steps:**\n\n- In your Supabase project, open the SQL Editor.\n\n- Locate the sticky note below that includes the full SQL schema.\n\n- Copy the entire SQL code, paste it into the editor, and click ‚ÄúRUN‚Äù.\n\n### ‚ö†Ô∏è **Heads-Up:**\n\n- If you get an error saying pgvector already exists, simply delete the first line of the code (create extension vector;) and run it again.\n\n- This workflow uses Gemini embeddings with 768 dimensions.\n‚Üí If you're switching to OpenAI embeddings, you must update the schema line:\nChange vector(768) to vector(1536) to match the correct dimensions.\n\n\n### SQL"
        },
        "typeVersion": 1
      },
      {
        "id": "d9415450-8f09-4120-aacb-af623509c0aa",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2640,
          512
        ],
        "parameters": {
          "color": 7,
          "width": 768,
          "height": 896,
          "content": "-- üßπ (Optional) Clean up any previous table for fresh setup\ndrop table documents;\n\n-- üß† Enable pgvector to store and search vector embeddings\ncreate extension vector;\n\n-- üìö Create the main table to store your document chunks\ncreate table documents (\n  id bigserial primary key,         -- Unique ID for each chunk\n  content text,                     -- The chunk content (pageContent)\n  metadata jsonb,                   -- Metadata like filename, section, topic, etc.\n  embedding vector(768)             -- Gemini embedding vector (768 dims)\n                                    -- ‚ö†Ô∏è If using OpenAI: change to vector(1536)\n);\n\n-- üîß Drop older or conflicting versions of the matching function\ndrop function if exists public.match_documents(jsonb, int, vector);\ndrop function if exists public.match_documents(int, vector, jsonb);\ndrop function if exists public.match_documents(vector, int);\n\n-- üîç Create a custom function to perform vector search with optional filters\ncreate or replace function public.match_documents (\n  query_embedding vector(768),      -- Input embedding from user query\n  match_count int,                  -- Number of results to return\n  filter jsonb default '{}'::jsonb -- Optional filter using metadata\n)\nreturns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  embedding vector(768),\n  similarity float                  -- Cosine similarity score\n)\nlanguage sql stable\nas $$\n  select\n    id,\n    content,\n    metadata,\n    embedding,\n    1 - (embedding <#> query_embedding) as similarity  -- Cosine similarity = 1 - distance\n  from documents\n  where (filter is null or filter = '{}'::jsonb or metadata @> filter)\n  order by embedding <#> query_embedding                -- Order by closest match\n  limit match_count;\n$$;\n"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "5e6d500c-a7c9-4618-8eb1-9687146b726f",
    "connections": {
      "Wait": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Insert into Supabase Vectorstore",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reranker": {
        "ai_reranker": [
          [
            {
              "node": "Supabase Vector Store",
              "type": "ai_reranker",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Metadata Obtention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update a row": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get many rows": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Query Builder": {
        "main": [
          [
            {
              "node": "RAG Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set File Data": {
        "main": [
          [
            {
              "node": "Delete Old Doc Rows",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Get many rows",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from File": {
        "main": [
          [
            {
              "node": "Set File Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Metadata Obtention": {
        "main": [
          [
            {
              "node": "Update a row",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On form submission": {
        "main": [
          [
            {
              "node": "Extract from File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Default Data Loader": {
        "ai_document": [
          [
            {
              "node": "Insert into Supabase Vectorstore",
              "type": "ai_document",
              "index": 0
            }
          ]
        ]
      },
      "Delete Old Doc Rows": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "RAG Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Supabase Vector Store": {
        "ai_tool": [
          [
            {
              "node": "RAG Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini 2.0 Flash": {
        "ai_languageModel": [
          [
            {
              "node": "RAG Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings Google Gemini": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings Google Gemini1": {
        "ai_embedding": [
          [
            {
              "node": "Insert into Supabase Vectorstore",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "Query Builder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert into Supabase Vectorstore": {
        "main": [
          []
        ]
      },
      "Recursive Character Text Splitter": {
        "ai_textSplitter": [
          [
            {
              "node": "Default Data Loader",
              "type": "ai_textSplitter",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "wyzRJoRGTlwmZ0JJ",
    "meta": {
      "instanceId": "38c7fb933498a5028d938adeb8c37dbb3117d7ec2d546d718be8f13730816a0d",
      "templateCredsSetupCompleted": true
    },
    "name": "Social Media Content Generator And Publisher | X, Linkedin",
    "tags": [],
    "nodes": [
      {
        "id": "7095690e-4f33-4ad0-8276-f5f91768bc42",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          200,
          220
        ],
        "parameters": {
          "options": {},
          "modelName": "models/gemini-2.0-flash"
        },
        "credentials": {
          "googlePalmApi": {
            "id": "Td5xMGwy3MYAYRjH",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "2858290a-82be-4f2f-9f20-a1147d1feb32",
        "name": "Receive Post Title",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          0,
          0
        ],
        "webhookId": "4d921ee9-7668-4133-8750-4e35f9fc2353",
        "parameters": {
          "options": {},
          "formTitle": "post",
          "formFields": {
            "values": [
              {
                "fieldLabel": "post title"
              }
            ]
          },
          "authentication": "basicAuth",
          "formDescription": "post"
        },
        "credentials": {
          "httpBasicAuth": {
            "id": "YoS57iMdTC3pnXR6",
            "name": "Unnamed credential 2"
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "b1540464-46ca-42d3-9e53-c3b7bd006d55",
        "name": "Generate AI Content",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          200,
          0
        ],
        "parameters": {
          "text": "=\nwrite min 50 word about this topic '{{ $json[\"post title\"] }}'\nfor Linkedin and X platform separately",
          "options": {},
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 1.7
      },
      {
        "id": "ac86de4e-49a2-4efc-9067-bbb0008a218c",
        "name": "Format AI Output",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          360,
          260
        ],
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"event_name\": {\n      \"type\": \"string\"\n    },\n    \"event_description\": {\n      \"type\": \"string\"\n    },\n    \"platform_posts\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"LinkedIn\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"post\": {\n              \"type\": \"string\"\n            },\n            \"hashtags\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n              }\n            },\n            \"call_to_action\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"Twitter\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"post\": {\n              \"type\": \"string\"\n            },\n            \"hashtags\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n              }\n            },\n            \"character_limit\": {\n              \"type\": \"integer\"\n            }\n          }\n        }\n      }\n    },\n    \"additional_notes\": {\n      \"type\": \"string\"\n    }\n  }\n}"
        },
        "typeVersion": 1.2
      },
      {
        "id": "5a4cbb6f-4efc-4fd1-85ea-9022d6415811",
        "name": "Post to X",
        "type": "n8n-nodes-base.twitter",
        "position": [
          580,
          -100
        ],
        "parameters": {
          "text": "={{ $json.output.platform_posts.Twitter.post }}",
          "additionalFields": {}
        },
        "credentials": {
          "twitterOAuth2Api": {
            "id": "tFoAD5zVouFXHqHV",
            "name": "X account 4"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "6be0a393-1ef8-4e2e-b58e-e7dd90bf5295",
        "name": "Post to LinkedIn",
        "type": "n8n-nodes-base.linkedIn",
        "position": [
          580,
          120
        ],
        "parameters": {
          "text": "={{ $json.output.platform_posts.LinkedIn.post }}",
          "person": "-HtNhNKSsE",
          "additionalFields": {}
        },
        "credentials": {
          "linkedInOAuth2Api": {
            "id": "wssjQBMipjgQPG10",
            "name": "LinkedIn account 3"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "10336b6e-b093-473c-b8d1-90d6b7b043b3",
        "name": "Append Linkedin And X Publishing Responses",
        "type": "n8n-nodes-base.merge",
        "position": [
          860,
          20
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "combineBy": "combineAll"
        },
        "typeVersion": 3
      },
      {
        "id": "a236d6ba-0ded-4d42-99a3-0b53069faec5",
        "name": "Show Confirmation",
        "type": "n8n-nodes-base.form",
        "position": [
          1080,
          20
        ],
        "webhookId": "9c0b2419-aff6-40dd-95f7-5dfd0a88d46c",
        "parameters": {
          "options": {},
          "operation": "completion",
          "completionTitle": "Your post has been successfully shared",
          "completionMessage": "=üîó View your posts:\n\nX (Twitter): \n[https://x.com/x/status/{{ $json.id }}]\n\nLinkedIn:\n[https://www.linkedin.com/feed/update/{{ $json.urn }}]"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "7b92c25a-8617-44c8-b3b6-c038f01d6bfa",
    "connections": {
      "Post to X": {
        "main": [
          [
            {
              "node": "Append Linkedin And X Publishing Responses",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format AI Output": {
        "ai_outputParser": [
          [
            {
              "node": "Generate AI Content",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Post to LinkedIn": {
        "main": [
          [
            {
              "node": "Append Linkedin And X Publishing Responses",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Receive Post Title": {
        "main": [
          [
            {
              "node": "Generate AI Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate AI Content": {
        "main": [
          [
            {
              "node": "Post to X",
              "type": "main",
              "index": 0
            },
            {
              "node": "Post to LinkedIn",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Generate AI Content",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Append Linkedin And X Publishing Responses": {
        "main": [
          [
            {
              "node": "Show Confirmation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "26ba763460b97c249b82942b23b6384876dfeb9327513332e743c5f6219c2b8e"
    },
    "nodes": [
      {
        "id": "81ea4c6a-d603-4688-8b72-d9c79faf7adf",
        "name": "n8n Form Trigger",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          1272,
          455
        ],
        "webhookId": "d280e773-3bd8-44ce-a147-8b404251fce9",
        "parameters": {
          "path": "d280e773-3bd8-44ce-a147-8b404251fce9",
          "options": {},
          "formTitle": "BannerBear Clone",
          "formFields": {
            "values": [
              {
                "fieldType": "dropdown",
                "fieldLabel": "Template",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "n8n Meetup Template"
                    },
                    {
                      "option": "AI Meetup Template"
                    }
                  ]
                }
              },
              {
                "fieldType": "textarea",
                "fieldLabel": "Title of Event",
                "requiredField": true
              },
              {
                "fieldType": "textarea",
                "fieldLabel": "Location of Event",
                "requiredField": true
              },
              {
                "fieldType": "textarea",
                "fieldLabel": "Date of Event",
                "requiredField": true
              },
              {
                "fieldType": "textarea",
                "fieldLabel": "Image Prompt",
                "requiredField": true
              }
            ]
          },
          "formDescription": "Generate an image and apply text"
        },
        "typeVersion": 2
      },
      {
        "id": "dea26687-4060-488b-a09f-e21900fec2fc",
        "name": "Upload to Cloudinary",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1920,
          480
        ],
        "parameters": {
          "url": "https://api.cloudinary.com/v1_1/daglih2g8/image/upload",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "sendQuery": true,
          "contentType": "multipart-form-data",
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "file",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "data"
              }
            ]
          },
          "genericAuthType": "httpQueryAuth",
          "queryParameters": {
            "parameters": [
              {
                "name": "upload_preset",
                "value": "n8n-workflows-preset"
              }
            ]
          }
        },
        "credentials": {
          "httpQueryAuth": {
            "id": "sT9jeKzZiLJ3bVPz",
            "name": "Cloudinary API"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "4b73ba35-eac9-467b-b711-49061da30fbc",
        "name": "Send to Bannerbear Template",
        "type": "n8n-nodes-base.bannerbear",
        "position": [
          2260,
          440
        ],
        "parameters": {
          "templateId": "={{ $('Set Parameters').item.json.template_id }}",
          "modificationsUi": {
            "modificationsValues": [
              {
                "name": "placeholder_image",
                "text": "=",
                "imageUrl": "={{ $json.secure_url.replace('upload/','upload/f_auto,q_auto/') }}"
              },
              {
                "name": "placeholder_text",
                "text": "={{ $('Set Parameters').item.json.title }}"
              },
              {
                "name": "placeholder_location",
                "text": "={{ $('Set Parameters').item.json.location }}"
              },
              {
                "name": "placeholder_date",
                "text": "={{ $('Set Parameters').item.json.date }}"
              }
            ]
          },
          "additionalFields": {
            "waitForImage": true,
            "waitForImageMaxTries": 10
          }
        },
        "credentials": {
          "bannerbearApi": {
            "id": "jXg71GVWN3F4PvI8",
            "name": "Bannerbear account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "d9b8f63b-ee0f-40d6-9b1a-8213c7043b3a",
        "name": "Set Parameters",
        "type": "n8n-nodes-base.set",
        "position": [
          1452,
          455
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8c526649-b8a8-4b9f-a805-41de053bb642",
                "name": "template_id",
                "type": "string",
                "value": "={{ {\n'AI Meetup Template': 'lzw71BD6VNLgD0eYkn',\n'n8n Meetup Template': 'n1MJGd52o696D7LaPV'\n}[$json.Template] ?? '' }}"
              },
              {
                "id": "f5a3c285-719b-4a12-a669-47a63a880ac4",
                "name": "title",
                "type": "string",
                "value": "={{ $json[\"Title of Event\"] }}"
              },
              {
                "id": "6713a88e-815c-416a-b838-b07006a090a3",
                "name": "location",
                "type": "string",
                "value": "={{ $json[\"Location of Event\"] }}"
              },
              {
                "id": "3c331756-1f1f-4e27-b769-e3de860bfdf0",
                "name": "date",
                "type": "string",
                "value": "={{ $json[\"Date of Event\"] }}"
              },
              {
                "id": "b933df30-8067-4a0a-bff1-64441490478d",
                "name": "image_prompt",
                "type": "string",
                "value": "={{ $json[\"Image Prompt\"] }}"
              }
            ]
          }
        },
        "typeVersion": 3.3
      },
      {
        "id": "3290571f-e858-4b73-b27d-7077d4efad15",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1220,
          280
        ],
        "parameters": {
          "color": 7,
          "width": 392.4891967891814,
          "height": 357.1079372601395,
          "content": "## 1. Start with n8n Forms\n[Read more about using forms](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.formtrigger/)\n\nFor this demo, we'll use the form trigger for simple data capture but you could use webhooks for better customisation and/or integration into other workflows."
        },
        "typeVersion": 1
      },
      {
        "id": "560a6c43-07bd-4a5c-8af7-0cda78f345d4",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1640,
          215.68990043281633
        ],
        "parameters": {
          "color": 7,
          "width": 456.99271465116215,
          "height": 475.77059293291677,
          "content": "## 2. Use AI to Generate an Image\n[Read more about using OpenAI](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-langchain.openai)\n\nGenerating AI images is just as easy as generating text thanks for n8n's OpenAI node. Once completed, OpenAI will return a binary image file. We'll have to store this image externally however since we can't upload it directly BannerBear. I've chosen to use Cloudinary CDN but S3 is also a good choice."
        },
        "typeVersion": 1
      },
      {
        "id": "0ffe2ada-9cb6-4d4c-9d15-df83d5a596ce",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2120,
          168.04517481270597
        ],
        "parameters": {
          "color": 7,
          "width": 387.4250119152741,
          "height": 467.21699325771294,
          "content": "## 3. Create Social Media Banners with BannerBear.com\n[Read more about the BannerBear Node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.bannerbear)\n\nNow with your generated AI image and template variables, we're ready to send them to BannerBear which will use a predefined template to create our social media banner.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "e8269a57-caab-40c6-bf47-95b64eccde81",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2540,
          299.6729638445606
        ],
        "parameters": {
          "color": 7,
          "width": 404.9582850950252,
          "height": 356.8876009810222,
          "content": "## 4. Post directly to Social Media\n[Read more about using the Discord Node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.discord)\n\nWe'll share our event banner with our community in Discord. You can also choose to post this on your favourite social media channels."
        },
        "typeVersion": 1
      },
      {
        "id": "457a0744-4c08-4489-af50-5a746fa4b756",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2120,
          40
        ],
        "parameters": {
          "color": 5,
          "width": 388.96199194175017,
          "height": 122.12691731521146,
          "content": "### üôã‚Äç‚ôÇÔ∏è Optimise your images!\nAI generated images can get quite large (20mb+) which may hit filesize limits for some services. I've used Cloudinary's optimise API to reduce the file size before sending to BannerBear."
        },
        "typeVersion": 1
      },
      {
        "id": "c38cc2c6-a595-48c8-a5be-668fd609c76b",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2960,
          220
        ],
        "parameters": {
          "color": 5,
          "width": 391.9308945140308,
          "height": 288.0739771936459,
          "content": "### Result!\nHere is a screenshot of the generated banner.\n![Result](https://res.cloudinary.com/daglih2g8/image/upload/f_auto,q_auto,w_360/v1/n8n-workflows/qlzyrjjhxeh3zgerglti)"
        },
        "typeVersion": 1
      },
      {
        "id": "29ce299d-3444-4e71-b83c-edbe867e833f",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          800,
          240
        ],
        "parameters": {
          "width": 392.9673182916798,
          "height": 404.96428251481916,
          "content": "## Try It Out!\n### This workflow does the following:\n* Uses an n8n form to capture an event to be announced.\n* Form includes imagery required for the event and this is sent to OpenAI Dalle-3 service to generate.\n* Event details as well as the ai-generated image is then sent to the BannerBear.com service where a template is used.\n* The final event poster is created and posted to X (formerly Twitter)\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!"
        },
        "typeVersion": 1
      },
      {
        "id": "c01d1ac0-5ebe-4ef1-bece-d6ad8bbff94e",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2200,
          400
        ],
        "parameters": {
          "width": 221.3032167915293,
          "height": 368.5789698912447,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nüö®**Required**\n* You'll need to create a template in BannerBear.\n* Once you have, map the template variables to fields in this node!"
        },
        "typeVersion": 1
      },
      {
        "id": "c929d9c4-1e18-4806-9fc6-fb3bf0fa75ad",
        "name": "Download Banner",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2600,
          480
        ],
        "parameters": {
          "url": "={{ $json.image_url_jpg }}",
          "options": {}
        },
        "typeVersion": 4.2
      },
      {
        "id": "79d19004-7d82-42be-89d5-dcb3af5e3fb1",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1857.0197380966872,
          440
        ],
        "parameters": {
          "width": 224.2834786948422,
          "height": 368.5789698912447,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nüö®**Required**\n* You'll need to change all ids and references to your own Cloudinary instance.\n* Feel free to change this to another service!"
        },
        "typeVersion": 1
      },
      {
        "id": "18ccd15f-65b6-46eb-8235-7fe19b13649d",
        "name": "Discord",
        "type": "n8n-nodes-base.discord",
        "position": [
          2780,
          480
        ],
        "parameters": {
          "files": {
            "values": [
              {}
            ]
          },
          "content": "=üìÖ New Event Alert!  {{ $('Set Parameters').item.json.title }} being held at  {{ $('Set Parameters').item.json.location }} on the  {{ $('Set Parameters').item.json.date }}! Don't miss it!",
          "guildId": {
            "__rl": true,
            "mode": "list",
            "value": "1248678443432808509",
            "cachedResultUrl": "https://discord.com/channels/1248678443432808509",
            "cachedResultName": "Datamoldxyz"
          },
          "options": {},
          "resource": "message",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "1248678443432808512",
            "cachedResultUrl": "https://discord.com/channels/1248678443432808509/1248678443432808512",
            "cachedResultName": "general"
          }
        },
        "credentials": {
          "discordBotApi": {
            "id": "YUwD52E3oHsSUWdW",
            "name": "Discord Bot account"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "7122fac9-4b4d-4fcf-a188-21af025a7fa8",
        "name": "Generate AI Banner Image",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1700,
          480
        ],
        "parameters": {
          "prompt": "={{ $json.image_prompt }}",
          "options": {
            "size": "1024x1024",
            "quality": "standard"
          },
          "resource": "image"
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.3
      }
    ],
    "pinData": {},
    "connections": {
      "Set Parameters": {
        "main": [
          [
            {
              "node": "Generate AI Banner Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Banner": {
        "main": [
          [
            {
              "node": "Discord",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "n8n Form Trigger": {
        "main": [
          [
            {
              "node": "Set Parameters",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload to Cloudinary": {
        "main": [
          [
            {
              "node": "Send to Bannerbear Template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate AI Banner Image": {
        "main": [
          [
            {
              "node": "Upload to Cloudinary",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send to Bannerbear Template": {
        "main": [
          [
            {
              "node": "Download Banner",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "db80165df40cb07c0377167c050b3f9ab0b0fb04f0e8cae0dc53f5a8527103ca",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "e27afbc7-8cae-44b6-b506-474bb2692f08",
        "name": "Wait",
        "type": "n8n-nodes-base.wait",
        "position": [
          -640,
          -300
        ],
        "webhookId": "cf27222d-20db-4ba5-bd4c-e6ca05efd4d7",
        "parameters": {
          "amount": 20
        },
        "typeVersion": 1.1
      },
      {
        "id": "2cc8d35f-f255-4adc-b1d7-7f9ab34dde66",
        "name": "Get progress",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -1020,
          -400
        ],
        "parameters": {
          "url": "=https://api.brightdata.com/datasets/v3/progress/{{ $json.snapshot_id }}",
          "options": {},
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer YOUR_TOKEN_HERE"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "eb6ab86c-3e8b-4dc6-8d70-3346531905fa",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "position": [
          -840,
          -400
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "ready",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "4712e222-2bad-4d91-be87-ab0e0693c0c6",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "ready"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "running",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "9a473960-6ba5-4f1b-afc6-396348bd338d",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "=running"
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "88b7e912-af0c-4527-baa3-4f8cf0b072d1",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -1660,
          -400
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "json"
        },
        "typeVersion": 1
      },
      {
        "id": "d0ee4823-0536-415e-8fa9-861c1701665d",
        "name": "SAMPLE DATA",
        "type": "n8n-nodes-base.set",
        "position": [
          -1860,
          -400
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8d1bd0c8-37bf-4028-a20c-ac214ec06d7b",
                "name": "json",
                "type": "array",
                "value": "=[\n  {\n    \"ticker\": \"NVDA\",\n    \"name\": \"NVIDIA Corporation\",\n    \"market_cap\": \"‚âà $3.6T\"\n  },\n  {\n    \"ticker\": \"MSFT\",\n    \"name\": \"Microsoft Corporation\",\n    \"market_cap\": \"‚âà $3.6T\"\n  },\n  {\n    \"ticker\": \"AAPL\",\n    \"name\": \"Apple Inc.\",\n    \"market_cap\": \"‚âà $3.0T\"\n  },\n  {\n    \"ticker\": \"AMZN\",\n    \"name\": \"Amazon.com Inc.\",\n    \"market_cap\": \"‚âà $2.2T\"\n  },\n  {\n    \"ticker\": \"GOOGL\",\n    \"name\": \"Alphabet Inc.\",\n    \"market_cap\": \"‚âà $1.9T\"\n  },\n  {\n    \"ticker\": \"META\",\n    \"name\": \"Meta Platforms Inc.\",\n    \"market_cap\": \"‚âà $1.5T\"\n  },\n  {\n    \"ticker\": \"BRK.B\",\n    \"name\": \"Berkshire Hathaway Inc.\",\n    \"market_cap\": \"‚âà $1.1T\"\n  },\n  {\n    \"ticker\": \"TSLA\",\n    \"name\": \"Tesla Inc.\",\n    \"market_cap\": \"‚âà $830B\"\n  },\n  {\n    \"ticker\": \"UNH\",\n    \"name\": \"UnitedHealth Group Inc.\",\n    \"market_cap\": \"‚âà $450B\"\n  },\n  {\n    \"ticker\": \"JNJ\",\n    \"name\": \"Johnson & Johnson\",\n    \"market_cap\": \"‚âà $450B\"\n  }\n]\n"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "2aab292f-0287-4da6-86ee-83c5a9aee30a",
        "name": "set keyword",
        "type": "n8n-nodes-base.set",
        "position": [
          -1480,
          -400
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8d9e80d9-16dd-4658-928f-d94735209bfd",
                "name": "keyword",
                "type": "string",
                "value": "={{ $json.ticker }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "13f81727-f586-4fb6-be73-4880c9efd165",
        "name": "Financial times scraper",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -1260,
          -400
        ],
        "parameters": {
          "url": "https://api.brightdata.com/datasets/v3/trigger",
          "method": "POST",
          "options": {},
          "jsonBody": "={{ $('set keyword').all().map(item => item.json)}}",
          "sendBody": true,
          "sendQuery": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "queryParameters": {
            "parameters": [
              {
                "name": "dataset_id",
                "value": "gd_lmrpz3vxmz972ghd7"
              },
              {
                "name": "include_errors",
                "value": "true"
              },
              {
                "name": "type",
                "value": "discover_new"
              },
              {
                "name": "discover_by",
                "value": "keyword"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer YOUR_TOKEN_HERE"
              }
            ]
          }
        },
        "executeOnce": true,
        "typeVersion": 4.2
      },
      {
        "id": "5e828381-8268-4114-b16c-a60c4ca23e80",
        "name": "Get snapshot + data",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -620,
          -480
        ],
        "parameters": {
          "url": "=https://api.brightdata.com/datasets/v3/snapshot/{{ $json.snapshot_id }}",
          "options": {},
          "sendQuery": true,
          "sendHeaders": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "format",
                "value": "json"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer YOUR_TOKEN_HERE"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "4c2826ee-30bb-4438-a531-c370edbe2103",
        "name": "Aggregate",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          -300,
          -280
        ],
        "parameters": {
          "options": {},
          "aggregate": "aggregateAllItemData"
        },
        "typeVersion": 1
      },
      {
        "id": "9cd0f2fd-248b-4047-aeb3-1a548ad02514",
        "name": "Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -320,
          -620
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [],
            "mappingMode": "autoMapInputData",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1I5CvpHlmDsIFOfnGg4DEtniem0oTiumWWzGs4CV6AuM/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1I5CvpHlmDsIFOfnGg4DEtniem0oTiumWWzGs4CV6AuM",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1I5CvpHlmDsIFOfnGg4DEtniem0oTiumWWzGs4CV6AuM/edit?usp=drivesdk",
            "cachedResultName": "Stock Monitor"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "ZAI2a6Qt80kX5a9s",
            "name": "Google Sheets account‚úÖ "
          }
        },
        "typeVersion": 4.6
      },
      {
        "id": "d9797a77-bdf3-4600-bcd7-21311bb405fd",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          0,
          -260
        ],
        "parameters": {
          "options": {},
          "modelName": "models/gemini-2.0-flash-lite"
        },
        "credentials": {
          "googlePalmApi": {
            "id": "Xp5T9q3YYxBIw2nd",
            "name": "Google Gemini(PaLM) Api account‚úÖ"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "ef5165a4-0452-4b20-b2fa-994429f3bc5b",
        "name": "create summary",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          0,
          -480
        ],
        "parameters": {
          "text": "=\n\n## üì§ SYSTEM PROMPT: Daily Stock Summary Email Generator (for n8n AI Agent)\n\n````markdown\n## üéØ ROLE\nYou are a financial summary agent integrated in an n8n workflow. Your role is to:\n- Analyze incoming JSON data of top 10 U.S. stocks.\n- Identify meaningful insights: trends, outliers, sentiment, sector behavior.\n- Format this into a **clear, styled HTML email body** for professional users.\n- Return the **HTML content only** ‚Äì ready to send via n8n‚Äôs email nodes.\n\n---\n\n## üì• INPUT FORMAT (JSON)\n\nYou will receive daily JSON input structured like this:\n\n\nThe day and date today is {{ $now.format('cccc yyyy-MM-dd t ') }}\n\nHere is today‚Äôs data: =\n\n```\n\n{{ $json.data.toJsonString() }}\n\n```\n\n---\n\n## ‚úÖ TASKS\n\n1. **Analyze market trends** based on price movements and sentiment.\n2. **Highlight top 2 gainers and losers**, including reasoning from news or change %.\n3. **Generate a stock table** (Ticker, Name, Price Change, Sentiment Icon).\n4. **Include 3‚Äì5 key takeaways**, insights, or investor watch notes.\n5. **Add upcoming events** if mentioned in news or based on date.\n6. Format everything as **HTML only**, ready for use in an email body.\n\n---\n\n## ‚ú® OUTPUT FORMAT (HTML Only)\n\n* Include inline styles (no external CSS).\n* Use semantic structure:\n\n  * `<h2>` for main title\n  * `<ul>` for movers and insights\n  * `<table>` for stock data\n* Use icons or colors for sentiment: üü¢ Positive, üü° Neutral, üî¥ Negative\n* Footer: ‚ÄúGenerated automatically by your AI-powered stock monitor‚Äù\n\n---\n\n## ‚ö†Ô∏è CONSTRAINTS\n\n* DO NOT include subject or email headers\n* DO NOT output plaintext explanations or markdown\n* Output **HTML only**, clean and professional\n\n---\n\n## üì¨ GOAL\n\nDeliver a polished, mobile-friendly, and insightful daily stock market summary email that can be sent directly by n8n. Final output should require zero manual edits.\n\n",
          "options": {},
          "promptType": "define"
        },
        "typeVersion": 2
      },
      {
        "id": "cf744498-62bf-4e6a-8570-dda7fea35fe5",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -2140,
          -400
        ],
        "parameters": {
          "rule": {
            "interval": [
              {}
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "d564ee93-181f-461b-8ace-2dcb26439b6c",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1940,
          -600
        ],
        "parameters": {
          "color": 5,
          "width": 220,
          "height": 420,
          "content": "## Add stock to track\n\nYou will add a list of the stocks you need to track here"
        },
        "typeVersion": 1
      },
      {
        "id": "0c7e5d90-ce9e-456c-9f48-ba6872557467",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1680,
          -600
        ],
        "parameters": {
          "color": 4,
          "width": 340,
          "height": 420,
          "content": "## Split and set the field names\nThe field name MUST be keyword to match the bright data API"
        },
        "typeVersion": 1
      },
      {
        "id": "64d932ee-f0b1-458a-a017-505676666c18",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1320,
          -600
        ],
        "parameters": {
          "color": 2,
          "height": 420,
          "content": "## Financial Times scraper\nScrap the latest trends in our selected Stock. \n\nSet it to run once"
        },
        "typeVersion": 1
      },
      {
        "id": "bb55cc08-f262-42c1-9951-00771689495a",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1040,
          -680
        ],
        "parameters": {
          "color": 4,
          "width": 620,
          "height": 520,
          "content": "## Check the status of the progress and Get results\n\nIf `running` we make it loop until done"
        },
        "typeVersion": 1
      },
      {
        "id": "9bc67859-d0b7-4d48-84d3-d0b9c90e8ca5",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -700,
          -560
        ],
        "parameters": {
          "color": 7,
          "width": 260,
          "height": 260,
          "content": "## Get scraping results"
        },
        "typeVersion": 1
      },
      {
        "id": "9627ec91-d2c4-4076-b39f-9f8be978177b",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -380,
          -420
        ],
        "parameters": {
          "width": 280,
          "height": 280,
          "content": "## Aggregate results to pass to AI for our email summary"
        },
        "typeVersion": 1
      },
      {
        "id": "e01b8ad5-e028-4c81-9162-b27ae75687a3",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -60,
          -720
        ],
        "parameters": {
          "color": 3,
          "width": 520,
          "height": 600,
          "content": "## Create Draft email and notify admin\n\n\n\nCreate an email summary and notify the user"
        },
        "typeVersion": 1
      },
      {
        "id": "8a23ca78-36e5-4ce3-b81d-fa62d770aa36",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -380,
          -680
        ],
        "parameters": {
          "color": 6,
          "width": 280,
          "height": 240,
          "content": "## Save results to G sheets"
        },
        "typeVersion": 1
      },
      {
        "id": "3f953ffd-4faa-4cd5-bd3a-b3a6d021eebf",
        "name": "Gmail1",
        "type": "n8n-nodes-base.gmailTool",
        "position": [
          180,
          -260
        ],
        "webhookId": "fe4a416a-43f3-4ad1-80c8-51f1de4c2343",
        "parameters": {
          "sendTo": "kimothozacharia5@gmail.com",
          "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', `A detailed summary of the stock performance today. Must Look good`, 'string') }}",
          "options": {
            "appendAttribution": false
          },
          "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', `Daily Stock report for {date today}`, 'string') }}"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "8PS0qVYNzZvoWNA7",
            "name": "phoenix‚úÖ"
          }
        },
        "typeVersion": 2.1
      }
    ],
    "pinData": {
      "Financial times scraper": [
        {
          "snapshot_id": "s_mcbvdqgz1avn39assa"
        },
        {
          "snapshot_id": "s_mcbvdqht249242mqlq"
        },
        {
          "snapshot_id": "s_mcbvdqg4px7h201w9"
        },
        {
          "snapshot_id": "s_mcbvdqh4ci8ij15d1"
        },
        {
          "snapshot_id": "s_mcbvdqgs12legdw0a2"
        },
        {
          "snapshot_id": "s_mcbvdqhpqyr6tf8q"
        },
        {
          "snapshot_id": "s_mcbvdqgu1ti5q0ginr"
        },
        {
          "snapshot_id": "s_mcbvdqi21uyjc3tefw"
        },
        {
          "snapshot_id": "s_mcbvdqgzp73zxysyr"
        },
        {
          "snapshot_id": "s_mcbvdqgi2f3l95krzm"
        }
      ]
    },
    "connections": {
      "Wait": {
        "main": [
          [
            {
              "node": "Get progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail1": {
        "ai_tool": [
          [
            {
              "node": "create summary",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Get snapshot + data",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "create summary",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "set keyword",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SAMPLE DATA": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "set keyword": {
        "main": [
          [
            {
              "node": "Financial times scraper",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get progress": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          []
        ]
      },
      "create summary": {
        "main": [
          []
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "SAMPLE DATA",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get snapshot + data": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Financial times scraper": {
        "main": [
          [
            {
              "node": "Get progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "create summary",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "g25bM3Hj71T3ZVVe",
    "meta": {
      "instanceId": "21754f977ce20b07e6fe64be3fbc663f6e6f730423d6e46c6cd2bf5b5e70a383"
    },
    "name": "Streamline data from an n8n form into Google Sheet and Airtable",
    "tags": [],
    "nodes": [
      {
        "id": "32bd3bcb-7de7-4ca3-ba31-897e90f663b1",
        "name": "n8n Form Trigger",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          720,
          -400
        ],
        "webhookId": "c07c8eb6-cf56-4941-91cc-e3cb31c90b5c",
        "parameters": {
          "path": "c07c8eb6-cf56-4941-91cc-e3cb31c90b5c",
          "options": {},
          "formTitle": "Data Colleacation",
          "formFields": {
            "values": [
              {
                "fieldLabel": "What's your name ?",
                "requiredField": true
              },
              {
                "fieldLabel": "Where do you live ?",
                "requiredField": true
              },
              {
                "fieldLabel": "Your Email ?",
                "requiredField": true
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "bf341165-2698-4f42-a92d-bc5e9a750bf1",
        "name": "Extracting Date and Time Fields from 'submittedAt' Field",
        "type": "n8n-nodes-base.code",
        "position": [
          920,
          -400
        ],
        "parameters": {
          "jsCode": "// Loop over input items and separate date and time into two new fields\nfor (const item of $input.all()) {\n  // Extract date and time from 'submittedAt' field\n  const submittedAt = new Date(item.json['submittedAt']);\n  const date = submittedAt.toISOString().split('T')[0]; // Get date part\n  const time = submittedAt.toISOString().split('T')[1].split('.')[0]; // Get time part\n\n  // Remove the old 'submittedAt' field\n  delete item.json['submittedAt'];\n\n  // Add new 'Date' and 'Time' fields with respective values\n  item.json['Date'] = date;\n  item.json['Time'] = time;\n}\n\nreturn $input.all();\n"
        },
        "typeVersion": 2
      },
      {
        "id": "c9955ba1-0aa4-476b-b2ac-8a458b1547b3",
        "name": "Format the Fields",
        "type": "n8n-nodes-base.set",
        "position": [
          1100,
          -400
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "Name",
                "stringValue": "={{ $json['What\\'s your name ?'] }}"
              },
              {
                "name": "City",
                "stringValue": "={{ $json['Where do you live ?'] }}"
              },
              {
                "name": "Date",
                "stringValue": "={{ $json.Date }}"
              },
              {
                "name": "Time",
                "stringValue": "={{ $json.Time }}"
              },
              {
                "name": "Email",
                "stringValue": "={{ $json['Your Email ?'] }}"
              }
            ]
          },
          "include": "selected",
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "50e6057e-4b26-40f6-adc1-1721818f7a46",
        "name": "Airtable",
        "type": "n8n-nodes-base.airtable",
        "position": [
          1320,
          -260
        ],
        "parameters": {
          "base": {
            "__rl": true,
            "mode": "id",
            "value": "appIIeJ18fnPkNyNS"
          },
          "table": {
            "__rl": true,
            "mode": "id",
            "value": "tblZvKuOMmtHnv5TH"
          },
          "columns": {
            "value": {
              "City": "={{ $json.City }}",
              "Date": "={{ $json.Date }}",
              "Name": "={{ $json.Name }}",
              "Time": "={{ $json.Time }}",
              "Email": "={{ $json.Email }}"
            },
            "schema": [
              {
                "id": "Name",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "Name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "City",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "City",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Email",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "Email",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Date",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "Date",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Time",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "Time",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": []
          },
          "options": {},
          "operation": "create"
        },
        "credentials": {
          "airtableTokenApi": {
            "id": "maZEeRzOyC8Q06Zf",
            "name": "Airtable Personal Access Token account"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "4f561bd8-a5dd-4ff2-9d3e-cdac6f762bd4",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          100,
          -680
        ],
        "parameters": {
          "color": 5,
          "width": 2256.3366317584496,
          "height": 851.9587677224575,
          "content": "### Workflow Description:\n\n1. **n8n Form Trigger:**\n   - A trigger node that initiates the workflow when a form is submitted.\n   - Form fields include Name, City, and Email.\n\n2. **Extracting Date and Time Fields from 'submittedAt' Field:**\n   - A code node that extracts Date and Time from the submittedAt field.\n\n3. **Format the Fields:**\n   - Sets the format for the extracted fields (Name, City, Date, Time, Email).\n\n4. **Airtable:**\n   - Creates a new record in Airtable with the formatted data.\n   - Includes columns for Name, City, Email, Time, and Date.\n\n5. **Google Sheets:**\n   - Appends the formatted data to a Google Sheet.\n   - Includes columns for Name, City, Email, Date, and Time.\n\n6. **Gmail:**\n   - Sends an email to the provided Email address.\n   - Subject: \"Testing Text Message Delivery\"\n   - Message: Customized message with Name placeholder.\n\n7. **Gmail1:**\n   - Sends another email using a different template.\n   - Subject includes the Date field.\n   - Similar message content with a different subject line.\n\n### Workflow Connections:\n- n8n Form Trigger -> Extracting Date and Time Fields -> Format the Fields -> Google Sheets & Airtable -> Gmail\n- Google Sheets -> Gmail1\n\nThis workflow collects data from a form submission, processes it to extract Date and Time fields, saves the formatted data to Google Sheets and Airtable, and sends customized emails to the submitter.\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "a0d53cb5-27c8-4dfb-a1ea-e2403bde1fc4",
        "name": "Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1320,
          -540
        ],
        "parameters": {
          "columns": {
            "value": {
              "City": "={{ $json.City }}",
              "Date": "={{ $json.Date }}",
              "Name": "={{ $json.Name }}",
              "Time": "={{ $json.Time }}",
              "Email": "={{ $json.Email }}"
            },
            "schema": [
              {
                "id": "Name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "City",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "City",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Email",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Email",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Date",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Date",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Time",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Time",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": []
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Ss6AEwaXpAl54YQAQDf1z6SRyh6pj719-A9eOzf2Dv4/edit#gid=0",
            "cachedResultName": "Page"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1Ss6AEwaXpAl54YQAQDf1z6SRyh6pj719-A9eOzf2Dv4",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Ss6AEwaXpAl54YQAQDf1z6SRyh6pj719-A9eOzf2Dv4/edit?usp=drivesdk",
            "cachedResultName": "Streamline data from an n8n form into Google Sheet and Airtable"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "L5CnisK8R3BgVGcO",
            "name": "Omar sheet"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "de697574-f547-4374-86d9-c6d9f709c404",
        "name": "Gmail",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1560,
          -260
        ],
        "parameters": {
          "sendTo": "={{ $json.fields.Email }}",
          "message": "=Dear {{ $json.fields.Name }} ..\n\nHey there! Just testing to see if this message goes through. Let me know if you receive it. \n\nThanks! \nSupport Team",
          "options": {},
          "subject": "Testing Text Message Delivery",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "UJx4Tiq8WRtxWEIP",
            "name": "Gmail Omar"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "66677b7e-d053-4050-a65c-9c9f8f689646",
        "name": "Gmail1",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1560,
          -540
        ],
        "parameters": {
          "sendTo": "={{ $json.Email }}",
          "message": "=Dear {{ $json.Name }} ..\n\nHey there! Just testing to see if this message goes through. Let me know if you receive it. \n\nThanks! \nSupport Team  ",
          "options": {},
          "subject": "=Testing Text Message Delivery , ( {{ $json.Date }} ) ",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "UJx4Tiq8WRtxWEIP",
            "name": "Gmail Omar"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "e440b4cb-6910-4bc7-b3df-7c14dd9c43a9",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1820,
          -640
        ],
        "parameters": {
          "width": 510.8381838182147,
          "height": 206.48715095387286,
          "content": "### Links to Node Documentation:\n1. [n8n Form Trigger Documentation](https://docs.n8n.io/nodes/n8n-nodes-base.formTrigger)\n2. [Code Node Documentation](https://docs.n8n.io/nodes/n8n-nodes-base.code)\n3. [Set Node Documentation](https://docs.n8n.io/nodes/n8n-nodes-base.set)\n4. [Airtable Node Documentation](https://docs.n8n.io/nodes/n8n-nodes-base.airtable)\n5. [Google Sheets Node Documentation](https://docs.n8n.io/nodes/n8n-nodes-base.googleSheets)\n6. [Gmail Node Documentation](https://docs.n8n.io/nodes/n8n-nodes-base.gmail)\n"
        },
        "typeVersion": 1
      },
      {
        "id": "541ecd4c-22bc-4bc9-8364-ca73b4650092",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          680,
          -640
        ],
        "parameters": {
          "width": 1105.0652438372836,
          "height": 630.9350509674927,
          "content": ""
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "de903de6-c793-4a64-9d3c-0ade08d6994e",
    "connections": {
      "Airtable": {
        "main": [
          [
            {
              "node": "Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          [
            {
              "node": "Gmail1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "n8n Form Trigger": {
        "main": [
          [
            {
              "node": "Extracting Date and Time Fields from 'submittedAt' Field",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format the Fields": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Airtable",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extracting Date and Time Fields from 'submittedAt' Field": {
        "main": [
          [
            {
              "node": "Format the Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "2DT5BW5tOdy87AUl",
    "meta": {
      "instanceId": "8418cffce8d48086ec0a73fd90aca708aa07591f2fefa6034d87fe12a09de26e"
    },
    "name": "Streamline Your Zoom Meetings with Secure, Automated Stripe Payments",
    "tags": [],
    "nodes": [
      {
        "id": "fcc38ae8-0dbf-4676-b47b-ba77f97a38b8",
        "name": "Create Zoom meeting",
        "type": "n8n-nodes-base.zoom",
        "position": [
          180,
          480
        ],
        "parameters": {
          "topic": "={{ $('Creation Form').item.json.title }}",
          "authentication": "oAuth2",
          "additionalFields": {
            "password": "={{ Math.random().toString(36).slice(-4); }}",
            "startTime": "={{ new Date(new Date($('Creation Form').item.json.date_start).getTime() + ($('Creation Form').item.json.hour * 3600000) + ($('Creation Form').item.json.minute * 60000)).toISOString() }}"
          }
        },
        "credentials": {
          "zoomOAuth2Api": {
            "id": "JQ9fG5WNTVssHxGj",
            "name": "Zoom account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "3d2dea09-c463-447b-9a9d-daca8fdcac06",
        "name": "Create Stripe Product",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          480
        ],
        "parameters": {
          "url": "https://api.stripe.com/v1/products",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "form-urlencoded",
          "authentication": "predefinedCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "name",
                "value": "={{ $('Creation Form').item.json.title }}"
              },
              {
                "name": "default_price_data[unit_amount]",
                "value": "={{ $('Creation Form').item.json.price * 100 }}"
              },
              {
                "name": "default_price_data[currency]",
                "value": "={{ $('Config').item.json.currency }}"
              }
            ]
          },
          "nodeCredentialType": "stripeApi"
        },
        "credentials": {
          "stripeApi": {
            "id": "qjose8z3RR7Xzm7b",
            "name": "Stripe Dev"
          }
        },
        "typeVersion": 4.1
      },
      {
        "id": "01ab74fb-19a1-42ef-a0ad-31107c7ded3f",
        "name": "Config",
        "type": "n8n-nodes-base.set",
        "notes": "Setup your flow",
        "position": [
          -220,
          640
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "038b54b7-9559-444e-8653-c5256a5b784e",
                "name": "currency",
                "type": "string",
                "value": "EUR"
              },
              {
                "id": "64d1eeee-cabe-403b-a634-f3238f586f58",
                "name": "sheet_url",
                "type": "string",
                "value": "https://docs.google.com/spreadsheets/d/1ZliqqBNo6X0iM9yXBOiCG1e4Q7L7bQKMFmjvbSgUSnA/edit#gid=0"
              },
              {
                "id": "997fe5a1-f601-458d-899c-673dff4acb04",
                "name": "teacher_email",
                "type": "string",
                "value": "emm.bernard@gmail.com"
              }
            ]
          }
        },
        "notesInFlow": true,
        "typeVersion": 3.3
      },
      {
        "id": "2aa87b96-924b-472c-8cc6-2de028ce0195",
        "name": "Send email to teacher",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1040,
          480
        ],
        "parameters": {
          "sendTo": "={{ $('Config').item.json.teacher_email }}",
          "message": "=<b>Congratulations, your event has been succesfully created üéâ</b><br/><br/>\n\nTitle: {{ $('Creation Form').item.json.title }}<br/>\nPrice:  {{ $('Creation Form').item.json.price }} {{ $('Config').item.json.currency }}<br/>\nStart date: {{ $('Creation Form').item.json.date_start }}<br/><br/>\n\n<b>Payment link:</b><br/>\n {{ $('Create payment link').item.json.url }}<br/>\n<i>Start sharing this link to get subscriptions</i><br/><br/>\n<b>Participant list:</b><br/>\n{{ $('Config').item.json.sheet_url }}#gid={{ $('Create Stripe Product').item.json.created }}\n<br/><br/>\n<b>Zoom infos:</b><br/>\nLink: {{ $('Create Zoom meeting').item.json.join_url }}<br/>\nSession ID: {{ $('Create Zoom meeting').item.json.id }}<br/>\nPassword: {{ $('Create Zoom meeting').item.json.password }}<br/> ",
          "options": {},
          "subject": "=üéâ {{ $('Creation Form').item.json.title }} has been created!"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "DMcPDN0IHPwGmI7f",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "40f66f09-19c9-40eb-a9c4-138464ccd371",
        "name": "Create participant list",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          840,
          480
        ],
        "parameters": {
          "title": "={{ $('Creation Form').item.json.date_start }} - {{ $('Creation Form').item.json.title }} - {{ $('Create Stripe Product').item.json.created }}",
          "options": {
            "index": 0,
            "sheetId": "={{ $('Create Stripe Product').item.json.created }}"
          },
          "operation": "create",
          "documentId": {
            "__rl": true,
            "mode": "url",
            "value": "={{ $('Config').item.json.sheet_url }}"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RICzFHixgHXMuKmg",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.3,
        "alwaysOutputData": true
      },
      {
        "id": "67ff21d2-57b8-4ccd-91ee-a1bff1ea23b2",
        "name": "Add participant to list",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          400,
          800
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [
              {
                "id": "city",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "city",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "email",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "email",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "name",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "country",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "country",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "postal_code",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "postal_code",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "amount",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "amount",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "currency",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "currency",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "autoMapInputData",
            "matchingColumns": []
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $('On payment').item.json.data.object.metadata.event_sheet_id }}"
          },
          "documentId": {
            "__rl": true,
            "mode": "url",
            "value": "={{ $('Config').item.json.sheet_url }}"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RICzFHixgHXMuKmg",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.3
      },
      {
        "id": "67e317ba-77d5-4f77-8fe2-d38e1a68c6f1",
        "name": "Send confirmation to participant",
        "type": "n8n-nodes-base.gmail",
        "position": [
          620,
          800
        ],
        "parameters": {
          "sendTo": "={{ $('On payment').item.json.data.object.customer_details.email }}",
          "message": "=Dear {{ $('On payment').item.json.data.object.customer_details.name }},<br/><br/>\n\nWe are very happy to announce that your subscription to our event <b>{{ $json.title }}</b> starting on <b>{{ $json.start }}</b> is now confirmed.<br/><br/>\n\nHere are the infos you will need to participate:<br/> \nZoom link:  {{ $('On payment').item.json.data.object.metadata.zoom_link }}<br/>\nZoom password:{{ $('On payment').item.json.data.object.metadata.zoom_password }}<br/>\nZoom ID: {{ $('On payment').item.json.data.object.metadata.zoom_id }}<br/><br/> \n\nLooking forward to see you there!<br/>\nKind regards<br/>",
          "options": {
            "appendAttribution": false
          },
          "subject": "Than you for your subscription üôè"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "DMcPDN0IHPwGmI7f",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "ac5ca5f3-f9ca-494f-8e78-33dd663111ab",
        "name": "Notify teacher",
        "type": "n8n-nodes-base.gmail",
        "position": [
          840,
          800
        ],
        "parameters": {
          "sendTo": "={{ $('Config').item.json.teacher_email }}",
          "message": "=<b>A new participant registred for the event {{ $('Retrieve event infos').item.json.title }} ({{ $('Retrieve event infos').item.json.start }})!</b><br/><br/>\n\n<b>Name: {{ $('On payment').item.json.data.object.customer_details.name }}</b><br/>\n<b>Email: {{ $('On payment').item.json.data.object.customer_details.email }}</b><br/><br/>\n\n<b>Participant list:</b><br/>\n{{ $('Config').item.json.sheet_url }}#gid={{ $('On payment').item.json.data.object.metadata.event_sheet_id }} ",
          "options": {},
          "subject": "New participant registred ‚òùÔ∏è"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "DMcPDN0IHPwGmI7f",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "33e5283f-3854-4ada-8412-858c205f1d1e",
        "name": "Create payment link",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          620,
          480
        ],
        "parameters": {
          "url": "https://api.stripe.com/v1/payment_links",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "form-urlencoded",
          "authentication": "predefinedCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "line_items[0][price]",
                "value": "={{ $json.default_price }}"
              },
              {
                "name": "line_items[0][quantity]",
                "value": "1"
              },
              {
                "name": "metadata[event_sheet_id]",
                "value": "={{ $('Create Stripe Product').item.json.created }}"
              },
              {
                "name": "metadata[zoom_link]",
                "value": "={{ $('Create Zoom meeting').item.json.join_url }}"
              },
              {
                "name": "metadata[zoom_password]",
                "value": "={{ $('Create Zoom meeting').item.json.password }}"
              },
              {
                "name": "metadata[zoom_id]",
                "value": "={{ $('Create Zoom meeting').item.json.id }}"
              },
              {
                "name": "metadata[title]",
                "value": "={{ $('Creation Form').item.json.title }}"
              },
              {
                "name": "metadata[start_time]",
                "value": "={{ $('Create Zoom meeting').item.json.start_time }}"
              },
              {
                "name": "metadata[price]",
                "value": "={{ $('Creation Form').item.json.price }}"
              },
              {
                "name": "metadata[currency]",
                "value": "={{ $('Config').item.json.currency }}"
              }
            ]
          },
          "nodeCredentialType": "stripeApi"
        },
        "credentials": {
          "stripeApi": {
            "id": "qjose8z3RR7Xzm7b",
            "name": "Stripe Dev"
          }
        },
        "typeVersion": 4.1
      },
      {
        "id": "600c5382-bdac-4131-a784-399f5be2b54b",
        "name": "Format participant",
        "type": "n8n-nodes-base.set",
        "position": [
          180,
          800
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "dabd3bc2-ca92-4d99-a223-b0ad18945121",
                "name": "email",
                "type": "string",
                "value": "={{ $('On payment').item.json.data.object.customer_details.email }}"
              },
              {
                "id": "d40709f6-ffcd-4055-a374-9044a9a5e3b2",
                "name": "name",
                "type": "string",
                "value": "={{ $('On payment').item.json.data.object.customer_details.name }}"
              }
            ]
          }
        },
        "typeVersion": 3.3
      },
      {
        "id": "c8a90ac5-14cd-4ff2-bd5b-c35724f085d1",
        "name": "Format event",
        "type": "n8n-nodes-base.set",
        "position": [
          840,
          280
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "a29943ba-b516-41a8-8f85-5bcee5eda0d1",
                "name": "title",
                "type": "string",
                "value": "={{ $('Creation Form').item.json.title }}"
              },
              {
                "id": "bf642fde-c4c2-42b4-beed-ef65efdab55b",
                "name": "start",
                "type": "string",
                "value": "={{ $('Creation Form').item.json.date_start }}"
              },
              {
                "id": "33f7a58e-624d-4ccc-bbea-ed3365cede20",
                "name": "price",
                "type": "number",
                "value": "={{ $('Creation Form').item.json.price }}"
              },
              {
                "id": "c948f71e-3b12-4c6a-a1f9-ee9a511fe262",
                "name": "currency",
                "type": "string",
                "value": "={{ $('Config').item.json.currency }}"
              },
              {
                "id": "887461ca-db0d-442e-8008-5fe6a6fbdd8f",
                "name": "zoom_link",
                "type": "string",
                "value": "={{ $('Create Zoom meeting').item.json.join_url }}"
              },
              {
                "id": "4b2bd5e2-3bd5-443a-94a3-9ababfd9d881",
                "name": "zoom_id",
                "type": "string",
                "value": "={{ $('Create Zoom meeting').item.json.id }}"
              },
              {
                "id": "a1cea8e2-9954-4143-b71f-5ea194a873dd",
                "name": "zoom_password",
                "type": "string",
                "value": "={{ $('Create Zoom meeting').item.json.password }}"
              },
              {
                "id": "faa52bc6-dfbe-49e2-bc95-dae198a61293",
                "name": "payment_link",
                "type": "string",
                "value": "={{ $json.url }}"
              },
              {
                "id": "d7f5f0f5-cc7b-436a-9ad1-0b8f410c62c6",
                "name": "payment_id",
                "type": "string",
                "value": "={{ $json.id }}"
              },
              {
                "id": "020b22d0-f525-4120-9f8b-2fa33e88c2e1",
                "name": "event_sheet_id",
                "type": "string",
                "value": "={{ $json.metadata.event_sheet_id }}"
              }
            ]
          }
        },
        "typeVersion": 3.3
      },
      {
        "id": "def10b04-98c3-46cc-bdeb-9592c7466992",
        "name": "Store event",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1040,
          280
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [],
            "mappingMode": "autoMapInputData",
            "matchingColumns": []
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "0"
          },
          "documentId": {
            "__rl": true,
            "mode": "url",
            "value": "={{ $('Config').item.json.sheet_url }}"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RICzFHixgHXMuKmg",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.3,
        "alwaysOutputData": true
      },
      {
        "id": "594fc7a1-f299-49c4-a25b-07cf2ced16f7",
        "name": "Creation Form",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -500,
          480
        ],
        "webhookId": "1c6fe52c-48ab-4688-b5ae-7e24361aa603",
        "parameters": {
          "path": "1c6fe52c-48ab-4688-b5ae-7e24361aa602",
          "options": {},
          "formTitle": "Create a new meeting",
          "formFields": {
            "values": [
              {
                "fieldLabel": "title",
                "requiredField": true
              },
              {
                "fieldType": "number",
                "fieldLabel": "price",
                "requiredField": true
              },
              {
                "fieldType": "date",
                "fieldLabel": "date_start",
                "requiredField": true
              },
              {
                "fieldType": "number",
                "fieldLabel": "hour"
              },
              {
                "fieldType": "number",
                "fieldLabel": "minute"
              }
            ]
          },
          "responseMode": "lastNode",
          "formDescription": "This automates the creation of a Zoom Meeting and a Stripe Payment page, streamlining your event setup process."
        },
        "typeVersion": 2
      },
      {
        "id": "18fec11b-da39-4fe2-afab-d1585e3d9a99",
        "name": "On payment",
        "type": "n8n-nodes-base.stripeTrigger",
        "disabled": true,
        "position": [
          -500,
          780
        ],
        "webhookId": "ee7d6932-0583-47a3-b442-8bc161eee5e9",
        "parameters": {
          "events": [
            "checkout.session.completed"
          ]
        },
        "credentials": {
          "stripeApi": {
            "id": "qjose8z3RR7Xzm7b",
            "name": "Stripe Dev"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "1d95a7a5-7ddc-4338-9784-1d0554f39808",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -220,
          118
        ],
        "parameters": {
          "color": 6,
          "width": 275.01592825011585,
          "height": 468.76027109756643,
          "content": "# Setup\n### 1/ Add Your credentials\n[Zoom](https://docs.n8n.io/integrations/builtin/credentials/zoom/)\n[Google](https://docs.n8n.io/integrations/builtin/credentials/google/)\n[Stripe](https://docs.n8n.io/integrations/builtin/credentials/stripe/)\n\nNote: For Google, you need to add Gmail and Google Sheet.\n\n### 2/ Create a [new Google Sheet](https://sheets.new/).\nKeep this sheet blank for now; it contains your meeting and participant information. Place it wherever it fits best in your organization.\n\n### 3/ And fill the config node\n# üëá"
        },
        "typeVersion": 1
      },
      {
        "id": "58312523-1bee-4a56-9ab2-dc166fe30573",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -920,
          500
        ],
        "parameters": {
          "color": 6,
          "width": 372,
          "height": 200.14793114506386,
          "content": "# Create a meeting üëâüèª\n\nYour journey to easy event management starts here.\n\nClick this node, copy the production URL, and keep it handy. It's your personal admin tool for quickly creating new meetings. Simple and efficient!"
        },
        "typeVersion": 1
      },
      {
        "id": "09153c6b-33cb-4fd1-8fa2-3513bca01f0c",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          620,
          660
        ],
        "parameters": {
          "color": 6,
          "width": 519.9859025074911,
          "height": 106.11515926602786,
          "content": "# üñãÔ∏è Customize\n### Feel free to adapt email contents to your needs."
        },
        "typeVersion": 1
      },
      {
        "id": "da13aadc-eb3c-4d99-8e2b-3e56a40d09f3",
        "name": "if is creation flow",
        "type": "n8n-nodes-base.if",
        "position": [
          -20,
          640
        ],
        "parameters": {
          "options": {
            "looseTypeValidation": true
          },
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "40ddf809-1602-4120-ae7e-8be61437b50d",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{ $(\"Creation Form\").isExecuted }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "ca62dd52-cb79-45c1-a26a-91ba4c16b6ed",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          180,
          340
        ],
        "parameters": {
          "color": 7,
          "width": 202.64787116404852,
          "height": 85.79488430601403,
          "content": "### Crafted by the\n## [ü•∑ n8n.ninja](https://n8n.ninja)"
        },
        "typeVersion": 1
      },
      {
        "id": "aebdc1b5-ccf7-4299-a8ec-10eb448c4d72",
        "name": "the end",
        "type": "n8n-nodes-base.noOp",
        "position": [
          1040,
          800
        ],
        "parameters": {},
        "typeVersion": 1
      }
    ],
    "active": true,
    "pinData": {
      "On payment": [
        {
          "json": {
            "id": "evt_1Ou0e4BH8XCwzsfXEKVN0GkI",
            "data": {
              "object": {
                "id": "cs_test_a1G73c0pSu8hnD8y4we2ZVGy3MdmDuam1jLT07DqcBgYkuH1vOpWSkclBr",
                "url": null,
                "mode": "payment",
                "locale": "auto",
                "object": "checkout.session",
                "status": "complete",
                "consent": null,
                "created": 1710370285,
                "invoice": null,
                "ui_mode": "hosted",
                "currency": "eur",
                "customer": null,
                "livemode": false,
                "metadata": {
                  "zoom_id": "86579738722",
                  "zoom_link": "https://us06web.zoom.us/j/86579738722?pwd=i8QeOxKGO8GODInTP3gsYUjvrCYarA.1",
                  "zoom_password": "260j",
                  "event_sheet_id": "1710369993"
                },
                "shipping": null,
                "cancel_url": "https://stripe.com",
                "expires_at": 1710456685,
                "custom_text": {
                  "submit": null,
                  "after_submit": null,
                  "shipping_address": null,
                  "terms_of_service_acceptance": null
                },
                "submit_type": "auto",
                "success_url": "https://stripe.com",
                "amount_total": 2000,
                "payment_link": "plink_1Ou0ZCBH8XCwzsfXUongWL67",
                "setup_intent": null,
                "subscription": null,
                "automatic_tax": {
                  "status": null,
                  "enabled": false,
                  "liability": null
                },
                "client_secret": null,
                "custom_fields": [],
                "shipping_rate": null,
                "total_details": {
                  "amount_tax": 0,
                  "amount_discount": 0,
                  "amount_shipping": 0
                },
                "customer_email": null,
                "payment_intent": "pi_3Ou0e2BH8XCwzsfX14Vi1Pak",
                "payment_status": "paid",
                "recovered_from": null,
                "amount_subtotal": 2000,
                "after_expiration": null,
                "customer_details": {
                  "name": "Emmanuel Bern",
                  "email": "emm.bernard@gmail.com",
                  "phone": null,
                  "address": {
                    "city": "Lausanne",
                    "line1": "Avenue Charles Dickens 10",
                    "line2": null,
                    "state": null,
                    "country": "CH",
                    "postal_code": "1006"
                  },
                  "tax_ids": [],
                  "tax_exempt": "none"
                },
                "invoice_creation": {
                  "enabled": false,
                  "invoice_data": {
                    "footer": null,
                    "issuer": null,
                    "metadata": {},
                    "description": null,
                    "custom_fields": null,
                    "account_tax_ids": null,
                    "rendering_options": null
                  }
                },
                "shipping_options": [],
                "customer_creation": "if_required",
                "consent_collection": null,
                "client_reference_id": null,
                "currency_conversion": null,
                "payment_method_types": [
                  "card",
                  "bancontact",
                  "eps",
                  "giropay",
                  "ideal",
                  "link",
                  "klarna"
                ],
                "allow_promotion_codes": false,
                "payment_method_options": {
                  "card": {
                    "request_three_d_secure": "automatic"
                  }
                },
                "phone_number_collection": {
                  "enabled": false
                },
                "payment_method_collection": "always",
                "billing_address_collection": "auto",
                "shipping_address_collection": null,
                "payment_method_configuration_details": {
                  "id": "pmc_1Om7TPBH8XCwzsfXBB30jrJh",
                  "parent": null
                }
              }
            },
            "type": "checkout.session.completed",
            "object": "event",
            "created": 1710370296,
            "request": {
              "id": null,
              "idempotency_key": null
            },
            "livemode": false,
            "api_version": "2020-08-27",
            "pending_webhooks": 4
          }
        }
      ]
    },
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "9e350a8f-30e0-43ab-8dab-a7edbfd637d8",
    "connections": {
      "Config": {
        "main": [
          [
            {
              "node": "if is creation flow",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On payment": {
        "main": [
          [
            {
              "node": "Config",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format event": {
        "main": [
          [
            {
              "node": "Store event",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Creation Form": {
        "main": [
          [
            {
              "node": "Config",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Notify teacher": {
        "main": [
          [
            {
              "node": "the end",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format participant": {
        "main": [
          [
            {
              "node": "Add participant to list",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Zoom meeting": {
        "main": [
          [
            {
              "node": "Create Stripe Product",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create payment link": {
        "main": [
          [
            {
              "node": "Create participant list",
              "type": "main",
              "index": 0
            },
            {
              "node": "Format event",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "if is creation flow": {
        "main": [
          [
            {
              "node": "Create Zoom meeting",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Format participant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Stripe Product": {
        "main": [
          [
            {
              "node": "Create payment link",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add participant to list": {
        "main": [
          [
            {
              "node": "Send confirmation to participant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create participant list": {
        "main": [
          [
            {
              "node": "Send email to teacher",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send confirmation to participant": {
        "main": [
          [
            {
              "node": "Notify teacher",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "YVNJOltj0jMQatGz",
    "meta": {
      "instanceId": "143d2ab55c8bffb06f8b9c7ad30335764fdc48bbbacecbe2218dadb998a32213",
      "templateCredsSetupCompleted": true
    },
    "name": "Stripe Payment Order Sync ‚Äì Auto Retrieve Customer & Product Purchased",
    "tags": [],
    "nodes": [
      {
        "id": "90322fe5-5536-41c3-ac08-ea87a856781b",
        "name": "Stripe Trigger on Payment Event",
        "type": "n8n-nodes-base.stripeTrigger",
        "position": [
          0,
          0
        ],
        "webhookId": "e85ac894-bb67-436c-ad39-308a00c8e922",
        "parameters": {
          "events": [
            "checkout.session.completed"
          ]
        },
        "credentials": {
          "stripeApi": {
            "id": "ClCB0WooGxls3WGM",
            "name": "Stripe Test"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "3feb0b03-921e-4bfd-8a50-b2b6b47e9497",
        "name": "Extract Session Information",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          300,
          0
        ],
        "parameters": {
          "url": "=https://api.stripe.com/v1/checkout/sessions/{{ $json.data.object.id }}",
          "options": {},
          "sendQuery": true,
          "authentication": "predefinedCredentialType",
          "queryParameters": {
            "parameters": [
              {
                "name": "expand[]",
                "value": "line_items"
              }
            ]
          },
          "nodeCredentialType": "stripeApi"
        },
        "credentials": {
          "stripeApi": {
            "id": "ClCB0WooGxls3WGM",
            "name": "Stripe Test"
          },
          "httpHeaderAuth": {
            "id": "9UNc6IDuBlNCX6zd",
            "name": "PDF to Text"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "5a436d1c-88e9-492e-8fe0-33a5706de1b3",
        "name": "Filter Information",
        "type": "n8n-nodes-base.set",
        "position": [
          560,
          0
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "95a68e0f-b74c-4ca2-8143-14b469aa6bfb",
                "name": "Customer Name",
                "type": "string",
                "value": "={{ $json.customer_details.name }}"
              },
              {
                "id": "7634efa6-04f3-4dac-8509-56aae29fcc79",
                "name": "Customer Email",
                "type": "string",
                "value": "={{ $json.customer_details.email }}"
              },
              {
                "id": "10e71e07-6dd3-410c-a774-1eeffe2be7a5",
                "name": "Product Purchased",
                "type": "string",
                "value": "={{ $json.line_items.data[0].description }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "e3f6ba06-36d9-4b41-9c5a-cec669ce507b",
    "connections": {
      "Extract Session Information": {
        "main": [
          [
            {
              "node": "Filter Information",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Stripe Trigger on Payment Event": {
        "main": [
          [
            {
              "node": "Extract Session Information",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "eaa31cde-3017-400d-aac8-999def8cc227",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -340,
          -780
        ],
        "parameters": {
          "width": 617,
          "height": 490,
          "content": "## Check if incoming email is about appointment\nWe use LLM to check subject and body of the email and determine if it's an appointment request. "
        },
        "typeVersion": 1
      },
      {
        "id": "b03d3f72-d1d8-49a7-bcc1-a476fd5c4ad7",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          -780
        ],
        "parameters": {
          "width": 796,
          "height": 482,
          "content": "## Get calendar availability and compose a response\nMake sure to update the Workflow ID if you are running this as 2 workflows"
        },
        "typeVersion": 1
      },
      {
        "id": "29ce0093-c4c8-41cc-be69-334de3a1d1a2",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -60,
          -460
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "5176f475-704b-446e-b368-ffa395bb089e",
        "name": "OpenAI Chat Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          480,
          -460
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "0e8a75dd-ce68-46c3-972c-32b15e04b254",
        "name": "Send reply",
        "type": "n8n-nodes-base.gmail",
        "position": [
          940,
          -660
        ],
        "webhookId": "0f18d414-1b14-4d2e-9fc2-d2d302372dc6",
        "parameters": {
          "message": "={{ $json.output }}",
          "options": {},
          "messageId": "={{ $('Gmail Trigger').first().json.id }}",
          "operation": "reply"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "Sf5Gfl9NiFTNXFWb",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "bf154384-274a-4cdd-977d-890220948a9d",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -280,
          -640
        ],
        "parameters": {
          "filters": {
            "readStatus": "unread",
            "includeSpamTrash": false
          },
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "Sf5Gfl9NiFTNXFWb",
            "name": "Gmail account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "5a268b34-38ea-4e55-87ab-8a616e2aa1fa",
        "name": "Classify appointment",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "position": [
          -60,
          -640
        ],
        "parameters": {
          "options": {
            "fallback": "discard"
          },
          "inputText": "=Please evaluate the following email to determine if it suggests scheduling a meeting or a call:\nSubject: {{ $json.Subject }}\nSnippet: {{ $json.snippet }}",
          "categories": {
            "categories": [
              {
                "category": "is_appointment",
                "description": "email Is requesting an appointment"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7b5a8468-09e5-4575-97cb-9175ee02b19d",
        "name": "Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          500,
          -660
        ],
        "parameters": {
          "text": "=Sender: {{ $('Gmail Trigger').first().json.From }}\nSubject: {{ $('Gmail Trigger').first().json.Subject }}\nEmail Text: {{ $('Gmail Trigger').first().json.snippet }}",
          "options": {
            "systemMessage": "=You are an email scheduling assistant. Based on the received email, check my availability and propose an appropriate response. \nAim to get a specific time, rather than just a day. When checking my availability, make sure that there's enough time in between meetings.\nIf I'm not available, ALWAYS propose a new time based on my availability. When proposing a new time, always leave 15 minutes buffer from previous meeting.\nToday date and time is: {{ $now.toISO() }}."
          },
          "promptType": "define"
        },
        "typeVersion": 1.8
      },
      {
        "id": "b61e8061-5719-4c30-97da-e306e7b79b76",
        "name": "Google Calendar",
        "type": "n8n-nodes-base.googleCalendarTool",
        "position": [
          680,
          -460
        ],
        "parameters": {
          "options": {},
          "timeMax": "={{ $now.plus(1, 'month').toISO() }}",
          "timeMin": "={{ $now.minus(1, 'day').toISO() }}",
          "calendar": {
            "__rl": true,
            "mode": "id",
            "value": "your_email@gmail.com"
          },
          "operation": "getAll",
          "returnAll": true
        },
        "credentials": {
          "googleCalendarOAuth2Api": {
            "id": "kWMxmDbMDDJoYFVK",
            "name": "Google Calendar account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "47e07b6c-d432-4111-b33e-56d6c305c40c",
        "name": "Mark as read",
        "type": "n8n-nodes-base.gmail",
        "position": [
          940,
          -480
        ],
        "webhookId": "7e2d851b-c9f3-471c-875d-0da7c2c3b561",
        "parameters": {
          "messageId": "={{ $('Gmail Trigger').first().json.id }}",
          "operation": "markAsRead"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "Sf5Gfl9NiFTNXFWb",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      }
    ],
    "pinData": {},
    "connections": {
      "Agent": {
        "main": [
          [
            {
              "node": "Send reply",
              "type": "main",
              "index": 0
            },
            {
              "node": "Mark as read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Classify appointment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Calendar": {
        "ai_tool": [
          [
            {
              "node": "Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Classify appointment",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Classify appointment": {
        "main": [
          [
            {
              "node": "Agent",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    }
  },
  {
    "id": "O16rkzLczZ7KXsJr",
    "meta": {
      "instanceId": "fe52080916406a2a9812a7975b2d9b9e9838f3ce0f0b34614c611fb2ca1528d3"
    },
    "name": "Apple App Store reviews summary",
    "tags": [],
    "nodes": [
      {
        "id": "8d29dacc-12dc-4b59-8f61-94c06633c85e",
        "name": "Split Out6",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          448,
          464
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "apps"
        },
        "typeVersion": 1
      },
      {
        "id": "851e89ba-22be-4a77-92ab-87d5a996e43c",
        "name": "Split Out8",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          480,
          928
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "apps"
        },
        "typeVersion": 1
      },
      {
        "id": "8b3b836b-e9c9-49bf-9a47-2eaad4b70487",
        "name": "Loop Over Items3",
        "type": "n8n-nodes-base.splitInBatches",
        "onError": "continueRegularOutput",
        "position": [
          656,
          928
        ],
        "parameters": {
          "options": {
            "reset": false
          }
        },
        "typeVersion": 3
      },
      {
        "id": "41b33c31-6d86-475f-a5b0-b837310cf310",
        "name": "JWT",
        "type": "n8n-nodes-base.jwt",
        "position": [
          848,
          464
        ],
        "parameters": {
          "options": {
            "kid": "key_id_here"
          },
          "useJson": true,
          "claimsJson": "={\n  \"iss\": \"......\",\n  \"aud\": \"appstoreconnect-v1\",\n  \"bid\": \"......\",\n  \"exp\": {{ Math.floor((new Date().getTime() + 10 * 60 * 1000) / 1000) }}\n}\n"
        },
        "credentials": {
          "jwtAuth": {
            "id": "7qTWKeegrAbdcNLO",
            "name": "Apple Connect JWT Auth account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "9871f543-2071-4ead-ab58-6ea3fd652867",
        "name": "HTTP Request - CUSTOMER REVIEWS",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1040,
          464
        ],
        "parameters": {
          "url": "=https://api.appstoreconnect.apple.com/v1/apps/{{ $('Loop Over Items2').item.json.apple_app_store_app_id }}/customerReviews?sort=-createdDate",
          "options": {
            "pagination": {
              "pagination": {
                "nextURL": "={{$response.body.links[\"next\"]}}",
                "maxRequests": 5,
                "paginationMode": "responseContainsNextURL",
                "limitPagesFetched": true,
                "completeExpression": "={{$response.body.links[\"next\"] == null}}",
                "paginationCompleteWhen": "other"
              }
            }
          },
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBearerAuth"
        },
        "credentials": {
          "httpBearerAuth": {
            "id": "vqqwFq1bj6pWDkMw",
            "name": "Apple Connect Bearer YOUR_TOKEN_HERE account - Tripledot"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "14faa3b0-63a2-42d2-9bb0-e5af2e380768",
        "name": "Pinecone Vector Store9",
        "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
        "position": [
          1536,
          464
        ],
        "parameters": {
          "mode": "insert",
          "options": {
            "clearNamespace": "={{ new Date().getDay() === 6 }}",
            "pineconeNamespace": "=store_reviews_apple_app_store_{{$('Split Out6').item.json.apple_app_store_app_id}}"
          },
          "pineconeIndex": {
            "__rl": true,
            "mode": "list",
            "value": "n8n-store-reviews",
            "cachedResultName": "n8n-store-reviews"
          }
        },
        "credentials": {
          "pineconeApi": {
            "id": "AhisTk5eS6H3HYiC",
            "name": "PineconeApi account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "da56079e-cb79-477d-8975-0ce5d6986719",
        "name": "Embeddings OpenAI9",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "position": [
          1536,
          640
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "iAPtqcVj4gp3rRy2",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "fd593a5c-7a30-4cc3-b176-a70e71eb7367",
        "name": "Default Data Loader8",
        "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
        "position": [
          1632,
          640
        ],
        "parameters": {
          "options": {
            "metadata": {
              "metadataValues": [
                {
                  "name": "star_rating",
                  "value": "={{ $('Filter1').item.json.data.attributes.rating }}"
                },
                {
                  "name": "date",
                  "value": "={{$('Filter1').item.json.data.attributes.createdDate}}\n"
                },
                {
                  "name": "territory",
                  "value": "={{ $('Filter1').item.json.data.attributes.territory }}"
                },
                {
                  "name": "review_id",
                  "value": "={{ $('Filter1').item.json.data.id }}"
                }
              ]
            }
          },
          "jsonData": "=title: {{ $('Filter1').item.json.data.attributes.title }} | comment: {{ $('Filter1').item.json.data.attributes.body }} | date: {{ $('Filter1').item.json.data.attributes.createdDate }} | star rating: {{ $('Filter1').item.json.data.attributes.rating }} | territory: {{ $('Filter1').item.json.data.attributes.territory }}",
          "jsonMode": "expressionData"
        },
        "typeVersion": 1.1
      },
      {
        "id": "29922c0f-d2dc-4753-abc1-4e52de4be1bf",
        "name": "Split Out9",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          1216,
          464
        ],
        "parameters": {
          "include": "=",
          "options": {
            "destinationFieldName": ""
          },
          "fieldToSplitOut": "data"
        },
        "typeVersion": 1
      },
      {
        "id": "ed1b9229-af94-4757-a920-068d08d50c39",
        "name": "OpenAI Chat Model10",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          880,
          1152
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "iAPtqcVj4gp3rRy2",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "49252522-8491-4099-9b53-699d81bc8fac",
        "name": "Embeddings OpenAI12",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "position": [
          976,
          1328
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "iAPtqcVj4gp3rRy2",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "e7ab3d96-4ceb-448c-b059-ccc314943589",
        "name": "Pinecone Vector Store12",
        "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
        "position": [
          976,
          1200
        ],
        "parameters": {
          "mode": "retrieve-as-tool",
          "topK": 500,
          "options": {
            "pineconeNamespace": "=store_reviews_apple_app_store_{{$('Loop Over Items3').item.json.apple_app_store_app_id}}"
          },
          "pineconeIndex": {
            "__rl": true,
            "mode": "list",
            "value": "n8n-store-reviews",
            "cachedResultName": "n8n-store-reviews"
          },
          "toolDescription": "This is the vector store for the Apple App Store reviews data you need to answer queries"
        },
        "credentials": {
          "pineconeApi": {
            "id": "AhisTk5eS6H3HYiC",
            "name": "PineconeApi account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "e6bdf836-c130-44f5-80fb-04afd274fed9",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1232,
          864
        ],
        "parameters": {
          "color": 7,
          "width": 192,
          "height": 224,
          "content": "Post the summary to a Slack channel"
        },
        "typeVersion": 1
      },
      {
        "id": "7997491f-54e8-4a1c-8f8d-62171d58e45e",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          48,
          400
        ],
        "parameters": {
          "color": 7,
          "width": 150,
          "height": 208,
          "content": "Fetch reviews once a day"
        },
        "typeVersion": 1
      },
      {
        "id": "1cee29d5-8b94-4cbc-b9e0-9d5312dd3490",
        "name": "Daily Trigger1",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          80,
          464
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 10
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "fc49497e-d286-406d-8d80-22be63779d5e",
        "name": "Set App Store app ids",
        "type": "n8n-nodes-base.set",
        "position": [
          256,
          464
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "ed79836f-8032-4daa-afc1-d0170157c8a0",
                "name": "=apps",
                "type": "array",
                "value": "=[\n  { \n    \"apple_app_store_app_id\": \"<Apple app id here>\", \n    \"app_name\": \"<App name here>\"\n  },\n  {\n    \"apple_app_store_app_id\": \"<Apple app id here>\", \n    \"app_name\": \"<App name here>\"\n  }\n]"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "0a5b71ee-bf43-4312-9d26-799e3669b6d3",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          208,
          400
        ],
        "parameters": {
          "color": 7,
          "width": 192,
          "height": 208,
          "content": "Define app ids and names"
        },
        "typeVersion": 1
      },
      {
        "id": "ada28eab-f4f1-4720-8ea5-55371299289d",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          432,
          400
        ],
        "parameters": {
          "color": 7,
          "width": 304,
          "height": 208,
          "content": "Loop over app ids (apps) in the list"
        },
        "typeVersion": 1
      },
      {
        "id": "56f0e43e-9687-46e2-8aff-50b1548db9a8",
        "name": "Loop Over Items2",
        "type": "n8n-nodes-base.splitInBatches",
        "onError": "continueRegularOutput",
        "position": [
          624,
          464
        ],
        "parameters": {
          "options": {
            "reset": false
          }
        },
        "typeVersion": 3
      },
      {
        "id": "32631042-deb4-494d-93be-800695376bfc",
        "name": "Sticky Note12",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          752,
          208
        ],
        "parameters": {
          "color": 7,
          "width": 224,
          "height": 400,
          "content": "Generate a JWT token for Apple's App Store Connect API. Required fields: \n- iss: Issuer ID generated by Apple\n- bid: Bundle id of one of the apps in the App Store account\n- exp: Token expiry date. Set to current time + 10 minutes."
        },
        "typeVersion": 1
      },
      {
        "id": "94eef180-922d-4e24-a35a-30ebf3526059",
        "name": "Sticky Note13",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          992,
          400
        ],
        "parameters": {
          "color": 7,
          "width": 192,
          "height": 208,
          "content": "HTTP call to fetch App Store reviews of the app"
        },
        "typeVersion": 1
      },
      {
        "id": "cd008073-8feb-4cac-bde8-502e726bd06b",
        "name": "Sticky Note15",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1344,
          384
        ],
        "parameters": {
          "color": 7,
          "width": 464,
          "height": 224,
          "content": "Store the previous day's reviews in the vector store. Create a different namespace for each app (app id). Clear the name space once a week to remove old reviews."
        },
        "typeVersion": 1
      },
      {
        "id": "85942bd2-57d2-4504-bb39-ce32b3d47389",
        "name": "Filter1",
        "type": "n8n-nodes-base.filter",
        "notes": "Fetch yesterday's reviews",
        "position": [
          1376,
          464
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "e5cc101a-9e06-4f33-8578-63c4acc66042",
                "operator": {
                  "type": "dateTime",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.data.attributes.createdDate.toDateTime().toISODate() }}",
                "rightValue": "={{$today.minus({days: 1})}}\n"
              }
            ]
          }
        },
        "notesInFlow": false,
        "typeVersion": 2.2,
        "alwaysOutputData": true
      },
      {
        "id": "79baaaa8-8c25-4bdf-a98e-1427a116ce49",
        "name": "Weekly Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "notes": "On Fridays at 11am",
        "position": [
          112,
          928
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "weeks",
                "triggerAtDay": [
                  5
                ],
                "triggerAtHour": 11
              }
            ]
          }
        },
        "notesInFlow": true,
        "typeVersion": 1.2
      },
      {
        "id": "58011080-6343-4314-91c5-fb45f8795013",
        "name": "Sticky Note16",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          48,
          864
        ],
        "parameters": {
          "color": 7,
          "width": 176,
          "height": 224,
          "content": "Prepare and send the summary once a week"
        },
        "typeVersion": 1
      },
      {
        "id": "ef95861d-7a8e-47f3-8eac-017cc530d090",
        "name": "Set App Store app ids1",
        "type": "n8n-nodes-base.set",
        "position": [
          288,
          928
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "ed79836f-8032-4daa-afc1-d0170157c8a0",
                "name": "=apps",
                "type": "array",
                "value": "=[\n  { \n    \"apple_app_store_app_id\": \"<Apple app id here>\", \n    \"app_name\": \"<App name here>\"\n  },\n  {\n    \"apple_app_store_app_id\": \"<Apple app id here>\", \n    \"app_name\": \"<App name here>\"\n  }\n]"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "ca10af78-f185-4c10-9431-2d20a3c6e327",
        "name": "Sticky Note17",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          240,
          864
        ],
        "parameters": {
          "color": 7,
          "width": 192,
          "height": 224,
          "content": "Define app ids and names"
        },
        "typeVersion": 1
      },
      {
        "id": "247fe591-2a5f-43cc-98e3-db448ff8666c",
        "name": "Sticky Note18",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          464,
          864
        ],
        "parameters": {
          "color": 7,
          "width": 320,
          "height": 224,
          "content": "Loop over app ids (apps) in the list"
        },
        "typeVersion": 1
      },
      {
        "id": "25651392-868b-4481-98d5-cbb1fb628b09",
        "name": "AI Agent - Summariser",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "onError": "continueRegularOutput",
        "position": [
          928,
          944
        ],
        "parameters": {
          "text": "=Create a summary of store reviews submitted. In your output, include the number of reviews you processed to create the summary. The summary should be split into two groups: a summary about positive reviews and a summary about negative reviews. Also include the average star rating.",
          "options": {
            "systemMessage": "=Your job is to respond to prompts using the information you gather from the Apple App Store reviews of a mobile app. Your main role is to help your users to gain insights from store review without having to read reviews one by one. Store review usually have star ratings with 1 star being the lowest rating and 5 star being the highest rating. They can also have a text description where the player of the game writes a review about their experience with the game. These can be negative reviews or positive reviews. The lower the star rating is the more likely that the review is negative."
          },
          "promptType": "define"
        },
        "typeVersion": 2
      },
      {
        "id": "b86bb808-114c-45d2-99f9-2ee24ff47684",
        "name": "Send to Slack channel1",
        "type": "n8n-nodes-base.slack",
        "position": [
          1280,
          944
        ],
        "webhookId": "91dd6021-c694-4470-9013-53d5f2e213f8",
        "parameters": {
          "text": "={{ $json.output }}",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "id",
            "value": "C1111111"
          },
          "otherOptions": {}
        },
        "credentials": {
          "slackApi": {
            "id": "tVU8HVcP92PJGgqD",
            "name": "Slack account"
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "c15903ad-8adc-4a93-beb7-51b7337a369d",
        "name": "Sticky Note19",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          896,
          864
        ],
        "parameters": {
          "color": 7,
          "width": 288,
          "height": 224,
          "content": "Generate Apple App Store review summary for the app"
        },
        "typeVersion": 1
      },
      {
        "id": "b0bc0432-3765-4037-9983-2b883417278a",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -384,
          336
        ],
        "parameters": {
          "width": 336,
          "height": 784,
          "content": "## Apple App Store Reviews Summary with Pinecone, OpenAI & Slack Notification\n\nThis n8n workflow automates the process of collecting, storing, and summarizing customer reviews from the Apple App Store for multiple apps. It fetches daily reviews, stores them in a Pinecone vector database, and generates a weekly summary using OpenAI, which is then posted to a Slack channel.\n\n**Key Features**\n\n- Fetches daily customer reviews for a list of Apple App Store apps using the App Store Connect API.\n- Stores reviews in Pinecone, with separate namespaces for each app and automatic weekly cleanup.\n- Uses OpenAI to generate a summary of reviews, including positive/negative highlights and average star rating.\n- Posts the summary to a specified Slack channel every week.\n\n\n**How to use**\n\n- Set your Apple App Store app IDs and names in the provided Set nodes.\n- Configure your Apple API, Pinecone, OpenAI, and Slack credentials.\n- Adjust the schedule triggers as needed for daily fetching and weekly summarization.\n- Deploy the workflow to automate review monitoring and reporting for your apps."
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {
      "Daily Trigger1": [
        {
          "json": {
            "Hour": "14",
            "Year": "2025",
            "Month": "November",
            "Minute": "19",
            "Second": "04",
            "Timezone": "Europe/Madrid (UTC+01:00)",
            "timestamp": "2025-11-07T14:19:04.933+01:00",
            "Day of week": "Friday",
            "Day of month": "07",
            "Readable date": "November 7th 2025, 2:19:04 pm",
            "Readable time": "2:19:04 pm"
          }
        }
      ]
    },
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "dd6fb4d2-4be5-439b-9e2d-bd0a96364b4d",
    "connections": {
      "JWT": {
        "main": [
          [
            {
              "node": "HTTP Request - CUSTOMER REVIEWS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter1": {
        "main": [
          [
            {
              "node": "Pinecone Vector Store9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out6": {
        "main": [
          [
            {
              "node": "Loop Over Items2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out8": {
        "main": [
          [
            {
              "node": "Loop Over Items3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out9": {
        "main": [
          [
            {
              "node": "Filter1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Trigger1": {
        "main": [
          [
            {
              "node": "Set App Store app ids",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Trigger": {
        "main": [
          [
            {
              "node": "Set App Store app ids1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items2": {
        "main": [
          [],
          [
            {
              "node": "JWT",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items3": {
        "main": [
          [],
          [
            {
              "node": "AI Agent - Summariser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI9": {
        "ai_embedding": [
          [
            {
              "node": "Pinecone Vector Store9",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI12": {
        "ai_embedding": [
          [
            {
              "node": "Pinecone Vector Store12",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model10": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent - Summariser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Default Data Loader8": {
        "ai_document": [
          [
            {
              "node": "Pinecone Vector Store9",
              "type": "ai_document",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent - Summariser": {
        "main": [
          [
            {
              "node": "Send to Slack channel1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set App Store app ids": {
        "main": [
          [
            {
              "node": "Split Out6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pinecone Vector Store9": {
        "main": [
          [
            {
              "node": "Loop Over Items2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send to Slack channel1": {
        "main": [
          [
            {
              "node": "Loop Over Items3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set App Store app ids1": {
        "main": [
          [
            {
              "node": "Split Out8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pinecone Vector Store12": {
        "ai_tool": [
          [
            {
              "node": "AI Agent - Summariser",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request - CUSTOMER REVIEWS": {
        "main": [
          [
            {
              "node": "Split Out9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "Gn5M1FfXUAVy6h9l",
    "meta": {
      "instanceId": "f70454a5d1bedfb04805f13a51a4a63e308e7fc8821155a97e93d697feaee047",
      "templateCredsSetupCompleted": true
    },
    "tags": [],
    "nodes": [
      {
        "id": "3d621f41-b73a-406a-bfda-fac0d2ed1499",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          800,
          340
        ],
        "parameters": {
          "color": 4,
          "width": 540,
          "height": 560,
          "content": "## Router agent\nMakes decisions with the help of an LLM  \n- Analyzes the content\n- Decides which part of the transcript is relevant to the different departments\n- Sends the emails to the departments\n"
        },
        "typeVersion": 1
      },
      {
        "id": "249c22aa-58ca-40df-9157-7a00fbfd3dff",
        "name": "Router Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "notes": "Route the client feedback topics to the relevant department ",
        "position": [
          960,
          540
        ],
        "parameters": {
          "text": "={{ $('Webhook').item.json.body['Client Conversation'] }}",
          "options": {
            "systemMessage": "=You are provided with some client-company conversation and should decide who has to be informed about the feedback. Always only inform one person. Those are your options: \n- It's about a product, send an email to {{ $('Define routing emails').item.json['Support Email'] }}\n- It's about an invoicing problem, send an email to {{ $('Define routing emails').item.json['Administrative Email'] }}\n- It's  related to a travelling/trip, send an email to {{ $('Define routing emails').item.json['Commercial Email'] }}\n\nAdd the email of the person (\"{{ $('Webhook').item.json.body['Client Email'] }}\") at the beginning of the text preceded by \"FROM CLIENT: \"\nUse the Mailjet tool to inform each of the most related department. Provide mailjet with a subject, an email, and the email body formated as html which is the client conversation itself."
          },
          "promptType": "define"
        },
        "notesInFlow": true,
        "typeVersion": 1.8
      },
      {
        "id": "cffeafac-75e0-4a60-91d3-0a7d3bdb7371",
        "name": "Summarization",
        "type": "@n8n/n8n-nodes-langchain.chainSummarization",
        "notes": "The transcript summarized here",
        "position": [
          360,
          140
        ],
        "parameters": {
          "options": {
            "summarizationMethodAndPrompts": {
              "values": {
                "prompt": "=Summarize the following Converstaion in 2-3 sentences:\n\n\"{{ $('Webhook').item.json.body['Client Conversation'] }}\"\n\nJust output the summarized conversation and nothing else. Use the same language as the input",
                "summarizationMethod": "stuff"
              }
            }
          }
        },
        "notesInFlow": true,
        "typeVersion": 2,
        "alwaysOutputData": false
      },
      {
        "id": "ac5a16de-efb5-4603-bb52-2d85b007bf86",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          460,
          420
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "7mydLbpOJgXQKswc",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "8644b46e-b64c-415b-acfc-103ef5c71903",
        "name": "Gmail",
        "type": "n8n-nodes-base.gmailTool",
        "position": [
          1040,
          760
        ],
        "webhookId": "be3ad85f-a576-44d6-9383-6a038edfb25a",
        "parameters": {
          "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
          "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
          "options": {
            "appendAttribution": false
          },
          "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "Eo7V1LrxcAy38kKf",
            "name": "Harsh"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "b02e1dad-6f07-4215-a89b-fb0763232bcb",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -20,
          40
        ],
        "parameters": {
          "color": 4,
          "width": 260,
          "height": 260,
          "content": "## Set emails here\nFor each responsible person"
        },
        "typeVersion": 1
      },
      {
        "id": "fec711e6-837a-4722-83b9-dc838770fcb3",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -300,
          40
        ],
        "parameters": {
          "color": 4,
          "width": 260,
          "height": 260,
          "content": "## Webhook \nTo be used to send the transcription."
        },
        "typeVersion": 1
      },
      {
        "id": "2af225aa-95b9-4578-9c8c-0c49bb5e8510",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          800,
          40
        ],
        "parameters": {
          "color": 4,
          "width": 540,
          "height": 280,
          "content": "## Save transcription to Hubspot\n- Search for the client ID based on his email\n- Upload the summarized conversation as meeting notes"
        },
        "typeVersion": 1
      },
      {
        "id": "fb226ebf-b62f-48ef-b291-17b4beb30ebc",
        "name": "Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          880,
          -160
        ],
        "webhookId": "ffba5d59-965e-4042-a5cd-d6d89c443e75",
        "parameters": {
          "text": "=Below is the latest summary.\n\n{{ $json.response.text }}",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "C08VCE4AYNL",
            "cachedResultName": "n8n"
          },
          "otherOptions": {},
          "authentication": "oAuth2"
        },
        "credentials": {
          "slackOAuth2Api": {
            "id": "SbSspavlddGUo8F0",
            "name": "Slack account"
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "5622a2af-726d-468c-88b2-22d66a449128",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          800,
          -280
        ],
        "parameters": {
          "color": 4,
          "width": 540,
          "height": 300,
          "content": "## Send the summary to Slack and WhatsApp\n- Configure Slack Channel\n- Configure WhatsApp Recepient"
        },
        "typeVersion": 1
      },
      {
        "id": "d8b2181f-1c52-417b-9fdd-776e64a920ab",
        "name": "WhatsApp Business Cloud",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          1120,
          -160
        ],
        "webhookId": "36dba7ba-f6f2-45a0-ad5d-cfd5c1622a49",
        "parameters": {
          "template": "n8n_workflow_latest|en",
          "components": {
            "component": [
              {
                "bodyParameters": {
                  "parameter": [
                    {
                      "text": "={{ $('Webhook').item.json.body['Your Name'] }}"
                    },
                    {
                      "text": "={{ $('Summarization').item.json.response.text }}"
                    }
                  ]
                }
              }
            ]
          },
          "phoneNumberId": "702894569566382",
          "recipientPhoneNumber": "={{ $('Webhook').item.json.body['WhatsApp Contact Number'] }}"
        },
        "credentials": {
          "whatsAppApi": {
            "id": "bvkhSq7q9MuoWneA",
            "name": "WhatsApp account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "039c62d8-3a33-4436-9577-e2dc45f9e694",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "position": [
          -220,
          140
        ],
        "webhookId": "1ffeacc2-1dbd-4a9e-bf3f-6811ddd31642",
        "parameters": {
          "path": "1ffeacc2-1dbd-4a9e-bf3f-6811ddd31642",
          "options": {},
          "httpMethod": "POST"
        },
        "typeVersion": 2
      },
      {
        "id": "941ea710-68a5-46c7-b622-bf88b96430a7",
        "name": "Define routing emails",
        "type": "n8n-nodes-base.set",
        "position": [
          60,
          140
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "099d5326-3452-47b8-9dc0-acc0e6fd951e",
                "name": "Support Email",
                "type": "string",
                "value": "info@encoresky.com"
              },
              {
                "id": "4ed84290-dbf7-47f7-8693-4f95e0c2fd7e",
                "name": "Administrative Email",
                "type": "string",
                "value": "hr@encoresky.com"
              },
              {
                "id": "614d4a5c-c9f2-4d82-bfcb-cfdcc8a4b07d",
                "name": "Commercial Email",
                "type": "string",
                "value": "sales@encoresky.com"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "8af03b9d-b647-4d4c-8903-dd32e4b6a434",
        "name": "HubSpot Search Client",
        "type": "n8n-nodes-base.hubspot",
        "notes": "Search for the id",
        "position": [
          880,
          160
        ],
        "parameters": {
          "operation": "search",
          "authentication": "oAuth2",
          "filterGroupsUi": {
            "filterGroupsValues": [
              {
                "filtersUi": {
                  "filterValues": [
                    {
                      "value": "={{ $('Webhook').item.json.body['Client Email'] }}",
                      "propertyName": "email|string"
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {}
        },
        "credentials": {
          "hubspotOAuth2Api": {
            "id": "pQcxnwCMnLiFiQOJ",
            "name": "HubSpot account"
          }
        },
        "notesInFlow": true,
        "typeVersion": 2.1
      },
      {
        "id": "cb2bb828-ca8c-473a-a485-c8cde6116388",
        "name": "HubSpot Save Notes",
        "type": "n8n-nodes-base.hubspot",
        "notes": "Add meeting notes in the contact form",
        "position": [
          1120,
          160
        ],
        "parameters": {
          "type": "meeting",
          "metadata": {
            "body": "={{ $('Summarization').item.json.response.text }}",
            "title": "New meeting"
          },
          "resource": "engagement",
          "authentication": "oAuth2",
          "additionalFields": {
            "associations": {
              "contactIds": "={{ $json.properties.hs_object_id }}"
            }
          }
        },
        "credentials": {
          "hubspotOAuth2Api": {
            "id": "pQcxnwCMnLiFiQOJ",
            "name": "HubSpot account"
          }
        },
        "notesInFlow": true,
        "typeVersion": 2.1
      }
    ],
    "active": true,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "428e832a-7b0e-4e88-9695-6d793067deb8",
    "connections": {
      "Gmail": {
        "ai_tool": [
          [
            {
              "node": "Router Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Slack": {
        "main": [
          [
            {
              "node": "WhatsApp Business Cloud",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "Define routing emails",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Router Agent": {
        "main": [
          []
        ]
      },
      "Summarization": {
        "main": [
          [
            {
              "node": "Router Agent",
              "type": "main",
              "index": 0
            },
            {
              "node": "HubSpot Search Client",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Summarization",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Router Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Define routing emails": {
        "main": [
          [
            {
              "node": "Summarization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HubSpot Search Client": {
        "main": [
          [
            {
              "node": "HubSpot Save Notes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "NPGAfBzz4nv8lTpl",
    "meta": {
      "instanceId": "d40a25503b797861fe81ffcf2649da2a83b8677ac1ef2ee6b6872aa9b52454b8",
      "templateCredsSetupCompleted": true
    },
    "name": "Save New Sales Opportunities",
    "tags": [],
    "nodes": [
      {
        "id": "64b02b70-e7f2-4df0-852f-b6959af8d8c5",
        "name": "Received Emails with Sales Label",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          760,
          540
        ],
        "parameters": {
          "simple": false,
          "filters": {
            "labelIds": [
              "Label_8035866011660570111"
            ]
          },
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyHour"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "hCIbT7XsRrtmzCCJ",
            "name": "Gmail account"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "6dca3c61-98ba-4d18-bc5c-9c762e12f13b",
        "name": "Odoo - Create Opportunity",
        "type": "n8n-nodes-base.odoo",
        "position": [
          1500,
          540
        ],
        "parameters": {
          "resource": "opportunity",
          "opportunityName": "={{ $('Received Emails with Sales Label').item.json.headers.subject }}",
          "additionalFields": {
            "email_from": "={{ $('Received Emails with Sales Label').item.json.from.value[0].address }}",
            "description": "={{ $json.response.text }}"
          }
        },
        "credentials": {
          "odooApi": {
            "id": "5XAxrqqPxY5dzcoP",
            "name": "Odoo account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a57e0e51-50d3-49de-8dc6-6fe592604765",
        "name": "OpenAI Model",
        "type": "@n8n/n8n-nodes-langchain.lmOpenAi",
        "position": [
          1040,
          720
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-3.5-turbo-instruct"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8F3dAS1qjFM6mYbD",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a6de25a3-3967-4957-bc98-4cb774a53dda",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          700,
          220
        ],
        "parameters": {
          "width": 446.44549763033154,
          "height": 261.8821936357484,
          "content": "## Summarize emails and save them as notes on sales opportunity in Odoo\n\nSet up steps:\n* Configure Google Cloud credentials with Gmail access\n* Configure OpenAI credentials\n* Configure Odoo credentials\n "
        },
        "typeVersion": 1
      },
      {
        "id": "8705b4de-1334-4ff2-8d5d-60ec96cfb8cd",
        "name": "Summarize Email Content",
        "type": "@n8n/n8n-nodes-langchain.chainSummarization",
        "position": [
          1060,
          540
        ],
        "parameters": {
          "options": {
            "summarizationMethodAndPrompts": {
              "values": {
                "prompt": "=Write a concise summary of the following sales inquiry:\n\" {{ $json.text }}\"\nInclude structured information such as project budget, timelines, industry and a general summary\n\nCONCISE SUMMARY: \n",
                "combineMapPrompt": "=Write a concise summary of the following sales inquiry:\n\"{{ $json.text }}\"\nExtract information such as project budget, timelines and a general summary.\n\nCONCISE SUMMARY: \n"
              }
            }
          }
        },
        "typeVersion": 2
      }
    ],
    "active": false,
    "pinData": {
      "Summarize Email Content": [
        {
          "json": {
            "response": {
              "text": "Mihai Farcas, Procurement Manager at Innovative Solutions Inc, is interested in incorporating CloudConnect Pro platform into their upcoming projects. They are impressed by its capabilities in cloud integration, data management, and flexibility. They request detailed information on pricing, implementation options, support services, and case studies for enterprise-level deployments. They are eager to learn more and hope for a mutually beneficial partnership. "
            }
          }
        }
      ],
      "Received Emails with Sales Label": [
        {
          "json": {
            "id": "1903f41a3a4813f4",
            "to": {
              "html": "<span class=\"mp_address_group\"><span class=\"mp_address_name\">Mihai Farcas</span> &lt;<a href=\"mailto:farcasmihai91@gmail.com\" class=\"mp_address_email\">farcasmihai91@gmail.com</a>&gt;</span>",
              "text": "\"Mihai Farcas\" <farcasmihai91@gmail.com>",
              "value": [
                {
                  "name": "Mihai Farcas",
                  "address": "farcasmihai91@gmail.com"
                }
              ]
            },
            "date": "2024-06-22T09:23:01.000Z",
            "from": {
              "html": "<span class=\"mp_address_group\"><span class=\"mp_address_name\">Mihai Farcas</span> &lt;<a href=\"mailto:contact@mihai.ltd\" class=\"mp_address_email\">contact@mihai.ltd</a>&gt;</span>",
              "text": "\"Mihai Farcas\" <contact@mihai.ltd>",
              "value": [
                {
                  "name": "Mihai Farcas",
                  "address": "contact@mihai.ltd"
                }
              ]
            },
            "html": "<div dir=\"ltr\"><p>Dear Alex,</p><p>I hope this email finds you well.</p><p>My name is Mihai Farcas, and I&#39;m the Procurement Manager at Innovative Solutions Inc. We are a leading provider of cutting-edge technological solutions for businesses across various industries.</p><p>I&#39;m reaching out to you today to express our strong interest in your company&#39;s CloudConnect Pro platform. We&#39;ve been thoroughly impressed by its capabilities in cloud integration, data management, and overall flexibility. Our research indicates that it could be an excellent fit for our clients&#39; needs, particularly in the areas of streamlining workflows and enhancing data accessibility.</p><p>We are currently exploring the possibility of incorporating CloudConnect Pro into our upcoming projects. To this end, we would appreciate it if you could provide us with detailed information on pricing, implementation options, and support services for enterprise-level deployments.  Additionally, any case studies or testimonials from companies similar to ours would be most welcome.</p><p>Given the urgency of our projects, a prompt response would be greatly appreciated. We are eager to learn more about how CloudConnect Pro can contribute to our success and look forward to the possibility of a mutually beneficial partnership.</p><p>Thank you for your time and consideration.</p><p><br></p><p>Sincerely,</p><p>Mihai Farcas</p><p>Procurement Manager</p><p>Innovative Solutions Inc.</p></div>\n",
            "text": "Dear Alex,\n\nI hope this email finds you well.\n\nMy name is Mihai Farcas, and I'm the Procurement Manager at Innovative\nSolutions Inc. We are a leading provider of cutting-edge technological\nsolutions for businesses across various industries.\n\nI'm reaching out to you today to express our strong interest in your\ncompany's CloudConnect Pro platform. We've been thoroughly impressed by its\ncapabilities in cloud integration, data management, and overall\nflexibility. Our research indicates that it could be an excellent fit for\nour clients' needs, particularly in the areas of streamlining workflows and\nenhancing data accessibility.\n\nWe are currently exploring the possibility of incorporating CloudConnect\nPro into our upcoming projects. To this end, we would appreciate it if you\ncould provide us with detailed information on pricing, implementation\noptions, and support services for enterprise-level deployments.\nAdditionally, any case studies or testimonials from companies similar to\nours would be most welcome.\n\nGiven the urgency of our projects, a prompt response would be greatly\nappreciated. We are eager to learn more about how CloudConnect Pro can\ncontribute to our success and look forward to the possibility of a mutually\nbeneficial partnership.\n\nThank you for your time and consideration.\n\n\nSincerely,\n\nMihai Farcas\n\nProcurement Manager\n\nInnovative Solutions Inc.\n",
            "headers": {
              "to": "To: Mihai Farcas <farcasmihai91@gmail.com>",
              "date": "Date: Sat, 22 Jun 2024 12:23:01 +0300",
              "from": "From: Mihai Farcas <contact@mihai.ltd>",
              "subject": "Subject: Urgent Inquiry for CloudConnect Pro Integration",
              "message-id": "Message-ID: <CAGDzDQR5BWWjU40G26dg4AZuiMKZ5b0GtdUyn-2FbfMFs2yJwg@mail.gmail.com>",
              "content-type": "Content-Type: multipart/alternative; boundary=\"00000000000064dc5b061b7718a6\"",
              "mime-version": "MIME-Version: 1.0"
            },
            "subject": "Urgent Inquiry for CloudConnect Pro Integration",
            "labelIds": [
              "Label_8035866011660570111",
              "IMPORTANT",
              "SENT",
              "INBOX"
            ],
            "threadId": "1903f3f36f29657c",
            "messageId": "<CAGDzDQR5BWWjU40G26dg4AZuiMKZ5b0GtdUyn-2FbfMFs2yJwg@mail.gmail.com>",
            "textAsHtml": "<p>Dear Alex,</p><p>I hope this email finds you well.</p><p>My name is Mihai Farcas, and I&apos;m the Procurement Manager at Innovative<br/>Solutions Inc. We are a leading provider of cutting-edge technological<br/>solutions for businesses across various industries.</p><p>I&apos;m reaching out to you today to express our strong interest in your<br/>company&apos;s CloudConnect Pro platform. We&apos;ve been thoroughly impressed by its<br/>capabilities in cloud integration, data management, and overall<br/>flexibility. Our research indicates that it could be an excellent fit for<br/>our clients&apos; needs, particularly in the areas of streamlining workflows and<br/>enhancing data accessibility.</p><p>We are currently exploring the possibility of incorporating CloudConnect<br/>Pro into our upcoming projects. To this end, we would appreciate it if you<br/>could provide us with detailed information on pricing, implementation<br/>options, and support services for enterprise-level deployments.<br/>Additionally, any case studies or testimonials from companies similar to<br/>ours would be most welcome.</p><p>Given the urgency of our projects, a prompt response would be greatly<br/>appreciated. We are eager to learn more about how CloudConnect Pro can<br/>contribute to our success and look forward to the possibility of a mutually<br/>beneficial partnership.</p><p>Thank you for your time and consideration.</p><p>Sincerely,</p><p>Mihai Farcas</p><p>Procurement Manager</p><p>Innovative Solutions Inc.</p>",
            "sizeEstimate": 3554
          }
        }
      ]
    },
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "8c905538-5613-464b-b5a0-87e266a507c7",
    "connections": {
      "OpenAI Model": {
        "ai_languageModel": [
          [
            {
              "node": "Summarize Email Content",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Summarize Email Content": {
        "main": [
          [
            {
              "node": "Odoo - Create Opportunity",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Received Emails with Sales Label": {
        "main": [
          [
            {
              "node": "Summarize Email Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "Lwvu2jjMU2irTyAY",
    "meta": {
      "instanceId": "fb924c73af8f703905bc09c9ee8076f48c17b596ed05b18c0ff86915ef8a7c4a"
    },
    "name": "Summarize Google Sheets form feedback via OpenAI's GPT-4",
    "tags": [
      {
        "id": "y9tvM3hISJKT2jeo",
        "name": "Ted's Tech Talks",
        "createdAt": "2023-08-15T22:12:34.260Z",
        "updatedAt": "2023-08-15T22:12:34.260Z"
      }
    ],
    "nodes": [
      {
        "id": "cd80cd2f-a6e1-48eb-ba05-0f8f1a0875e5",
        "name": "When clicking \"Test workflow\"",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          680,
          320
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "9f03f1c4-c47e-4eda-bc0a-a598c21e4616",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          640,
          130
        ],
        "parameters": {
          "width": 369.1031874662338,
          "height": 349,
          "content": "### 1. Create a Google Sheet document\n* This tutorial uses Google Sheet document connected to Google Forms, but a standalone Sheet document will work too\n* Adapt initial trigger to your needs: run manually or at some time intervals\n\n[Link to the Google Sheets template](https://docs.google.com/spreadsheets/d/1Kcr1oF_RrfNQJczmJDpwClOSYpvSnwbeX-_pdUo91-I/edit?usp=sharing)"
        },
        "typeVersion": 1
      },
      {
        "id": "1e478f81-76e7-4fc3-a147-11a92d3f9998",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1040,
          160
        ],
        "parameters": {
          "width": 394,
          "height": 319,
          "content": "### 2. Combine all answers into an array\n* Since the main goal is to provide an overall summary, we need to combine all answers for each Google Form question\n* Aggregate Node takes multiple incoming items and produces just a single item which contains arrays of user feedback"
        },
        "typeVersion": 1
      },
      {
        "id": "1ab06b51-3b9e-4a4c-afba-c98e529a636c",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1480,
          160
        ],
        "parameters": {
          "width": 432,
          "height": 319,
          "content": "### 3. Generate a summary report\n* Enter a __system message__ with a overall instructions on how to analyze the feedback form\n* Provide a __user message__ with JSON arrays.\n\n__NB! Consider splitting the form questions for a very long forms or when the number of responses is too high__"
        },
        "typeVersion": 1
      },
      {
        "id": "ce0118a3-4eaf-4d60-adf0-5bde5d41328a",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1940,
          160
        ],
        "parameters": {
          "width": 359.1031874662346,
          "height": 319,
          "content": "### 4. Convert to HTML and send an email\n* GPT is configured to reply in Markdown format. Markdown Node converts such text into HTML\n* Finally, the Gmail node sends a message with HTML report"
        },
        "typeVersion": 1
      },
      {
        "id": "37bc8ab5-328c-4f50-bbda-f7482bf36522",
        "name": "Get Google Sheets records",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          860,
          320
        ],
        "parameters": {
          "options": {},
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 2035968519,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Kcr1oF_RrfNQJczmJDpwClOSYpvSnwbeX-_pdUo91-I/edit#gid=2035968519",
            "cachedResultName": "Form Responses 1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1Kcr1oF_RrfNQJczmJDpwClOSYpvSnwbeX-_pdUo91-I",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Kcr1oF_RrfNQJczmJDpwClOSYpvSnwbeX-_pdUo91-I/edit?usp=drivesdk",
            "cachedResultName": "Event feedback form (Responses)"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "RtRiRezoxiWkzZQt",
            "name": "Ted's Tech Talks Google account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "d75b11b1-2cce-40c2-ab5a-d18fdf7f5283",
        "name": "Aggregate responses into arrays",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          1200,
          320
        ],
        "parameters": {
          "options": {},
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "['What went great?']"
              },
              {
                "fieldToAggregate": "['How can we improve?']"
              },
              {
                "fieldToAggregate": "['What is the chance of recommending our event?']"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a90f83fe-809b-42db-b65d-43fb11b2979a",
        "name": "Summarize via GPT model",
        "type": "n8n-nodes-base.openAi",
        "position": [
          1620,
          320
        ],
        "parameters": {
          "prompt": {
            "messages": [
              {
                "role": "system",
                "content": "Your task is to summarize event feedback form responses. You will receive answers on three questions:\n1. What went great?\n2. How can we improve?\n3. What is the chance of recommending our event?\n\nEach questions has several answers separated by | character.\nAnalyze each question and prepare a summary report. It should contain an overall sentiment regarding the event, followed by the constructive ideas of what to improve.\n\nReply in Markdown formatting"
              },
              {
                "content": "=1. What went great: ```{{ $json['What went great?'].join(' | ') }}```\n2. How can we improve: ```{{ $json['How can we improve?'].join(' | ') }}```\n3. What is the chance of recommending our event: ```{{ $json['What is the chance of recommending our event?'].join(' | ') }}```"
              }
            ]
          },
          "options": {
            "temperature": 0.3
          },
          "resource": "chat",
          "chatModel": "gpt-4-turbo-preview"
        },
        "credentials": {
          "openAiApi": {
            "id": "rveqdSfp7pCRON1T",
            "name": "Ted's Tech Talks OpenAi"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "2c8d4e46-9d3e-4655-952b-37d04f673914",
        "name": "Convet from Markdown to HTML",
        "type": "n8n-nodes-base.markdown",
        "position": [
          1980,
          320
        ],
        "parameters": {
          "mode": "markdownToHtml",
          "options": {
            "completeHTMLDocument": false
          },
          "markdown": "={{ $json.message.content }}"
        },
        "typeVersion": 1
      },
      {
        "id": "a27d8664-dc87-4458-9f12-970b88ab6515",
        "name": "Send via Gmail",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2160,
          320
        ],
        "parameters": {
          "sendTo": "teds.tech.talks@gmail.com",
          "message": "={{ $json.data }}",
          "options": {
            "appendAttribution": false
          },
          "subject": "Feedback form response"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "UllrXlZsDnkdA3tT",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "756cdd85-49dd-4f0f-acc7-58f834a3512f",
    "connections": {
      "Summarize via GPT model": {
        "main": [
          [
            {
              "node": "Convet from Markdown to HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Google Sheets records": {
        "main": [
          [
            {
              "node": "Aggregate responses into arrays",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convet from Markdown to HTML": {
        "main": [
          [
            {
              "node": "Send via Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking \"Test workflow\"": {
        "main": [
          [
            {
              "node": "Get Google Sheets records",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate responses into arrays": {
        "main": [
          [
            {
              "node": "Summarize via GPT model",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "3c58c896c9089c8fb4d7f2b069bf3119193f239a1f538829758e2f4d6b5f5b24"
    },
    "nodes": [
      {
        "id": "ed18a0ab-ac62-469e-9490-d9fcf75b4606",
        "name": "Setup",
        "type": "n8n-nodes-base.set",
        "position": [
          -700,
          320
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "linkedInAPIKey"
              },
              {
                "name": "twitterAPIKey"
              },
              {
                "name": "emails"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "d6624796-3f59-4077-8d41-4418c869ad27",
        "name": "Every morning @ 7",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -940,
          320
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 7
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "1cb46dc8-c2b5-487c-a382-a5714686be50",
        "name": "Get meetings for today",
        "type": "n8n-nodes-base.googleCalendar",
        "position": [
          -300,
          320
        ],
        "parameters": {
          "options": {
            "timeMax": "={{ $today.plus({ days: 1 }) }}",
            "timeMin": "={{ $today.minus({ days: 3 }) }}",
            "singleEvents": true
          },
          "calendar": {
            "__rl": true,
            "mode": "list",
            "value": "milorad.filipovic19@gmail.com",
            "cachedResultName": "milorad.filipovic19@gmail.com"
          },
          "operation": "getAll"
        },
        "credentials": {
          "googleCalendarOAuth2Api": {
            "id": "22",
            "name": "Google Calendar account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "22167c9c-6dc2-41a8-a8b8-218643b943e5",
        "name": "Get attendees email domains",
        "type": "n8n-nodes-base.set",
        "position": [
          -80,
          320
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "domain",
                "type": "arrayValue",
                "arrayValue": "={{ $json.attendees.filter(a => !a.organizer).map(a => a.email.split('@').pop()) }}"
              },
              {
                "name": "attendeeEmails",
                "type": "arrayValue",
                "arrayValue": "={{ $json.attendees.filter(a => !a.organizer).map(a => a.email) }}"
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "271d0044-ceb1-4e3a-9a60-9c003cd4b198",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          140,
          320
        ],
        "parameters": {
          "include": "selectedOtherFields",
          "options": {},
          "fieldToSplitOut": "domain",
          "fieldsToInclude": "attendeeEmails, start"
        },
        "typeVersion": 1
      },
      {
        "id": "68041cd4-6dc3-4225-b39e-d227a3142e02",
        "name": "Get recent LinkedIn posts",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -20,
          540
        ],
        "parameters": {
          "url": "https://fresh-linkedin-profile-data.p.rapidapi.com/get-company-posts",
          "options": {
            "batching": {
              "batch": {}
            }
          },
          "sendQuery": true,
          "sendHeaders": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "linkedin_url",
                "value": "=https://www.linkedin.com/{{ $json.linkedin.handle }}"
              },
              {
                "name": "sort_by",
                "value": "recent"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "X-RapidAPI-Key",
                "value": "={{ $('Setup').item.json.linkedInAPIKey }}"
              },
              {
                "name": "X-RapidAPI-Host",
                "value": "fresh-linkedin-profile-data.p.rapidapi.com"
              }
            ]
          }
        },
        "typeVersion": 4.1
      },
      {
        "id": "bcbc845c-dd69-491e-b18d-7e1cd73d94b4",
        "name": "Enrich attendee company",
        "type": "n8n-nodes-base.clearbit",
        "position": [
          580,
          320
        ],
        "parameters": {
          "domain": "={{ $json.domain }}",
          "additionalFields": {}
        },
        "credentials": {
          "clearbitApi": {
            "id": "tuwO0i7CavIt5j8X",
            "name": "Clearbit account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a928a47a-c7be-4b08-ae78-05541963bf0e",
        "name": "Gmail",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1360,
          640
        ],
        "parameters": {
          "sendTo": "={{ $('Setup').first().json.emails }}",
          "message": "={{ $json.html }}",
          "options": {},
          "subject": "=Latest social activity for: {{ $('Wrap everything together').item.json.name }}"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "10",
            "name": "mrdosija@gmail.com"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "cc82d1ef-5601-4844-b2c1-91cb7d16c080",
        "name": "Combine all activity for a company",
        "type": "n8n-nodes-base.merge",
        "position": [
          460,
          620
        ],
        "parameters": {
          "mode": "combine",
          "options": {
            "clashHandling": {
              "values": {
                "resolveClash": "preferInput2"
              }
            }
          },
          "joinMode": "keepEverything",
          "mergeByFields": {
            "values": [
              {
                "field1": "name",
                "field2": "name"
              }
            ]
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "d0843f1d-173c-4c6a-8ef7-be122551ce03",
        "name": "Extract data for email",
        "type": "n8n-nodes-base.set",
        "position": [
          680,
          800
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "attendeeEmail",
                "stringValue": "={{ $json.meeting.attendeeEmails.find(a => a.endsWith($json.meeting.domain)) }}"
              },
              {
                "name": "startHour",
                "type": "numberValue",
                "numberValue": "={{ DateTime.fromISO($json.meeting.start.dateTime).hour }}"
              },
              {
                "name": "startMinute",
                "type": "numberValue",
                "numberValue": "={{ DateTime.fromISO($json.meeting.start.dateTime).minute }}"
              }
            ]
          },
          "include": "selected",
          "options": {},
          "includeFields": "name, html_twitter, html_linkedin"
        },
        "typeVersion": 3.2
      },
      {
        "id": "7bbb4100-7529-4b33-8301-6e312e15d0c3",
        "name": "Prepare email template",
        "type": "n8n-nodes-base.html",
        "position": [
          1140,
          640
        ],
        "parameters": {
          "html": "<!DOCTYPE html>\n\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n\n</head>\n<body>\n  <div class=\"container\">\n     <h2 style=\"font-size: 1.2em\">\n      üóìÔ∏è Meeting with <span>{{ $json.attendeeEmail }}</span>\n       at {{ $json.startHour }}:{{ $json.startMinute < 10 ? `0${$json.startMinute}` : $json.startMinute }}h\n       <h3>Here's a quick summary of {{ $json.name }}'s recent social media activities</h3>\n       <p class=\"summary\">\n         {{ $json.message.content }}\n       </p>\n    </h2>\n\n  </div>\n</body>\n</html>\n\n<style>\n.container {\n  font-family: sans-serif;\n}\n\n.summary {\n  background-color: #f7f9fc; \n  font-family: sans-serif; \n  padding: 0.3em 1em\n}\n</style>"
        },
        "typeVersion": 1.1
      },
      {
        "id": "0ebfe036-0988-4775-bff4-1e52ba81fd12",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -773.5590877677955,
          50.38078783690389
        ],
        "parameters": {
          "color": 7,
          "width": 409.31582584657923,
          "height": 426.61520915049425,
          "content": "## Start here\n1Ô∏è‚É£ Register on [RapidAPI](https://rapidapi.com) and subscribe to these two APIs:\n- [Fresh LinkedIn Profile Data](https://rapidapi.com/freshdata-freshdata-default/api/fresh-linkedin-profile-data)\n- [Twitter](https://rapidapi.com/omarmhaimdat/api/twitter154)\n\n\n2Ô∏è‚É£ Set API keys for these two in `linkedInAPIKey` and `twitterAPIKey`fields of this node\n\n3Ô∏è‚É£ Set email addresses that should receive the list in the `emails` field of this node"
        },
        "typeVersion": 1
      },
      {
        "id": "3fcc1786-757f-49fd-842c-9f77c2a869a4",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -474,
          620
        ],
        "parameters": {
          "color": 7,
          "width": 334.90628250854803,
          "height": 282.9114150520537,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n‚ÑπÔ∏è If you need to get activities from more social media accounts found by ClearBit, they can be added here, just make sure to process them properly in separate switch node branches"
        },
        "typeVersion": 1
      },
      {
        "id": "0eb689e9-f347-482c-b6f3-de9913696eec",
        "name": "Keep only ones with the domain",
        "type": "n8n-nodes-base.filter",
        "position": [
          360,
          320
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "881d891e-ea17-4879-a5cf-72d08b281f56",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.domain }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "9c479fe7-b0da-402a-bc4e-1c52b0bcb677",
        "name": "Extract important data",
        "type": "n8n-nodes-base.set",
        "position": [
          220,
          540
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "linkedin_posts",
                "type": "arrayValue",
                "arrayValue": "={{ $input.item.json.data.slice(0, 10).map(d => { return { text: d.text, likes: d.num_likes, comments: d.num_comments, postedAt: d.posted } } ) }}"
              },
              {
                "name": "name",
                "stringValue": "={{ $('Switch').item.json.name }}"
              },
              {
                "name": "meeting",
                "type": "objectValue",
                "objectValue": "={{ $('Split Out').item.json }}"
              }
            ]
          },
          "include": "none",
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "4956210f-4797-4266-acb7-b80684f76052",
        "name": "Extract important data again",
        "type": "n8n-nodes-base.set",
        "position": [
          220,
          740
        ],
        "parameters": {
          "fields": {
            "values": [
              {
                "name": "twitter_posts",
                "type": "arrayValue",
                "arrayValue": "={{ $input.item.json.results.map(d => { return { text: d.text, favorites: d.favorite_count, retweets: d.retweet_count, replies: d.reply_count, postedAt: d.creationDate} }) }}"
              },
              {
                "name": "name",
                "stringValue": "={{ $('Switch').item.json.name }}"
              },
              {
                "name": "meeting",
                "type": "objectValue",
                "objectValue": "={{ $('Split Out').item.json }}"
              }
            ]
          },
          "include": "none",
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "fda56f50-ebc8-4259-9155-017f09a64f26",
        "name": "Ask AI to summerize",
        "type": "n8n-nodes-base.openAi",
        "position": [
          680,
          620
        ],
        "parameters": {
          "prompt": {
            "messages": [
              {
                "content": "=I am a sales representative in my company and I want to see social media activity for a company I am about to meet. I will give you a JSON object  containing company name, and lists of recent LinkedIn and X(Twitter) posts and your job is to give me a summary these posts. This summary needs to be in textual form suitable for email (just the content without the subject and should be impersonal) and should include details interested to a sales representative such as me. JSON data has the following properties: - 'name': Company name, - 'linkedin_posts': List of LinkedIn posts, - 'twitter_posts': List of Twitter posts, You can ignore all other properties in the JSON data. This is the data:\n{{ JSON.stringify($json) }}"
              }
            ]
          },
          "options": {},
          "resource": "chat",
          "chatModel": "gpt-4"
        },
        "credentials": {
          "openAiApi": {
            "id": "fN3KsfZMEf9qu6J6",
            "name": "OpenAi account 3"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "0c082a02-72b3-47d8-9a62-ca5973eed8be",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "position": [
          -260,
          640
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "linkedin",
                "conditions": {
                  "options": {
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.linkedin.handle !== null }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "twitter",
                "conditions": {
                  "options": {
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "bbb0310e-8b20-4bc6-a540-a4cd17470e28",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.twitter.id !== null }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {
            "allMatchingOutputs": true,
            "looseTypeValidation": false
          }
        },
        "typeVersion": 3
      },
      {
        "id": "e1cf0a2e-834b-4259-91e4-47e13c07c321",
        "name": "Wrap everything together",
        "type": "n8n-nodes-base.merge",
        "position": [
          940,
          640
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "combinationMode": "mergeByPosition"
        },
        "typeVersion": 2.1
      },
      {
        "id": "e45f33ec-6d67-4ae9-a450-5c300c8748b1",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          780,
          197.44186046511595
        ],
        "parameters": {
          "color": 5,
          "width": 738.9631933644362,
          "height": 399.8417061497098,
          "content": "### üì¨ You will receive one email for every company in your calendar. These emails will look something like this:\n\n![Email example](https://i.imgur.com/IP2Jw1F.png#full-width)"
        },
        "typeVersion": 1
      },
      {
        "id": "31d22fdc-aacf-4228-ac78-b8f05621c0e0",
        "name": "Get latest tweets",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -20,
          740
        ],
        "parameters": {
          "url": "https://twitter154.p.rapidapi.com/user/tweets",
          "options": {
            "batching": {
              "batch": {
                "batchSize": 1,
                "batchInterval": 2000
              }
            }
          },
          "sendQuery": true,
          "sendHeaders": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "limit",
                "value": "10"
              },
              {
                "name": "user_id",
                "value": "={{ $json.twitter.id }}"
              },
              {
                "name": "include_replies",
                "value": "={{ false }}"
              },
              {
                "name": "include_pinned",
                "value": "={{ false }}"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "X-RapidAPI-Host",
                "value": "twitter154.p.rapidapi.com"
              },
              {
                "name": "X-RapidAPI-Key",
                "value": "={{ $('Setup').first().json.twitterAPIKey }}"
              }
            ]
          }
        },
        "typeVersion": 4.1
      }
    ],
    "pinData": {},
    "connections": {
      "Setup": {
        "main": [
          [
            {
              "node": "Get meetings for today",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Get recent LinkedIn posts",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get latest tweets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Keep only ones with the domain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Every morning @ 7": {
        "main": [
          [
            {
              "node": "Setup",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get latest tweets": {
        "main": [
          [
            {
              "node": "Extract important data again",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ask AI to summerize": {
        "main": [
          [
            {
              "node": "Wrap everything together",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract data for email": {
        "main": [
          [
            {
              "node": "Wrap everything together",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Extract important data": {
        "main": [
          [
            {
              "node": "Combine all activity for a company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get meetings for today": {
        "main": [
          [
            {
              "node": "Get attendees email domains",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare email template": {
        "main": [
          [
            {
              "node": "Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Enrich attendee company": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wrap everything together": {
        "main": [
          [
            {
              "node": "Prepare email template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get recent LinkedIn posts": {
        "main": [
          [
            {
              "node": "Extract important data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get attendees email domains": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract important data again": {
        "main": [
          [
            {
              "node": "Combine all activity for a company",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Keep only ones with the domain": {
        "main": [
          [
            {
              "node": "Enrich attendee company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Combine all activity for a company": {
        "main": [
          [
            {
              "node": "Ask AI to summerize",
              "type": "main",
              "index": 0
            },
            {
              "node": "Extract data for email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "uAdVHL23IJrOK6rq",
    "meta": {
      "instanceId": "17e99dcb1ea433b75b4642e8bc83accaf7a2740c54d374c773b1bae2e7a647f9",
      "templateCredsSetupCompleted": true
    },
    "name": "Webflow -> Pipedrive",
    "tags": [
      {
        "id": "781s4D9v2JcEpUXK",
        "name": "template",
        "createdAt": "2025-06-23T19:00:47.921Z",
        "updatedAt": "2025-06-23T19:00:47.921Z"
      }
    ],
    "nodes": [
      {
        "id": "1cb2135d-277a-4833-a962-d46881a487b0",
        "name": "Webflow Trigger",
        "type": "n8n-nodes-base.webflowTrigger",
        "position": [
          -760,
          20
        ],
        "webhookId": "ee8dde3f-962a-4201-83fe-ce09ac638d22",
        "parameters": {
          "site": "685990e04a4dfd23668cab20"
        },
        "credentials": {
          "webflowOAuth2Api": {
            "id": "7iIodD2bqyahoeiC",
            "name": "Webflow account"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "8a15787e-0721-4db8-9511-e7b0ee2c51da",
        "name": "Pipedrive",
        "type": "n8n-nodes-base.pipedrive",
        "position": [
          760,
          0
        ],
        "parameters": {
          "term": "={{ $('Webflow Trigger').item.json.payload.data.Email }}",
          "resource": "person",
          "operation": "search",
          "additionalFields": {}
        },
        "credentials": {
          "pipedriveApi": {
            "id": "A7EjW0Zwif5vUM1c",
            "name": "Pipedrive account"
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": true
      },
      {
        "id": "e7fff24e-4087-4fae-9ce8-a63088fc321f",
        "name": "Person Exists?",
        "type": "n8n-nodes-base.if",
        "position": [
          1020,
          0
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "f23938f7-4df0-4df0-aa71-78c7cb4f52d3",
                "operator": {
                  "type": "object",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "ef577258-bf9d-4280-a027-a30258411fc0",
        "name": "Create Person",
        "type": "n8n-nodes-base.pipedrive",
        "position": [
          1420,
          100
        ],
        "parameters": {
          "name": "={{ $('Webflow Trigger').item.json.payload.data.Name }}",
          "resource": "person",
          "additionalFields": {
            "email": [
              "={{ $('Webflow Trigger').item.json.payload.data.Email }}"
            ],
            "org_id": "={{ $('Organization Exists?').item.json.id }}"
          }
        },
        "credentials": {
          "pipedriveApi": {
            "id": "A7EjW0Zwif5vUM1c",
            "name": "Pipedrive account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a43c7ae3-f09f-493b-b990-d11c32b25ddb",
        "name": "Add Note",
        "type": "n8n-nodes-base.pipedrive",
        "position": [
          1620,
          100
        ],
        "parameters": {
          "content": "=Form:  {{ $('Webflow Trigger').item.json.payload.name }}\nPage: {{ $('Webflow Trigger').item.json.payload.publishedPath }}",
          "resource": "note",
          "additionalFields": {
            "person_id": "={{ $json.id }}"
          }
        },
        "credentials": {
          "pipedriveApi": {
            "id": "A7EjW0Zwif5vUM1c",
            "name": "Pipedrive account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "16ec8feb-f526-4f4f-9546-0715015c117b",
        "name": "Create Lead",
        "type": "n8n-nodes-base.pipedrive",
        "position": [
          1840,
          100
        ],
        "parameters": {
          "title": "={{ $json.person.name }}",
          "resource": "lead",
          "person_id": "={{ $('Create Person').item.json.id }}",
          "associateWith": "person",
          "additionalFields": {}
        },
        "credentials": {
          "pipedriveApi": {
            "id": "A7EjW0Zwif5vUM1c",
            "name": "Pipedrive account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "332041fb-beb1-4973-bbe4-7263ca09074d",
        "name": "Add Note 2",
        "type": "n8n-nodes-base.pipedrive",
        "position": [
          1420,
          -80
        ],
        "parameters": {
          "content": "=Form:  {{ $('Webflow Trigger').item.json.payload.name }} \nPage: {{ $('Webflow Trigger').item.json.payload.publishedPath }}",
          "resource": "note",
          "additionalFields": {
            "person_id": "={{ $json.id }}"
          }
        },
        "credentials": {
          "pipedriveApi": {
            "id": "A7EjW0Zwif5vUM1c",
            "name": "Pipedrive account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "70dc530a-bd77-47a0-8c36-4414b0373c3a",
        "name": "Get Organization",
        "type": "n8n-nodes-base.pipedrive",
        "position": [
          -100,
          20
        ],
        "parameters": {
          "term": "={{ $json.website }}",
          "resource": "organization",
          "operation": "search",
          "additionalFields": {}
        },
        "credentials": {
          "pipedriveApi": {
            "id": "A7EjW0Zwif5vUM1c",
            "name": "Pipedrive account"
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": true
      },
      {
        "id": "1f1fd890-41e5-4914-b684-1ec10f265596",
        "name": "Organization Exists?",
        "type": "n8n-nodes-base.if",
        "position": [
          160,
          20
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "f23938f7-4df0-4df0-aa71-78c7cb4f52d3",
                "operator": {
                  "type": "object",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "d4775c6f-ede6-48d3-8842-94583288f927",
        "name": "Add Organization",
        "type": "n8n-nodes-base.pipedrive",
        "position": [
          440,
          160
        ],
        "parameters": {
          "name": "={{ $('Webflow Trigger').item.json.payload.data.Company }}",
          "resource": "organization",
          "additionalFields": {
            "customProperties": {
              "property": [
                {
                  "name": "71fc16c7e516e1e0b757e427454222ab2652f27e",
                  "value": "={{ $('Website').item.json.website }}"
                }
              ]
            }
          }
        },
        "credentials": {
          "pipedriveApi": {
            "id": "A7EjW0Zwif5vUM1c",
            "name": "Pipedrive account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "514578ab-052c-4a4d-9f64-225a939e71d6",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -480,
          -120
        ],
        "parameters": {
          "color": 6,
          "width": 260,
          "height": 480,
          "content": "## 1. Extract website from email\nWe will first split the email into 2 parts to extract the website."
        },
        "typeVersion": 1
      },
      {
        "id": "71ac9e5a-9d40-44a9-a56b-5aec18cdc900",
        "name": "Website",
        "type": "n8n-nodes-base.code",
        "position": [
          -420,
          20
        ],
        "parameters": {
          "jsCode": "return {website: $input.first().json.payload.data.Email.split(\"@\")[1]}"
        },
        "typeVersion": 2
      },
      {
        "id": "a113e82f-1558-49a6-9841-890313ea8dde",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -200,
          -120
        ],
        "parameters": {
          "color": 4,
          "width": 880,
          "height": 480,
          "content": "## 2. Check if the organization already exists\nUsing the extracted website, we check if the organization already exists in Pipedrive.\n- If it does not exist, we create it.\n- Otherwise, we move to the next step."
        },
        "typeVersion": 1
      },
      {
        "id": "660f9518-c737-4adc-86c5-ebff6a23508e",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          700,
          -120
        ],
        "parameters": {
          "color": 5,
          "width": 1380,
          "height": 480,
          "content": "## 3. Check if the person already exists\n- If it exists, add a note to record the submission event.\n- If it does not exist, create the person, add a note to record the submission event, and create a lead."
        },
        "typeVersion": 1
      },
      {
        "id": "3a56b855-c59b-439f-9b76-652e64bbe1b8",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1340,
          -120
        ],
        "parameters": {
          "width": 400,
          "height": 1380,
          "content": "This n8n template automates the process of capturing leads from Webflow form submissions and syncing them with your Pipedrive CRM. It ensures that each submission is accurately associated with the correct organization and contact in Pipedrive, streamlining lead management and minimizing duplicates.\n\n## Use cases include:\nSales teams that want to automate CRM data entry, marketing teams capturing qualified leads from landing pages, or any business looking to improve their Webflow-to-CRM integration workflow.\n\n## Good to know\n- The workflow assumes that Webflow form submissions include the lead‚Äôs email address.\n\n- The domain is extracted from the email to match or create the organization in Pipedrive.\n\n- This template does not handle lead scoring or enrichment, but can be extended for such use-cases.\n\n## How it works\n\n1. Extract website from email\nThe email is split to extract the domain (e.g., jane@company.com ‚Üí company.com), which is used to search for existing organizations.\n\n2. Check if the organization exists\nThe Pipedrive API is queried using the domain. If the organization exists, we proceed. If not, a new organization is created.\n\n3. Check if the person exists\n-- If the person already exists in Pipedrive, a note is added to their activities to log the form submission.\n-- If the person does not exist, a new person is created, a note is added to the person, and a new lead is created.\n\n4. (Optional) Add your own actions\nYou can extend this workflow to trigger Slack notifications, email follow-ups, or internal dashboards.\n\n## How to use\nStart with the manual trigger node, or replace it with a webhook to connect directly to Webflow form submissions in real-time.\n\n## Requirements\n- Webflow form integration (via webhook or other method)\n- Pipedrive account and API key\n\n## Customising this workflow\nYou can add enrichment services to auto-fill job titles or LinkedIn profiles. Perfect for growing sales pipelines without manual CRM input."
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {
      "Webflow Trigger": [
        {
          "json": {
            "payload": {
              "id": "6859a33ce8bc5381957ead84",
              "data": {
                "Name": "John Doe 3",
                "Email": "john+doe3@doe.com",
                "Company": "Doe, Inc."
              },
              "name": "Email Form",
              "formId": "685991e93b863ab8fbe16de1",
              "pageId": "685990e04a4dfd23668cab42",
              "schema": [
                {
                  "fieldName": "Name",
                  "fieldType": "FormTextInput",
                  "fieldElementId": "d4b5a1a1-321a-b624-bf2f-09a44a69531d"
                },
                {
                  "fieldName": "Company",
                  "fieldType": "FormTextInput",
                  "fieldElementId": "afce08ff-f75f-805c-c1e2-6b5b4beeabd1"
                },
                {
                  "fieldName": "Email",
                  "fieldType": "FormTextInput",
                  "fieldElementId": "d4b5a1a1-321a-b624-bf2f-09a44a695320"
                }
              ],
              "siteId": "685990e04a4dfd23668cab20",
              "submittedAt": "2025-06-23T18:55:54.068Z",
              "formElementId": "d4b5a1a1-321a-b624-bf2f-09a44a69531a",
              "publishedPath": "/"
            },
            "triggerType": "form_submission"
          }
        }
      ]
    },
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "23e3f223-453f-4751-91c2-59571268d948",
    "connections": {
      "Website": {
        "main": [
          [
            {
              "node": "Get Organization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Note": {
        "main": [
          [
            {
              "node": "Create Lead",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pipedrive": {
        "main": [
          [
            {
              "node": "Person Exists?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Lead": {
        "main": [
          []
        ]
      },
      "Create Person": {
        "main": [
          [
            {
              "node": "Add Note",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Person Exists?": {
        "main": [
          [
            {
              "node": "Add Note 2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Create Person",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webflow Trigger": {
        "main": [
          [
            {
              "node": "Website",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Organization": {
        "main": [
          [
            {
              "node": "Pipedrive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Organization": {
        "main": [
          [
            {
              "node": "Organization Exists?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Organization Exists?": {
        "main": [
          [
            {
              "node": "Pipedrive",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Add Organization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "iRaDuebfCVnNBqF1",
    "meta": {
      "instanceId": "3a7e7b7e92e2049f5f0691e88d182013a2c9726f7e3a108e2a76cf49a18f7456",
      "templateCredsSetupCompleted": true
    },
    "name": "Sync NetSuite Customers to Salesforce Accounts and Contacts",
    "tags": [],
    "nodes": [
      {
        "id": "517d49d4-bfb1-427e-98b2-1e45965c5311",
        "name": "Is Company?",
        "type": "n8n-nodes-base.if",
        "position": [
          1056,
          -160
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "b551567c-df5c-4d02-86a0-82752d35df2b",
                "operator": {
                  "type": "boolean",
                  "operation": "false",
                  "singleValue": true
                },
                "leftValue": "={{ $json.isPerson }}",
                "rightValue": "false"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "14529f4d-5bb7-492b-aefd-195d2541e002",
        "name": "NS: Customer - Get record",
        "type": "n8n-nodes-netsuite-rest.netSuiteRest",
        "position": [
          672,
          -160
        ],
        "parameters": {
          "id": "={{ $json.id }}",
          "resource": "Customer",
          "operation": "get /customer/{id}",
          "additionalFields": {}
        },
        "credentials": {
          "netSuiteRestOAuth2Api": {
            "id": "yBU7WCFQjxMU2Crj",
            "name": "NetSuite REST account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "709bf40e-3ac7-4108-8683-5e91564bf05d",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1344,
          -544
        ],
        "parameters": {
          "width": 460,
          "height": 960,
          "content": "### This n8n template demonstrates how to export NetSuite Customers and Upsert into Salesforce.\n\n### How it works\n* Workflow processes 20 records per iteration until there are no records left.\n* To find unique records - NetSuite Internal Id is used in Salesforce as External Id.\n* If record in NetSuite is a company - it is created/updated as Salesforce Account.\n* If record in NetSuite is an individual - it is created/updated as Salesforce Account and Salesforce Contact (with Account as parent record).\n\n\n### How to use\n* Set up NetSuite and Salesforce connections.\n* The 'Execute Workflow Daily' node is used as an example but feel free to replace it with any other trigger.\n* Run the flow manually to process all records. Non-existing records will be created, all existing - updated.\n* After running workflow manually - you can set up schedule to run the flow. To process only records updated after last workflow run date - switch 'NS: Customer - Get All records' node with 'NS: Customer - Get Delta records'\n\n\n### Requirements\n* Salesforce connection working and External Id field exists.\n* NetSuite connection working. Please refer to the details provided in [NetSuite REST Node description](https://www.npmjs.com/package/n8n-nodes-netsuite-rest).\n\n### Note\n* When running a workflow with Schedule trigger - on a first run workflow will use {today} date as a last export date.\n* Currently workflow uses NetSuite REST community node   and can run on self-hosted n8n instance only.\n\n### Need Help?\nFeel free to reach out to support@entechsolutions.com\n\nHappy Integrating!"
        },
        "typeVersion": 1
      },
      {
        "id": "79637b70-9586-473b-a053-fc54bcf931c5",
        "name": "SF: Create or Update Company Account",
        "type": "n8n-nodes-base.salesforce",
        "position": [
          1552,
          -256
        ],
        "parameters": {
          "name": "={{ $json.companyName }}",
          "resource": "account",
          "operation": "upsert",
          "externalId": "External_ID__c",
          "externalIdValue": "={{ $json.id }}",
          "additionalFields": {}
        },
        "credentials": {
          "salesforceOAuth2Api": {
            "id": "AomShl0rpiUu4La4",
            "name": "Salesforce account"
          }
        },
        "executeOnce": false,
        "retryOnFail": false,
        "typeVersion": 1
      },
      {
        "id": "03827337-fcd9-4c53-a427-0b65d21fce57",
        "name": "SF: Create or Update Contact",
        "type": "n8n-nodes-base.salesforce",
        "position": [
          1664,
          -48
        ],
        "parameters": {
          "lastname": "={{ $('Is Company?').item.json.lastName }}",
          "resource": "contact",
          "operation": "upsert",
          "externalId": "External_ID__c",
          "externalIdValue": "={{ $json.id }}",
          "additionalFields": {
            "email": "={{ $('Is Company?').item.json.email }}",
            "firstName": "={{ $('Is Company?').item.json.firstName }}",
            "acconuntId": "={{ $json.id }}"
          }
        },
        "credentials": {
          "salesforceOAuth2Api": {
            "id": "AomShl0rpiUu4La4",
            "name": "Salesforce account"
          }
        },
        "executeOnce": false,
        "retryOnFail": false,
        "typeVersion": 1
      },
      {
        "id": "21e2e2f6-f9e6-4c66-a6a0-33cc5c8aa4c8",
        "name": "SF: Create or Update Person's Account",
        "type": "n8n-nodes-base.salesforce",
        "position": [
          1440,
          -48
        ],
        "parameters": {
          "name": "={{ $json.firstName + ' ' + $json.lastName}}",
          "resource": "account",
          "operation": "upsert",
          "externalId": "External_ID__c",
          "externalIdValue": "={{ $json.id }}",
          "additionalFields": {}
        },
        "credentials": {
          "salesforceOAuth2Api": {
            "id": "AomShl0rpiUu4La4",
            "name": "Salesforce account"
          }
        },
        "executeOnce": false,
        "retryOnFail": false,
        "typeVersion": 1
      },
      {
        "id": "3e3b7363-ac9b-44f1-900b-d493a9db597e",
        "name": "Split Customers Array",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          448,
          -160
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "items"
        },
        "typeVersion": 1
      },
      {
        "id": "b4e45f33-2385-472d-b619-b45b3bbad8c8",
        "name": "Merge Company/Contact Results",
        "type": "n8n-nodes-base.merge",
        "position": [
          2048,
          -144
        ],
        "parameters": {},
        "typeVersion": 3.2
      },
      {
        "id": "a88430cf-850b-4ee7-bda3-035d65f160bf",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1312,
          -416
        ],
        "parameters": {
          "color": 5,
          "width": 592,
          "height": 560,
          "content": "## Salesforce section\n\n### Records are inserted/updated into Salesforce here"
        },
        "typeVersion": 1
      },
      {
        "id": "e4accef6-6a08-4a36-8100-32e831bffd59",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          96,
          -416
        ],
        "parameters": {
          "color": 7,
          "width": 784,
          "height": 496,
          "content": "## Netsuite section\n\n### Records are pulled from NetSuite here\n\n### Fell free to use filter with Q parameter passed in 'NS: Customer - Get records' step\nFor example - email START_WITH barbara\n\nRead about using Q parameter in [NetSuite Docs](https://docs.oracle.com/en/cloud/saas/netsuite/ns-online-help/section_1545222128.html)"
        },
        "typeVersion": 1
      },
      {
        "id": "19070186-030e-44bb-a9ff-8b5a474cee3f",
        "name": "Workflow is finished",
        "type": "n8n-nodes-base.noOp",
        "position": [
          256,
          368
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "7102959c-8f8b-4cd7-bfda-c33b150156ea",
        "name": "Has More Records?",
        "type": "n8n-nodes-base.if",
        "position": [
          -320,
          -96
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "da799032-1cc2-421d-91cd-4eb174744162",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{ $json.hasMore }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "7a88c79c-142b-47c1-b690-1b7ea4d30db8",
        "name": "Retrieve Paging Offset and LastExportDate",
        "type": "n8n-nodes-base.code",
        "position": [
          -96,
          -160
        ],
        "parameters": {
          "jsCode": "const workflowStaticData = $getWorkflowStaticData('global');\nconst lastExportDate = workflowStaticData.lastExportDate ? workflowStaticData.lastExportDate : $today.minus({days: 1}).toFormat('MM/dd/yyyy')\n\nreturn [\n  {\n      offset: workflowStaticData.offset,\n      lastExportDate: lastExportDate\n  }\n];"
        },
        "typeVersion": 2
      },
      {
        "id": "3eaa9173-d196-400f-853c-49f4a7f13847",
        "name": "Update Paging Offset and LastExportDate",
        "type": "n8n-nodes-base.code",
        "position": [
          2272,
          -80
        ],
        "parameters": {
          "jsCode": "const workflowStaticData = $getWorkflowStaticData('global');\n\nworkflowStaticData.offset = workflowStaticData.offset+20\nworkflowStaticData.hasMore = $('NS: Customer - Get All records').isExecuted ? $('NS: Customer - Get All records').first().json.hasMore: $('NS: Customer - Get Delta records').first().json.hasMore\n\nreturn [\n  {\n      offset: workflowStaticData.offset,\n      hasMore: workflowStaticData.hasMore\n  }\n];"
        },
        "typeVersion": 2
      },
      {
        "id": "fe7f6315-dcba-4e31-ad10-cf8856633b6a",
        "name": "Execute Workflow Daily",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -768,
          -96
        ],
        "parameters": {
          "rule": {
            "interval": [
              {}
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "66e23779-e65f-4659-905f-c931167b8b0d",
        "name": "Init Offset",
        "type": "n8n-nodes-base.code",
        "position": [
          -544,
          -96
        ],
        "parameters": {
          "jsCode": "// initialize staticData object\nconst workflowStaticData = $getWorkflowStaticData('global');\n\nworkflowStaticData.offset = 0\nworkflowStaticData.hasMore = true\n\nreturn [\n  {\n      offset: workflowStaticData.offset,\n      hasMore: workflowStaticData.hasMore\n  }\n];"
        },
        "typeVersion": 2
      },
      {
        "id": "d85c4562-19c4-4eaa-8486-207332facfe1",
        "name": "NS: Customer - Get Delta records",
        "type": "n8n-nodes-netsuite-rest.netSuiteRest",
        "position": [
          224,
          -656
        ],
        "parameters": {
          "resource": "Customer",
          "isDebugMode": true,
          "additionalFields": {
            "q": "=lastModifiedDate ON_OR_AFTER \"{{ $json.lastExportDate }}\"",
            "limit": 20,
            "offset": "={{ $json.offset }}"
          }
        },
        "credentials": {
          "netSuiteRestOAuth2Api": {
            "id": "yBU7WCFQjxMU2Crj",
            "name": "NetSuite REST account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a42909a2-1cfd-49fe-8461-e42f665e744f",
        "name": "NS: Customer - Get All records",
        "type": "n8n-nodes-netsuite-rest.netSuiteRest",
        "position": [
          208,
          -160
        ],
        "parameters": {
          "resource": "Customer",
          "isDebugMode": true,
          "additionalFields": {
            "limit": 20,
            "offset": "={{ $json.offset }}"
          }
        },
        "credentials": {
          "netSuiteRestOAuth2Api": {
            "id": "yBU7WCFQjxMU2Crj",
            "name": "NetSuite REST account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "e8b078e6-099c-46e7-ae9d-5400d8355614",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          96,
          -912
        ],
        "parameters": {
          "width": 368,
          "height": 480,
          "content": "## Run for Delta records\n\n### Replace a 'NS: Customer - Get All records' node with a node below to run flow only for records changed after Last Workflow Run"
        },
        "typeVersion": 1
      },
      {
        "id": "9cd4dfd7-b24b-4752-84d3-cb44ba02078e",
        "name": "Update LastExportDate",
        "type": "n8n-nodes-base.code",
        "position": [
          48,
          368
        ],
        "parameters": {
          "jsCode": "const workflowStaticData = $getWorkflowStaticData('global');\n\nworkflowStaticData.lastExportDate = DateTime.now().toFormat('MM/dd/yyyy')\n\nreturn [\n  {\n      lastExportDate: workflowStaticData.lastExportDate\n  }\n];"
        },
        "typeVersion": 2
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "d2eda63c-ab7d-4564-bf5d-084e70e37146",
    "connections": {
      "Init Offset": {
        "main": [
          [
            {
              "node": "Has More Records?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Company?": {
        "main": [
          [
            {
              "node": "SF: Create or Update Company Account",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "SF: Create or Update Person's Account",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has More Records?": {
        "main": [
          [
            {
              "node": "Retrieve Paging Offset and LastExportDate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update LastExportDate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Customers Array": {
        "main": [
          [
            {
              "node": "NS: Customer - Get record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update LastExportDate": {
        "main": [
          [
            {
              "node": "Workflow is finished",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Workflow Daily": {
        "main": [
          [
            {
              "node": "Init Offset",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NS: Customer - Get record": {
        "main": [
          [
            {
              "node": "Is Company?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SF: Create or Update Contact": {
        "main": [
          [
            {
              "node": "Merge Company/Contact Results",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge Company/Contact Results": {
        "main": [
          [
            {
              "node": "Update Paging Offset and LastExportDate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NS: Customer - Get All records": {
        "main": [
          [
            {
              "node": "Split Customers Array",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NS: Customer - Get Delta records": {
        "main": [
          []
        ]
      },
      "SF: Create or Update Company Account": {
        "main": [
          [
            {
              "node": "Merge Company/Contact Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SF: Create or Update Person's Account": {
        "main": [
          [
            {
              "node": "SF: Create or Update Contact",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Paging Offset and LastExportDate": {
        "main": [
          [
            {
              "node": "Has More Records?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retrieve Paging Offset and LastExportDate": {
        "main": [
          [
            {
              "node": "NS: Customer - Get All records",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "xWJadnVEYEmfvsH5",
    "meta": {
      "instanceId": "88804d8e264d231c18413147cc92e4245b20ae7b97d774bad847556f645c8192",
      "templateCredsSetupCompleted": true
    },
    "name": "Advanced WooCommerce Product Reconciliation & Synchronization",
    "tags": [],
    "nodes": [
      {
        "id": "359efd1f-8b53-4856-aa26-48103897473d",
        "name": "Get many products",
        "type": "n8n-nodes-base.wooCommerce",
        "position": [
          256,
          -144
        ],
        "parameters": {
          "options": {
            "search": "={{ $json.Name }}"
          },
          "operation": "getAll"
        },
        "credentials": {
          "wooCommerceApi": {
            "id": "LwI8wvOrr3sPSHLk",
            "name": "WooCommerce account"
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": true
      },
      {
        "id": "5d014a7c-5952-41de-8be2-08435144fab4",
        "name": "Update a product",
        "type": "n8n-nodes-base.wooCommerce",
        "onError": "continueErrorOutput",
        "position": [
          944,
          -160
        ],
        "parameters": {
          "imagesUi": {},
          "resource": "product",
          "operation": "update",
          "productId": "={{ $json.id }}",
          "metadataUi": {},
          "dimensionsUi": {},
          "updateFields": {
            "regularPrice": "={{ $('BrowserAct JSON Breakdown').item.json.Price }}",
            "stockQuantity": "={{ $('BrowserAct JSON Breakdown').item.json.Quantity }}"
          }
        },
        "credentials": {
          "wooCommerceApi": {
            "id": "LwI8wvOrr3sPSHLk",
            "name": "WooCommerce account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f3091026-476d-48e7-8768-0015c03564a1",
        "name": "Get Product Stock Data",
        "type": "n8n-nodes-browseract-workflows.browserAct",
        "onError": "continueErrorOutput",
        "position": [
          -512,
          -80
        ],
        "parameters": {
          "workflowId": "58839712632662919",
          "runMaxWaitTime": 900,
          "inputParameters": {
            "parameters": [
              {
                "name": "Target_Url",
                "value": "={{ $json[\"Inventory page\"] }}"
              }
            ]
          },
          "additionalFields": {
            "saveBrowserData": true
          },
          "runPollingInterval": 30
        },
        "credentials": {
          "browserActApi": {
            "id": "AzKMhR2eAlOjzDiJ",
            "name": "BrowserAct account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "16539d4b-2817-4dc2-abac-2c58bc3ad5d8",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          736,
          240
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "googlePalmApi": {
            "id": "U1olizkBYhp4g9AB",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "e7b713db-9a9b-41e1-accd-2c7a3fe6b737",
        "name": "Send a message",
        "type": "n8n-nodes-base.slack",
        "position": [
          -512,
          -240
        ],
        "webhookId": "650d7b5e-b7d3-4df3-b5dd-01471dd0a6de",
        "parameters": {
          "text": "The product syncing process finished.",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "C09LWT82KHN",
            "cachedResultName": "new_product_added"
          },
          "otherOptions": {},
          "authentication": "oAuth2"
        },
        "credentials": {
          "slackOAuth2Api": {
            "id": "5rQCkyObBqbHIbZA",
            "name": "Slack account"
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "60842653-3eec-4b3f-a80a-cf8cf3da97d7",
        "name": "Create a product",
        "type": "n8n-nodes-base.wooCommerce",
        "onError": "continueErrorOutput",
        "position": [
          960,
          48
        ],
        "parameters": {
          "name": "={{ $('BrowserAct Json Breakdown').item.json.Name }}",
          "imagesUi": {},
          "resource": "product",
          "operation": "create",
          "metadataUi": {},
          "dimensionsUi": {},
          "additionalFields": {
            "sku": "=SKU_{{ $('BrowserAct Json Breakdown').item.json.Name }}",
            "description": "={{ $json.output }}",
            "manageStock": true,
            "regularPrice": "={{ $('BrowserAct Json Breakdown').item.json.Price}}",
            "stockQuantity": "={{ $('BrowserAct Json Breakdown').item.json.Quantity }}"
          }
        },
        "credentials": {
          "wooCommerceApi": {
            "id": "LwI8wvOrr3sPSHLk",
            "name": "WooCommerce account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "8b95853a-0792-4c73-bbfe-07c8921844e5",
        "name": "Merge",
        "type": "n8n-nodes-base.merge",
        "position": [
          1392,
          16
        ],
        "parameters": {
          "numberInputs": 3
        },
        "typeVersion": 3.2
      },
      {
        "id": "358f3506-7b05-48e8-9e75-d9315c22b90e",
        "name": "Add Missing Product",
        "type": "n8n-nodes-browseract-workflows.browserAct",
        "onError": "continueErrorOutput",
        "position": [
          336,
          64
        ],
        "parameters": {
          "workflowId": "58839211174254215",
          "runMaxWaitTime": 900,
          "inputParameters": {
            "parameters": [
              {
                "name": "Product_Name",
                "value": "={{ $('BrowserAct JSON Breakdown').item.json.Name }}"
              },
              {
                "name": "Supplier_Link",
                "value": "https://www.digikey.co.uk/en/"
              }
            ]
          },
          "additionalFields": {},
          "runPollingInterval": 30
        },
        "credentials": {
          "browserActApi": {
            "id": "AzKMhR2eAlOjzDiJ",
            "name": "BrowserAct account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7de632a3-0a8e-483e-95b0-5751bb738968",
        "name": "When clicking ‚ÄòExecute workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -1088,
          -96
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "1384104c-8f59-459a-a563-f814fa395e91",
        "name": "Sticky Note - Intro",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1136,
          96
        ],
        "parameters": {
          "width": 672,
          "height": 560,
          "content": "## Try It Out!\n### This sophisticated n8n template automates WooCommerce inventory management by scraping supplier stock data, updating existing products, and intelligently creating new ones with AI-formatted descriptions.\n\n### How it works\n* The workflow reads a list of suppliers and their inventory page URLs from a **Google Sheet**.\n* It **loops** through each supplier.\n* For each supplier, it uses **BrowserAct** to scrape the current product stock and price data.\n* It then **loops** through each product found in the scraped data.\n* The workflow searches **WooCommerce** to see if the product already exists.\n* **If the product exists:** It updates the price and stock quantity in WooCommerce.\n* **If the product DOES NOT exist:**\n    * It optionally checks if the product category matches a predefined type.\n    * If it matches, it runs a **second BrowserAct** workflow to scrape detailed product attributes from another source (e.g., DigiKey).\n    * An **AI Agent (Gemini)** transforms these attributes into a specific HTML table format for the product description.\n    * Finally, it creates the new product in **WooCommerce** with all scraped details and the AI-generated description.\n* Error handling is included to send **Slack** alerts if updates or creations fail.\n\n### Requirements\n* **BrowserAct** API account for web scraping.\n* **BrowserAct** n8n Community Node -> ([n8n Nodes BrowserAct](https://www.npmjs.com/package/n8n-nodes-browseract-workflows))\n* **Google Sheets** credentials for the supplier list.\n* **WooCommerce** credentials for product management.\n* **Google Gemini** account for the AI Agent.\n* **Slack** credentials for error alerts.\n* BrowserAct templates named **‚ÄúWooCommerce Inventory & Stock Synchronization‚Äù** and **‚ÄúWooCommerce Product Data Reconciliation‚Äù**.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/UpnCKd7GaU) or Visit Our [Blog](https://www.browseract.com/blog)!\n"
        },
        "typeVersion": 1
      },
      {
        "id": "6e2da3a0-7637-427e-9b54-c2c30032cc91",
        "name": "Sticky Note - How to Use",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -448,
          384
        ],
        "parameters": {
          "width": 528,
          "height": 264,
          "content": "## How to use\n\n1.  **Set up Credentials:** Add your credentials for **BrowserAct**, **Google Sheets**, **WooCommerce**, **Google Gemini**, and **Slack**.\n2.  **Set up BrowserAct Templates:** Ensure you have the **‚ÄúGet Product Stock Data‚Äù** and **‚ÄúAdd Missing Product‚Äù** templates in your BrowserAct account.\n3.  **Prepare Your Input Sheet:** In the 'Get row(s) in sheet' node, point it to your spreadsheet. It must have columns like `Inventory page` (URL for stock check), `Name` (supplier name), and potentially `Product Type` if using the category filter.\n4.  **Set Slack Channel:** Update the **Channel ID** in the **Slack** error notification node.\n5.  **Configure Category Check (Optional):** Adjust the logic in the `If1` node if you want to filter which missing products get created based on category.\n6.  **Activate Workflow:** Manually trigger the workflow or replace the trigger with a `Schedule Trigger` for automation."
        },
        "typeVersion": 1
      },
      {
        "id": "82e23aaf-ceca-4015-9136-bf23ff035997",
        "name": "Sticky Note - Need Help",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -448,
          224
        ],
        "parameters": {
          "width": 336,
          "height": 152,
          "content": "### Need Help?\n* #### [How to Find Your BrowseAct API Key & Workflow ID](https://www.youtube.com/watch?v=pDjoZWEsZlE)\n* #### [How to Connect n8n to Browseract](https://www.youtube.com/watch?v=RoYMdJaRdcQ)\n* #### [How to Use & Customize BrowserAct Templates](https://www.youtube.com/watch?v=CPZHFUASncY)\n* #### [How to Use the BrowserAct N8N Community Node](https://youtu.be/j0Nlba2pRLU)\n* #### [STOP Overselling! Auto-Sync WooCommerce Inventory from ANY Supplier](https://youtu.be/khLtyM2ktoU)"
        },
        "typeVersion": 1
      },
      {
        "id": "9d902298-8b60-4646-abaf-e7383878b6ff",
        "name": "Sticky Note - Input & Scrape Loop",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -848,
          -432
        ],
        "parameters": {
          "color": 6,
          "width": 624,
          "height": 176,
          "content": "### üìã 1. Input & Scrape Loop\n\n* **Trigger:** Starts the process manually or on a schedule.\n* **Google Sheets:** Fetches your list of suppliers and their inventory page URLs.\n* **Loop Over Items:** Processes each supplier one by one.\n* **Get Product Stock Data (BrowserAct):** Runs the first scraper to get the list of products currently in stock for the supplier.\n* **Code Node:** Parses the scraped stock data into individual product items.\n* **Slack Node:** Send Alert to Slack channel"
        },
        "typeVersion": 1
      },
      {
        "id": "14b77e15-d220-4687-b260-1679b1d7649f",
        "name": "Sticky Note - Product Processing Loop",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          304,
          -400
        ],
        "parameters": {
          "color": 5,
          "width": 560,
          "height": 200,
          "content": "### üîÑ 2. Product Processing Loop & Update Existing Product\nThis section runs for every product scraped from the supplier.\n\n* **Loop Over Items1:** Handles each product individually.\n* **Get many products (WooCommerce):** Searches your store to see if this product already exists based on its name.\n* **If (Product Exists?):** This crucial node routes the workflow based on whether the product was found.\nIf the product *was* found in WooCommerce:\n\n* **Update a product (WooCommerce):** This node takes the scraped `Price` and `Quantity` and updates the existing product record. It's set to continue on error and trigger a Slack alert if the update fails. "
        },
        "typeVersion": 1
      },
      {
        "id": "7b291eaf-c4a1-46fd-9083-cf7e81a57ff0",
        "name": "Sticky Note - Create New Product",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          384,
          368
        ],
        "parameters": {
          "color": 4,
          "width": 480,
          "height": 216,
          "content": "### ‚ú® 4. Create New Product (If Missing)\n\nIf the product was *not* found:\n\n* **If1 (Category Check - Optional):** Filters if you only want to add products matching a specific type.\n* **Add Missing Product (BrowserAct):** Runs a *second* scraper to get detailed attributes from another source.\n* **Code Node:** Parses these detailed attributes.\n* **AI Agent:** Uses Gemini to transform the attributes into an HTML table for the description.\n* **Create a product (WooCommerce):** Creates the new product using all scraped data and the AI description. Also includes error handling."
        },
        "typeVersion": 1
      },
      {
        "id": "bd5c0de3-4b7a-4f31-9d78-3dda3bcd1c2b",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -80,
          -176
        ],
        "parameters": {
          "color": 5,
          "width": 1184,
          "height": 208,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "f75b433a-1c8c-458b-aecf-879a6881f23d",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          112,
          48
        ],
        "parameters": {
          "color": 4,
          "width": 976,
          "height": 304,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "06d9505d-d672-469e-b0d0-36fdf1a5abd9",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -960,
          -240
        ],
        "parameters": {
          "color": 6,
          "width": 848,
          "height": 320,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "7535c929-96b9-451e-bf9e-c6a6b440d6b3",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1104,
          48
        ],
        "parameters": {
          "color": 3,
          "height": 208,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "98d804e1-f59d-4020-844c-d7e04b86a57c",
        "name": "Sticky Note - Create New Product1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1104,
          272
        ],
        "parameters": {
          "color": 3,
          "height": 104,
          "content": "‚úÖ 4. Error Handling\n\nWhen the process encounters an error, the **Slack** node notifies the team."
        },
        "typeVersion": 1
      },
      {
        "id": "b5cb6c9a-edc9-4aef-9750-e95985d80e34",
        "name": "Send Error 2",
        "type": "n8n-nodes-base.slack",
        "position": [
          544,
          224
        ],
        "webhookId": "650d7b5e-b7d3-4df3-b5dd-01471dd0a6de",
        "parameters": {
          "text": "An error has occurred inside the Second BrowserAct node.",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "C09LWT82KHN",
            "cachedResultName": "new_product_added"
          },
          "otherOptions": {},
          "authentication": "oAuth2"
        },
        "credentials": {
          "slackOAuth2Api": {
            "id": "5rQCkyObBqbHIbZA",
            "name": "Slack account"
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "b5d687e7-5781-4b29-b96e-a1cff88d6dea",
        "name": "Send Error",
        "type": "n8n-nodes-base.slack",
        "position": [
          1184,
          96
        ],
        "webhookId": "650d7b5e-b7d3-4df3-b5dd-01471dd0a6de",
        "parameters": {
          "text": "Error Occur on Updating Or Creating Data",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "C09LWT82KHN",
            "cachedResultName": "new_product_added"
          },
          "otherOptions": {},
          "authentication": "oAuth2"
        },
        "credentials": {
          "slackOAuth2Api": {
            "id": "5rQCkyObBqbHIbZA",
            "name": "Slack account"
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "d4812931-1bca-4892-9133-88c36e1558e5",
        "name": "Loop Over Suppliers",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          -720,
          -96
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "703e314d-8e2a-4bec-90ee-76397090591e",
        "name": "Loop Over Products",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          -64,
          -96
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 3
      },
      {
        "id": "b6239845-f5f7-4bfa-9c69-89508b96793c",
        "name": "Send BrowserAct Error",
        "type": "n8n-nodes-base.slack",
        "position": [
          -288,
          80
        ],
        "webhookId": "650d7b5e-b7d3-4df3-b5dd-01471dd0a6de",
        "parameters": {
          "text": "An error has occurred inside the first BrowserAct node.",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "C09LWT82KHN",
            "cachedResultName": "new_product_added"
          },
          "otherOptions": {},
          "authentication": "oAuth2"
        },
        "credentials": {
          "slackOAuth2Api": {
            "id": "5rQCkyObBqbHIbZA",
            "name": "Slack account"
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "e7b9c737-521c-4b52-bc41-7bb63b92a3eb",
        "name": "Check the Category",
        "type": "n8n-nodes-base.if",
        "position": [
          160,
          80
        ],
        "parameters": {
          "options": {
            "ignoreCase": true
          },
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": false,
              "typeValidation": "loose"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "013b4904-dd59-4fe7-90c9-a1fbbd3cab83",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $('Loop Over Products').item.json.Category }}",
                "rightValue": "={{ $item(\"0\").$node[\"Get Suppliers & Links\"].json[\"Product Type\"] }}"
              }
            ]
          },
          "looseTypeValidation": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "59f6c99e-fffc-48d6-beb2-8c08c34d40e3",
        "name": "Check for Product availability",
        "type": "n8n-nodes-base.if",
        "position": [
          544,
          -144
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "657542ba-f1ec-43ef-be60-9c3600b0dd99",
                "operator": {
                  "type": "object",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json }}",
                "rightValue": ""
              }
            ]
          },
          "looseTypeValidation": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "fdbbae9a-fad8-4180-9e8b-b3a9013eace9",
        "name": "BrowserAct JSON Breakdown",
        "type": "n8n-nodes-base.code",
        "position": [
          -288,
          -96
        ],
        "parameters": {
          "jsCode": "// Get the JSON string using the exact path provided by the user.\nconst jsonString = $input.first().json.output.string;\n\nlet parsedData;\n\n// Check if the string exists before attempting to parse\nif (!jsonString) {\n    // Return an empty array or throw an error if no string is found\n    // Throwing an error is usually better to stop the workflow if data is missing.\n    throw new Error(\"Input string is empty or missing at the specified path: $input.first().json.output.string\");\n}\n\ntry {\n    // 1. Parse the JSON string into a JavaScript array of objects\n    parsedData = JSON.parse(jsonString);\n} catch (error) {\n    // Handle JSON parsing errors (e.g., if the string is malformed)\n    throw new Error(`Failed to parse JSON string: ${error.message}`);\n}\n\n// 2. Ensure the parsed data is an array\nif (!Array.isArray(parsedData)) {\n    throw new Error('Parsed data is not an array. It cannot be split into multiple items.');\n}\n\n// 3. Map the array of objects into the n8n item format { json: object }\n// Each element in this array will be treated as a new item by n8n, achieving the split.\nconst outputItems = parsedData.map(item => ({\n    json: item,\n}));\n\n// 4. Return the new array of items\nreturn outputItems;"
        },
        "typeVersion": 2
      },
      {
        "id": "68ac7520-266b-45d1-b4ef-888cde19c635",
        "name": "BrowserAct Json Breakdown",
        "type": "n8n-nodes-base.code",
        "position": [
          512,
          48
        ],
        "parameters": {
          "jsCode": "// Get the JSON string using the exact path provided by the user.\nconst jsonString = $input.first().json.output.string;\n\nlet parsedData;\n\n// Check if the string exists before attempting to parse\nif (!jsonString) {\n    // Return an empty array or throw an error if no string is found\n    // Throwing an error is usually better to stop the workflow if data is missing.\n    throw new Error(\"Input string is empty or missing at the specified path: $input.first().json.output.string\");\n}\n\ntry {\n    // 1. Parse the JSON string into a JavaScript array of objects\n    parsedData = JSON.parse(jsonString);\n} catch (error) {\n    // Handle JSON parsing errors (e.g., if the string is malformed)\n    throw new Error(`Failed to parse JSON string: ${error.message}`);\n}\n\n// 2. Ensure the parsed data is an array\nif (!Array.isArray(parsedData)) {\n    throw new Error('Parsed data is not an array. It cannot be split into multiple items.');\n}\n\n// 3. Map the array of objects into the n8n item format { json: object }\n// Each element in this array will be treated as a new item by n8n, achieving the split.\nconst outputItems = parsedData.map(item => ({\n    json: item,\n}));\n\n// 4. Return the new array of items\nreturn outputItems;"
        },
        "typeVersion": 2
      },
      {
        "id": "5b2bbcd8-551a-4ad5-bd8a-c8c9a08cd4f8",
        "name": "Create the HTML Data Table",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          688,
          48
        ],
        "parameters": {
          "text": "=input :  {{ $json.Product_Attributes }}\n\nsend data to ouput like this \n\n\"Output\": \"data\"\n",
          "options": {
            "systemMessage": "You are an AI assistant specialized in data transformation. Your task is to convert input text containing product specifications into a specific HTML `<table>` format. You must follow the instructions precisely to replicate the target HTML structure.\n\n**Task:**\nConvert the provided key-value text into an HTML table, matching the exact structure, tags, and CSS classes from the target specification.\n\n**Instructions:**\n\n1.  **Parse Input:** The input is a block of plain text with key-value pairs separated by a colon (`:`) and a newline.\n\n2.  **Generate Table:**\n\n      * Start with `<table id=\"product-attributes\" class=\"MuiTable-root mui-css-1ssfo\">`.\n      * Add a `<tbody class=\"MuiTableBody-root mui-css-1xnox0e\">`.\n\n3.  **Generate Rows (`<tr>`):**\n\n      * Create a `<tr class=\"MuiTableRow-root mui-css-c9pui3\">` for each of the attributes listed above, in that order.\n      * Each row must contain specific `<td>` cells as defined below.\n\n4.  **Generate Cells (`<td>`):**\n\n      * **Cell 1: Attribute Name (Key)**\n\n          * Wrap the key (e.g., \"Mfr\", \"Series\") in this structure:\n\n        <!-- end list -->\n\n        ```html\n        <td class=\"MuiTableCell-root MuiTableCell-body MuiTableCell-sizeMedium tss-css-my7fuh-tableCellBold mui-css-4ro0k3\">\n        <div class=\"tss-css-8y8kah-tableCellBreak\">[ATTRIBUTE_NAME]</div></td>\n        ```\n\n      * **Cell 2: Attribute Value**\n\n          * Start with this structure:\n\n        <!-- end list -->\n\n        ```html\n        <td class=\"MuiTableCell-root MuiTableCell-body MuiTableCell-sizeMedium tss-css-110lnqa-tableCell mui-css-4ro0k3\">\n        <div class=\"tss-css-1agxsdl-tableCellDescription\">\n        </div></td>\n        ```\n\n          * **Value Formatting (Content):**\n              * **For `Category`:** If the value contains a comma (`,`), split the value by the comma. Wrap each part in its own `<div>` and `<a>` tag like this (using `#` for `href`):\n                ```html\n                <div><a class=\"tss-css-yusyu7-anchor\" href=\"#\" rel=\"opener\">[Part 1]</a></div>\n                <div><a class=\"tss-css-yusyu7-anchor\" href=\"#\" rel=\"opener\">[Part 2]</a></div>\n                ```\n              * **For `Mfr`, `Series`, `Power (Watts)`, `Base Product Number`:** Wrap the value in an `<a>` tag like this (using `#` for `href`):\n                ```html\n                <a class=\"tss-css-yusyu7-anchor\" href=\"#\" rel=\"opener\" data-testid=\"product-attributes-link\">[VALUE]</a>\n                ```\n              * **For ALL OTHER attributes:** Wrap the value in a `<div>` tag like this:\n                ```html\n                <div class=\"tss-css-tsu9t4-packageName\">[VALUE]</div>\n                ```\n\n      * **Cell 3: Empty/Action Cell**\n\n          * **For the `Category` row:** Use this *exact* cell:\n            ```html\n            <td class=\"MuiTableCell-root MuiTableCell-body MuiTableCell-alignRight MuiTableCell-sizeMedium tss-css-my7fuh-tableCellBold print-hide mui-css-115xzy4\" data-testid=\"attributes-table-search-column\"><div class=\"MuiFormGroup-root tss-css-1kh0d0a-tableCellHeadDescription mui-css-1h7anqn\" role=\"radiogroup\"></div></td>\n            ```\n          * **For the `Base Product Number` row:** **DO NOT** add this third cell. This row only has two `<td>` cells.\n          * **For ALL OTHER rows:** Use this *exact* cell:\n            ```html\n            <td class=\"MuiTableCell-root MuiTableCell-body MuiTableCell-alignRight MuiTableCell-sizeMedium tss-css-1vs9p76-tableCellCheckBox print-hide mui-css-115xzy4\" data-testid=\"attributes-table-search-column\"><div class=\"tss-css-8y8kah-tableCellBreak\"><div></div></div></td>\n            ```\n\n5.  **Finalize:**\n\n      * Close the table with `</tbody>` and `</table>`.\n      * **Crucially: Only output the final HTML code.** \nDo not include any other text, explanations, or markdown formatting (like \\`\\`\\`html) around your response.\n\nremove any \"\\n\" before sending to output\n"
          },
          "promptType": "define"
        },
        "typeVersion": 2.2
      },
      {
        "id": "fde001d3-f383-47ea-a38c-3f86ebb1a886",
        "name": "Get Suppliers & Links",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -928,
          -96
        ],
        "parameters": {
          "options": {},
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1TeICFGUZisbOwkrOiDzObI2nW5smNErlmK5ncGER1wY/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1TeICFGUZisbOwkrOiDzObI2nW5smNErlmK5ncGER1wY",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1TeICFGUZisbOwkrOiDzObI2nW5smNErlmK5ncGER1wY/edit?usp=drivesdk",
            "cachedResultName": "Product Suppliers"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "wAMAqU43zjVjlpuA",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.7
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "4733f40a-31cf-4065-85e4-b79b2336d974",
    "connections": {
      "Merge": {
        "main": [
          [
            {
              "node": "Loop Over Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Error": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 2
            }
          ]
        ]
      },
      "Create a product": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ],
          [
            {
              "node": "Send Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update a product": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get many products": {
        "main": [
          [
            {
              "node": "Check for Product availability",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check the Category": {
        "main": [
          [
            {
              "node": "Add Missing Product",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Products": {
        "main": [
          [
            {
              "node": "Loop Over Suppliers",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get many products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Missing Product": {
        "main": [
          [
            {
              "node": "BrowserAct Json Breakdown",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Error 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Suppliers": {
        "main": [
          [
            {
              "node": "Send a message",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Product Stock Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Suppliers & Links": {
        "main": [
          [
            {
              "node": "Loop Over Suppliers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Product Stock Data": {
        "main": [
          [
            {
              "node": "BrowserAct JSON Breakdown",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send BrowserAct Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Create the HTML Data Table",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "BrowserAct JSON Breakdown": {
        "main": [
          [
            {
              "node": "Loop Over Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "BrowserAct Json Breakdown": {
        "main": [
          [
            {
              "node": "Create the HTML Data Table",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create the HTML Data Table": {
        "main": [
          [
            {
              "node": "Create a product",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check for Product availability": {
        "main": [
          [
            {
              "node": "Update a product",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Check the Category",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòExecute workflow‚Äô": {
        "main": [
          [
            {
              "node": "Get Suppliers & Links",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "ad0113c344ee237399e44e9f11798b05baeb83a6196d514a9ae9d2ad71c3b5c9",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "5b054044-5814-47aa-99b4-0a9c5a601bad",
        "name": "Analyze Data",
        "type": "n8n-nodes-base.googleSheetsTool",
        "position": [
          784,
          1328
        ],
        "parameters": {
          "options": {},
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 365710158,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1UDWt0-Z9fHqwnSNfU3vvhSoYCFG6EG3E-ZewJC_CLq4/edit#gid=365710158",
            "cachedResultName": "Data"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1UDWt0-Z9fHqwnSNfU3vvhSoYCFG6EG3E-ZewJC_CLq4",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1UDWt0-Z9fHqwnSNfU3vvhSoYCFG6EG3E-ZewJC_CLq4/edit?usp=drivesdk",
            "cachedResultName": "Sample Marketing Data - n8n"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "a6869994-77e8-4f5d-916c-cc40f0b5ab7e",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          224,
          1312
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-nano",
            "cachedResultName": "gpt-4.1-nano"
          },
          "options": {}
        },
        "typeVersion": 1.2
      },
      {
        "id": "aa9fe53d-83b8-47e0-a4be-8496f4cbe552",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -32,
          416
        ],
        "parameters": {
          "color": 7,
          "width": 1152,
          "height": 1168,
          "content": "## Talk to Your Data with Google Sheets & OpenAI GPT-5 Mini\nThis n8n workflow template creates an intelligent data analysis chatbot that can answer questions about data stored in Google Sheets using OpenAI's GPT-5 Mini model. The system automatically analyzes your spreadsheet data and provides insights through natural language conversations.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "2ecbc678-f948-4435-bc3a-e66718810b33",
        "name": "Talk to Your Data",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          704,
          688
        ],
        "parameters": {
          "options": {
            "systemMessage": "Google Sheets Ask-YOUR_OPENAI_KEY_HERE \n\n\nYou are Ask-YOUR_OPENAI_KEY_HERE. Answer questions using Google Sheets ONLY via the tool below. Be precise and conservative. \n\nThere is only one dataset. dont ask what dataset it is. \n\nUse the data tool to answer the question."
          },
          "hasOutputParser": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "f1beca70-a4bd-41db-a461-2a3041e8963f",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          16,
          576
        ],
        "parameters": {
          "color": 7,
          "width": 480,
          "height": 432,
          "content": "### 3. Ask Questions of Your Data\n\nYou can ask natural language questions to analyze your marketing data, such as:\n- **Total spend** across all campaigns.\n- **Spend for Paid Search only**.\n- **Month-over-month changes** in ad spend.\n- **Top-performing campaigns** by conversion rate.\n- **Cost per lead** for each channel."
        },
        "typeVersion": 1
      },
      {
        "id": "277d266d-e457-4005-baf6-2de276b2a888",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -592,
          416
        ],
        "parameters": {
          "width": 528,
          "height": 1168,
          "content": "## üé• Watch This Tutorial\n\n@[youtube](qsrVPdo6svc)\n\n\n### 1. Set Up OpenAI Connection\n\n#### Get Your API Key\n1. Visit the [OpenAI API Keys](https://platform.openai.com/api-keys) page.\n2. Go to [OpenAI Billing](https://platform.openai.com/settings/organization/billing/overview).\n3. Add funds to your billing account.\n4. Copy your API key into your **OpenAI credentials** in n8n (or your chosen platform).\n\n---\n### 2. Prepare Your Google Sheet\n\n#### Connect Your Data in Google Sheets\n- Data must follow this format: [Sample Marketing Data](https://docs.google.com/spreadsheets/d/1UDWt0-Z9fHqwnSNfU3vvhSoYCFG6EG3E-ZewJC_CLq4/edit?gid=365710158#gid=365710158)\n- **First row** contains column names.\n- Data should be in **rows 2‚Äì100**.\n- Log in using **OAuth**, then select your workbook and sheet.\n\n---\n### 3. Ask Questions of Your Data\n\nYou can ask natural language questions to analyze your marketing data, such as:\n- **Total spend** across all campaigns.\n- **Spend for Paid Search only**.\n- **Month-over-month changes** in ad spend.\n- **Top-performing campaigns** by conversion rate.\n- **Cost per lead** for each channel.\n\n---\n## üì¨ Need Help or Want to Customize This?\nüìß [rbreen@ynteractive.com](mailto:robert@ynteractive.com)  \nüîó [LinkedIn](https://www.linkedin.com/in/robert-breen-29429625/)\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "0249ac43-4804-4c12-b72a-9ef0357f2412",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          16,
          1056
        ],
        "parameters": {
          "color": 3,
          "width": 480,
          "height": 432,
          "content": "### 1. Set Up OpenAI Connection\n\n#### Get API Key:\n1. Go to [OpenAI Platform](https://platform.openai.com/api-keys)\n1. Go to [OpenAI Billing](https://platform.openai.com/settings/organization/billing/overview)\n2. Add funds to your billing account & copy your api key into the openAI credentials\n"
        },
        "typeVersion": 1
      },
      {
        "id": "ddb3a0d8-5a07-4361-ba37-1c9d1a225d86",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          560,
          1056
        ],
        "parameters": {
          "color": 3,
          "width": 512,
          "height": 432,
          "content": "### 2. Prepare Your Google Sheet\n\n#### Connect your Data in Google Sheets\n- Data must be in a format similar to this: [Sample Marketing Data](https://docs.google.com/spreadsheets/d/1UDWt0-Z9fHqwnSNfU3vvhSoYCFG6EG3E-ZewJC_CLq4/edit?gid=365710158#gid=365710158)\n- First row contains column names\n- Data in rows 2-100\n- Log in with OAuth2 and choose your workbook and sheet\n- Optional: Try connecting to Airtable, Notion or your Database"
        },
        "typeVersion": 1
      },
      {
        "id": "93c92fba-07f8-416f-952b-3b001e8294e0",
        "name": "Chat with Your Data",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          192,
          848
        ],
        "webhookId": "edca0f0a-77c3-43e5-8ece-e514a29446f5",
        "parameters": {
          "options": {}
        },
        "typeVersion": 1.3
      },
      {
        "id": "713d398d-fb27-42b2-bb39-21ef8f8f97df",
        "name": "Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          736,
          880
        ],
        "parameters": {},
        "typeVersion": 1.3
      },
      {
        "id": "db0584ce-5b77-45aa-b0d1-1d1055c97157",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          560,
          576
        ],
        "parameters": {
          "color": 7,
          "width": 512,
          "height": 432,
          "content": ""
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Memory": {
        "ai_memory": [
          [
            {
              "node": "Talk to Your Data",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Data": {
        "ai_tool": [
          [
            {
              "node": "Talk to Your Data",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Talk to Your Data",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Chat with Your Data": {
        "main": [
          [
            {
              "node": "Talk to Your Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "5d6a5a45-8aa8-4c34-aa10-5dd85f05de9d",
        "name": "Human Handoff using Send and Wait",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1580,
          1040
        ],
        "webhookId": "d2bbc82f-0509-470a-af4d-9d92cfed4d5f",
        "parameters": {
          "chatId": "=<human chat id>",
          "message": "=chatId: {{ $('Handoff Subworkflow').first().json.chatId }}\nsessionId: {{ $('Handoff Subworkflow').first().json.sessionId }}\nuser: {{ $('Handoff Subworkflow').first().json.username }} ({{ $('Handoff Subworkflow').item.json.userId }})\n\nSummary:\n{{ $('Handoff Subworkflow').item.json.summary }}\n\n---\nThis user has now been handed off to a human.\nClick the button to return user to bot.",
          "options": {},
          "operation": "sendAndWait",
          "responseType": "freeText"
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "5d2f73ff-b233-4456-b34d-d5a5454dabda",
        "name": "Set Interaction to Bot",
        "type": "n8n-nodes-base.redis",
        "position": [
          1780,
          1040
        ],
        "parameters": {
          "key": "=handoff_{{ $('Handoff Subworkflow').first().json.sessionId }}_state",
          "value": "bot",
          "keyType": "string",
          "operation": "set"
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f799e213-f3ed-4479-aade-7a7c38eb5792",
        "name": "Set Interaction to Human",
        "type": "n8n-nodes-base.redis",
        "position": [
          1380,
          1040
        ],
        "parameters": {
          "key": "=handoff_{{ $json.sessionId }}_state",
          "value": "=human",
          "keyType": "string",
          "operation": "set"
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "059c9b8c-ba50-4bdd-8969-6f5f35bba304",
        "name": "Get Interaction State",
        "type": "n8n-nodes-base.redis",
        "position": [
          -800,
          820
        ],
        "parameters": {
          "key": "=handoff_{{ $json.message.chat.id }}_state",
          "options": {},
          "operation": "get",
          "propertyName": "data"
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "8afd48ff-478d-4092-ac88-fb2e435ded00",
        "name": "Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -280,
          640
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "19c5ef66-410d-47fd-9b2a-19776c53a681",
        "name": "Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
        "position": [
          -160,
          640
        ],
        "parameters": {
          "sessionKey": "=handoff_{{ $('Telegram Trigger').first().json.message.chat.id }}_chat",
          "sessionIdType": "customKey"
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1.4
      },
      {
        "id": "814e464d-a2e0-4ae1-83d1-df3732d3b430",
        "name": "Handoff Subworkflow",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "position": [
          980,
          1040
        ],
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "chatId"
              },
              {
                "name": "sessionId"
              },
              {
                "name": "userId"
              },
              {
                "name": "username"
              },
              {
                "name": "summary"
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "53c311ca-b7ad-4705-97c9-f6438a6c6b4e",
        "name": "Telegram Trigger",
        "type": "n8n-nodes-base.telegramTrigger",
        "position": [
          -1000,
          820
        ],
        "webhookId": "e905dd99-eefc-48ff-a62d-c7078e9bb216",
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {}
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "ea54c9f7-8ebc-4146-a4ec-6d05957f340d",
        "name": "Send Response",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1400,
          340
        ],
        "webhookId": "55ecb0ba-72c8-4f16-a6c8-0c0bb8582554",
        "parameters": {
          "text": "=Thank you. I've now transferred you to a human agent who will reach out to you. Once complete, you can come back to this chat to finish the process.",
          "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "7f895e2a-7aee-40be-a8b7-b2b0ff469b2d",
        "name": "Switch Interaction",
        "type": "n8n-nodes-base.switch",
        "position": [
          -620,
          820
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "Human",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "6bc61072-f7cf-4a6d-af81-36abede59d47",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.data }}",
                      "rightValue": "human"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "Bot",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "6882db64-b522-4895-8949-d98d87b53b49",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.data }}",
                      "rightValue": "bot"
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Onboarding"
          }
        },
        "typeVersion": 3.2
      },
      {
        "id": "df203358-e6c7-4014-8e2b-ef934e331215",
        "name": "Information Extractor",
        "type": "@n8n/n8n-nodes-langchain.informationExtractor",
        "position": [
          440,
          460
        ],
        "parameters": {
          "text": "={{\n$json.data\n  .reverse()\n  .slice(0, 5)\n  .map(item => item.parseJson())\n  .map(item => `${item.type}: ${item.data.content}`)\n  .join('\\n')\n}}",
          "options": {
            "systemPromptTemplate": "Analyse the conversation history and extract the required customer details. If not found, leave blank."
          },
          "attributes": {
            "attributes": [
              {
                "name": "firstname",
                "required": true,
                "description": "first name of customer"
              },
              {
                "name": "lastname",
                "required": true,
                "description": "last name of customer"
              },
              {
                "name": "address_and_postcode",
                "required": true,
                "description": "address and postcode of customer"
              },
              {
                "name": "reason_for_call",
                "required": true,
                "description": "a summary of the reason for the call"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "35bc11d2-6024-425b-ac67-a61ff26b9478",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          420,
          640
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "20d71c5f-6e84-4b45-b324-0706ecd3a681",
        "name": "With Defaults",
        "type": "n8n-nodes-base.code",
        "position": [
          760,
          460
        ],
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "return {\n  \"firstname\": \"\",\n  \"lastname\": \"\",\n  \"address_and_postcode\": \"\",\n  \"reason_for_call\": \"\",\n  ...$input.item.json.output,\n}"
        },
        "typeVersion": 2
      },
      {
        "id": "76344f79-1afa-4fd9-9c01-ca3818f62f37",
        "name": "Has All Criteria?",
        "type": "n8n-nodes-base.if",
        "position": [
          920,
          460
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "96d4a43f-aa0f-486a-b692-0105196d099a",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{ Object.values($json).every(val => Boolean(val)) }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "f76c1032-036b-46ad-91da-023d5af931fd",
        "name": "Onboarding Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -240,
          460
        ],
        "parameters": {
          "text": "={{ $('Telegram Trigger').first().json.message.text }}",
          "options": {
            "systemMessage": "=You are a prescreen assistant whose task is to get the following details from a customer before handing them over to a human agent.\n* first name\n* last name\n* address and postcode\n* reason for calling - capture exact wording if possible.\n\nOnce all data is gathered, hand the user off to a human agent."
          },
          "promptType": "define"
        },
        "typeVersion": 1.8
      },
      {
        "id": "0a5b19a5-9c19-436c-b1d3-23d962efd23e",
        "name": "Get Onboarding Chat History",
        "type": "n8n-nodes-base.redis",
        "position": [
          280,
          460
        ],
        "parameters": {
          "key": "=handoff_{{ $('Telegram Trigger').first().json.message.chat.id }}_chat",
          "options": {},
          "operation": "get",
          "propertyName": "data"
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "4f247eb3-78f0-4ec1-8713-1373da07b5f3",
        "name": "After Sales Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          340,
          1000
        ],
        "parameters": {
          "text": "={{ $('Telegram Trigger').item.json.message.text }}",
          "options": {
            "systemMessage": "You are an aftersales agent helping the user answer questions about their recent purchase."
          },
          "promptType": "define"
        },
        "typeVersion": 1.8
      },
      {
        "id": "bce26253-f7da-49e8-952b-52e14eb4f9b5",
        "name": "Memory1",
        "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
        "position": [
          420,
          1180
        ],
        "parameters": {
          "sessionKey": "=handoff_{{ $('Telegram Trigger').first().json.message.chat.id }}_chat2",
          "sessionIdType": "customKey",
          "contextWindowLength": 30
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1.4
      },
      {
        "id": "51c4549b-559c-400d-9951-dde0953ade4c",
        "name": "Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          300,
          1180
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "63b8d9e8-7af2-4103-a365-ca5471bd7b36",
        "name": "Handoff Tool",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          540,
          1180
        ],
        "parameters": {
          "name": "handoff_to_human",
          "workflowId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $workflow.id }}"
          },
          "description": "Call this tool to handoff or defer to a human agent at the request of the customer. Ensure a summary of the reason for the handoff is obtained first.",
          "workflowInputs": {
            "value": {
              "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id.toString() }}",
              "userId": "={{ $('Telegram Trigger').first().json.message.from.id.toString() }}",
              "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('summary', `Reason for human hand-off`, 'string') }}",
              "username": "={{ $('Telegram Trigger').first().json.message.from.username }}",
              "sessionId": "={{ $('Telegram Trigger').first().json.message.chat.id.toString() }}"
            },
            "schema": [
              {
                "id": "chatId",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "chatId",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "sessionId",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "sessionId",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "userId",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "userId",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "username",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "username",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "summary",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "summary",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "typeVersion": 2
      },
      {
        "id": "9a2b9077-0ead-4f2c-9e83-05ee341ff697",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1080,
          580
        ],
        "parameters": {
          "color": 7,
          "width": 660,
          "height": 460,
          "content": "## 1. Check Interaction State For Incoming Message\n[Learn more about the telegram trigger](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.telegramtrigger/)\n\nThis is an example of a state-based agent - the technique commonly known as a finite-state machine. This is a great way to really control the flow and direction of the conversation where there are requirements to collect data or perform steps in sequence. To manage the session state, we can use Redis and the session key will be the user's number."
        },
        "typeVersion": 1
      },
      {
        "id": "ccca9a5c-595a-4c58-9316-933a8234ab91",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -380,
          260
        ],
        "parameters": {
          "color": 7,
          "width": 560,
          "height": 520,
          "content": "## 2. Onboarding Agent to Validate Customers\n[Read more about Agents](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent)\n\nThis agent unlike the common multi-tasking examples out there, is only tasked to handle the user's onboarding. In this way, we trade convenience for clutter but ensure the agent is less likely to stray from the desired path."
        },
        "typeVersion": 1
      },
      {
        "id": "2d859430-1326-4cbc-a5cc-3af0d091e5c0",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          200,
          260
        ],
        "parameters": {
          "color": 7,
          "width": 880,
          "height": 520,
          "content": "## 3. Extract Customer Details from Conversation\n[Learn more about the Information Extractor](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.information-extractor)\n\nTo collect the user's details in a structured format, we can analyse the current conversation and extract the data with the Information Extractor node. This allows the conversation to remain free-form and avoids asking a question for each field. We use a code node to check if all details are captured."
        },
        "typeVersion": 1
      },
      {
        "id": "754f0859-8af7-4a15-8e46-c9ad62b55bf3",
        "name": "Handoff Subworkflow1",
        "type": "n8n-nodes-base.executeWorkflow",
        "position": [
          1220,
          340
        ],
        "parameters": {
          "mode": "each",
          "options": {
            "waitForSubWorkflow": false
          },
          "workflowId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $workflow.id }}"
          },
          "workflowInputs": {
            "value": {
              "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id.toString() }}",
              "userId": "={{ $('Telegram Trigger').first().json.message.from.id.toString() }}",
              "summary": "=name: {{ $json.firstname }} {{ $json.lastname }}\naddress: {{ $json.address_and_postcode }}\nsummary: {{ $json.reason_for_call }}",
              "username": "={{ $('Telegram Trigger').first().json.message.from.username }}",
              "sessionId": "={{ $('Telegram Trigger').first().json.message.chat.id.toString() }}"
            },
            "schema": [
              {
                "id": "chatId",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "chatId",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "sessionId",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "sessionId",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "userId",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "userId",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "username",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "username",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "summary",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "summary",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "6f92128f-14dc-4b0a-b098-3d9535ac11e3",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1100,
          140
        ],
        "parameters": {
          "color": 7,
          "width": 800,
          "height": 640,
          "content": "## 4. Human Handoff when Criteria Met\n[Learn more about subworkflows](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflow)\n\nHere, we initiate the hand-off which calls our hand-off subworkflow. Subworkflows can be a great way to run actions concurrently and without blocking the reply to the user. At this point, the session state would be set to \"human\" which means the human agent should take over."
        },
        "typeVersion": 1
      },
      {
        "id": "14500c4f-da43-460f-bf4d-80d0a2f4537b",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -380,
          800
        ],
        "parameters": {
          "color": 7,
          "width": 520,
          "height": 440,
          "content": "## 5. Defer to Human\n\nWhen session state is \"human\", no further user messages can reach the agent. This is to ensure there isn't a parallel conversation happening which may confuse the human and agent."
        },
        "typeVersion": 1
      },
      {
        "id": "4d74d479-8525-4b64-8291-e2b3058edeaa",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          160,
          800
        ],
        "parameters": {
          "color": 7,
          "width": 720,
          "height": 520,
          "content": "## 6. Interaction Switched Back to Bot\n[Read more about the Customer Workflow Tool](https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.toolworkflow/)\n\nWhen the session state is \"bot\", it signals the human agent has \"transferred\" the user back to the bot and so can continue processing their messages. A Custom Workflow Tool is used to retrigger the hand-off process whenever the user requests for it."
        },
        "typeVersion": 1
      },
      {
        "id": "a1c064d9-cc74-475d-b233-9deb4dfa81d7",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          920,
          820
        ],
        "parameters": {
          "color": 7,
          "width": 1580,
          "height": 560,
          "content": "## 7. Interaction Subworkflow\n[Learn more about n8n's human-in-the-loop feature](https://docs.n8n.io/advanced-ai/examples/human-fallback/)\n\nThe hand-off implementation here involves a \"human-in-the-loop\" feature of n8n - a feature which \"pauses\" an execution whilst running until a reply or action is sent back by the human. Sounds complicated but good to note that n8n handles this interaction seemlessly! Here, we're using it to allow the human agent to reliquish control of the conversation back to the AI agent. Additionally, the human agent's feedback is captured and added to the agent's memory to better assist the user afterwards."
        },
        "typeVersion": 1
      },
      {
        "id": "33684768-2f21-4f30-9e56-934171b215fc",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1580,
          -260
        ],
        "parameters": {
          "width": 440,
          "height": 1320,
          "content": "## Try it out\n### This n8n template demonstrates an approach to perform bot-to-human handoff using Human-in-the-loop functionality as a switch.\n\nIn this experiment, we play with the idea of states we want our agent to be in which controls it's interacton with the user.\n* **First state** - the agent is onboarding the user by collecting their details for a sales inquiry. After which, they are handed-off / transferred to a human to continue the call.\n* **Second state** - the agent is essentially \"deactivated\" as further messages to the bot will not reach it. Instead, a canned response is given to the user. The human agent must \"reactivate\" the bot by completing the human-in-the-loop form and give a summary of their conversation with the user.\n* **Third state** - the agent is \"reactivated\" with context of the human-to-user conversation and is set to provide after sales assistance. An tool is made available to the agent to again delegate back to the human agent when requested.\n\n### How it works\n* This template uses telegram to handle the interaction between the user and the agent.\n* Each user message is checked for a session state to ensure it is guided to the right stage of the conversation. For this, we can use Redis as a simple key-value store.\n* When no state is set, the user is directed through an onboarding step to attain their details. Once complete, the agent will \"transfer\" the user to a human agent - technically, all this involves is an update to the session state and a message to another chat forwarding the user's details.\n* During this \"human\" state, the agent cannot reply to the user and must wait until the human \"transfers\" the conversation back. The human can do this by replying to \"human-in-the-loop\" message with a summary of their conversation with the user. This session state now changes to \"bot\" and the context is implanted in the agent's memory so that the agent can respond to future questions.\n* At this stage of the conversation, the agent is now expected to handle and help the user with after-sales questions. The user can at anytime request transfer back to the human agent, repeating the previous steps as necessary.\n\n#### How to use\n* Plan your user journey! Here is a very basic example of a sales inquiry with at most 3 states. More thought should be developed when many more states are involved.\n* You may want to better log and manage session states so no user is left in limbo. Try connecting the user and sessions to your CRM.\n* Note, the Onboarding agent and After-Sales agent have separate chat memories. When adding more agents, it is recommend to continue having separate chat memories to help focus between states.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!"
        },
        "typeVersion": 1
      },
      {
        "id": "187ca5ef-c804-4aca-8ad9-3c4b11676fbf",
        "name": "Send Response2",
        "type": "n8n-nodes-base.telegram",
        "position": [
          2320,
          1040
        ],
        "webhookId": "55ecb0ba-72c8-4f16-a6c8-0c0bb8582554",
        "parameters": {
          "text": "=Hello again! I'm now ready to answer any remaining questions you may have.",
          "chatId": "={{ $('Handoff Subworkflow').first().json.chatId }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "ab036106-84f2-4cf7-a5ad-7706a9e5ea0a",
        "name": "Memory2",
        "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
        "position": [
          1980,
          1200
        ],
        "parameters": {
          "sessionKey": "=handoff_{{ $('Handoff Subworkflow').first().json.chatId }}_chat2",
          "sessionIdType": "customKey",
          "contextWindowLength": 30
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1.5
      },
      {
        "id": "9d9d1aee-5632-499c-968d-63a555cc58d8",
        "name": "Update Agent Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryManager",
        "position": [
          1980,
          1040
        ],
        "parameters": {
          "mode": "insert",
          "messages": {
            "messageValues": [
              {
                "type": "ai",
                "message": "=Report from human agent says \"{{ $('Human Handoff using Send and Wait').first().json.data.text }}\"",
                "hideFromUI": true
              },
              {
                "type": "ai",
                "message": "Hello again! I'm now ready to answer any remaining questions you may have."
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "8da2fefa-e51f-4258-8ded-e0f20db87641",
        "name": "Send Response3",
        "type": "n8n-nodes-base.telegram",
        "position": [
          680,
          1000
        ],
        "webhookId": "55ecb0ba-72c8-4f16-a6c8-0c0bb8582554",
        "parameters": {
          "text": "={{ $json.output }}",
          "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "f027afe0-0fd2-47a2-a0f8-f0d78f8fbc18",
        "name": "Get Canned Response",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -180,
          1000
        ],
        "webhookId": "55ecb0ba-72c8-4f16-a6c8-0c0bb8582554",
        "parameters": {
          "text": "=This conversation has been handed-off to a human agent who will be in contact soon if not done so already. I cannot respond to your query until the human agent transfers you back to me.",
          "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "a1ada0c7-779e-44bc-bdbd-1d5285bedf3c",
        "name": "Notify user",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1180,
          1040
        ],
        "webhookId": "55ecb0ba-72c8-4f16-a6c8-0c0bb8582554",
        "parameters": {
          "text": "=You have now been transferred to a human. Unfortunately, I will not be able to respond until the human agent transfers you back to me.",
          "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "31287a38-e7a7-4518-9f54-6e6c9b2486fe",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1520,
          1020
        ],
        "parameters": {
          "width": 220,
          "height": 320,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Add Human Chat ID\nThis is needed to notify the human agent."
        },
        "typeVersion": 1
      },
      {
        "id": "a58a82b9-2c37-4137-9b3e-17479c78a2d2",
        "name": "Memory3",
        "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
        "position": [
          1580,
          500
        ],
        "parameters": {
          "sessionKey": "=handoff_{{ $('Telegram Trigger').first().json.message.chat.id }}_chat2",
          "sessionIdType": "customKey",
          "contextWindowLength": 30
        },
        "credentials": {
          "redis": {
            "id": "zU4DA70qSDrZM1El",
            "name": "Redis account (localhost)"
          }
        },
        "typeVersion": 1.5
      },
      {
        "id": "4d3d5b46-6e82-4b97-9e5f-76f02ff79ce5",
        "name": "Update Agent Memory1",
        "type": "@n8n/n8n-nodes-langchain.memoryManager",
        "position": [
          1580,
          340
        ],
        "parameters": {
          "mode": "insert",
          "messages": {
            "messageValues": [
              {
                "type": "ai",
                "message": "=The person I'm speaking to has the following details:\nfirstname: {{ $('Handoff Subworkflow1').first().json.firstname }}\nlastname: {{ $('Handoff Subworkflow1').first().json.firstname }}\nreason for call: {{ $('Handoff Subworkflow1').first().json.reason_for_call }}",
                "hideFromUI": true
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "ced46068-440b-46b4-aa51-b5bb9d59a004",
        "name": "Continue Conversation",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1220,
          580
        ],
        "webhookId": "55ecb0ba-72c8-4f16-a6c8-0c0bb8582554",
        "parameters": {
          "text": "={{ $('Onboarding Agent').first().json.output }}",
          "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "XVBXGXSsaCjU2DOS",
            "name": "jimleuk_handoff_bot"
          }
        },
        "typeVersion": 1.2
      }
    ],
    "pinData": {},
    "connections": {
      "Model": {
        "ai_languageModel": [
          [
            {
              "node": "Onboarding Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Memory": {
        "ai_memory": [
          [
            {
              "node": "Onboarding Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Model1": {
        "ai_languageModel": [
          [
            {
              "node": "After Sales Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Memory1": {
        "ai_memory": [
          [
            {
              "node": "After Sales Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Memory2": {
        "ai_memory": [
          [
            {
              "node": "Update Agent Memory",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Memory3": {
        "ai_memory": [
          [
            {
              "node": "Update Agent Memory1",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Notify user": {
        "main": [
          [
            {
              "node": "Set Interaction to Human",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Handoff Tool": {
        "ai_tool": [
          [
            {
              "node": "After Sales Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Send Response": {
        "main": [
          [
            {
              "node": "Update Agent Memory1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "With Defaults": {
        "main": [
          [
            {
              "node": "Has All Criteria?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Onboarding Agent": {
        "main": [
          [
            {
              "node": "Get Onboarding Chat History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Telegram Trigger": {
        "main": [
          [
            {
              "node": "Get Interaction State",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "After Sales Agent": {
        "main": [
          [
            {
              "node": "Send Response3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has All Criteria?": {
        "main": [
          [
            {
              "node": "Handoff Subworkflow1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Continue Conversation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Information Extractor",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch Interaction": {
        "main": [
          [
            {
              "node": "Get Canned Response",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "After Sales Agent",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Onboarding Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Handoff Subworkflow": {
        "main": [
          [
            {
              "node": "Notify user",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Agent Memory": {
        "main": [
          [
            {
              "node": "Send Response2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Handoff Subworkflow1": {
        "main": [
          [
            {
              "node": "Send Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Interaction State": {
        "main": [
          [
            {
              "node": "Switch Interaction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Information Extractor": {
        "main": [
          [
            {
              "node": "With Defaults",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Interaction to Bot": {
        "main": [
          [
            {
              "node": "Update Agent Memory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Interaction to Human": {
        "main": [
          [
            {
              "node": "Human Handoff using Send and Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Onboarding Chat History": {
        "main": [
          [
            {
              "node": "Information Extractor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human Handoff using Send and Wait": {
        "main": [
          [
            {
              "node": "Set Interaction to Bot",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "H2OMONcmT6qIf0p0",
    "meta": {
      "instanceId": "bc8ca75c203589705ae2e446cad7181d6f2a7cc1766f958ef9f34810e53b8cb2",
      "templateCredsSetupCompleted": true
    },
    "name": "TikTok Post Scraper via Keywords | Bright Data + Sheets Integration",
    "tags": [],
    "nodes": [
      {
        "id": "3c96466a-128d-403a-8449-b54001944b1d",
        "name": "Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -540,
          -560
        ],
        "parameters": {
          "columns": {
            "value": {
              "url": "={{ $json.url }}",
              "input": "={{ $json.input }}",
              "music": "={{ $json.music }}",
              "ratio": "={{ $json.ratio }}",
              "width": "={{ $json.width }}",
              "region": "={{ $json.region }}",
              "cdn_url": "={{ $json.cdn_url }}",
              "post_id": "={{ $json.post_id }}",
              "secu_id": "={{ $json.secu_id }}",
              "hashtags": "={{ $json.hashtags }}",
              "post_type": "={{ $json.post_type }}",
              "shortcode": "={{ $json.shortcode }}",
              "timestamp": "={{ $json.timestamp }}",
              "video_url": "={{ $json.video_url }}",
              "account_id": "={{ $json.account_id }}",
              "digg_count": "={{ $json.digg_count }}",
              "play_count": "={{ $json.play_count }}",
              "profile_id": "={{ $json.profile_id }}",
              "create_time": "={{ $json.create_time }}",
              "description": "={{ $json.description }}",
              "is_verified": "={{ $json.is_verified }}",
              "profile_url": "={{ $json.profile_url }}",
              "share_count": "={{ $json.share_count }}",
              "offical_item": "={{ $json.offical_item }}",
              "collect_count": "={{ $json.collect_count }}",
              "comment_count": "={{ $json.comment_count }}",
              "original_item": "={{ $json.original_item }}",
              "preview_image": "={{ $json.preview_image }}",
              "original_sound": "={{ $json.original_sound }}",
              "profile_avatar": "={{ $json.profile_avatar }}",
              "tt_chain_token": "={{ $json.tt_chain_token }}",
              "video_duration": "={{ $json.video_duration }}",
              "discovery_input": "={{ $json.discovery_input }}",
              "profile_username": "={{ $json.profile_username }}",
              "profile_biography": "={{ $json.profile_biography }}",
              "profile_followers": "={{ $json.profile_followers }}"
            },
            "schema": [
              {
                "id": "url",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "post_id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "post_id",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "description",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "description",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "create_time",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "create_time",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "digg_count",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "digg_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "share_count",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "share_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "collect_count",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "collect_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "comment_count",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "comment_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "play_count",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "play_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "video_duration",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "video_duration",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "hashtags",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "hashtags",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "original_sound",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "original_sound",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "profile_id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "profile_id",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "profile_username",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "profile_username",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "profile_url",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "profile_url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "profile_avatar",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "profile_avatar",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "profile_biography",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "profile_biography",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "preview_image",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "preview_image",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "post_type",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "post_type",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "discovery_input",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "discovery_input",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "offical_item",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "offical_item",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "secu_id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "secu_id",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "original_item",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "original_item",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "shortcode",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "shortcode",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "width",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "width",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "ratio",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "ratio",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "video_url",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "video_url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "music",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "music",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "cdn_url",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "cdn_url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "is_verified",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "is_verified",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "account_id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "account_id",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "profile_followers",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "profile_followers",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "tt_chain_token",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "tt_chain_token",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "region",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "region",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "timestamp",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "timestamp",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "input",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "input",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "url"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "appendOrUpdate",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 1067534155,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/YOUR_GOOGLE_SHEET_ID/edit#gid=1067534155",
            "cachedResultName": "Tiktok by keyword"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "YOUR_GOOGLE_SHEET_ID",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/YOUR_GOOGLE_SHEET_ID/edit?usp=drivesdk",
            "cachedResultName": "Tiktok by keyword data Scraping "
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "YOUR_GOOGLE_SHEETS_CREDENTIAL_ID",
            "name": "Google Sheets Credential"
          }
        },
        "typeVersion": 4.6
      },
      {
        "id": "e7b9dde9-0cd6-429e-b5ea-1e8269d7df7e",
        "name": "Decode Snapshot from Response",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -900,
          -560
        ],
        "parameters": {
          "url": "=https://api.brightdata.com/datasets/v3/snapshot/s_mbghznsg225nzgyhz8",
          "options": {},
          "sendQuery": true,
          "sendHeaders": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "format",
                "value": "json"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer YOUR_TOKEN_HERE"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "461df00a-925d-4bbf-b28e-7aa367ad54d5",
        "name": "Wait 1 minute",
        "type": "n8n-nodes-base.wait",
        "position": [
          -1540,
          -540
        ],
        "webhookId": "10b45556-5e91-4387-abd0-f9078b220286",
        "parameters": {
          "unit": "minutes",
          "amount": 1
        },
        "typeVersion": 1.1
      },
      {
        "id": "f15192de-4d53-4716-a2d1-876494712c81",
        "name": "Accepts keyword input from the user.",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -2580,
          -540
        ],
        "webhookId": "781b36e7-1076-4ddf-9541-bab8c9d4386c",
        "parameters": {
          "options": {},
          "formTitle": "TikTok ",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Keyword"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "a1bcfe64-ac31-43c2-b0d5-33caa9ef50a6",
        "name": "Sends keyword to Bright Data's Discover API to start scraping.",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -2280,
          -540
        ],
        "parameters": {
          "url": "https://api.brightdata.com/datasets/v3/trigger",
          "method": "POST",
          "options": {},
          "jsonBody": "=[\n  {\n    \"search_keyword\": \"{{ $json.Keyword }}\",\n    \"country\": \"\"\n  },\n  {\n    \"search_keyword\": \"{{ $json.Keyword }}\",\n    \"country\": \"\"\n  },\n  {\n    \"search_keyword\": \"{{ $json.Keyword }}\",\n    \"country\": \"\"\n  }\n]",
          "sendBody": true,
          "sendQuery": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "queryParameters": {
            "parameters": [
              {
                "name": "dataset_id",
                "value": "gd_lu702nij2f790tmv9h"
              },
              {
                "name": "include_errors",
                "value": "true"
              },
              {
                "name": "type",
                "value": "discover_new"
              },
              {
                "name": "discover_by",
                "value": "keyword"
              },
              {
                "name": "limit_per_input",
                "value": "2"
              }
            ]
          },
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer YOUR_TOKEN_HERE"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "da3fc0d4-98a6-48a3-b691-6e29db0969c0",
        "name": "Checks the scraping status using snapshot ID.",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -1880,
          -540
        ],
        "parameters": {
          "url": "=https://api.brightdata.com/datasets/v3/progress/{{ $json.snapshot_id }}",
          "options": {},
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer YOUR_TOKEN_HERE"
              }
            ]
          }
        },
        "typeVersion": 4.2,
        "alwaysOutputData": true
      },
      {
        "id": "76797c1e-d329-4003-af3f-fac14a3fbdc8",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2660,
          -680
        ],
        "parameters": {
          "color": 3,
          "width": 280,
          "height": 340,
          "content": "üü• 1. Form Trigger Node\nüìå Purpose:\n\nUser submits a keyword input.\n\nThis starts the scraping process.\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "b849575e-2a93-42e3-a084-f536e634e035",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2360,
          -760
        ],
        "parameters": {
          "color": 4,
          "width": 340,
          "height": 420,
          "content": "üü© 2. HTTP Request (Trigger Scraping on Bright Data)\nüîó POST to Bright Data\n\nSends the keyword to Bright Data.\n\nTriggers scraping using dataset ID.\n\nTikTok keyword-based discovery initiated.\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "e3648a2b-a0e7-41ab-9794-bd8fa1faf16a",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1980,
          -700
        ],
        "parameters": {
          "color": 5,
          "width": 320,
          "height": 360,
          "content": "üü¶ 3. Snapshot Progress Check\nüîç GET - snapshot status\n\nFetches the current snapshot_id.\n\nChecks if the scraping task is finished (status == ready)."
        },
        "typeVersion": 1
      },
      {
        "id": "850f3c9d-2184-42b7-b6c5-e155c2d43f57",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1320,
          -720
        ],
        "parameters": {
          "color": 2,
          "width": 260,
          "height": 360,
          "content": "üü™ 4. IF Node (Check Completion)\nüìå Condition:\n\nIf snapshot is ready ‚Üí move forward.\n\nElse ‚Üí wait and retry."
        },
        "typeVersion": 1
      },
      {
        "id": "3a54a9d4-07ff-4e04-831b-f618e9bdd48b",
        "name": "Check Final Status",
        "type": "n8n-nodes-base.if",
        "position": [
          -1240,
          -540
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "35ed620d-b5d5-4e97-bcc5-52b283d85616",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status }}",
                "rightValue": "ready"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "5cca9c7d-d10c-4817-9d10-d0c904ad059b",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1640,
          -720
        ],
        "parameters": {
          "color": 6,
          "width": 280,
          "height": 380,
          "content": "üü• 5. Wait Node\nüïí Delays by 1 minute\n\nIf snapshot is not ready, pause for 1 minute.\n\nThen return to recheck loop."
        },
        "typeVersion": 1
      },
      {
        "id": "75b635ea-6e6c-41e7-8cae-168b2c6f8c00",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -640,
          -740
        ],
        "parameters": {
          "color": 3,
          "width": 300,
          "height": 380,
          "content": "üü® 6. Final Data Storage\nüìå Google Sheets Integration:\n\nStores extracted TikTok data.\n\nIncludes all post metrics and profile info.\n\n"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "e61d0a2b-f49c-4f76-ae0c-55f397d4ea32",
    "connections": {
      "Google Sheets": {
        "main": [
          []
        ]
      },
      "Wait 1 minute": {
        "main": [
          [
            {
              "node": "Check Final Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Final Status": {
        "main": [
          [
            {
              "node": "Decode Snapshot from Response",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Checks the scraping status using snapshot ID.",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Decode Snapshot from Response": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Accepts keyword input from the user.": {
        "main": [
          [
            {
              "node": "Sends keyword to Bright Data's Discover API to start scraping.",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Checks the scraping status using snapshot ID.": {
        "main": [
          [
            {
              "node": "Wait 1 minute",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sends keyword to Bright Data's Discover API to start scraping.": {
        "main": [
          [
            {
              "node": "Checks the scraping status using snapshot ID.",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "nodes": [
      {
        "name": "Telegram Bot (Webhook)",
        "type": "n8n-nodes-base.telegramBot",
        "position": [
          250,
          200
        ],
        "parameters": {
          "webhookUrl": "=https://api.telegram.org/bot{{$env.YOUR_TELEGRAM_BOT_TOKEN}}/getUpdates",
          "pollInterval": 5,
          "allowedUpdates": [
            "message"
          ],
          "onlyNewUpdates": true
        },
        "typeVersion": 1
      },
      {
        "name": "Check 'Photo'",
        "type": "n8n-nodes-base.if",
        "position": [
          450,
          500
        ],
        "parameters": {
          "conditions": [
            {
              "value1": "={{$json.message.photo}}",
              "value2": "true",
              "operation": "isNotEmpty"
            }
          ]
        },
        "typeVersion": 1
      },
      {
        "name": "Get Telegram Photo",
        "type": "n8n-nodes-base.telegramBot",
        "position": [
          700,
          500
        ],
        "parameters": {
          "chatId": "={{$json.message.chat.id}}",
          "fileId": "={{$json.message.photo[{$json.message.photo.length - 1}].file_id}}",
          "operation": "getFile"
        },
        "typeVersion": 1
      },
      {
        "name": "OCR.space Request",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          950,
          500
        ],
        "parameters": {
          "url": "https://api.ocr.space/parse/image",
          "method": "POST",
          "options": {
            "query": [
              {
                "name": "apikey",
                "value": "={{$env.YOUR_OCR_SPACE_API_KEY}}"
              },
              {
                "name": "language",
                "value": "eng"
              },
              {
                "name": "isOverlayRequired",
                "value": "true"
              }
            ],
            "bodyParameters": [
              {
                "name": "file",
                "value": "={{$binary.data}}"
              }
            ],
            "bodyContentType": "formData"
          }
        },
        "typeVersion": 1
      },
      {
        "name": "Send Raw OCR Text",
        "type": "n8n-nodes-base.telegramBot",
        "position": [
          1200,
          500
        ],
        "parameters": {
          "text": "OCR Text Found:\n\n*{{$json.ParsedResults[0].ParsedText}}*",
          "chatId": "={{$json.message.chat.id}}",
          "parseMode": "HTML"
        },
        "typeVersion": 1
      }
    ],
    "connections": {
      "Check 'Photo'": {
        "output": [
          {
            "node": "Get Telegram Photo",
            "type": "main",
            "index": 0
          }
        ]
      },
      "OCR.space Request": {
        "output": [
          {
            "node": "Send Raw OCR Text",
            "type": "main",
            "index": 0
          }
        ]
      },
      "Get Telegram Photo": {
        "output": [
          {
            "node": "OCR.space Request",
            "type": "main",
            "index": 0
          }
        ]
      },
      "Telegram Bot (Webhook)": {
        "output": [
          {
            "node": "Check 'Photo'",
            "type": "main",
            "index": 0
          }
        ]
      }
    }
  },
  {
    "id": "K9qVquFhgKL4K7Sy",
    "meta": {
      "instanceId": "8443f10082278c46aa5cf3acf8ff0f70061a2c58bce76efac814b16290845177",
      "templateCredsSetupCompleted": true
    },
    "name": "Lead Source Quality Analyzer",
    "tags": [],
    "nodes": [
      {
        "id": "d4979a88-400d-4ce0-a27e-e0465b248e7e",
        "name": "When clicking ‚ÄòExecute workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          32,
          608
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "1a91fc6a-fa5b-4985-ae23-d9e02e2ad1dd",
        "name": "Sticky Note - Workflow Overview",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -336,
          496
        ],
        "parameters": {
          "color": 4,
          "width": 320,
          "height": 280,
          "content": "## üìä WORKFLOW START\n\nThis workflow analyzes lead source quality by:\n1. Fetching opportunities from HighLevel\n2. Filtering won deals\n3. Computing conversion metrics\n4. Sending reports to Slack and Google Sheets\n\n**Trigger:** Manual execution"
        },
        "typeVersion": 1
      },
      {
        "id": "8908da61-371e-4efe-986f-199ef3889a1a",
        "name": "Sticky Note - Fetch Data",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          112,
          304
        ],
        "parameters": {
          "color": 5,
          "width": 280,
          "height": 284,
          "content": "## üéØ FETCH OPPORTUNITIES\n\nRetrieves all opportunities from HighLevel CRM.\n\nThis is the data source for the entire analysis.\n\n**Output:** List of all opportunities with status, amount, and lead source information."
        },
        "typeVersion": 1
      },
      {
        "id": "0cf6069e-5d6f-4337-b213-1931fb787104",
        "name": "Sticky Note - Filtering Logic",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          352,
          768
        ],
        "parameters": {
          "color": 6,
          "width": 300,
          "height": 296,
          "content": "## ‚úÖ FILTER WON DEALS\n\nSplits the workflow into two paths:\n\n**TRUE Path:** Opportunities with status = 'won'\n‚Üí Goes to analysis and reporting\n\n**FALSE Path:** All other opportunities\n‚Üí Sends individual notifications to Slack\n\nThis ensures only successful deals are analyzed for lead source quality."
        },
        "typeVersion": 1
      },
      {
        "id": "d751b397-2da7-468c-af32-c469485e9847",
        "name": "Sticky Note - Analytics",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          720,
          240
        ],
        "parameters": {
          "color": 7,
          "width": 520,
          "height": 240,
          "content": "## üìà ANALYTICS PIPELINE\n\nProcesses won deals through:\n\n1. **Google Sheets:** Logs raw won deal data\n2. **Metrics Calculation:** Aggregates by lead source\n3. **Slack Report:** Sends summary to team\n\nThis pipeline provides both raw data storage and actionable insights."
        },
        "typeVersion": 1
      },
      {
        "id": "ba86138e-0226-401c-84c3-22ab9b9baecc",
        "name": "Sticky Note - Status Alerts",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          880,
          800
        ],
        "parameters": {
          "color": 3,
          "width": 280,
          "height": 268,
          "content": "## üîî NON-WON NOTIFICATION\n\nSends individual Slack messages for opportunities that are NOT won.\n\nUseful for tracking:\n- Lost opportunities\n- Pending deals\n- Other statuses requiring attention"
        },
        "typeVersion": 1
      },
      {
        "id": "48d32b33-0535-4cda-9f9b-aaf70d494950",
        "name": "Log Won Deals to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          720,
          512
        ],
        "parameters": {
          "range": "Sheet1!A1:D1",
          "options": {},
          "sheetId": "<YOUR_GOOGLE_SHEET_ID>",
          "authentication": "oAuth2"
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "s4dP1fNuVZ2gWvs3",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "66b4ddec-d5ed-47b7-8392-dc048b75f4cb",
        "name": "Calculate Lead Source Metrics",
        "type": "n8n-nodes-base.function",
        "position": [
          944,
          512
        ],
        "parameters": {
          "functionCode": "const sourceData = items.map(i => i.json);\nconst result = {};\n\nsourceData.forEach(deal => {\n  const source = deal.leadSource;\n  if (!result[source]) result[source] = { deals: 0, totalAmount: 0 };\n  result[source].deals += 1;\n  result[source].totalAmount += parseFloat(deal.amount || 0);\n});\n\nreturn [{ json: result }];"
        },
        "typeVersion": 1
      },
      {
        "id": "8f3105fb-6b5c-4882-8144-6cde4aadb837",
        "name": "Send Analytics to Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          1168,
          512
        ],
        "parameters": {
          "text": "={{JSON.stringify($json, null, 2)}}",
          "channel": "#lead-source-report",
          "attachments": [],
          "otherOptions": {}
        },
        "credentials": {
          "slackApi": {
            "id": "rNqvWj9TfChPVRYY",
            "name": "Slack account vivek"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "c635333b-e2ff-403c-ad24-809d7ff7b2ac",
        "name": "Fetch All HighLevel Opportunities",
        "type": "n8n-nodes-base.highLevel",
        "position": [
          272,
          608
        ],
        "parameters": {
          "filters": {},
          "resource": "opportunity",
          "operation": "getAll",
          "returnAll": true,
          "requestOptions": {}
        },
        "credentials": {
          "highLevelOAuth2Api": {
            "id": "5QWHSi134dLIBEsC",
            "name": "HighLevel account"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "bca4f587-dc3a-4979-9d80-8f172d6f888a",
        "name": "Check If Status = Won",
        "type": "n8n-nodes-base.if",
        "position": [
          496,
          608
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "101c298b-4c62-4273-9d25-bad055eff980",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status }}",
                "rightValue": "=won"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "5c2b45bc-4c6a-4263-b5a6-f56e796f7aee",
        "name": "Alert Non-Won Status to Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          720,
          704
        ],
        "webhookId": "87d944e1-4d16-4154-bb7c-cb36637272df",
        "parameters": {
          "text": "=Opportuniy id: {{ $json.id }} is {{ $json.status }}",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "list",
            "value": "C09GNB90TED",
            "cachedResultName": "general-information"
          },
          "otherOptions": {}
        },
        "credentials": {
          "slackApi": {
            "id": "rNqvWj9TfChPVRYY",
            "name": "Slack account vivek"
          }
        },
        "typeVersion": 2.3
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "0baa1992-9f7c-4c69-94bd-25d9fe883283",
    "connections": {
      "Check If Status = Won": {
        "main": [
          [
            {
              "node": "Log Won Deals to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Alert Non-Won Status to Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Won Deals to Sheets": {
        "main": [
          [
            {
              "node": "Calculate Lead Source Metrics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Lead Source Metrics": {
        "main": [
          [
            {
              "node": "Send Analytics to Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch All HighLevel Opportunities": {
        "main": [
          [
            {
              "node": "Check If Status = Won",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòExecute workflow‚Äô": {
        "main": [
          [
            {
              "node": "Fetch All HighLevel Opportunities",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "FJU3f2ANp6c9kw2k",
    "meta": {
      "instanceId": "60046904b104f0f72b2629a9d88fe9f676be4035769f1f08dad1dd38a76b9480",
      "templateCredsSetupCompleted": true
    },
    "name": "19 Monitor Keyword Rankings",
    "tags": [],
    "nodes": [
      {
        "id": "cbb327c9-e995-49c6-b933-65d5667afb3d",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          460,
          260
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8sEyPDkC5p4w4Jha",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "fb426c60-7ab8-485d-a5c8-7343b701580c",
        "name": "MCP Client",
        "type": "n8n-nodes-mcp.mcpClientTool",
        "position": [
          640,
          260
        ],
        "parameters": {
          "toolName": "search_engine",
          "operation": "executeTool",
          "toolParameters": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Tool_Parameters', ``, 'json') }}"
        },
        "credentials": {
          "mcpClientApi": {
            "id": "eqq94k789oJCd6jU",
            "name": "MCP Client (STDIO) account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "de8164ef-9546-45dd-b1d2-b75f6f7e617d",
        "name": "üïí Trigger: Run Daily/Weekly",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          0,
          0
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 9
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "53338cbc-add1-4881-80e8-35f6f86588ed",
        "name": "üìù Input: Keyword & Domain",
        "type": "n8n-nodes-base.set",
        "position": [
          200,
          0
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "95b1399f-4709-46e0-89a9-cbf17ce9c06c",
                "name": "keyword",
                "type": "string",
                "value": "best running shoes"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "73fecf1f-284d-403d-abe0-ee19818066e4",
        "name": "ü§ñ SERP Scraper Agent (MCP)",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          480,
          0
        ],
        "parameters": {
          "text": "=Based on the following keyword, provide me ranking of the 1st 5 website.\nkeyword: {{ $json.keyword }}",
          "options": {},
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 2
      },
      {
        "id": "2c635b80-4d63-46a9-90a9-7a24c4f06719",
        "name": "üß† Format SERP Results",
        "type": "n8n-nodes-base.code",
        "position": [
          960,
          0
        ],
        "parameters": {
          "jsCode": "// Get the SERP list from the incoming item\nconst serpList = items[0].json.output;\n\n// Emit each result as a separate item\nreturn serpList.map(result => {\n  return {\n    json: result\n  };\n});\n"
        },
        "typeVersion": 2
      },
      {
        "id": "80cae567-a9eb-4c90-aacb-31be114960c3",
        "name": "üìä Log to Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1180,
          0
        ],
        "parameters": {
          "columns": {
            "value": {
              "URL": "={{ $json.url }}",
              "Rank": "={{ $json.rank }}",
              "Title": "={{ $json.title }}",
              "Description": "={{ $json.description }}"
            },
            "schema": [
              {
                "id": "Title",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Title",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "URL",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "URL",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Description",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Description",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Rank",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Rank",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "appendOrUpdate",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1p64unH_JjzG978cAxPZC4kSZmoXgvYTA-Q7qdfnxr8Y/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1p64unH_JjzG978cAxPZC4kSZmoXgvYTA-Q7qdfnxr8Y",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1p64unH_JjzG978cAxPZC4kSZmoXgvYTA-Q7qdfnxr8Y/edit?usp=drivesdk",
            "cachedResultName": "Website Ranking"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "r2mDaisH6e9VkwHl",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.6
      },
      {
        "id": "685c2bb4-37d7-466b-b3f2-9b844298843a",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -20,
          -1120
        ],
        "parameters": {
          "color": 6,
          "width": 360,
          "height": 1320,
          "content": "## üü¶ **Section 1: Input & Trigger Configuration**\n\n### üïí **Trigger: Run Daily/Weekly**\n\nüîß **Node Name:** `Trigger: Run Daily/Weekly`\nüí° **What it does:**\nThis node automatically starts your workflow on a set schedule. You can run it:\n\n* Daily to monitor SEO fluctuations\n* Weekly to track long-term trends\n\nüìå **Why it's useful:**\nNo manual work is needed. Just set it once and it keeps your ranking logs up to date.\n\n---\n\n### üìù **Input: Keyword & Domain**\n\nüîß **Node Name:** `Input: Keyword & Domain`\nüí° **What it does:**\nHere you provide the **search keyword** (like `\"best running shoes\"`) and optionally the **domain name** (like `\"yourwebsite.com\"`) to monitor.\n\nüìå **Why it's useful:**\nYou can change or extend keywords anytime without changing the rest of the workflow. Great for campaign flexibility.\n\n---\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "05accd72-2d70-47cb-8632-26e16dcbcfde",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          440,
          -1080
        ],
        "parameters": {
          "color": 3,
          "width": 340,
          "height": 1280,
          "content": "## üü® **Section 2: Smart SERP Scraping with AI Agent**\n\n### ü§ñ **SERP Scraper Agent (MCP)**\n\nüîß **Node Name:** `SERP Scraper Agent (MCP)`\nüí° **What it does:**\nThis is your smart agent that uses **Bright Data's MCP (Mobile Carrier Proxy)** to simulate real user behavior and scrape **Google Search Results** accurately.\n\nIt connects to:\n\n#### üß† **AI Brain**\n\nüîß **Sub-node:** `OpenAI Chat Model`\nüéØ Understands the keyword, crafts a natural query prompt, and makes sure the search context is accurate.\n\n#### üåê **MCP SERP Fetcher**\n\nüîß **Sub-node:** `MCP Client`\nüõ∞Ô∏è Actually performs the search on Google and fetches the **top 5 results** anonymously through real mobile-like connections (bypassing CAPTCHAs & blocks).\n\n#### üßæ **SERP Output Formatter**\n\nüîß **Sub-node:** `Structured Output Parser`\nüßπ Cleans up the scraped data and structures it into useful fields:\n\n* `rank`\n* `title`\n* `url`\n* `description`\n\nüìå **Why it's useful:**\nTraditional scrapers break often. This smart setup ensures highly accurate, undetectable scraping that adapts to changes in search results.\n\n---\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "7dbd367a-a156-4ee0-b6c3-73c2414aceb7",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          920,
          -900
        ],
        "parameters": {
          "color": 5,
          "width": 400,
          "height": 1100,
          "content": "## üü© **Section 3: Rank Logging and Reporting**\n\n### üß† **Parse SERP Results**\n\nüîß **Node Name:** `Parse SERP Results`\nüí° **What it does:**\nThis **Code node** takes the structured list of top 5 results and **splits them into individual records**, one per website.\n\nüìå **Why it's useful:**\nIt prepares the data so each row can be logged separately in your spreadsheet, which makes filtering, charting, and comparison super easy.\n\n---\n\n### üìä **Log to Google Sheets**\n\nüîß **Node Name:** `Log to Google Sheets`\nüí° **What it does:**\nAppends each parsed search result (rank, title, URL, description) into your tracking spreadsheet.\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "a9b9be2f-c21e-499d-939b-b07f0a88d4cf",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1420,
          -900
        ],
        "parameters": {
          "color": 7,
          "width": 380,
          "height": 240,
          "content": "## I‚Äôll receive a tiny commission if you join Bright Data through this link‚Äîthanks for fueling more free content!\n\n### https://get.brightdata.com/1tndi4600b25"
        },
        "typeVersion": 1
      },
      {
        "id": "2613a78d-33b1-4807-b363-d590c171a870",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1680,
          -1120
        ],
        "parameters": {
          "color": 4,
          "width": 1300,
          "height": 320,
          "content": "=======================================\n            WORKFLOW ASSISTANCE\n=======================================\nFor any questions or support, please contact:\n    Yaron@nofluff.online\n\nExplore more tips and tutorials here:\n   - YouTube: https://www.youtube.com/@YaronBeen/videos\n   - LinkedIn: https://www.linkedin.com/in/yaronbeen/\n=======================================\n"
        },
        "typeVersion": 1
      },
      {
        "id": "f425a1ba-751f-4ac6-90f4-afea94889d9c",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1680,
          -780
        ],
        "parameters": {
          "color": 4,
          "width": 1289,
          "height": 2558,
          "content": "## üîç **Workflow: Monitor Keyword Rankings with AI & Bright Data MCP**\n\nTrack where your website ranks on Google for specific keywords, using AI-powered scraping and structured logging in Google Sheets.\n\n---\n\n## üü¶ **Section 1: Input & Trigger Configuration**\n\n### üïí **Trigger: Run Daily/Weekly**\n\nüîß **Node Name:** `Trigger: Run Daily/Weekly`\nüí° **What it does:**\nThis node automatically starts your workflow on a set schedule. You can run it:\n\n* Daily to monitor SEO fluctuations\n* Weekly to track long-term trends\n\nüìå **Why it's useful:**\nNo manual work is needed. Just set it once and it keeps your ranking logs up to date.\n\n---\n\n### üìù **Input: Keyword & Domain**\n\nüîß **Node Name:** `Input: Keyword & Domain`\nüí° **What it does:**\nHere you provide the **search keyword** (like `\"best running shoes\"`) and optionally the **domain name** (like `\"yourwebsite.com\"`) to monitor.\n\nüìå **Why it's useful:**\nYou can change or extend keywords anytime without changing the rest of the workflow. Great for campaign flexibility.\n\n---\n\n## üü® **Section 2: Smart SERP Scraping with AI Agent**\n\n### ü§ñ **SERP Scraper Agent (MCP)**\n\nüîß **Node Name:** `SERP Scraper Agent (MCP)`\nüí° **What it does:**\nThis is your smart agent that uses **Bright Data's MCP (Mobile Carrier Proxy)** to simulate real user behavior and scrape **Google Search Results** accurately.\n\nIt connects to:\n\n#### üß† **AI Brain**\n\nüîß **Sub-node:** `OpenAI Chat Model`\nüéØ Understands the keyword, crafts a natural query prompt, and makes sure the search context is accurate.\n\n#### üåê **MCP SERP Fetcher**\n\nüîß **Sub-node:** `MCP Client`\nüõ∞Ô∏è Actually performs the search on Google and fetches the **top 5 results** anonymously through real mobile-like connections (bypassing CAPTCHAs & blocks).\n\n#### üßæ **SERP Output Formatter**\n\nüîß **Sub-node:** `Structured Output Parser`\nüßπ Cleans up the scraped data and structures it into useful fields:\n\n* `rank`\n* `title`\n* `url`\n* `description`\n\nüìå **Why it's useful:**\nTraditional scrapers break often. This smart setup ensures highly accurate, undetectable scraping that adapts to changes in search results.\n\n---\n\n## üü© **Section 3: Rank Logging and Reporting**\n\n### üß† **Parse SERP Results**\n\nüîß **Node Name:** `Parse SERP Results`\nüí° **What it does:**\nThis **Code node** takes the structured list of top 5 results and **splits them into individual records**, one per website.\n\nüìå **Why it's useful:**\nIt prepares the data so each row can be logged separately in your spreadsheet, which makes filtering, charting, and comparison super easy.\n\n---\n\n### üìä **Log to Google Sheets**\n\nüîß **Node Name:** `Log to Google Sheets`\nüí° **What it does:**\nAppends each parsed search result (rank, title, URL, description) into your tracking spreadsheet.\n\nüìå **Why it's useful:**\nYou now have a full historical record of how rankings change day by day, week by week. This is great for:\n\n* SEO audits\n* Campaign reporting\n* Alerting when a competitor outranks you\n\n---\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "aea188eb-b9af-4902-8af5-441940c392f6",
        "name": "Auto-fixing Output Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserAutofixing",
        "position": [
          760,
          260
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 1
      },
      {
        "id": "6a7971dc-6694-4752-8154-cfa9e1c0c37c",
        "name": "OpenAI Chat Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          740,
          480
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "8sEyPDkC5p4w4Jha",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "d9f0aa04-25e9-436b-9c83-067736012399",
        "name": "Structured Output Parser1",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          900,
          480
        ],
        "parameters": {
          "jsonSchemaExample": "[\n  {\n    \"rank\": 1,\n    \"title\": \"Runner's World\",\n    \"url\": \"https://www.runnersworld.com/gear/a19663621/best-running-shoes/\",\n    \"description\": \"A comprehensive guide on the best running shoes, recommending models like Brooks Ghost and Nike Pegasus for new runners.\"\n  },\n  {\n    \"rank\": 2,\n    \"title\": \"RunRepeat\",\n    \"url\": \"https://runrepeat.com/catalog/running-shoes\",\n    \"description\": \"Offers running shoe reviews with ratings for various models such as Nike Pegasus 41 and Hoka Mach 6.\"\n  },\n  {\n    \"rank\": 3,\n    \"title\": \"Believe in the Run\",\n    \"url\": \"https://believeintherun.com/shoe-reviews/best-running-shoes-2025/\",\n    \"description\": \"Features an in-depth guide to the best running shoes of 2025 across different categories.\"\n  },\n  {\n    \"rank\": 4,\n    \"title\": \"The Run Testers\",\n    \"url\": \"https://theruntesters.com/running-shoes/the-best-running-shoes-to-buy/\",\n    \"description\": \"Reviews the best running shoes available, highlighting their performance and value.\"\n  },\n  {\n    \"rank\": 5,\n    \"title\": \"Men's Health\",\n    \"url\": \"https://www.menshealth.com/fitness/a64476227/running-shoes-editors-picks/\",\n    \"description\": \"Provides a selection of top running shoes recommended by Men's Health editors.\"\n  }\n]\n"
        },
        "typeVersion": 1.2
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "59c58fd0-444f-4801-9b03-83ac820691d0",
    "connections": {
      "MCP Client": {
        "ai_tool": [
          [
            {
              "node": "ü§ñ SERP Scraper Agent (MCP)",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "ü§ñ SERP Scraper Agent (MCP)",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Auto-fixing Output Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "üß† Format SERP Results": {
        "main": [
          [
            {
              "node": "üìä Log to Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Auto-fixing Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "ü§ñ SERP Scraper Agent (MCP)",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser1": {
        "ai_outputParser": [
          [
            {
              "node": "Auto-fixing Output Parser",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "üìù Input: Keyword & Domain": {
        "main": [
          [
            {
              "node": "ü§ñ SERP Scraper Agent (MCP)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ü§ñ SERP Scraper Agent (MCP)": {
        "main": [
          [
            {
              "node": "üß† Format SERP Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "üïí Trigger: Run Daily/Weekly": {
        "main": [
          [
            {
              "node": "üìù Input: Keyword & Domain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "761a3dddae2bb21eb8973ffca0ba97d5b4f499405873760164a536f547546882",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "a5f53559-6b91-45a9-8822-53439b9c306d",
        "name": "Clean Email",
        "type": "n8n-nodes-base.code",
        "position": [
          -160,
          180
        ],
        "parameters": {
          "jsCode": "// Make sure From exists and is a string\nconst rawFrom = $input.first().json.From;\n\nlet cleanEmail = \"\";\n\n// Proceed only if rawFrom is a valid string\nif (typeof rawFrom === \"string\" && rawFrom.trim() !== \"\") {\n  const match = rawFrom.match(/<(.+?)>/);\n  cleanEmail = match ? match[1] : rawFrom.trim();\n} else {\n  cleanEmail = \"[Missing From field]\";\n}\n\nreturn [\n  {\n    json: {\n      cleanEmail\n    }\n  }\n];\n"
        },
        "typeVersion": 2
      },
      {
        "id": "e6a332b0-529d-489c-9d67-8d7d06bc8044",
        "name": "Gmail",
        "type": "n8n-nodes-base.gmail",
        "position": [
          -160,
          -20
        ],
        "webhookId": "0c25cbb3-b954-4c3a-aabc-9f4473b9f733",
        "parameters": {
          "messageId": "={{ $json.id }}",
          "operation": "markAsRead"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "6I8sq2IhPgySI6XX",
            "name": "Gmail account 2 - infodpatel15"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "032629d7-d41b-4d8f-b545-e98df9cf796c",
        "name": "Send Message",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1380,
          180
        ],
        "webhookId": "836270b1-beef-4520-b024-30b72af1582a",
        "parameters": {
          "text": "=KITE 11: {{ $('Get Email').item.json.snippet }}",
          "chatId": "1520681602",
          "additionalFields": {}
        },
        "credentials": {
          "telegramApi": {
            "id": "bAaBU3SFXiLAdyvU",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "f7e47b44-5ea8-43fa-9054-539e710d3a39",
        "name": "Verify Mail",
        "type": "n8n-nodes-base.if",
        "position": [
          60,
          180
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "7f6c2c11-6204-4f36-8e57-dcc9efc93433",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.cleanEmail }}",
                "rightValue": "=noreply@tradingview.com"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "66b91b39-49f7-44cc-8d9a-f4392c11ff77",
        "name": "Extract Company Name",
        "type": "n8n-nodes-base.code",
        "position": [
          500,
          180
        ],
        "parameters": {
          "jsCode": "// Get subject from previous node (e.g., IMAP Email node)\nconst subject = $input.first().json.Subject;\n\nconst stockSymbol = subject.split('for ')[1]?.trim() || '';\n\nreturn [\n  {\n    json: {\n      symbol: stockSymbol,\n      originalSubject: subject,\n    }\n  }\n];\n"
        },
        "typeVersion": 2
      },
      {
        "id": "ffbbff24-1959-4254-b05c-4a6327edec95",
        "name": "Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1160,
          180
        ],
        "parameters": {
          "columns": {
            "value": {
              "Date": "={{ $json.formattedDate }}",
              "Stock": "={{ $('Extract Company Name').item.json.symbol }}"
            },
            "schema": [
              {
                "id": "Date",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Date",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Stock",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Stock",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1PBvePZN2yvVg23hDIDB62e91ogTgbuNXVduZTai-bZc/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1PBvePZN2yvVg23hDIDB62e91ogTgbuNXVduZTai-bZc",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1PBvePZN2yvVg23hDIDB62e91ogTgbuNXVduZTai-bZc/edit?usp=drivesdk",
            "cachedResultName": "KITE FINAL 11"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "9NecV5qrcx7kjh5f",
            "name": "Google Sheets account 2"
          }
        },
        "typeVersion": 4.5
      },
      {
        "id": "dde99d76-79fe-4650-b7a2-948047b62a16",
        "name": "Current Date & Time",
        "type": "n8n-nodes-base.dateTime",
        "position": [
          720,
          180
        ],
        "parameters": {
          "options": {
            "timezone": "Asia/kolkata"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "7a60d22e-8027-423c-9927-aa2e0759744d",
        "name": "Formatted Date & Time",
        "type": "n8n-nodes-base.dateTime",
        "position": [
          940,
          180
        ],
        "parameters": {
          "date": "={{ $json.currentDate }}",
          "format": "custom",
          "options": {},
          "operation": "formatDate",
          "customFormat": "DD"
        },
        "typeVersion": 2
      },
      {
        "id": "288dec30-51c9-4206-a0d8-5bca9317ec57",
        "name": "Get Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          300,
          180
        ],
        "webhookId": "1fd0763d-5989-4fc4-aa5f-191eb8ee51bc",
        "parameters": {
          "messageId": "={{ $('Email Received').item.json.id }}",
          "operation": "get"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "6I8sq2IhPgySI6XX",
            "name": "Gmail account 2 - infodpatel15"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "20ac9cda-60e1-4a52-a41d-e83485f2c76f",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -400,
          -80
        ],
        "parameters": {
          "color": 7,
          "width": 380,
          "height": 400,
          "content": "## Read Emails"
        },
        "typeVersion": 1
      },
      {
        "id": "9a8cae5e-9601-4500-bde6-8a84837fc378",
        "name": "Email Received",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -380,
          80
        ],
        "parameters": {
          "filters": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "6I8sq2IhPgySI6XX",
            "name": "Gmail account 2 - infodpatel15"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "ff7bbb0d-29a1-458d-8437-089fb0bb4ef4",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          20,
          120
        ],
        "parameters": {
          "color": 7,
          "width": 180,
          "height": 200,
          "content": "## Identify Email"
        },
        "typeVersion": 1
      },
      {
        "id": "70ed236c-3d55-48ec-884c-8bf707139f61",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          240,
          80
        ],
        "parameters": {
          "color": 7,
          "width": 400,
          "height": 260,
          "content": "## Get Email Data - Extract Buy or Sell Signal"
        },
        "typeVersion": 1
      },
      {
        "id": "a86e1c5f-9059-4971-835c-3e39dc176a3e",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          660,
          120
        ],
        "parameters": {
          "color": 7,
          "width": 440,
          "height": 220,
          "content": "## Get Current Date & Time"
        },
        "typeVersion": 1
      },
      {
        "id": "84d9bbe3-ebe6-4edb-b02b-f37c3dfdabdf",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1120,
          120
        ],
        "parameters": {
          "color": 7,
          "width": 420,
          "height": 220,
          "content": "## Update Data On Sheet & Notify"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Get Email": {
        "main": [
          [
            {
              "node": "Extract Company Name",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Clean Email": {
        "main": [
          [
            {
              "node": "Verify Mail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verify Mail": {
        "main": [
          [
            {
              "node": "Get Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Message": {
        "main": [
          []
        ]
      },
      "Google Sheets": {
        "main": [
          [
            {
              "node": "Send Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email Received": {
        "main": [
          [
            {
              "node": "Gmail",
              "type": "main",
              "index": 0
            },
            {
              "node": "Clean Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Current Date & Time": {
        "main": [
          [
            {
              "node": "Formatted Date & Time",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Company Name": {
        "main": [
          [
            {
              "node": "Current Date & Time",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatted Date & Time": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "2f17285f1745a5069c9edd8be78921f40c6549f5b2e1cfd76834c7f73edd2c07",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "02628817-d072-4caa-b935-945d09f57a85",
        "name": "When clicking ‚ÄòTest workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          0,
          0
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "7361f9a8-d834-49d3-b0c1-bb4510f654cc",
        "name": "Gmail",
        "type": "n8n-nodes-base.gmail",
        "position": [
          220,
          0
        ],
        "webhookId": "326419f6-008b-4814-b55d-efaae118eab7",
        "parameters": {
          "limit": 1,
          "simple": false,
          "filters": {
            "sender": "decodeai@ghost.io"
          },
          "options": {},
          "operation": "getAll"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "pwMK2jDEWY5arMX3",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "39e63d5f-db0d-4fc6-a5e8-a9ac3c2a703c",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          816,
          0
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "message.content.news_items"
        },
        "typeVersion": 1
      },
      {
        "id": "70e64a00-8dc0-4ef4-a4fd-3ac2e50c8fb3",
        "name": "Extract News Items",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          440,
          0
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "o3-mini-2025-01-31",
            "cachedResultName": "O3-MINI-2025-01-31"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Given the following newsletter content, identify and summarize the 5 main news items. Focus on factual updates like new AI tools, product launches, or strategic investments. For each item, extract a headline and provide a concise summary. Please ignore purely promotional sections (e.g., calls to book demos or product advertisements).\n\n<text>\n{{ $json.text }}\n</text>"
              }
            ]
          },
          "jsonOutput": true
        },
        "credentials": {
          "openAiApi": {
            "id": "29u49HnATSs6YuKN",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "cecf013b-bcf2-49a3-acc2-b81e355446b6",
        "name": "Create LinkedIn Posts",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1040,
          0
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "o3-mini-2025-01-31",
            "cachedResultName": "O3-MINI-2025-01-31"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Using the news item details below:\n\nHeadline: {{ $json.headline }}\nSummary: {{ $json.summary }}\n\nCraft a concise, non-promotional LinkedIn post in a smart, deadpan style with subtle humor. Focus on clearly conveying the main points and insights so readers gain practical value. \n- Break up the text into short paragraphs or bullet points for clarity.\n- Use line breaks where helpful.\n- End with an observation or question that encourages reflection‚Äîwithout being overly salesy or flashy.\n- Keep it under 80 words total.\n\n"
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "29u49HnATSs6YuKN",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "31412fb3-ef9a-4c98-840b-a97fd7075181",
        "name": "LinkedIn",
        "type": "n8n-nodes-base.linkedIn",
        "position": [
          1420,
          0
        ],
        "parameters": {
          "text": "={{ $json.message.content }}",
          "person": "EI5XKdiMv1",
          "additionalFields": {}
        },
        "credentials": {
          "linkedInOAuth2Api": {
            "id": "G3JLFJtB5Y7q9FSY",
            "name": "LinkedIn account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a80f43a1-35c8-4f41-8d96-6e64e4ae0cf7",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -20,
          -620
        ],
        "parameters": {
          "width": 900,
          "height": 520,
          "content": "# Workflow Overview\n\n**Name:** Transform Gmail Newsletters into Insightful LinkedIn Posts Using OpenAI\n\n**Purpose:**  \n- **Filter Newsletters:** Use the Gmail node to process emails from a specific sender (e.g., `newsletter@example.com`).  \n- **Extract Key Items:** Leverage an OpenAI node to identify and summarize the top news items from each newsletter.  \n- **Generate Posts:** Automatically create concise, informative, and subtly humorous LinkedIn posts for each news item.  \n- **Publish:** Post the refined content to your LinkedIn account with the LinkedIn node.\n\n**Setup Steps:**  \n1. **Gmail Node:** Configure and rename to \"Filter Gmail Newsletter\" with the appropriate sender filter.  \n2. **OpenAI Nodes:** Ensure API credentials are set; customize prompt texts if desired.  \n3. **LinkedIn Node:** Rename to \"Post to LinkedIn\" and verify correct OAuth2 credentials.\n\n**Customization Tips:**  \n- Modify the OpenAI prompts to fine-tune the tone and structure of the LinkedIn posts.  \n- Add additional formatting (e.g., Function nodes) for post readability if needed.\n\n*This workflow turns your regular newsletters into engaging, ready-to-share LinkedIn insights in just a few simple steps!*\n"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Gmail": {
        "main": [
          [
            {
              "node": "Extract News Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Create LinkedIn Posts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract News Items": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create LinkedIn Posts": {
        "main": [
          [
            {
              "node": "LinkedIn",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòTest workflow‚Äô": {
        "main": [
          [
            {
              "node": "Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "3378b0d68c3b7ebfc71b79896d94e1a044dec38e99a1160aed4e9c323910fbe2"
    },
    "nodes": [
      {
        "id": "6d8263d8-298e-48ff-ab17-92c9f4ccb997",
        "name": "Download Audio",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          208,
          144
        ],
        "parameters": {
          "url": "=https://api.upload-post.com/api/uploadposts/ffmpeg/jobs/{{ $json.job_id }}/download",
          "options": {
            "response": {
              "response": {}
            }
          },
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Upload-post mutonseo"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "5f87dd99-6d60-4c5f-a74c-bfa249153e9e",
        "name": "FFmpeg: Extract Audio",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -496,
          272
        ],
        "parameters": {
          "url": "https://api.upload-post.com/api/uploadposts/ffmpeg/jobs/upload",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "multipart-form-data",
          "sendHeaders": true,
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "file",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "Video"
              },
              {
                "name": "full_command",
                "value": "=ffmpeg -y -i {input} -map a:0 -vn -ac 1 -ar 16000 -c:a pcm_s16le {output}"
              },
              {
                "name": "output_extension",
                "value": "wav"
              }
            ]
          },
          "genericAuthType": "httpHeaderAuth",
          "headerParameters": {
            "parameters": [
              {}
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Upload-post mutonseo"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "687ed081-a970-4f55-b5ed-047da7ab9217",
        "name": "Schedule to TikTok, Instagram, and YouTube",
        "type": "n8n-nodes-upload-post.uploadPost",
        "position": [
          2432,
          128
        ],
        "parameters": {
          "user": "influencersde",
          "title": "={{ $('Parse Gemini Analysis').item.json.video_description_for_tiktok }}",
          "video": "data",
          "platform": [
            "tiktok",
            "instagram",
            "youtube"
          ],
          "operation": "uploadVideo",
          "youtubeTitle": "={{ $('Parse Gemini Analysis').item.json.video_title_for_youtube_short }}",
          "scheduledDate": "={{ \n  $now\n    .setZone('Europe/Madrid')\n    .plus({ days: $itemIndex + 1 })   // +1 = empieza ma√±ana\n    .set({ hour: 15, minute: 0, second: 0, millisecond: 0 })\n    .toFormat('yyyy-LL-dd HH:mm:ss')  // si tu nodo acepta este formato\n}}\n",
          "instagramTitle": "={{ $('Parse Gemini Analysis').item.json.video_description_for_instagram }}",
          "waitForCompletion": "="
        },
        "credentials": {
          "uploadPostApi": {
            "id": "mREXP5Q3Gj5dS52e",
            "name": "Smoker"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "0cee305a-553d-45f6-93e4-604f624e6409",
        "name": "Parse Whisper Results",
        "type": "n8n-nodes-base.code",
        "position": [
          576,
          144
        ],
        "parameters": {
          "jsCode": "// Input: item.json.{text, words, duration} del nodo Whisper\nreturn items.map(item => {\n  const dur = Number(item.json.duration || 0);\n\n  // Redondea a 3 decimales y mantiene tipo number\n  const round3 = (n) => Math.round(Number(n) * 1000) / 1000;\n\n  const wordsLLM = (item.json.words || []).map(w => ({\n    w: w.word,\n    s: round3(w.start),\n    e: round3(w.end),\n  }));\n\n  item.json.video_duration = round3(dur);\n  item.json.words_llm = wordsLLM;      // array limpio para la IA\n  item.json.text_llm  = item.json.text; // texto tal cual (o l√≠mpialo si quieres)\n\n  return item;\n});\n"
        },
        "typeVersion": 2
      },
      {
        "id": "afaf8237-f4e5-401f-b6c9-1073d51e274c",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          784,
          352
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "googlePalmApi": {
            "id": "Pz5rkKL1ZRGrSYoQ",
            "name": "key studio google"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "2c2b2df2-feec-4454-b178-e1eb7732ee21",
        "name": "AI Agent - Select Viral Clips",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          784,
          144
        ],
        "parameters": {
          "text": "=You are a senior short-form video editor. Read the ENTIRE transcription and word-level timestamps to pick the 3‚Äì15 MOST VIRAL moments for TikTok/IG Reels/YouTube Shorts. Each clip must be 15‚Äì60 seconds.\n\n‚ö†Ô∏è FFMPEG TIMING CONTRACT ‚Äî HARD REQUIREMENTS:\n- Return timestamps as ABSOLUTE SECONDS from video start (usable in: ffmpeg -ss <start> -to <end> -i <input> ‚Ä¶).\n- Numbers ONLY with DOT decimal, up to 3 decimals (examples: 0, 1.250, 17.350).\n- Ensure 0 ‚â§ start < end ‚â§ VIDEO_DURATION_SECONDS.\n- Each clip 15‚Äì60s inclusive.\n- Prefer starting 0.2‚Äì0.4s BEFORE the hook and ending 0.2‚Äì0.4s AFTER the payoff.\n- Use silent moments for natural cuts; never cut mid-word or mid-phrase.\n- STRICTLY NO time formats other than absolute seconds.\n\nVIDEO_DURATION_SECONDS: {{ $json.video_duration }}\n\nTRANSCRIPT_TEXT (raw):\n{{ JSON.stringify($json.text_llm) }}\n\nWORDS_JSON (array of {w, s, e} where s/e are seconds):\n{{ JSON.stringify($json.words_llm) }}\n\nHARD EXCLUSIONS:\n- No generic intros/outros or sponsor-only segments unless they contain the hook.\n- No clips < 15s or > 60s.\n\nOUTPUT ‚Äî RETURN ONLY VALID JSON (no markdown, no comments). Order clips by predicted performance (best first):\n{\n  \"shorts\": [\n    {\n      \"start\": <number seconds, e.g. 12.340>,\n      \"end\": <number seconds, e.g. 37.900>,\n      \"video_description_for_tiktok\": \"<tiktok video description for get views>\",\n      \"video_description_for_instagram\": \"<instagram video description for get views>\",\n      \"video_title_for_youtube_short\": \"<youtube short video title for get views>\",\n\n    }\n  ]\n}\n",
          "options": {},
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "839b4b11-670f-49ad-8bca-7ef00f5e3f86",
        "name": "Whisper: Transcribe with Timestamps",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          384,
          144
        ],
        "parameters": {
          "url": "https://api.openai.com/v1/audio/transcriptions",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "multipart-form-data",
          "authentication": "predefinedCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "file",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "data"
              },
              {
                "name": "model",
                "value": "whisper-1"
              },
              {
                "name": "response_format",
                "value": "verbose_json"
              },
              {
                "name": "timestamp_granularities[]",
                "value": "word"
              }
            ]
          },
          "nodeCredentialType": "openAiApi"
        },
        "credentials": {
          "openAiApi": {
            "id": "XJdxgMSXFgwReSsh",
            "name": "n8n key"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "033d8aea-4f8b-4e71-8ed0-19b56f154909",
        "name": "Wait 5s & Retry (Audio)",
        "type": "n8n-nodes-base.wait",
        "position": [
          208,
          288
        ],
        "webhookId": "259572b2-f378-479f-8f2e-219635986fc4",
        "parameters": {},
        "typeVersion": 1.1
      },
      {
        "id": "4d0ee972-c2a6-418b-aae4-86f12f1d6a44",
        "name": "Is Audio Job Completed?",
        "type": "n8n-nodes-base.if",
        "position": [
          32,
          272
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 1,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "60615090-7a29-4573-9b47-369d6a3e95e9",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status }}",
                "rightValue": "finished"
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "4a63e87e-e81c-4208-9ac6-3d4273bf3fdd",
        "name": "Check Audio Job Status",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -128,
          272
        ],
        "parameters": {
          "url": "=https://api.upload-post.com/api/uploadposts/ffmpeg/jobs/{{ $json.job_id }}",
          "options": {},
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Upload-post mutonseo"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "a9697288-c8a4-498d-9bbd-aa23ab8d85d8",
        "name": "Wait 10s (Audio)",
        "type": "n8n-nodes-base.wait",
        "position": [
          -336,
          272
        ],
        "webhookId": "cc0bf0ea-46f3-415c-b08a-0126aa1bb33b",
        "parameters": {
          "amount": 10
        },
        "typeVersion": 1.1
      },
      {
        "id": "83b29508-c1d5-4830-9b94-683cc6658b6b",
        "name": "Form: Upload Video",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -704,
          272
        ],
        "webhookId": "352a575b-42cf-4e9b-8d76-6acec4e40402",
        "parameters": {
          "path": "352a575b-42cf-4e9b-8d76-6acec4e40402",
          "options": {},
          "formTitle": "üé¨ Video to Viral Shorts",
          "formFields": {
            "values": [
              {
                "fieldType": "file",
                "fieldLabel": "Video",
                "requiredField": true,
                "acceptFileTypes": "video/*"
              }
            ]
          },
          "formDescription": "Upload your video and automatically create viral shorts with AI. Depending on the video's length, 3 to 6 shorts will be generated and automatically scheduled to be uploaded one per day at this time starting tomorrow.\n"
        },
        "typeVersion": 2.1
      },
      {
        "id": "ed8de4be-df78-4704-9be3-62ce0382b3ba",
        "name": "Wait 5s & Retry (Short)",
        "type": "n8n-nodes-base.wait",
        "position": [
          2160,
          288
        ],
        "webhookId": "259572b2-f378-479f-8f2e-219635986fc4",
        "parameters": {},
        "typeVersion": 1.1
      },
      {
        "id": "48dee67e-3ff8-4e77-8e3c-5ae1af1f0224",
        "name": "Download Short",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2160,
          128
        ],
        "parameters": {
          "url": "=https://api.upload-post.com/api/uploadposts/ffmpeg/jobs/{{ $json.job_id }}/download",
          "options": {
            "response": {
              "response": {}
            }
          },
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Upload-post mutonseo"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "894c84ab-4640-4e82-9bd5-3ff286309517",
        "name": "Is Short Job Completed?",
        "type": "n8n-nodes-base.if",
        "position": [
          1904,
          144
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 1,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "60615090-7a29-4573-9b47-369d6a3e95e9",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status }}",
                "rightValue": "finished"
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "63421b85-afea-46e6-a89d-52f8305f2f14",
        "name": "Check Short Job Status",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1680,
          144
        ],
        "parameters": {
          "url": "=https://api.upload-post.com/api/uploadposts/ffmpeg/jobs/{{ $json.job_id }}",
          "options": {},
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Upload-post mutonseo"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "92b26152-a124-4c6d-90f7-50de310733b4",
        "name": "Wait 10s (Short)",
        "type": "n8n-nodes-base.wait",
        "position": [
          1472,
          144
        ],
        "webhookId": "cc0bf0ea-46f3-415c-b08a-0126aa1bb33b",
        "parameters": {
          "amount": 10
        },
        "typeVersion": 1.1
      },
      {
        "id": "36e8d927-41d9-4fc7-9d62-8a3d41511836",
        "name": "Parse Gemini Analysis",
        "type": "n8n-nodes-base.code",
        "position": [
          1088,
          144
        ],
        "parameters": {
          "jsCode": "// Get Gemini response\nconst data = $input.first().json;\nconst formData = $('Form: Upload Video').first();\n\n// --- Config opcional ---\nconst VIDEO_DURATION_SECONDS =\n  Number(formData?.json?.videoDurationSeconds) ||\n  Number(formData?.json?.duration) ||\n  Number(formData?.json?.meta?.durationSec) ||\n  null;\n\n// --- Helpers ---\nconst toMs = (v) => (isFinite(Number(v)) ? Math.round(Number(v) * 1000) : 0);\n\nconst stripCodeFences = (txt) =>\n  String(txt || '')\n    .replace(/```json\\s*/gi, '')\n    .replace(/```\\s*/g, '')\n    .trim();\n\nconst extractJsonObject = (txt) => {\n  // 1) intenta parse directo\n  try { return JSON.parse(txt); } catch {}\n  // 2) intenta localizar el primer {...}\n  const m = String(txt).match(/\\{[\\s\\S]*\\}/);\n  if (m) {\n    try { return JSON.parse(m[0]); } catch {}\n  }\n  throw new Error('No se pudo extraer JSON v√°lido del texto:\\n' + String(txt).slice(0, 300));\n};\n\nconst pickText = (payload) => {\n  // Nuevos formatos (string en 'output')\n  if (typeof payload === 'string') return payload;\n  if (payload?.output) return payload.output;\n\n  // Antiguos formatos (content.parts[0].text)\n  if (Array.isArray(payload) && payload[0]?.output) return payload[0].output;\n  if (Array.isArray(payload) && payload[0]?.content?.parts?.[0]?.text) return payload[0].content.parts[0].text;\n  if (payload?.content?.parts?.[0]?.text) return payload.content.parts[0].text;\n\n  // Otros\n  if (payload?.response) return payload.response;\n  if (payload?.text) return payload.text;\n\n  // √öltimo recurso: stringify\n  return JSON.stringify(payload);\n};\n\n// --- 1) Extrae texto crudo del output ---\nlet textResponse = pickText(data);\n\n// --- 2) Limpia fences y parsea el JSON interior ---\ntextResponse = stripCodeFences(textResponse);\nlet parsed = extractJsonObject(textResponse);\n\n// Si vino envuelto otra vez dentro de 'output', vuelve a parsear\nif (!parsed?.shorts && typeof parsed?.output === 'string') {\n  parsed = extractJsonObject(stripCodeFences(parsed.output));\n}\n\nconst shorts = Array.isArray(parsed?.shorts) ? parsed.shorts : [];\nif (!shorts.length) {\n  throw new Error('Gemini no encontr√≥ segmentos interesantes');\n}\n\n// --- 3) Normalizaci√≥n opcional (si Gemini mand√≥ fracciones 0‚Äì1 y conocemos D) ---\nconst MIN = 15, MAX = 60;\nconst clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));\n\nconst vf = \"scale='min(1080,iw)':'min(1920,ih)':force_original_aspect_ratio=increase,crop=1080:1920,setsar=1\";\n\nreturn shorts.map((s, i) => {\n  let startSec = Number(s.start);\n  let endSec   = Number(s.end);\n\n  if (!isFinite(startSec) || !isFinite(endSec)) {\n    throw new Error(`Timestamps inv√°lidos en short #${i + 1}`);\n  }\n\n  // Si parecen porcentajes 0‚Äì1 y tenemos duraci√≥n del v√≠deo, convi√©rtelo a segundos\n  if (VIDEO_DURATION_SECONDS && endSec <= 1.001) {\n    startSec *= VIDEO_DURATION_SECONDS;\n    endSec   *= VIDEO_DURATION_SECONDS;\n  }\n\n  // Fuerza rango 15‚Äì60s de forma suave\n  let duration = endSec - startSec;\n  if (duration < MIN) endSec = startSec + MIN;\n  if (duration > MAX) endSec = startSec + MAX;\n  duration = endSec - startSec;\n\n  // Mant√©n dentro de la duraci√≥n del v√≠deo (si la sabemos)\n  if (VIDEO_DURATION_SECONDS) {\n    startSec = clamp(startSec, 0, Math.max(0, VIDEO_DURATION_SECONDS - MIN));\n    endSec   = clamp(endSec, startSec + MIN, VIDEO_DURATION_SECONDS);\n    duration = endSec - startSec;\n  }\n\n  // Redondeos\n  const start = Number(startSec.toFixed(3));\n  const end   = Number(endSec.toFixed(3));\n  const dur   = Number(duration.toFixed(3));\n\n  // Construye el comando FFmpeg completo (usa -t = duraci√≥n)\n  const ffmpegCmd =\n    `ffmpeg -y -hide_banner -loglevel error ` +\n    `-ss ${start} -t ${dur} -i {input} ` +\n    `-c:v h264_nvenc -cq 22 -vf \"${vf}\" ` +\n    `-c:a aac -b:a 128k -ar 48000 -ac 2 -movflags +faststart {output}`;\n\n  return {\n    json: {\n      index: i + 1,\n      startTime: start,\n      endTime: end,\n      duration: dur,\n      startTimeMs: toMs(start),\n      endTimeMs: toMs(end),\n      durationMs: toMs(dur),\n      video_description_for_tiktok: s.video_description_for_tiktok ?? '',\n      video_description_for_instagram: s.video_description_for_instagram ?? '',\n      video_title_for_youtube_short: s.video_title_for_youtube_short ?? '',\n      full_command: ffmpegCmd\n    },\n    binary: formData.binary\n  };\n});\n"
        },
        "typeVersion": 2
      },
      {
        "id": "20a0553c-352c-4903-bd33-2216c7f6accf",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -752,
          -464
        ],
        "parameters": {
          "color": 7,
          "width": 480,
          "height": 592,
          "content": "**AUTO-SHORTS GENERATOR**\n\n**How it Works:**\n1.  Upload a long video via the form.\n2.  AI transcribes the audio (Whisper) and finds the most viral clips (Gemini).\n3.  The clips are auto-cut, cropped, and prepared for social media.\n4.  Shorts are scheduled to post daily on TikTok, Instagram, and YouTube.\n\n**Quick Setup:**\n1.  **OpenAI Whisper:** Add your API key to the `Whisper: Transcribe` node.\n2.  **Google Gemini:** Add your Google AI Studio API key to the `Google Gemini Chat Model` node.\n3.  **Upload-Post:**\n    *   Sign up at `app.upload-post.com` & connect your social accounts.\n    *   Generate an API token.\n    *   In n8n, create credentials for the `HTTP Request` nodes (Header Auth) and the `Schedule...` node (Upload-Post API) using that token.\n4.  **Scheduling:** Adjust the post time and timezone in the `Schedule to...` node.\n5.  **To Run:** Use the URL from the `Form: Upload Video` node to upload your video."
        },
        "typeVersion": 1
      },
      {
        "id": "d17e4d15-bd41-460d-8739-0f423e70efd9",
        "name": "FFmpeg: Upload & Cut",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1264,
          144
        ],
        "parameters": {
          "url": "https://api.upload-post.com/api/uploadposts/ffmpeg/jobs/upload",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "multipart-form-data",
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "file",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "Video"
              },
              {
                "name": "full_command",
                "value": "=ffmpeg -y -hide_banner -loglevel error -ss {{ $json.startTime }} -t {{ $json.duration }} -i {input} -vf \"scale=trunc(iw/2)*2:trunc(ih/2)*2,setsar=1\" -c:v h264_nvenc -cq 22 -pix_fmt yuv420p -c:a aac -b:a 128k -ar 48000 -ac 2 -movflags +faststart {output}"
              },
              {
                "name": "output_extension",
                "value": "mp4"
              }
            ]
          },
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Upload-post mutonseo"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "abfbf025-e4b1-498c-8cbc-990d4b923bf2",
        "name": "Section: Intake & Form",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -752,
          128
        ],
        "parameters": {
          "width": 228,
          "height": 352,
          "content": "**Intake & Form**\n- Form: Upload Video"
        },
        "typeVersion": 1
      },
      {
        "id": "e99945ee-8a4f-4eaa-b835-def0a25f31d9",
        "name": "Section: Transcription & Parsing",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          352,
          16
        ],
        "parameters": {
          "width": 428,
          "height": 320,
          "content": "**Transcription & Parsing**\n- Whisper: Transcribe with Timestamps\n- Parse Whisper Results\n- Download Audio"
        },
        "typeVersion": 1
      },
      {
        "id": "1b8fe57b-93a8-4e42-bfbf-920a8c9ba9a5",
        "name": "Section: AI Selection (Gemini)",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          768,
          16
        ],
        "parameters": {
          "width": 420,
          "height": 480,
          "content": "**AI Selection**\n- Google Gemini Chat Model\n- AI Agent ‚Äì Select Viral Clips\n- Parse Gemini Analysis"
        },
        "typeVersion": 1
      },
      {
        "id": "ab0e8e1b-252a-44d6-a355-e1e1306776fb",
        "name": "Section: FFmpeg Audio Job Loop",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -528,
          128
        ],
        "parameters": {
          "width": 880,
          "height": 352,
          "content": "**FFmpeg Audio Job Loop**\n- FFmpeg: Extract Audio\n- Wait 10s (Audio) ‚Üí Check Audio Job Status ‚Üí Is Audio Job Completed?\n- Retry path: Wait 5s & Retry (Audio)"
        },
        "typeVersion": 1
      },
      {
        "id": "00d1a683-0c3f-4184-b9f5-dc0f120c85df",
        "name": "Section: FFmpeg Short Job Loop",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1184,
          16
        ],
        "parameters": {
          "width": 1132,
          "height": 480,
          "content": "**FFmpeg Short Job Loop**\n- FFmpeg: Upload & Cut\n- Wait 10s (Short) ‚Üí Check Short Job Status ‚Üí Is Short Job Completed?\n- Retry path: Wait 5s & Retry (Short)"
        },
        "typeVersion": 1
      },
      {
        "id": "0c6292f9-b1db-4710-8b10-1a7de6d609ad",
        "name": "Section: Scheduling",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2320,
          16
        ],
        "parameters": {
          "width": 420,
          "height": 480,
          "content": "**Scheduling**\n- Download Short\n- Schedule to TikTok, Instagram, and YouTube"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Download Audio": {
        "main": [
          [
            {
              "node": "Whisper: Transcribe with Timestamps",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Short": {
        "main": [
          [
            {
              "node": "Schedule to TikTok, Instagram, and YouTube",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 10s (Audio)": {
        "main": [
          [
            {
              "node": "Check Audio Job Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 10s (Short)": {
        "main": [
          [
            {
              "node": "Check Short Job Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Form: Upload Video": {
        "main": [
          [
            {
              "node": "FFmpeg: Extract Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FFmpeg: Upload & Cut": {
        "main": [
          [
            {
              "node": "Wait 10s (Short)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FFmpeg: Extract Audio": {
        "main": [
          [
            {
              "node": "Wait 10s (Audio)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Gemini Analysis": {
        "main": [
          [
            {
              "node": "FFmpeg: Upload & Cut",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Whisper Results": {
        "main": [
          [
            {
              "node": "AI Agent - Select Viral Clips",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Audio Job Status": {
        "main": [
          [
            {
              "node": "Is Audio Job Completed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Short Job Status": {
        "main": [
          [
            {
              "node": "Is Short Job Completed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Audio Job Completed?": {
        "main": [
          [
            {
              "node": "Download Audio",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait 5s & Retry (Audio)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Short Job Completed?": {
        "main": [
          [
            {
              "node": "Download Short",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait 5s & Retry (Short)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 5s & Retry (Audio)": {
        "main": [
          [
            {
              "node": "Check Audio Job Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 5s & Retry (Short)": {
        "main": [
          [
            {
              "node": "Check Short Job Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent - Select Viral Clips",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent - Select Viral Clips": {
        "main": [
          [
            {
              "node": "Parse Gemini Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Whisper: Transcribe with Timestamps": {
        "main": [
          [
            {
              "node": "Parse Whisper Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "NkkWMHiRAY5uPHmf",
    "meta": {
      "instanceId": "3378b0d68c3b7ebfc71b79896d94e1a044dec38e99a1160aed4e9c323910fbe2",
      "templateCredsSetupCompleted": true
    },
    "name": "Convert Old Photos to AI Videos And Auto-Publish in FB, IG, YT & X",
    "tags": [],
    "nodes": [
      {
        "id": "b9ae8c3f-21f4-4aaf-9352-824d2abcf430",
        "name": "Photo Upload Form",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -60,
          120
        ],
        "webhookId": "animate-photo-form",
        "parameters": {
          "path": "animate-photo-form",
          "options": {},
          "formTitle": "Colorize and Animate Old Photos",
          "formFields": {
            "values": [
              {
                "fieldType": "file",
                "fieldLabel": "Upload Old Photo",
                "requiredField": true
              },
              {
                "fieldType": "textarea",
                "fieldLabel": "Custom Animation Description (Optional)",
                "placeholder": "Describe how you'd like the photo to be animated (e.g., 'make the person smile and blink')"
              }
            ]
          },
          "formDescription": "Upload an old photo to colorize and animate it with AI"
        },
        "typeVersion": 2.1
      },
      {
        "id": "6bb93365-9c3d-4c18-a1cc-328d45b70b2f",
        "name": "Workflow Description",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -40,
          -740
        ],
        "parameters": {
          "color": 3,
          "width": 740,
          "height": 280,
          "content": "# Colorize and Animate Old Photos with AI\n\nThis workflow allows users to **upload old photos** and automatically:\n1. **Colorize and enhance** them using FLUX Kontext\n2. **Animate** them using Kling Video AI\n3. **Save** the final video to Google Drive\n\nSimply upload your old photo through the form and get back a colorized, animated video!"
        },
        "typeVersion": 1
      },
      {
        "id": "fb20fbac-63ea-41ef-8f6a-1aacf3e92245",
        "name": "Colorize Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          480,
          120
        ],
        "parameters": {
          "url": "https://queue.fal.run/fal-ai/flux-pro/kontext",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n  \"prompt\": \"Colorize this old black and white or sepia photograph. Make it look natural and vibrant with realistic colors. Remove any noise, scratches, or artifacts. Enhance the image quality and make it crystal clear. Keep all the original details and people exactly as they are, just add beautiful, realistic colors and improve the overall quality\",\n  \"image_url\": \"{{ $json.data.url }}\",\n  \"num_images\": 1\n}",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "lj8v2XS8OSqBUXwk",
            "name": "fal.ai victor"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "76d9b93e-9823-47cb-8d66-d158fd8b2b37",
        "name": "Wait for Colorization",
        "type": "n8n-nodes-base.wait",
        "position": [
          700,
          120
        ],
        "webhookId": "wait-colorize-webhook",
        "parameters": {},
        "typeVersion": 1.1
      },
      {
        "id": "ca65341f-ad21-4707-831f-c873ef770cc6",
        "name": "Check Colorization Status",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          920,
          120
        ],
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $('Colorize Image').item.json.request_id }}/status",
          "options": {},
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "lj8v2XS8OSqBUXwk",
            "name": "fal.ai victor"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "7d556144-538a-462d-a153-1971efcef011",
        "name": "Colorization Completed?",
        "type": "n8n-nodes-base.if",
        "position": [
          1140,
          120
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "colorize-completed",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "d1f4426a-c830-4402-91b4-389338f81c39",
        "name": "Get Colorized Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1360,
          120
        ],
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $('Colorize Image').item.json.request_id }}",
          "options": {},
          "sendHeaders": true,
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "headerParameters": {
            "parameters": [
              {
                "name": "Accept",
                "value": "application/json"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "lj8v2XS8OSqBUXwk",
            "name": "fal.ai victor"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "0397aef0-a837-4cfe-8029-d1c495bf6689",
        "name": "Animate Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1580,
          120
        ],
        "parameters": {
          "url": "https://queue.fal.run/fal-ai/kling-video/v2.1/standard/image-to-video",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n  \"prompt\": \"{{ $('Photo Upload Form').item.json['Custom Animation Description (Optional)'] ? $('Photo Upload Form').item.json['Custom Animation Description (Optional)'] : 'Animate this colorized vintage photograph. If there are multiple people, make them interact naturally - perhaps talking, smiling, or making subtle gestures. If there\\'s only one person, animate them with natural movements like breathing, blinking, slight head movements, or gentle smiling. Keep the animation subtle and realistic, maintaining the vintage charm. The movement should feel natural and bring the photo to life. Do not move the camera' }}\",\n  \"image_url\": \"{{ $('Get Colorized Image').item.json.images[0].url }}\",\n  \"duration\": 5,\n  \"quality\": \"standard\"\n}",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "lj8v2XS8OSqBUXwk",
            "name": "fal.ai victor"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "3406b890-4fe5-42f9-a52e-f67abab2720c",
        "name": "Wait for Animation",
        "type": "n8n-nodes-base.wait",
        "position": [
          1800,
          120
        ],
        "webhookId": "wait-animation-webhook",
        "parameters": {
          "amount": 60
        },
        "typeVersion": 1.1
      },
      {
        "id": "58103cde-9884-41d4-886a-99ba7bd0072a",
        "name": "Check Animation Status",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2020,
          120
        ],
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/kling-video/requests/{{ $('Animate Image').item.json.request_id }}/status",
          "options": {},
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "lj8v2XS8OSqBUXwk",
            "name": "fal.ai victor"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "e42474db-7881-4a0a-8ea0-d04e139c4740",
        "name": "Animation Completed?",
        "type": "n8n-nodes-base.if",
        "position": [
          2240,
          120
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "animation-completed",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "6db3f757-5748-4be6-917c-ddcd86621f2b",
        "name": "Get Animated Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2460,
          120
        ],
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/kling-video/requests/{{ $('Animate Image').item.json.request_id }}",
          "options": {},
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "lj8v2XS8OSqBUXwk",
            "name": "fal.ai victor"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "48d00cac-27d7-4b3b-aed2-f53bea846ecb",
        "name": "Download Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2680,
          120
        ],
        "parameters": {
          "url": "={{ $('Get Animated Video').item.json.video.url }}",
          "options": {}
        },
        "typeVersion": 4.2
      },
      {
        "id": "37a98a23-46f0-41a6-89df-f3f542abdc16",
        "name": "Upload to Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          2900,
          120
        ],
        "parameters": {
          "name": "=animated-photo-{{ $now.format('yyyyMMdd-HHmmss') }}.mp4",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive",
            "cachedResultUrl": "https://drive.google.com/drive/my-drive",
            "cachedResultName": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "root",
            "cachedResultUrl": "https://drive.google.com/drive",
            "cachedResultName": "/ (Root folder)"
          }
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "p5I6S4YkJps1zvwz",
            "name": "Google Drive account 2"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "7d0232ed-e8cd-421f-a9c6-70e3eb26b4cd",
        "name": "Final Results",
        "type": "n8n-nodes-base.set",
        "position": [
          3140,
          120
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "success-flag",
                "name": "success",
                "type": "boolean",
                "value": true
              },
              {
                "id": "message",
                "name": "message",
                "type": "string",
                "value": "Your old photo has been successfully colorized and animated!"
              },
              {
                "id": "colorized-image",
                "name": "colorized_image_url",
                "type": "string",
                "value": "={{ $('Get Colorized Image').item.json.images[0].url }}"
              },
              {
                "id": "animated-video",
                "name": "animated_video_url",
                "type": "string",
                "value": "={{ $('Get Animated Video').item.json.video.url }}"
              },
              {
                "id": "google-drive",
                "name": "google_drive_url",
                "type": "string",
                "value": "={{ $('Upload to Google Drive').item.json.webViewLink }}"
              },
              {
                "id": "processing-time",
                "name": "processing_time",
                "type": "string",
                "value": "={{ $now.format('yyyy-MM-dd HH:mm:ss') }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "2d3c6a3a-6ef2-47cd-8823-46c45361cb5f",
        "name": "Usage Instructions",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -40,
          -420
        ],
        "parameters": {
          "width": 740,
          "height": 200,
          "content": "## How to Use:\n\n1. **Click 'Execute workflow'** to start the process\n2. **Upload your old photo** in the form that appears\n3. The photo will be **colorized and enhanced** using FLUX Kontext\n4. Then **animated** using Kling Video AI\n5. Finally **saved to Google Drive**\n\n**Required:** Image file (JPG, PNG)\n**Optional:** Custom animation description"
        },
        "typeVersion": 1
      },
      {
        "id": "8b09bed7-a5f1-4e4c-8b08-0cb9807cf6fa",
        "name": "Setup Instructions",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -40,
          -180
        ],
        "parameters": {
          "width": 740,
          "height": 260,
          "content": "## Setup Required:\n1. **api.imgbb.com**: Get api token (it's free)\n2. **FAL.AI API Key**: Get from fal.ai and set in HTTP Request credentials\n3. **Google Drive**: Connect your Google Drive account\n4. **Test the workflow**: Click 'Test workflow' to start\n\n**API Endpoints Used:**\n- Upload image: api.imgbb.com\n- FLUX Kontext: Image enhancement and colorization\n- Kling Video: Image to video animation"
        },
        "typeVersion": 1
      },
      {
        "id": "4be63f77-8fca-46a3-84b9-4b5b30055a96",
        "name": "Upload Image to imgbb",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          240,
          120
        ],
        "parameters": {
          "url": "=https://api.imgbb.com/1/upload",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "image",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "=Upload_Old_Photo"
              },
              {
                "name": "key",
                "value": "generate_token_and_add"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "5fa469e9-cd6e-448f-843f-b82553216476",
        "name": "Upload Post",
        "type": "n8n-nodes-upload-post.uploadPost",
        "position": [
          3340,
          120
        ],
        "parameters": {
          "user": "ADD_UPLOAD_POST_USER",
          "title": "This video was uploaded with the upload-post api",
          "video": "={{ $('Get Animated Video').item.json.video.url }}",
          "platform": [
            "instagram",
            "x",
            "youtube",
            "facebook"
          ],
          "operation": "uploadVideo",
          "instagramMediaType": "REELS"
        },
        "credentials": {
          "uploadPostApi": {
            "id": "frehTItx3BCdCJHh",
            "name": "Upload Post account 2"
          }
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "2559ee00-f7d3-4ee6-bde7-0156eaa87741",
    "connections": {
      "Animate Image": {
        "main": [
          [
            {
              "node": "Wait for Animation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Final Results": {
        "main": [
          [
            {
              "node": "Upload Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Colorize Image": {
        "main": [
          [
            {
              "node": "Wait for Colorization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Video": {
        "main": [
          [
            {
              "node": "Upload to Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Photo Upload Form": {
        "main": [
          [
            {
              "node": "Upload Image to imgbb",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Animated Video": {
        "main": [
          [
            {
              "node": "Download Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait for Animation": {
        "main": [
          [
            {
              "node": "Check Animation Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Colorized Image": {
        "main": [
          [
            {
              "node": "Animate Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Animation Completed?": {
        "main": [
          [
            {
              "node": "Get Animated Video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait for Animation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Image to imgbb": {
        "main": [
          [
            {
              "node": "Colorize Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait for Colorization": {
        "main": [
          [
            {
              "node": "Check Colorization Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Animation Status": {
        "main": [
          [
            {
              "node": "Animation Completed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload to Google Drive": {
        "main": [
          [
            {
              "node": "Final Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Colorization Completed?": {
        "main": [
          [
            {
              "node": "Get Colorized Image",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait for Colorization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Colorization Status": {
        "main": [
          [
            {
              "node": "Colorization Completed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "l1wMIoms9BgoA2lV",
    "meta": {
      "instanceId": "05b0588df0f58c91cb668a930710fae1c12db867675e52c5c2912a7beee5342b",
      "templateCredsSetupCompleted": true
    },
    "name": "\"E-Mail to article/blog post\" - converter",
    "tags": [],
    "nodes": [
      {
        "id": "e24d8d7a-88b2-4ee2-9c38-4b6f4a88102c",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -100,
          360
        ],
        "parameters": {
          "simple": false,
          "filters": {
            "sender": "*@somedia.ch"
          },
          "options": {
            "downloadAttachments": true,
            "dataPropertyAttachmentsPrefixName": "attachment_"
          },
          "pollTimes": {
            "item": [
              {
                "mode": "everyX",
                "unit": "minutes",
                "value": 1
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "PNLoTfL8jP1YyGjJ",
            "name": "Gmail account 2"
          }
        },
        "notesInFlow": false,
        "typeVersion": 1.2
      },
      {
        "id": "b265f364-b246-4244-ab77-9812b90817e1",
        "name": "Extrahiere aus PDF1",
        "type": "n8n-nodes-base.extractFromFile",
        "position": [
          1120,
          -80
        ],
        "parameters": {
          "options": {},
          "operation": "pdf"
        },
        "typeVersion": 1
      },
      {
        "id": "2ff7ca6c-7ba6-4526-94fc-cb82b052648a",
        "name": "HTTP Request2",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1260,
          280
        ],
        "parameters": {
          "url": "=https://www.googleapis.com/drive/v3/files/{{$json[\"id\"]}}/copy\n",
          "method": "POST",
          "options": {},
          "jsonBody": "{\n  \"mimeType\": \"application/vnd.google-apps.document\"\n}\n",
          "sendBody": true,
          "jsonHeaders": "{\n  \"Authorization\": \"Bearer {{$credentials.googleDriveOAuth2.access_token}}\",\n  \"Content-Type\": \"application/json\"\n}\n",
          "sendHeaders": true,
          "specifyBody": "json",
          "authentication": "predefinedCredentialType",
          "specifyHeaders": "json",
          "nodeCredentialType": "googleDocsOAuth2Api"
        },
        "credentials": {
          "oAuth2Api": {
            "id": "INVJ4n7OLXgPI372",
            "name": "Unnamed credential"
          },
          "googleDocsOAuth2Api": {
            "id": "AeVFb8EMLqLEn7Db",
            "name": "Google Docs account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "1889bbb3-287b-4105-aea9-1b1f31e1bc1b",
        "name": "HTTP Request3",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1480,
          280
        ],
        "parameters": {
          "url": "=https://www.googleapis.com/drive/v3/files/{{$json[\"id\"]}}/export?mimeType=text/plain\n",
          "options": {
            "response": {
              "response": {
                "responseFormat": "text"
              }
            }
          },
          "jsonHeaders": "{\n  \"Authorization\": \"Bearer {{$credentials.googleDriveOAuth2.access_token}}\"\n}\n",
          "sendHeaders": true,
          "authentication": "predefinedCredentialType",
          "specifyHeaders": "json",
          "nodeCredentialType": "googleDocsOAuth2Api"
        },
        "credentials": {
          "oAuth2Api": {
            "id": "INVJ4n7OLXgPI372",
            "name": "Unnamed credential"
          },
          "googleDocsOAuth2Api": {
            "id": "AeVFb8EMLqLEn7Db",
            "name": "Google Docs account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "f6f0d96f-f1c8-4d6a-88c5-bfe86ff6a359",
        "name": "Anthropic Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "position": [
          660,
          740
        ],
        "parameters": {
          "model": "claude-3-5-sonnet-20241022",
          "options": {}
        },
        "credentials": {
          "anthropicApi": {
            "id": "51YEx3VTC2IuyUTO",
            "name": "Anthropic account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "0f3fee05-3444-4046-96f6-b0978eb9d16e",
        "name": "Anthropic Chat Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "position": [
          1780,
          500
        ],
        "parameters": {
          "model": "claude-3-5-sonnet-20241022",
          "options": {}
        },
        "credentials": {
          "anthropicApi": {
            "id": "51YEx3VTC2IuyUTO",
            "name": "Anthropic account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "34321fc9-ecaa-4f4c-a01c-b8cf0cd3df50",
        "name": "Anthropic Chat Model2",
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "position": [
          1400,
          80
        ],
        "parameters": {
          "model": "claude-3-5-sonnet-20241022",
          "options": {}
        },
        "credentials": {
          "anthropicApi": {
            "id": "51YEx3VTC2IuyUTO",
            "name": "Anthropic account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "86315ae8-f456-4e06-a281-b04f75886232",
        "name": "Code: delete all but pdf and word",
        "type": "n8n-nodes-base.code",
        "position": [
          140,
          360
        ],
        "parameters": {
          "jsCode": "const allItems = $input.all();\nlet data = [];\nallItems.forEach(item => {\n  const binaryData = item.binary;\n  if (binaryData) {\n    Object.keys(binaryData).forEach(key => {\n      // MIME-Types f√ºr PDF und Word\n      const allowedMimeTypes = [\n        'application/pdf',\n        'application/msword',\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n      ];\n      \n      if (allowedMimeTypes.includes(binaryData[key]?.mimeType)) {\n        data.push({\n          binary: { data: binaryData[key] },\n          json: {\n            fileName: binaryData[key].fileName,\n            mimeType: binaryData[key].mimeType\n          }\n        });\n      }\n    });\n  }\n});\nreturn data;"
        },
        "executeOnce": false,
        "typeVersion": 2,
        "alwaysOutputData": true
      },
      {
        "id": "6b95290e-4304-4187-8294-15f32e3227c9",
        "name": "has attachment?",
        "type": "n8n-nodes-base.if",
        "position": [
          380,
          360
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "0cd4c70c-9562-486e-95bd-497ba4816aac",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                },
                "leftValue": "={{ Object.keys($binary).length }}\n",
                "rightValue": 0
              }
            ]
          },
          "looseTypeValidation": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "59688c51-64aa-47bb-80e3-33185e358122",
        "name": "PDF or WORD?",
        "type": "n8n-nodes-base.if",
        "position": [
          680,
          240
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "0cd4c70c-9562-486e-95bd-497ba4816aac",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.mimeType }}",
                "rightValue": "pdf"
              }
            ]
          },
          "looseTypeValidation": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "8d767385-4e77-434f-8c47-1e5bbaae807f",
        "name": "OpenAI self assesment",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1020,
          520
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Deine Aufgabe ist es, den gegebenen Input-Text mit dem Output-Artikel zu vergleichen.\nBewerte, ob alle wesentlichen Informationen aus dem Input-Text im Output-Artikel korrekt enthalten sind, ohne dass neue, nicht im Input vorhandene Informationen hinzugef√ºgt wurden.\nVorgehensweise:\n\n    Vollst√§ndigkeit pr√ºfen: Sind alle relevanten Informationen aus dem Input im Output enthalten?\n    Genauigkeit bewerten: Wurde der Inhalt korrekt wiedergegeben, ohne √Ñnderungen oder Auslassungen?\n    Zus√§tzliche Informationen erkennen: Wurden Inhalte hinzugef√ºgt, die nicht im Input vorhanden sind? Falls ja, welche?\n\nAusgabe:\n\n    Bewertung (1 bis 5):\n        1 = Sehr schlecht (viele fehlende oder falsche Informationen, erhebliche neue Inhalte)\n        2 = Unzureichend (mehrere wichtige Auslassungen oder falsche Inhalte)\n        3 = Mittelm√§√üig (einige kleinere Fehler oder Erg√§nzungen)\n        4 = Gut (fast alles korrekt, minimale Abweichungen)\n        5 = Sehr gut (vollst√§ndige, korrekte √úbereinstimmung)\n    Textuelle Begr√ºndung: Eine kurze Analyse, warum diese Bewertung vergeben wurde.\n\n\nHier der Input:\n\n{{ $('Gmail Trigger').item.json.text }}\n\nUnd hier der Output:\n{{ $json.output }}"
              },
              {
                "role": "assistant",
                "content": "sei pedantisch"
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "DGnxI3xtf5aATUOp",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "f9c7b8a8-2148-49f1-b604-4766deafadd1",
        "name": "OpenAI self-assesment2",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "onError": "continueRegularOutput",
        "position": [
          1740,
          -80
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Deine Aufgabe ist es, den gegebenen Input-Text mit dem Output-Artikel zu vergleichen.\nBewerte, ob alle wesentlichen Informationen aus dem Input-Text im Output-Artikel korrekt enthalten sind, ohne dass neue, nicht im Input vorhandene Informationen hinzugef√ºgt wurden.\nVorgehensweise:\n\n    Vollst√§ndigkeit pr√ºfen: Sind alle relevanten Informationen aus dem Input im Output enthalten?\n    Genauigkeit bewerten: Wurde der Inhalt korrekt wiedergegeben, ohne √Ñnderungen oder Auslassungen?\n    Zus√§tzliche Informationen erkennen: Wurden Inhalte hinzugef√ºgt, die nicht im Input vorhanden sind? Falls ja, welche?\n\nAusgabe:\n\n    Bewertung (1 bis 5):\n        1 = Sehr schlecht (viele fehlende oder falsche Informationen, erhebliche neue Inhalte)\n        2 = Unzureichend (mehrere wichtige Auslassungen oder falsche Inhalte)\n        3 = Mittelm√§√üig (einige kleinere Fehler oder Erg√§nzungen)\n        4 = Gut (fast alles korrekt, minimale Abweichungen)\n        5 = Sehr gut (vollst√§ndige, korrekte √úbereinstimmung)\n    Textuelle Begr√ºndung: Eine kurze Analyse, warum diese Bewertung vergeben wurde.\n\n\nHier der Input:\n{{ $('Extrahiere aus PDF1').item.json.text }}\n{{ $('Gmail Trigger').item.json.text }}\n\nUnd hier der Output:\n {{ $json.output }}"
              },
              {
                "role": "assistant",
                "content": "sei pedantisch"
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "DGnxI3xtf5aATUOp",
            "name": "OpenAi account"
          }
        },
        "retryOnFail": true,
        "typeVersion": 1.8
      },
      {
        "id": "0c2c1c4d-b3ec-4e1d-b663-27c43dddb523",
        "name": "reply to sender (no attachment)",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1440,
          520
        ],
        "webhookId": "521f7992-d12c-4485-92d8-41cc5567938b",
        "parameters": {
          "message": "=***REDIGIERTER ARTIKEL***  !!!-CLAUDE-!!!\n\n{{ $('AI Article Writer 3').item.json.output }}\n\n***SELBSTKRITIK***\n\n{{ $json.message.content }}\n\n***ORIGINALNACHRICHT***\n\n{{ $('Gmail Trigger').item.json.text }}",
          "options": {},
          "emailType": "text",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "operation": "reply"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "BtnmuMmkgyJeYpoZ",
            "name": "Gmail account 3"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "de88f6fb-0e75-41d9-8e0c-7377ca1bdca4",
        "name": "reply to sender (word)",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2360,
          280
        ],
        "webhookId": "5767887a-ca7a-41f9-9745-34d49bb79691",
        "parameters": {
          "message": "=***REDIGIERTER ARTIKEL***   !!!! CLAUDE !!!!\n\n\n{{ $('AI Article Writer 2').item.json.output }}\n\n***SELBSTKRITIK***\nBewertung: 1 (schlecht) bis 5 (sehr gut)\n{{ $json.message.content }}\n***ORIGINALNACHRICHT***\n\n{{ $('Gmail Trigger').item.json.text }}\n\n***INHALT ANHANG***\n\n{{ $('HTTP Request3').item.json.data }}",
          "options": {},
          "emailType": "text",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "operation": "reply"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "BtnmuMmkgyJeYpoZ",
            "name": "Gmail account 3"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "0d9c55f9-3c53-44aa-b0d0-09141570b72b",
        "name": "reply to sender (pdf)",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2140,
          -80
        ],
        "webhookId": "523f355b-404f-4a60-b393-e2c5d8f29098",
        "parameters": {
          "message": "=*****REDIGIERTE NACHRICHT*****   !!!!- CLAUDE -!!!\n{{ $('AI Article Writer 1').item.json.output }}\n\n*****SELBSTKRITIK****\nBewertung 1 (schlecht) bis 5 (sehr gut):\n{{ $json.message.content }}\n\n*****ORIGINAL-E-MAIL*****\n\n{{ $('Gmail Trigger').item.json.text }}\n\n\n*****TEXT AUS PDF*****\n\n{{ $('Extrahiere aus PDF1').item.json.text }}\n\n\n",
          "options": {},
          "emailType": "text",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "operation": "reply"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "BtnmuMmkgyJeYpoZ",
            "name": "Gmail account 3"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "695e80d4-dbe2-4476-b680-b90732a6136a",
        "name": "AI Article Writer 1",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "onError": "continueRegularOutput",
        "maxTries": 5,
        "position": [
          1380,
          -80
        ],
        "parameters": {
          "text": "=Du bist Redakteur*in beim Schweizer Kulturmagazin Terra Grischuna. Erstelle aus den Textinformationen einen publikationsfertigen Artikel mit folgender Struktur und Vorgehensweise:\n\n    Stil und Sprache\n    ‚Äì Schreibe in einer neutralen, reduzierten und klaren Sprache.\n    ‚Äì Verwende die Schweizer Rechtschreibung.\n    ‚Äì Halte dich an ein genderneutrales, aktives und verst√§ndliches Wording.\n\n    Form und Aufbau\n    ‚Äì Nutze die Form der umgekehrten Pyramide (wichtigste Informationen zuerst, abnehmende Wichtigkeit im Verlauf).\n    ‚Äì Verfasse einen Titel und klare Zwischentitel (keine Bulletpoints).\n    ‚Äì Bei Veranstaltungshinweisen beginne den Artikel mit einem Satz, der Wer, wann, wo, was beantwortet (z. B. ‚ÄûFranz Tomaschett spricht am 5. Dezember in Chur √ºber das Thema Arbeit.‚Äú).\n    ‚Äì Der Fliesstext sollte zwischen 250 und 500 W√∂rtern umfassen.\n\n    Inhalte und Daten\n    ‚Äì Fasse alle relevanten Inhalte verst√§ndlich zusammen.\n- halte dich an die Informationen aus der E-Mail. Erfinde nichts! Sei genau!\n- wenn dir Informationen fehlen, konstruiere keine neuen. \n    ‚Äì Ignoriere alle anderen Dateiformate (z. B. Bilder, Excel-Tabellen).\n    ‚Äì Verwende keine Aufz√§hlungspunkte im finalen Artikel.\n- wenn subjektive oder streitbare Ansichten formuliert werden, attribuiere diese den Absendern dieser Ansichten. Nenne Quelle/Urheber solcher √Ñusserungen. Beispiel: \"ZITAT in direkter oder indirekter Rede\", schreibt die Gruppe Wolf in ihrer Mitteilung. \n\n    Zus√§tzliche Anweisung\n    ‚Äì Extrahiere zun√§chst alle wichtigen Daten, Personen und Schlagworte. Liste sie strukturiert (z. B. mit Abs√§tzen oder klarer Trennung) vor dem eigentlichen Artikel auf. Z√§hle zudem die Anzahl Zeichen und W√∂rter des Artikels.\n\nBeispielhafte Ausgabe-Struktur\n\nWichtige Daten und Personen\nNennehierknappundstrukturiertallerelevantenNamen,Daten,Orte,Termineetc.NennehierknappundstrukturiertallerelevantenNamen,Daten,Orte,Termineetc.\n\nTitel\nKurzer,pra¬®gnanterTitelKurzer,pra¬®gnanterTitel\n\n\nEinfu¬®hrenderAbsatzmitdenwichtigstenInfos(wer,wann,wo,was)Einfu¬®hrenderAbsatzmitdenwichtigstenInfos(wer,wann,wo,was)\n\nZwischentitel 1\nHintergrund,weitereZusammenha¬®nge,abnehmendwichtigeDetailsHintergrund,weitereZusammenha¬®nge,abnehmendwichtigeDetails\n\nZwischentitel 2\nRestlicheInformationen,kontextualisiertundzusammengefasstRestlicheInformationen,kontextualisiertundzusammengefasst\n\n(Ende des Artikels, maximal 500 W√∂rter.)\n\nNutze bitte diese Vorgaben, um den Artikel in hochwertiger, schweizkonformer Sprache zu verfassen.\n\nHier die Informationen aus dem E-Mail\n\n {{ $('Gmail Trigger').item.json.text }}\n\n{{ $json.text }}",
          "options": {},
          "promptType": "define"
        },
        "retryOnFail": true,
        "typeVersion": 1.7
      },
      {
        "id": "1d3988ea-b8ec-450a-a512-f5463953554b",
        "name": "AI Article Writer 2",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          1700,
          280
        ],
        "parameters": {
          "text": "=Du bist Redakteur*in beim Schweizer Kulturmagazin Terra Grischuna. Erstelle aus den Textinformationen einen publikationsfertigen Artikel mit folgender Struktur und Vorgehensweise:\n\n    Stil und Sprache\n    ‚Äì Schreibe in einer neutralen, reduzierten und klaren Sprache.\n    ‚Äì Verwende die Schweizer Rechtschreibung.\n    ‚Äì Halte dich an ein genderneutrales, aktives und verst√§ndliches Wording.\n\n    Form und Aufbau\n    ‚Äì Nutze die Form der umgekehrten Pyramide (wichtigste Informationen zuerst, abnehmende Wichtigkeit im Verlauf).\n    ‚Äì Verfasse einen Titel und klare Zwischentitel (keine Bulletpoints).\n    ‚Äì Bei Veranstaltungshinweisen beginne den Artikel mit einem Satz, der Wer, wann, wo, was beantwortet (z. B. ‚ÄûFranz Tomaschett spricht am 5. Dezember in Chur √ºber das Thema Arbeit.‚Äú).\n    ‚Äì Der Fliesstext sollte zwischen 250 und 500 W√∂rtern umfassen.\n\n    Inhalte und Daten\n    ‚Äì Fasse alle relevanten Inhalte verst√§ndlich zusammen.\n- halte dich an die Informationen aus der E-Mail. Erfinde nichts! Sei genau!\n- wenn dir Informationen fehlen, konstruiere keine neuen. \n    ‚Äì Ignoriere alle anderen Dateiformate (z. B. Bilder, Excel-Tabellen).\n    ‚Äì Verwende keine Aufz√§hlungspunkte im finalen Artikel.\n- wenn subjektive oder streitbare Ansichten formuliert werden, attribuiere diese den Absendern dieser Ansichten. Nenne Quelle/Urheber solcher √Ñusserungen. Beispiel: \"ZITAT in direkter oder indirekter Rede\", schreibt die Gruppe Wolf in ihrer Mitteilung. \n\n    Zus√§tzliche Anweisung\n    ‚Äì Extrahiere zun√§chst alle wichtigen Daten, Personen und Schlagworte. Liste sie strukturiert (z. B. mit Abs√§tzen oder klarer Trennung) vor dem eigentlichen Artikel auf. Z√§hle zudem die Anzahl Zeichen und W√∂rter des Artikels.\n\nBeispielhafte Ausgabe-Struktur\n\nWichtige Daten und Personen\nNennehierknappundstrukturiertallerelevantenNamen,Daten,Orte,Termineetc.NennehierknappundstrukturiertallerelevantenNamen,Daten,Orte,Termineetc.\n\nTitel\nKurzer,pra¬®gnanterTitelKurzer,pra¬®gnanterTitel\n\n\nEinfu¬®hrenderAbsatzmitdenwichtigstenInfos(wer,wann,wo,was)Einfu¬®hrenderAbsatzmitdenwichtigstenInfos(wer,wann,wo,was)\n\nZwischentitel 1\nHintergrund,weitereZusammenha¬®nge,abnehmendwichtigeDetailsHintergrund,weitereZusammenha¬®nge,abnehmendwichtigeDetails\n\nZwischentitel 2\nRestlicheInformationen,kontextualisiertundzusammengefasstRestlicheInformationen,kontextualisiertundzusammengefasst\n\n(Ende des Artikels, maximal 500 W√∂rter.)\n\nNutze bitte diese Vorgaben, um den Artikel in hochwertiger, schweizkonformer Sprache zu verfassen.\n\nHier die Informationen aus dem E-Mail\n\n {{ $('Gmail Trigger').item.json.text }}{{ $json.data }}",
          "options": {},
          "promptType": "define"
        },
        "typeVersion": 1.7
      },
      {
        "id": "99b5a06e-5d1b-4797-a934-2c37b49caf47",
        "name": "AI Article Writer 3",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          660,
          520
        ],
        "parameters": {
          "text": "=Du bist Redakteur*in beim Schweizer Kulturmagazin Terra Grischuna. Erstelle aus den Textinformationen einen publikationsfertigen Artikel mit folgender Struktur und Vorgehensweise:\n\n    Stil und Sprache\n    ‚Äì Schreibe in einer neutralen, reduzierten und klaren Sprache.\n    ‚Äì Verwende die Schweizer Rechtschreibung.\n    ‚Äì Halte dich an ein genderneutrales, aktives und verst√§ndliches Wording.\n\n    Form und Aufbau\n    ‚Äì Nutze die Form der umgekehrten Pyramide (wichtigste Informationen zuerst, abnehmende Wichtigkeit im Verlauf).\n    ‚Äì Verfasse einen Titel und klare Zwischentitel (keine Bulletpoints).\n    ‚Äì Bei Veranstaltungshinweisen beginne den Artikel mit einem Satz, der Wer, wann, wo, was beantwortet (z. B. ‚ÄûFranz Tomaschett spricht am 5. Dezember in Chur √ºber das Thema Arbeit.‚Äú).\n    ‚Äì Der Fliesstext sollte zwischen 250 und 500 W√∂rtern umfassen.\n- wenn subjektive oder streitbare Ansichten formuliert werden, attribuiere diese den Absendern dieser Ansichten. Nenne Quelle/Urheber solcher √Ñusserungen. Beispiel: \"ZITAT in direkter oder indirekter Rede\", schreibt die Gruppe Wolf in ihrer Mitteilung. \n\n    Inhalte und Daten\n    ‚Äì Fasse alle relevanten Inhalte verst√§ndlich zusammen.\n- halte dich an die Informationen aus der E-Mail. Erfinde nichts! Sei genau!\n- wenn dir Informationen fehlen, konstruiere keine neuen. \n    ‚Äì Ignoriere alle anderen Dateiformate (z. B. Bilder, Excel-Tabellen).\n    ‚Äì Verwende keine Aufz√§hlungspunkte im finalen Artikel.\n\n    Zus√§tzliche Anweisung\n    ‚Äì Extrahiere zun√§chst alle wichtigen Daten, Personen und Schlagworte. Liste sie strukturiert (z. B. mit Abs√§tzen oder klarer Trennung) vor dem eigentlichen Artikel auf. Z√§hle zudem die Anzahl Zeichen und W√∂rter des Artikels.\n\nBeispielhafte Ausgabe-Struktur\n\nWichtige Daten und Personen\nNennehierknappundstrukturiertallerelevantenNamen,Daten,Orte,Termineetc.NennehierknappundstrukturiertallerelevantenNamen,Daten,Orte,Termineetc.\n\nTitel\nKurzer,pra¬®gnanterTitelKurzer,pra¬®gnanterTitel\n\n\nEinfu¬®hrenderAbsatzmitdenwichtigstenInfos(wer,wann,wo,was)Einfu¬®hrenderAbsatzmitdenwichtigstenInfos(wer,wann,wo,was)\n\nZwischentitel 1\nHintergrund,weitereZusammenha¬®nge,abnehmendwichtigeDetailsHintergrund,weitereZusammenha¬®nge,abnehmendwichtigeDetails\n\nZwischentitel 2\nRestlicheInformationen,kontextualisiertundzusammengefasstRestlicheInformationen,kontextualisiertundzusammengefasst\n\n(Ende des Artikels, maximal 500 W√∂rter.)\n\nNutze bitte diese Vorgaben, um den Artikel in hochwertiger, Schweizkonformer Sprache zu verfassen.\n\nHier die Informationen aus dem E-Mail\n\n {{ $('Gmail Trigger').item.json.text }}",
          "options": {},
          "promptType": "define"
        },
        "typeVersion": 1.7
      },
      {
        "id": "f7280703-4570-4771-8a53-cac3a661f416",
        "name": "Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          960,
          280
        ],
        "parameters": {
          "name": "={{ $json.fileName }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {
            "useContentAsIndexableText": false
          },
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "root",
            "cachedResultName": "/ (Root folder)"
          }
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "q0vkLLRJ0qE1Wnbo",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "a83189ab-027d-4ed7-aa69-82e29270cd7c",
        "name": "OpenAI self-assesment",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2020,
          280
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Deine Aufgabe ist es, den gegebenen Input-Text mit dem Output-Artikel zu vergleichen.\nBewerte, ob alle wesentlichen Informationen aus dem Input-Text im Output-Artikel korrekt enthalten sind, ohne dass neue, nicht im Input vorhandene Informationen hinzugef√ºgt wurden.\nVorgehensweise:\n\n    Vollst√§ndigkeit pr√ºfen: Sind alle relevanten Informationen aus dem Input im Output enthalten?\n    Genauigkeit bewerten: Wurde der Inhalt korrekt wiedergegeben, ohne √Ñnderungen oder Auslassungen?\n    Zus√§tzliche Informationen erkennen: Wurden Inhalte hinzugef√ºgt, die nicht im Input vorhanden sind? Falls ja, welche?\n\nAusgabe:\n\n    Bewertung (1 bis 5):\n        1 = Sehr schlecht (viele fehlende oder falsche Informationen, erhebliche neue Inhalte)\n        2 = Unzureichend (mehrere wichtige Auslassungen oder falsche Inhalte)\n        3 = Mittelm√§√üig (einige kleinere Fehler oder Erg√§nzungen)\n        4 = Gut (fast alles korrekt, minimale Abweichungen)\n        5 = Sehr gut (vollst√§ndige, korrekte √úbereinstimmung)\n    Textuelle Begr√ºndung: Eine kurze Analyse, warum diese Bewertung vergeben wurde.\n\n\nHier der Input:\n{{ $('HTTP Request3').item.json.data }}\n{{ $('Gmail Trigger').item.json.text }}\nUnd hier der Output:\n{{ $json.output }}"
              },
              {
                "role": "assistant",
                "content": "sei pedantisch"
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "DGnxI3xtf5aATUOp",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "timezone": "Europe/Rome",
      "callerPolicy": "workflowsFromSameOwner",
      "executionOrder": "v1"
    },
    "versionId": "0e0eba57-a154-48ee-a86a-d4c787805456",
    "connections": {
      "Google Drive": {
        "main": [
          [
            {
              "node": "HTTP Request2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "PDF or WORD?": {
        "main": [
          [
            {
              "node": "Extrahiere aus PDF1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Code: delete all but pdf and word",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request2": {
        "main": [
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request3": {
        "main": [
          [
            {
              "node": "AI Article Writer 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "has attachment?": {
        "main": [
          [
            {
              "node": "PDF or WORD?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Article Writer 3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Article Writer 1": {
        "main": [
          [
            {
              "node": "OpenAI self-assesment2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Article Writer 2": {
        "main": [
          [
            {
              "node": "OpenAI self-assesment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Article Writer 3": {
        "main": [
          [
            {
              "node": "OpenAI self assesment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extrahiere aus PDF1": {
        "main": [
          [
            {
              "node": "AI Article Writer 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Article Writer 3",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "AI Article Writer 2",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model2": {
        "ai_languageModel": [
          [
            {
              "node": "AI Article Writer 1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI self assesment": {
        "main": [
          [
            {
              "node": "reply to sender (no attachment)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI self-assesment": {
        "main": [
          [
            {
              "node": "reply to sender (word)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI self-assesment2": {
        "main": [
          [
            {
              "node": "reply to sender (pdf)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code: delete all but pdf and word": {
        "main": [
          [
            {
              "node": "has attachment?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "21754f977ce20b07e6fe64be3fbc663f6e6f730423d6e46c6cd2bf5b5e70a383"
    },
    "nodes": [
      {
        "id": "0c8b3a80-00e1-4d69-aac9-df41a464914a",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -246.5549467302767,
          -396.60463598587717
        ],
        "parameters": {
          "width": 2260.4312974923314,
          "height": 1739.059401992624,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "74ee38b2-2d8a-40bf-8dad-e20125f000f7",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -220,
          -340
        ],
        "parameters": {
          "color": 5,
          "width": 644.910132006371,
          "height": 655.8676264589326,
          "content": "### Project Benefit üéßüåü\n\nThe goal of this awesome project is to turn those \"CATEGORY_PROMOTIONS\" emails into a super cool audio podcast! üéôÔ∏è This way, users can kick back and enjoy the promotional content without having to squint at their screens. By listening instead of reading, users can soak in the info in a fun and easy way.\n\nThis project rocks a workflow using n8n to automate tasks like a boss. Each node in the workflow plays its part in a smooth operation. Check out the main players:\n\n1. **Gmail trigger1 Node**: Kicks off the action every minute for those \"CATEGORY_PROMOTIONS\" emails.\n   \n2. **Get message content1 Node**: Grabs the email content for some magic.\n      \n3. **Summarization Chain3 Node**: Whips up some sweet summaries using fancy chunking methods.\n   \n4. **Delete the unnecessary items Node**: Clears out the clutter from the email content.\n   \n5. **Text to Free TTS Node**: Turns the summary into speech using Free TTS magic.\n   \n6. **Convert from base64 to File Node**: Changes the audio into a file format.\n   \n7. **Merge Text with Audio Node**: Mixes the text and audio together for a cool combo.\n   \n8. **Aggregate in same cell Node**: Puts all the data together for more awesomeness.\n   \n10. **Send Message to Telegram Node**: Sends the final audio message with a caption to a special Telegram chat ID.\n\nThis workflow is like a well-oiled machine, with each step flowing seamlessly into the next. By automating these tasks, this project aims to make communication a breeze and bring joy to all involved! üåà‚ú®üöÄ\n"
        },
        "typeVersion": 1
      },
      {
        "id": "07a4dc07-0109-464e-a661-d5a4bb7b4a1c",
        "name": "Get message content1",
        "type": "n8n-nodes-base.gmail",
        "position": [
          640,
          460
        ],
        "parameters": {
          "simple": false,
          "options": {},
          "messageId": "={{ $json.id }}",
          "operation": "get"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "UJx4Tiq8WRtxWEIP",
            "name": "Gmail Omar"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "283dcd8b-80a8-4e49-aba1-fabec333def3",
        "name": "OpenAI Chat Model3",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          1120,
          640
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "6u6TSayQDxci71Wb",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "71897790-5ee8-4f15-bc4e-26a987b79505",
        "name": "Delete the unnecessary items",
        "type": "n8n-nodes-base.code",
        "position": [
          880,
          460
        ],
        "parameters": {
          "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n delete item.json.threadId;\n delete item.json.labelIds;\n delete item.json.sizeEstimate;\n delete item.json.headers;\n delete item.json.html;\n delete item.json.to;\n delete item.json.cc;\n delete item.json.replyTo;\n delete item.json.messageId;\n delete item.json.id;\n delete item.json.textAsHtml;\n delete item.json.date;\n\n}\n\nreturn $input.all();"
        },
        "typeVersion": 2
      },
      {
        "id": "187704ba-ddc1-447e-99f6-8335b039dca3",
        "name": "Aggregate in same cell",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          1400,
          660
        ],
        "parameters": {
          "options": {
            "includeBinaries": true
          },
          "aggregate": "aggregateAllItemData"
        },
        "typeVersion": 1
      },
      {
        "id": "a8cba2a0-e751-4dc4-8cc1-9b91c587b1bc",
        "name": "Gmail trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          440,
          460
        ],
        "parameters": {
          "simple": false,
          "filters": {
            "labelIds": [
              "CATEGORY_PROMOTIONS"
            ]
          },
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "UJx4Tiq8WRtxWEIP",
            "name": "Gmail Omar"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7d170a4c-601e-49da-a834-2a40f992feff",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1380,
          -340
        ],
        "parameters": {
          "color": 5,
          "width": 478.42665735513924,
          "height": 651.7534899914576,
          "content": "### This API allows automatic text-to-speech generation.\nYou can utilize this API by sending a POST request to the specified link and including JSON data containing the text you want to convert to speech, along with selecting your preferred voice.\n\nWhen using this API, make sure to include the `Content-Type` header with the value `application/json` to ensure proper interpretation of the request data.\n\nThe API offers a user-friendly interface where you can simply submit the desired text and choose the appropriate voice, then receive an audio file containing the generated speech.\n\nUsing this API can be beneficial for quickly generating audio clips for texts in an efficient manner.\n\nYou can access this API at [https://tiktok-tts.weilnet.workers.dev/api/generation](https://tiktok-tts.weilnet.workers.dev/api/generation) or keep it as is without changing anything as provided on [https://tiktokvoicegenerator.com/](https://tiktokvoicegenerator.com/). \n"
        },
        "typeVersion": 1
      },
      {
        "id": "f0809138-4bde-4132-97b2-0810b920ed7a",
        "name": "Convert from base64 to File",
        "type": "n8n-nodes-base.convertToFile",
        "position": [
          1660,
          140
        ],
        "parameters": {
          "options": {},
          "operation": "toBinary",
          "sourceProperty": "data"
        },
        "typeVersion": 1.1
      },
      {
        "id": "2efdd685-57fe-4f5c-b295-183dddfeb0d6",
        "name": "Merge Text with Audio",
        "type": "n8n-nodes-base.merge",
        "position": [
          1720,
          440
        ],
        "parameters": {},
        "typeVersion": 2.1
      },
      {
        "id": "c59a00fd-c7c7-4dc5-91d1-492bd7715731",
        "name": "Send Message to Telegram",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1720,
          660
        ],
        "parameters": {
          "chatId": "53739339",
          "operation": "sendAudio",
          "binaryData": true,
          "additionalFields": {
            "caption": "={{ $json.data[1].response.text }}",
            "fileName": "New Message on Gmail"
          },
          "binaryPropertyName": "=data"
        },
        "credentials": {
          "telegramApi": {
            "id": "inUwZEIEWHK1poKe",
            "name": "aqsati services"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "3f3a1209-9787-41c3-af10-3f3e44a89c9b",
        "name": "Summarization Chain3",
        "type": "@n8n/n8n-nodes-langchain.chainSummarization",
        "position": [
          1120,
          460
        ],
        "parameters": {
          "options": {
            "summarizationMethodAndPrompts": {
              "values": {
                "prompt": "Craft a concise newsletter using the given content. Include emojis, avoid starting with the subject word, summarize linked articles briefly, and ensure it's under 247 characters for easy TTS readability, and after that chick if it's very short to pass it:\n\n\n\n\"{text}\"\n\n\n",
                "combineMapPrompt": "Craft a concise newsletter using the given content. Include emojis, avoid starting with the subject word, summarize linked articles briefly, and ensure it's under 247 characters for easy TTS readability, and after that chick if it's very short to pass it:\n\n\n\"{text}\"\n\n\n"
              }
            }
          },
          "chunkingMode": "advanced"
        },
        "typeVersion": 2
      },
      {
        "id": "f1e063a5-0e0e-4f8e-b8bc-e940db622843",
        "name": "Text to  TTS",
        "type": "n8n-nodes-base.httpRequest",
        "onError": "continueErrorOutput",
        "position": [
          1460,
          140
        ],
        "parameters": {
          "url": "https://tiktok-tts.weilnet.workers.dev/api/generation",
          "method": "POST",
          "options": {
            "allowUnauthorizedCerts": true
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "text",
                "value": "={{ $json.response.text }}"
              },
              {
                "name": "voice",
                "value": "en_us_001"
              }
            ]
          }
        },
        "retryOnFail": false,
        "typeVersion": 4.1,
        "alwaysOutputData": false
      },
      {
        "id": "c6f9e191-31a0-4ec7-aa11-8f615074b884",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -220,
          340
        ],
        "parameters": {
          "color": 5,
          "width": 821.8034694793512,
          "height": 987.2767141363915,
          "content": "### The Gmail Trigger:\nThe Gmail Trigger node in your N8N workflow is set to poll for new emails every minute and is configured to filter emails with the label \"CATEGORY_PROMOTIONS\" before triggering the workflow.\n\n### Steps to Use Filters Inside the Gmail Trigger Node:\n1. **Add Gmail Trigger Node**:\n   - Drag and drop a Gmail Trigger node onto your workflow canvas.\n\n\\```javascript\n// Add Gmail Trigger node\n\\```\n\n2. **Configure Gmail Trigger Node**:\n   - In the node configuration:\n     - Set \"Poll Times\" to \"Every Minute\" to check for new emails at regular intervals.\n     - Enable the \"Simple\" toggle if you want to simplify the node interface.\n     - Under \"Filters\", specify the label IDs you want to filter by. In this case, it's set to \"CATEGORY_PROMOTIONS\".\n     - Adjust any additional options as needed.\n\n\\```javascript\n// Configure Gmail Trigger node\npollTimes: {\n  item: [\n    {\n      mode: \"everyMinute\"\n    }\n  ]\n},\nsimple: false,\nfilters: {\n  labelIds: [\n    \"CATEGORY_PROMOTIONS\"\n  ]\n},\noptions: {}\n\\```\n\n3. **Provide Credentials**:\n   - Ensure that you have set up the necessary Gmail credentials. In this case, it's using Gmail OAuth2 with the ID \"UJx4Tiq8WRtxWEIP\" and the name \"Gmail Omar\".\n\n4. **Save and Execute**:\n   - Save your workflow and execute it to start monitoring your Gmail account for new emails with the specified label filter.\n\nBy following these steps, your workflow will effectively trigger based on new emails that match the \"CATEGORY_PROMOTIONS\" label in your Gmail account.\n"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Text to  TTS": {
        "main": [
          [
            {
              "node": "Convert from base64 to File",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Summarization Chain3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail trigger": {
        "main": [
          [
            {
              "node": "Get message content1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model3": {
        "ai_languageModel": [
          [
            {
              "node": "Summarization Chain3",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Get message content1": {
        "main": [
          [
            {
              "node": "Delete the unnecessary items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarization Chain3": {
        "main": [
          [
            {
              "node": "Merge Text with Audio",
              "type": "main",
              "index": 1
            },
            {
              "node": "Text to  TTS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Text with Audio": {
        "main": [
          [
            {
              "node": "Aggregate in same cell",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate in same cell": {
        "main": [
          [
            {
              "node": "Send Message to Telegram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert from base64 to File": {
        "main": [
          [
            {
              "node": "Merge Text with Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete the unnecessary items": {
        "main": [
          [
            {
              "node": "Summarization Chain3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "30r9acI1XVIIwAMi",
    "meta": {
      "instanceId": "378c072a34d9e63949fd9cf26b8d28ff276a486e303f0d8963f23e1d74169c1b",
      "templateCredsSetupCompleted": true
    },
    "name": "mails2notion V2",
    "tags": [],
    "nodes": [
      {
        "id": "3f649e97-e568-47ff-b175-bf63d859d95f",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          2560,
          240
        ],
        "parameters": {
          "model": "gpt-4o",
          "options": {
            "temperature": 0,
            "responseFormat": "json_object"
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "mrgqM64cM1L88xC6",
            "name": "octionicsolutions@gmail.com"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "bd60c65f-ba6c-4dcb-8d09-b29f5dd475b7",
        "name": "Calculator",
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "disabled": true,
        "position": [
          2700,
          240
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "d052786a-92a0-4f9b-9867-2dd64ada8034",
        "name": "Structured Output Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          2820,
          240
        ],
        "parameters": {
          "jsonSchemaExample": "{\n  \"summary\": \"Text\",\n  \"meta\": {\n    \"sender\": \"Text\",\n    \"subject\": \"Text\",\n    \"date\": \"Text\"\n  }\n}"
        },
        "typeVersion": 1.2
      },
      {
        "id": "50d396fd-d3b0-4fea-99d7-18bd4773cb20",
        "name": "Add Label \"Processed\"",
        "type": "n8n-nodes-base.gmail",
        "position": [
          3860,
          20
        ],
        "parameters": {
          "labelIds": "={{ $('Globals').item.json.processedLabelID }}",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "operation": "addLabels"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "9LLNsPzyDJlQFgdw",
            "name": "Gmail (mails2notion)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "8a4c49f9-0c14-46ea-a475-a0d83eb9d688",
        "name": "Active Routes Only",
        "type": "n8n-nodes-base.filter",
        "position": [
          2000,
          20
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "02b11920-e737-46cc-b1b9-22ffaf7f3f64",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{ $json.Active }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "fd0f902f-4d16-4bad-8ed0-7fe02e8e879b",
        "name": "Extract Route ID",
        "type": "n8n-nodes-base.set",
        "position": [
          1560,
          220
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "acfaf63a-74de-4018-ae30-671f209878ba",
                "name": "route",
                "type": "string",
                "value": "={{ $('Gmail Trigger').item.json.to.text.match(/\\+([^@]+)@/)[1] }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "81d1dec6-aacc-480d-8cb4-1832ff27de92",
        "name": "Deactivate Route",
        "type": "n8n-nodes-base.airtable",
        "position": [
          3420,
          220
        ],
        "parameters": {
          "base": {
            "__rl": true,
            "mode": "list",
            "value": "appuqZhHVVGAcMwoA",
            "cachedResultUrl": "https://airtable.com/appuqZhHVVGAcMwoA",
            "cachedResultName": "mails2notion"
          },
          "table": {
            "__rl": true,
            "mode": "list",
            "value": "tblWL6FqfLkLHmLEo",
            "cachedResultUrl": "https://airtable.com/appuqZhHVVGAcMwoA/tblWL6FqfLkLHmLEo",
            "cachedResultName": "Routes"
          },
          "columns": {
            "value": {
              "id": "={{ $('Get Route by ID').item.json.id }}",
              "Active": false
            },
            "schema": [
              {
                "id": "id",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": true,
                "required": false,
                "displayName": "id",
                "defaultMatch": true
              },
              {
                "id": "Name",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": false,
                "required": false,
                "displayName": "Name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Token",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": false,
                "required": false,
                "displayName": "Token",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "NotionDatabase",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": false,
                "required": false,
                "displayName": "NotionDatabase",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Email Alias",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": true,
                "required": false,
                "displayName": "Email Alias",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "User",
                "type": "array",
                "display": true,
                "removed": true,
                "readOnly": false,
                "required": false,
                "displayName": "User",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Active",
                "type": "boolean",
                "display": true,
                "removed": false,
                "readOnly": false,
                "required": false,
                "displayName": "Active",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Status",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": true,
                "required": false,
                "displayName": "Status",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "id"
            ]
          },
          "options": {},
          "operation": "update"
        },
        "credentials": {
          "airtableTokenApi": {
            "id": "kHzLZhbAFQ1CQnQz",
            "name": "Airtable (octionicsolutions)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "20242505-c57e-424c-a215-2b2effac1d94",
        "name": "Add Label \"Error\"",
        "type": "n8n-nodes-base.gmail",
        "position": [
          3860,
          220
        ],
        "parameters": {
          "labelIds": "={{ $('Globals').item.json.errorLabelID }}",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "operation": "addLabels"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "9LLNsPzyDJlQFgdw",
            "name": "Gmail (mails2notion)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "7a788a4f-f0a8-4fe8-b21d-b114a65313b1",
        "name": "Send notification about deactivated route",
        "type": "n8n-nodes-base.gmail",
        "position": [
          3640,
          220
        ],
        "parameters": {
          "sendTo": "={{ $('Gmail Trigger').item.json.from.value[0].address }}",
          "message": "=An error happened while trying to create a Notion Page. It can have various reasons, including a temporary outage of the Notion API, missing permissions to the Notion Database or a wrong Notion Database URL.\n\nThe route has been deaktivated to prevent future errors.\n\nPlease double check your configuration and enable the route again.",
          "options": {
            "appendAttribution": false
          },
          "subject": "A route has been deactivated",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "9LLNsPzyDJlQFgdw",
            "name": "Gmail (mails2notion)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "5e7cc69c-8f58-4ac8-9263-1ad206609295",
        "name": "Send notification about missing route",
        "type": "n8n-nodes-base.gmail",
        "position": [
          3640,
          420
        ],
        "parameters": {
          "sendTo": "={{ $('Gmail Trigger').item.json.from.value[0].address }}",
          "message": "=There seems to be no active route anymore which connects this Alias to a Notion Database.\n\nPlease try again later or double check your configuration.",
          "options": {
            "appendAttribution": false
          },
          "subject": "Your Message could not be processed",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "9LLNsPzyDJlQFgdw",
            "name": "Gmail (mails2notion)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "7dd9646c-3172-4b53-82c8-4df7fd5f53ea",
        "name": "Get Route by ID",
        "type": "n8n-nodes-base.airtable",
        "onError": "continueErrorOutput",
        "position": [
          1780,
          220
        ],
        "parameters": {
          "id": "={{ $json.route }}",
          "base": {
            "__rl": true,
            "mode": "list",
            "value": "appuqZhHVVGAcMwoA",
            "cachedResultUrl": "https://airtable.com/appuqZhHVVGAcMwoA",
            "cachedResultName": "mails2notion"
          },
          "table": {
            "__rl": true,
            "mode": "list",
            "value": "tblWL6FqfLkLHmLEo",
            "cachedResultUrl": "https://airtable.com/appuqZhHVVGAcMwoA/tblWL6FqfLkLHmLEo",
            "cachedResultName": "Routes"
          },
          "options": {},
          "operation": "get"
        },
        "credentials": {
          "airtableTokenApi": {
            "id": "kHzLZhbAFQ1CQnQz",
            "name": "Airtable (octionicsolutions)"
          }
        },
        "retryOnFail": true,
        "typeVersion": 2.1,
        "waitBetweenTries": 5000
      },
      {
        "id": "8ddfe273-3fda-4b71-a972-5001d4fa71c1",
        "name": "Create Notion Page",
        "type": "n8n-nodes-base.httpRequest",
        "onError": "continueErrorOutput",
        "position": [
          3200,
          20
        ],
        "parameters": {
          "url": "https://api.notion.com/v1/pages",
          "method": "POST",
          "options": {},
          "jsonBody": "={{ $json.toJsonString() }}",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Get Route by ID').item.json.Token }}"
              },
              {
                "name": "Notion-Version",
                "value": "2022-06-28"
              }
            ]
          }
        },
        "retryOnFail": true,
        "typeVersion": 4.2,
        "waitBetweenTries": 5000
      },
      {
        "id": "f773e41f-13b7-483a-9886-90a4425a7f6a",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          900,
          220
        ],
        "parameters": {
          "simple": false,
          "filters": {
            "labelIds": "=INBOX"
          },
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "9LLNsPzyDJlQFgdw",
            "name": "Gmail (mails2notion)"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "918ce27c-2886-4793-81f5-e459f3299bb1",
        "name": "Filter for unprocessed mails",
        "type": "n8n-nodes-base.filter",
        "position": [
          1340,
          220
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "28879541-2e66-4a31-b25f-f0419ae45f47",
                "operator": {
                  "type": "array",
                  "operation": "notContains",
                  "rightType": "any"
                },
                "leftValue": "={{ $('Gmail Trigger').item.json.labelIds }}",
                "rightValue": "={{ $json.errorLabelID }}"
              },
              {
                "id": "259a783f-5954-467b-ad52-c1e0072c2239",
                "operator": {
                  "type": "array",
                  "operation": "notContains",
                  "rightType": "any"
                },
                "leftValue": "={{ $('Gmail Trigger').item.json.labelIds }}",
                "rightValue": "={{ $json.processedLabelID }}"
              },
              {
                "id": "81ef1ac2-449e-44c2-a94b-2fc9b08ec934",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $('Gmail Trigger').item.json.to.text.match(/\\+([^@]+)@/)[1] }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "14764527-ca40-4937-baa2-368b716c6f58",
        "name": "When clicking ‚ÄòTest workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "disabled": true,
        "position": [
          920,
          600
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "5f955606-4063-4683-b242-2fc0a4fbf34a",
        "name": "Required labels",
        "type": "n8n-nodes-base.filter",
        "position": [
          1360,
          600
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "or",
            "conditions": [
              {
                "id": "9bb51a86-76d3-42f7-8362-1931244f8cd9",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.name }}",
                "rightValue": "Error"
              },
              {
                "id": "28b3afb4-d727-4306-9e45-321c9bd688e3",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                },
                "leftValue": "={{ $json.name }}",
                "rightValue": "Processed"
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "697198d3-2fc2-4665-86a8-4bc16dbc3d43",
        "name": "Globals",
        "type": "n8n-nodes-base.set",
        "position": [
          1120,
          220
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "0dcfba61-ddb5-425d-a803-f88cf36d81d9",
                "name": "errorLabelID",
                "type": "string",
                "value": "Label_4248329647975725750"
              },
              {
                "id": "b1505eaa-1d7e-49d7-be2e-cd71f5ec2632",
                "name": "processedLabelID",
                "type": "string",
                "value": "Label_6498950601707174088"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "b7efe665-97d8-4a82-a3f5-e15bffd68752",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          840,
          420
        ],
        "parameters": {
          "color": 5,
          "width": 742.4418604651174,
          "height": 361.9189248985609,
          "content": "## Setup\n- Disable the Gmail Trigger and enable the manual trigger here\n- Execute the workflow once\n- Copy the Gmail Label IDs from the output of the \"Required labels\" node to the \"Globals\" node\n- Disable the manual trigger here and and enable the Gmail Trigger again\n- Activate the workflow, so it runs automatically in the background\n"
        },
        "typeVersion": 1
      },
      {
        "id": "3d035d35-3760-4393-8796-cb713338c9d7",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1060,
          60
        ],
        "parameters": {
          "width": 215.20930232558143,
          "height": 323.99999999999943,
          "content": "## Set Globals\nUse the setup instructions below to retrieve the values for both `errorLabelID` and `processedLabelID`"
        },
        "typeVersion": 1
      },
      {
        "id": "b420310e-c0d5-4168-94ad-4c5973dfb3ab",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1720,
          60
        ],
        "parameters": {
          "width": 215.49263552738452,
          "height": 324.4244486294891,
          "content": "## Select Base\nSelect the database and the table where the \"Routes\" are defined"
        },
        "typeVersion": 1
      },
      {
        "id": "c917a3cb-d745-4f37-bd8f-0350c5aef473",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          840,
          140
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 245.005504426549,
          "content": "The Gmail inbox is checked every minute for new entries"
        },
        "typeVersion": 1
      },
      {
        "id": "9298ad5b-ae09-44c6-8da4-2d2bd473c3ea",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1500,
          140
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 245.005504426549,
          "content": "Extract the Airtable Row ID from the Email address"
        },
        "typeVersion": 1
      },
      {
        "id": "654bbfbe-3e0f-40e0-a686-5081069d825e",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1280,
          140
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 245.005504426549,
          "content": "Filter by labels to prohibit double-processing"
        },
        "typeVersion": 1
      },
      {
        "id": "31ade897-22de-4b39-8f96-37bc7b274bfb",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2920,
          -120
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 305.2192252594149,
          "content": "Dynamically build request body for Notion, since dynamic auth, and content with optional fields require a custom request"
        },
        "typeVersion": 1
      },
      {
        "id": "26cf52ea-01d1-48ed-9d3d-71e4ff01983f",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          3140,
          -120
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 304.5973623748489,
          "content": "The custom built request including the user specific authentication is sent to Notion to create a new Page inside of a database"
        },
        "typeVersion": 1
      },
      {
        "id": "d765c84d-9e15-44c8-b975-2c366c315bfe",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2160,
          -160
        ],
        "parameters": {
          "color": 7,
          "width": 755.8332895195936,
          "height": 529.1698390841688,
          "content": "The Email is processed in multiple ways:\n- An actionable task is being generated based on the content, consisting of a short title, a short description and optionally a few details as bullet points\n- A detailed Email summary is being generated\n- Meta data is being extracted - so the user has a reference to find the original Email again\n- To get more stable results, the tasks are devided between two Agents"
        },
        "typeVersion": 1
      },
      {
        "id": "0103f8bc-2a43-455a-88da-b7317821f0b3",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1940,
          -80
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 249.09934448053562,
          "content": "Skip disabled routes (determined by a checkbox attribute in Airtable)"
        },
        "typeVersion": 1
      },
      {
        "id": "1d2fe867-f3d1-4702-b35e-f730f20b7251",
        "name": "No Operation, do nothing",
        "type": "n8n-nodes-base.noOp",
        "position": [
          2000,
          420
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "758d1797-0e6c-40de-a6a4-e16f8350674c",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          3580,
          100
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 503.00412949500975,
          "content": "Send custom Email notifications back to sender, containing an error message and suggestions to fix it"
        },
        "typeVersion": 1
      },
      {
        "id": "56522a6d-c961-48a5-a5ef-33df96d77a22",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          3800,
          -60
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 446.3164817463921,
          "content": "Add labels which prevent from double-processing"
        },
        "typeVersion": 1
      },
      {
        "id": "5b81389b-49a6-4849-becf-35c4e680b734",
        "name": "Sticky Note12",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          3360,
          120
        ],
        "parameters": {
          "color": 7,
          "width": 216.47293010628914,
          "height": 261.3816681594028,
          "content": "Disable a checkbox attribute in Airtable which determines if a route is active"
        },
        "typeVersion": 1
      },
      {
        "id": "6558328c-30cf-4f37-a0cb-d5f9f6efa7b2",
        "name": "Format Notion Page Blocks",
        "type": "n8n-nodes-base.code",
        "position": [
          2980,
          20
        ],
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "function paragraph(content, annotations={}) {\n  return {\n    \"object\": \"block\",\n    \"type\": \"paragraph\",\n    \"paragraph\": {\n      \"rich_text\": [\n        {\n          \"type\": \"text\",\n          \"text\": {\n            \"content\": content\n          },\n          \"annotations\": annotations\n        }\n      ]\n    }\n  };\n}\nfunction bulletPoint(content) {\n  return {\n    \"object\": \"block\",\n    \"type\": \"bulleted_list_item\",\n    \"bulleted_list_item\": {\n      \"rich_text\": [\n        {\n          \"type\": \"text\",\n          \"text\": {\n            \"content\": content\n          }\n        }\n      ]\n    }\n  };\n}\n\n// combine AI generated content\nconst content = Object.assign({}, $('Generate Actionable Task').item.json.output, $('Get Summary & Meta Data').item.json.output);\n\nblocks = [];\n\n// append task description\nblocks.push(paragraph(content.description));\n\nif (content.bulletpoints) {\n  for (let bulletpoint of content.bulletpoints) {\n    blocks.push(bulletPoint(bulletpoint));\n  }\n}\n\n// append empty line\nblocks.push(paragraph(\"\"));\n\n// append devider\nblocks.push({\n  \"object\": \"block\",\n  \"type\": \"divider\",\n  \"divider\": {}\n});\n\n// append summary & meta data\nblocks.push(paragraph(\"Email summary:\"));\nblocks.push(paragraph(content.summary));\nblocks.push(paragraph(\"\"));\nblocks.push(paragraph(content.meta.sender + \"\\n\" + content.meta.subject + \"\\n\" + content.meta.date, {\"italic\": true}));\n\n// build final object\noutput = {\n  \"parent\": {\n    \"database_id\": $('Get Route by ID').item.json.NotionDatabase.match(/https:\\/\\/www\\.notion\\.so\\/[a-zA-Z0-9-]+\\/([a-zA-Z0-9]{32})/)[1]\n  },\n  \"properties\": {\n    \"Name\": {\n      \"title\": [\n        {\n          \"text\": {\n            \"content\": content.title\n          }\n        }\n      ]\n    }\n  },\n  \"children\": blocks\n};\n\nreturn { json: output };"
        },
        "typeVersion": 2
      },
      {
        "id": "133e3498-10ce-4a08-aa50-3c7d56f1b9c8",
        "name": "Get all labels",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1140,
          600
        ],
        "parameters": {
          "resource": "label",
          "returnAll": true
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "9LLNsPzyDJlQFgdw",
            "name": "Gmail (mails2notion)"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "f68e66e1-9f84-498a-bfc4-f7c5b2ca42b1",
        "name": "Structured Output Parser1",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          2440,
          240
        ],
        "parameters": {
          "jsonSchemaExample": "{\n  \"title\": \"Title\",\n  \"description\": \"Text\",\n  \"bulletpoints\": [\n    \"Text\",\n    \"Text\"\n  ]\n}"
        },
        "typeVersion": 1.2
      },
      {
        "id": "c55a3e9b-5637-4775-a0a6-ea11f1bd26a7",
        "name": "Calculator1",
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "disabled": true,
        "position": [
          2320,
          240
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "4d4f7b04-5431-47d2-b9b1-ee2c516e729c",
        "name": "OpenAI Chat Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          2180,
          240
        ],
        "parameters": {
          "model": "gpt-4o",
          "options": {
            "temperature": 0,
            "responseFormat": "json_object"
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "mrgqM64cM1L88xC6",
            "name": "octionicsolutions@gmail.com"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "ea081c31-2721-4e6c-820a-2f0da33495ac",
        "name": "Generate Actionable Task",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          2220,
          20
        ],
        "parameters": {
          "text": "={{ $('Gmail Trigger').item.json.text }}",
          "options": {
            "systemMessage": "Your task is to understand the Email content and extract one actionable task. If there is no obvious actionable task, then just create a title which implies to take a look at this Email by addressing the content summarized to 5 words. The title should be quite decided. This attribute is called title.\n\nCreate a proper description for the task. Be precise but detailed. Start with a short sentence and if it is worth adding more information, add bulletpoints after that containing additional information which help to understand the context of the task better, like links and other references, or just more detailed instructions. Add the description to the output as attribute output. Add the bulletpoints to the output as attribute output, but remember, bullet points are optional.\n\nReturn all attributes in a JSON format."
          },
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 1.6
      },
      {
        "id": "6fb2d964-dc0b-45d9-8307-6da16fba769e",
        "name": "Get Summary & Meta Data",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          2600,
          20
        ],
        "parameters": {
          "text": "={{ $('Gmail Trigger').item.json.text }}",
          "options": {
            "systemMessage": "Summarize the email (as much detail as possible) and add it to the output as the attribute summary.\n\nExtract the email sender, subject and date of receipt. If this is a forwarded email, then get this data from the original message, otherwise use the meta data of this Email. Format the Email Adress as follows, and add it to the JSON output as the attribute meta.sender: \"From: Full Name <mail@example.com\". Format the the subject as follows and add it to the output as attribute meta.subject: \"Subject: SubjectGoesHere\". Format the the date as follows and add it to the output as attribute meta.date: \"Date: DateStringGoesHere\" (Date format: RFC 2822).\n\nReturn all attributes in a JSON format."
          },
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 1.6
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "ee560597-bc46-4255-89b9-af8fe332b226",
    "connections": {
      "Globals": {
        "main": [
          [
            {
              "node": "Filter for unprocessed mails",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculator": {
        "ai_tool": [
          [
            {
              "node": "Get Summary & Meta Data",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator1": {
        "ai_tool": [
          [
            {
              "node": "Generate Actionable Task",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Globals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get all labels": {
        "main": [
          [
            {
              "node": "Required labels",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Route by ID": {
        "main": [
          [
            {
              "node": "Active Routes Only",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Deactivate Route": {
        "main": [
          [
            {
              "node": "Send notification about deactivated route",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Route ID": {
        "main": [
          [
            {
              "node": "Get Route by ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Get Summary & Meta Data",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Active Routes Only": {
        "main": [
          [
            {
              "node": "Generate Actionable Task",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Notion Page": {
        "main": [
          [
            {
              "node": "Add Label \"Processed\"",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Deactivate Route",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Generate Actionable Task",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Get Summary & Meta Data": {
        "main": [
          [
            {
              "node": "Format Notion Page Blocks",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Actionable Task": {
        "main": [
          [
            {
              "node": "Get Summary & Meta Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "No Operation, do nothing": {
        "main": [
          [
            {
              "node": "Send notification about missing route",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Get Summary & Meta Data",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Format Notion Page Blocks": {
        "main": [
          [
            {
              "node": "Create Notion Page",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser1": {
        "ai_outputParser": [
          [
            {
              "node": "Generate Actionable Task",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Filter for unprocessed mails": {
        "main": [
          [
            {
              "node": "Extract Route ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòTest workflow‚Äô": {
        "main": [
          [
            {
              "node": "Get all labels",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send notification about missing route": {
        "main": [
          [
            {
              "node": "Add Label \"Error\"",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send notification about deactivated route": {
        "main": [
          [
            {
              "node": "Add Label \"Error\"",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "wZBgoWrBZveMmzYi",
    "meta": {
      "instanceId": "147b9b53621dbd6fca5f762b57fc3fabf293d676d0c08463ec52c91332ab391f",
      "templateCredsSetupCompleted": true
    },
    "name": "Turn YouTube Videos into Summaries, Transcripts, and Visual Insights",
    "tags": [],
    "nodes": [
      {
        "id": "61c56de7-0d8e-44fe-baf3-3e33ddd35b21",
        "name": "When clicking ‚ÄòTest workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -1340,
          120
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "4e43030c-16cd-4b77-8c58-c3b703646a16",
        "name": "Set: Define Initial Variables",
        "type": "n8n-nodes-base.set",
        "position": [
          -840,
          120
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "72590fa0-cf12-4249-80fc-7aaec9992390",
                "name": "automationID",
                "type": "string",
                "value": "optional-enter-reference-tracking-identifier"
              },
              {
                "id": "24e9b1c3-2955-4e0b-9b4b-a6b9d046fb72",
                "name": "apiKey",
                "type": "string",
                "value": "enter-your-api-key-here"
              },
              {
                "id": "b6600a42-1b8d-486a-a51d-0868bc45452e",
                "name": "youtubeURL",
                "type": "string",
                "value": "https://www.youtube.com/watch?v=Ovg_KfKxnC8"
              },
              {
                "id": "ce9a9a40-5ae4-4106-ae61-0daba2ec185f",
                "name": "promptType",
                "type": "string",
                "value": "transcript"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "add611c6-c053-464c-b12b-f0f20b4c3c4f",
        "name": "Switch: What kind of question do we want to ask?",
        "type": "n8n-nodes-base.switch",
        "onError": "continueRegularOutput",
        "position": [
          -200,
          60
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "Transcript",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "4ba139e4-2fd7-473f-869d-f27a1a2f3823",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.promptType.toLowerCase() }}",
                      "rightValue": "transcript"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "Transcript with Timestamps",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "486f3c1c-7203-4bc5-a796-87939d4360c5",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.promptType.toLowerCase() }}",
                      "rightValue": "timestamps"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "Summary",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "814597ad-12ff-450d-a4bc-cd2eb2836d8f",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.promptType.toLowerCase() }}",
                      "rightValue": "summary"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "Scene Description",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "759debf2-3dfb-4bdd-b41f-7ef0a709e25e",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.promptType.toLowerCase() }}",
                      "rightValue": "scene"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "Clips",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "5c66a390-2566-461d-b9bc-b0e7ebdc4af8",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.promptType.toLowerCase() }}",
                      "rightValue": "clips"
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "typeVersion": 3.2,
        "alwaysOutputData": false
      },
      {
        "id": "96b6a6c7-3b4f-412d-b200-526971782346",
        "name": "Set: Scene Prompt",
        "type": "n8n-nodes-base.set",
        "position": [
          480,
          220
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8be68e95-53df-492f-a88a-14c06f51f531",
                "name": "prompt",
                "type": "string",
                "value": "=Please provide a detailed description of the scene in the video, including:\n\nSetting: Where the scene takes place (e.g., indoors, outdoors, specific location). Be specific - is it a forest, a city street, a living room?\n\nObjects: Prominent objects visible in the scene (e.g., furniture, vehicles, natural elements). Include details like color, size, and material if discernible.\n\nPeople: Description of any people present, including their appearance (clothing, hair, etc.), approximate age, and any actions they are performing.\n\nLighting: The overall lighting of the scene (e.g., bright, dim, natural, artificial). Note any specific light sources (lamps, sunlight).\n\nColors: Dominant colors and color palettes used in the scene.\n\nCamera Angle/Movement: Describe the camera perspective (e.g., close-up, wide shot, aerial view) and any camera movement (panning, zooming, static).\n\nStart output directly with the response -- do not include any introductory text or explanations."
              },
              {
                "id": "bfa3b421-643d-4a52-93e9-0830f794140b",
                "name": "model",
                "type": "string",
                "value": "gemini-1.5-flash"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "7506b5fa-be12-4d34-8583-027bc782db0d",
        "name": "Set: Summarize Prompt",
        "type": "n8n-nodes-base.set",
        "position": [
          480,
          20
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8be68e95-53df-492f-a88a-14c06f51f531",
                "name": "prompt",
                "type": "string",
                "value": "=Provide a concise summary of the main points in nested bullets, using quotes only when absolutely essential for clarity. Start output directly with the response."
              },
              {
                "id": "ccc44699-0918-4837-89a6-c763b157fc8c",
                "name": "model",
                "type": "string",
                "value": "gemini-1.5-flash"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "2aaf482d-af31-4cd8-9014-7b77efbf3021",
        "name": "Set: Transcript Prompt",
        "type": "n8n-nodes-base.set",
        "position": [
          480,
          -380
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8be68e95-53df-492f-a88a-14c06f51f531",
                "name": "prompt",
                "type": "string",
                "value": "=Transcribe the video. Return only the spoken dialogue, verbatim. Omit any additional text or descriptions."
              },
              {
                "id": "b445c2da-934f-4a78-a57b-f383d8950f8a",
                "name": "model",
                "type": "string",
                "value": "gemini-1.5-flash"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "75a6ac10-00c2-45ab-88b7-dfec3cd58bf2",
        "name": "Set: Fallback",
        "type": "n8n-nodes-base.set",
        "position": [
          480,
          620
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8be68e95-53df-492f-a88a-14c06f51f531",
                "name": "prompt",
                "type": "string",
                "value": "=Summarize this YouTube video with a focus on actionable insights. Use nested bullets and include relevant quotes. Specifically, highlight any recommended tools, strategies, or resources mentioned."
              },
              {
                "id": "da626eb8-a097-4a65-834d-4d1709aed260",
                "name": "model",
                "type": "string",
                "value": "gemini-1.5-flash"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "29ef7f9f-34c9-46f5-96f9-17b42feea381",
        "name": "Set: Transcript with Timestamps Prompt",
        "type": "n8n-nodes-base.set",
        "position": [
          480,
          -180
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8be68e95-53df-492f-a88a-14c06f51f531",
                "name": "prompt",
                "type": "string",
                "value": "=Generate a timestamped transcript of the video. Each line must follow this format precisely:  [hh:mm:ss] Dialogue. Return only the timestamp and spoken content; omit any other text or formatting.  "
              },
              {
                "id": "98ca7af8-0fbd-4ba8-8fc8-f914e5bbe48a",
                "name": "model",
                "type": "string",
                "value": "gemini-1.5-flash"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "e10524ed-09dd-4c0f-86b0-9161fa347821",
        "name": "Set: Scene Clips",
        "type": "n8n-nodes-base.set",
        "position": [
          480,
          420
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "8be68e95-53df-492f-a88a-14c06f51f531",
                "name": "prompt",
                "type": "string",
                "value": "=Extract shareable clips for social media. Each clip must include:\n\n* **Timestamp:** [hh:mm:ss]-[hh:mm:ss]\n* **Transcript:** Verbatim dialogue/text within the clip.\n* **Rationale:**  A concise explanation (under 20 words) of the clip's social media appeal (e.g., \"humorous,\" \"controversial,\" \"inspiring,\" \"informative\").  Focus on virality, engagement potential (shares, likes, comments).\n\nStart output directly with the response -- do not include any introductory text or explanations."
              },
              {
                "id": "0493ffa7-4fef-4e48-b9d7-7f0891660325",
                "name": "model",
                "type": "string",
                "value": "gemini-1.5-flash"
              }
            ]
          },
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "be66d323-9035-4123-8086-dde14e528dc8",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2340,
          -600
        ],
        "parameters": {
          "width": 780,
          "height": 820,
          "content": "# How to Use This Workflow\n\nVideo Overview: [https://www.youtube.com/watch?v=Ovg_KfKxnC8](https://www.youtube.com/watch?v=Ovg_KfKxnC8)\n\nUse this workflow to analyze YouTube videos effortlessly. Start by requesting a summary or transcript‚Äîthen refine the prompts to fit your needs and the type of content you're working with.\n\nEven more impressive? You can ask specific questions about what‚Äôs happening in a video‚Äîidentifying people, scenes, and visual details. The ability to extract this level of insight is game-changing.\n\nThis workflow is highly adaptable‚Äîactions adjust based on the values you set. With a single flow, you can generate transcripts, create detailed YouTube descriptions, and draft summary blog posts.\n\nTriggers are flexible, too. Run it manually, connect it to a webhook, or automate it through Airtable or another system. The output can go anywhere -- Notion, Google Docs, CMS platforms -- or simply stay in n8n for on-the-fly analysis.\n\nThis workflow was created using n8n 1.82.3.\n\n## Requirements\n* [Google API key](https://console.developers.google.com/) (or obtain via [AI Studio](https://aistudio.google.com/apikey))\n\n## Testing\n* This workflow was tested on an assortment of public YouTube videos from shorts up to about an hour in length.\n\n## Future-proofing\n* This workflow was created for use with gemini-1.5-flash. In the future, the set nodes for prompts could be updated to use different models and possibly add in what API endpoint should be used in the http node.\n\n## Documentation\n* [Explore vision capabilities with the Gemini API](https://ai.google.dev/gemini-api/docs/vision?lang=python)\n* [Pricing](https://ai.google.dev/gemini-api/docs/pricing)"
        },
        "typeVersion": 1
      },
      {
        "id": "a8f5541c-d267-4998-bb31-32f2684b0874",
        "name": "Set Fields: Define Outcome",
        "type": "n8n-nodes-base.set",
        "position": [
          2800,
          120
        ],
        "parameters": {
          "include": "except",
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "300bfbe7-8d13-41ba-8828-17bba1d0eabe",
                "name": "answerAIGenerated",
                "type": "string",
                "value": "={{ $json.candidates?.[0]?.content?.parts?.[0]?.text ? $json.candidates[0].content.parts[0].text : ($json.error ? $json.error : \"No content or error found\") }}"
              },
              {
                "id": "a54eeb5d-e4de-4fd9-a15c-be51cc414c46",
                "name": "promptTokenCount",
                "type": "string",
                "value": "={{ $json.usageMetadata?.promptTokenCount ? $json.usageMetadata.promptTokenCount : ($json.error ? $json.error : \"No content or error found\") }}"
              },
              {
                "id": "dd590788-069e-48d9-adb2-6a5d10f8af2f",
                "name": "candidatesTokenCount",
                "type": "string",
                "value": "={{ $json.usageMetadata?.candidatesTokenCount ? $json.usageMetadata.candidatesTokenCount : ($json.error ? $json.error : \"No content or error found\") }}"
              },
              {
                "id": "23766495-25df-4d3d-bc62-9e79a860ee19",
                "name": "totalTokenCount",
                "type": "string",
                "value": "={{ $json.usageMetadata?.totalTokenCount ? $json.usageMetadata.totalTokenCount : ($json.error ? $json.error : \"No content or error found\") }}"
              },
              {
                "id": "cfad5ba2-a2c5-48ff-b64b-9131a51fd23c",
                "name": "modelVersionUsed",
                "type": "string",
                "value": "={{ $json.modelVersion ? $json.modelVersion : ($json.error ? $json.error : \"No content or error found\") }}"
              }
            ]
          },
          "excludeFields": "candidates, usageMetadata",
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "062b5d41-27bb-4e67-8ffa-6e3e392fb437",
        "name": "HTTP Request to Google",
        "type": "n8n-nodes-base.httpRequest",
        "onError": "continueRegularOutput",
        "position": [
          1740,
          120
        ],
        "parameters": {
          "url": "=https://generativelanguage.googleapis.com/v1beta/models/{{ $json.model }}:generateContent?key={{ $json.apiKey }}",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [\n      { \"text\": {{ JSON.stringify($json.prompt) }} },\n      { \"file_data\": { \"file_uri\": \"{{ $json.youtubeURL }}\" } }\n    ]\n  }]\n}",
          "sendBody": true,
          "sendHeaders": true,
          "specifyBody": "json",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        },
        "typeVersion": 4.2,
        "alwaysOutputData": true
      },
      {
        "id": "0a204e60-674a-453d-81e1-9eb59a3214e2",
        "name": "Set: Merged Values",
        "type": "n8n-nodes-base.set",
        "position": [
          1380,
          120
        ],
        "parameters": {
          "options": {},
          "includeOtherFields": true
        },
        "typeVersion": 3.4
      },
      {
        "id": "48ed5162-61e1-4077-a13a-b2cf135fc11e",
        "name": "If: Was an error detected?",
        "type": "n8n-nodes-base.if",
        "disabled": true,
        "position": [
          2560,
          780
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "148e9a72-f826-468c-86a3-471873717ed4",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.error }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "f9c0ef37-da99-4100-bd04-b5f2ac93a694",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2340,
          280
        ],
        "parameters": {
          "width": 780,
          "height": 3580,
          "content": "## Prompt Inspiration Ideas\n\nUse these prompts as inspiration for your workflow. A quick way to iterate on ideas is to try them in [https://aistudio.google.com/](https://aistudio.google.com/).\n\n### üìù Essential Video Summarizer (Quick Content Digestion)\nProvide a concise summary of the main points of this YouTube video in nested bullets, using quotes only when absolutely essential for clarity.\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n### üöÄ Complete YouTube SEO Package Generator (Content Marketing)\n\nGenerate a complete YouTube package (Title, Description, Keywords, and Timestamps) based on the following transcript:\n\n**Instructions:**\n\n* **Title:** Craft a concise and engaging title (under 60 characters) that accurately reflects the video's content and will attract viewers.  \n* **Description:** Write a detailed description (around 150-200 words) summarizing the key topics covered in the video.  This description should:\n    * Clearly outline the value proposition for the viewer (what they will learn or gain).\n    * Include relevant keywords to improve searchability.\n    * Feature a strong call to action (e.g., subscribe, visit a website, follow on social media).\n    * Optionally include a brief, intriguing hook at the beginning to grab the viewer's attention.\n* **Keywords:** Generate a list of relevant keywords and tags (around 10-15) that accurately describe the video's content and will help viewers find it in search results.  Consider:\n    * Specific topics discussed\n    * Related terms and concepts\n    * Industry jargon (if applicable)\n    * Names of people or products mentioned\n* **Timestamps:**  Generate timestamps for key topics or sections within the video. These should be formatted clearly for easy navigation.  For example:\n    * 0:00 Introduction\n    * 1:15 Topic 1\n    * 3:45 Topic 2 ...etc.  \n\n**Important Considerations:**\n\n* **Target Audience:** Assume the target audience is [Describe your target audience ‚Äì e.g., beginners learning Python, experienced marketers, people interested in gardening].\n* **Overall Tone:** The tone of the entire package should be [Specify the desired tone ‚Äì e.g., informative and educational, enthusiastic and engaging, humorous and lighthearted].\n* **Video's Purpose:** The primary goal of the video is to [State the video's objective ‚Äì e.g., teach a skill, provide information, entertain, persuade].\n\n\n**Optional:**\n* If the video promotes a product, service, or other content, include relevant links in the description.\n* If there are any specific phrases or branding elements that should be included, specify them here.\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n### üó∫Ô∏è Structured Video Content Map (Educational Organization)\n\nSummarize the key points of this YouTube video with no introductory text. Follow this structured format:\n\nMain Topics\n* Organize content using Level 2 headers (##) based on key themes.\n\nUnder each header:\n* List only the most essential concepts using concise bullet points.\n* Ensure technical accuracy while maintaining clarity.\n\nOrganize sections in this order when applicable:\n* Overview & Context\n* Core Concepts & Features\n* How It Works\n* Benefits & Drawbacks\n\nFormatting Rules:\n* Use Markdown for structured readability.\n* Keep bullet points simple (avoid nesting).\n* No summaries, conclusions, or extra explanations -- just structured content.\n\n### üéØ Goal-Oriented Learning Digest (Personal Development)\n\nI'm trying to learn about [Specific Goal, e.g., \"how to improve my public speaking skills,\" \"the latest trends in web development\"]. Summarize the relevant information using nested bullets and quotes, focusing on how it helps me achieve this goal.\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n### ‚öôÔ∏è Actionable Insights Framework (Implementation Planning)\n\nExtract actionable insights with a focus on practical applications and recommendations.\n\nStart output directly with the response‚Äîdo not include any introductory text or explanations.\n\nFormat the summary using markdown and follow this structure:\n\nProblem Statement\n* Summarize the core issue or topic addressed.\n\nKey Solutions & Recommendations\n* Use separate ## headers for each major solution or recommendation.\n\nImplementation Steps:\n* Under each solution, list key steps using bullet points.\n\nExpected Outcomes & Benefits:\n* Describe the potential impact and advantages of each solution.\n\nResources & Tools\n* List any relevant tools, frameworks, or resources mentioned.\n\n### üí° Concept Extractor with Supporting Quotes (Deep Content Analysis)\n\nExtract the core concepts presented using nested bullets. Include supporting quotes for each concept. Focus on [Specific Topic/Area, e.g., \"the impact of AI on marketing,\" \"the principles of effective communication,\" etc.].\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n\n### üë• Audience-Targeted Video Analysis (Professional Development)\n\nAnalyze this video for a target audience of [Specify Target Audience, e.g., \"software engineers,\" \"marketing professionals,\" \"general readers\"].\n\nFormat the summary using markdown and structure it as follows:\n\nMain Topics\nOrganize key points under Level 2 headers (##), focusing on essential insights.\nSuggested sections (adjust as needed):\nOverview (context & background)\nKey Concepts & Features\nHow It Works (technical or practical explanation)\nBenefits & Challenges\nKey Instructions:\n\nTailor content to the [Target Audience] and their expected level of expertise.\nUse bullet points for clarity and conciseness.\nBold key terms to emphasize important ideas.\nEnsure technical accuracy, simplifying complex ideas only when needed.\nUse tables when making comparisons.\nLength Guidance:\n\nSummarize in approximately [Specify Desired Length, e.g., \"200 words,\" \"500 words,\" \"one page\"].\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n### üß† Knowledge Extension Analyzer (Advanced Learning & Analysis)\n\nAssuming I already understand [briefly state relevant background knowledge], provide specific insights that build upon this knowledge. Use nested bullets and relevant quotes.\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n### üîç Argument Analysis Blueprint (Critical Thinking)\n\nAnalyze the argument presented in this video. Outline the main claims and supporting evidence using nested bullets. Include direct quotes to illustrate key points. Identify any potential counterarguments or weaknesses in the reasoning.\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n### ‚öñÔ∏è YouTube Argument Analyzer (Debate & Rhetoric)\n\nAnalyze the argument presented in this YouTube video. Outline the main claims and supporting evidence using nested bullets. Include direct quotes to illustrate key points. Identify any potential counterarguments or weaknesses in the reasoning.\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n### üé≠ Rhetorical Technique Evaluator (Communication Analysis)\n\nAnalyze the speaker's [e.g., presentation style, persuasive techniques, use of rhetoric]. Use nested bullets and include specific quotes to illustrate your observations. Focus on how these techniques contribute to (or detract from) the video's overall message.\n\nStart output directly with the response -- do not include any introductory text or explanations.\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "d15f5fa4-731d-4d63-a065-e81a5248e8d8",
        "name": "Code: Merge data from prior nodes with HTTP Output",
        "type": "n8n-nodes-base.code",
        "position": [
          2340,
          120
        ],
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "return {\n  json: {\n    ...$json, // Keep data from http request\n    ...$('Set: Merged Values').item.json, // Keep data from before http request\n  }\n};\n\n\n\n"
        },
        "typeVersion": 2
      },
      {
        "id": "eb3b45bc-c59e-45f7-a352-97f62ae079f2",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1080,
          -80
        ],
        "parameters": {
          "width": 560,
          "height": 520,
          "content": "## ‚úèÔ∏è Set Values For Use in Flow\n1. automationID: Use this to reference the automation. Useful for troubleshooting when you have lots of flows running.\n2. apiKey: API key from Google\n3. youtubeURL: Public URL for video to be processed\n4. promptType: Used by switch node and determines which prompt is sent as part of API call."
        },
        "typeVersion": 1
      },
      {
        "id": "440539da-e658-404f-8f85-9e28e9acffc9",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -460,
          -80
        ],
        "parameters": {
          "width": 560,
          "height": 520,
          "content": "## ‚ÑπÔ∏è Determine which prompt will be passed in API call based on promptType value\n"
        },
        "typeVersion": 1
      },
      {
        "id": "ba3f3e35-d691-449e-9f62-d2246223ff5e",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          280,
          -580
        ],
        "parameters": {
          "width": 560,
          "height": 1520,
          "content": "## ‚úèÔ∏è Set Values For Prompts & Model\n1. prompt: What do you want to know about a video\n2. model: Which model to use (gemini-1.5-flash)"
        },
        "typeVersion": 1
      },
      {
        "id": "b33de065-16d5-4b29-8117-91cfd9d9034a",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1300,
          -60
        ],
        "parameters": {
          "width": 260,
          "height": 520,
          "content": "## ‚ÑπÔ∏è Making it easier to reference values in the http node\n"
        },
        "typeVersion": 1
      },
      {
        "id": "eb6788d8-4b99-42e5-b0c1-0430a8d786e6",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2420,
          580
        ],
        "parameters": {
          "width": 560,
          "height": 520,
          "content": "## ‚ÑπÔ∏è If you want to add special processing when errors occur (Optional)\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "432ef0bf-8c85-4f72-a771-42b3b2173094",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1680,
          -60
        ],
        "parameters": {
          "width": 260,
          "height": 520,
          "content": "## ‚ÑπÔ∏è Makes call to Google endpoint using values set in earlier nodes\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "57f29827-7f1f-4b73-b700-51af8bd1e582",
        "name": "Sticky Note13",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2240,
          -60
        ],
        "parameters": {
          "width": 300,
          "height": 520,
          "content": "## ‚ÑπÔ∏è Merges data from returned by Google with values set in prior nodes so that earlier data isn't lost"
        },
        "typeVersion": 1
      },
      {
        "id": "c42daf8b-2d9e-4258-91be-97b830c4eff4",
        "name": "Sticky Note14",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2700,
          -60
        ],
        "parameters": {
          "width": 300,
          "height": 520,
          "content": "## ‚ÑπÔ∏è Gives returned data meaningful names; Simplifies amount of data available to follow-on nodes"
        },
        "typeVersion": 1
      },
      {
        "id": "fb246216-645d-4c01-adc7-9b2be2920bcd",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1460,
          280
        ],
        "parameters": {
          "width": 360,
          "content": "#### üí° Trigger Ideas\nYou can change the trigger to meet your use case. If you need to run it once in awhile, can leave in current format. Try one of n8n's YouTube nodes, a form, a webhook, etc. for running more frequently as part of an automation."
        },
        "typeVersion": 1
      },
      {
        "id": "ba228de2-c2de-475c-95c3-20ef712edcc9",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          3120,
          100
        ],
        "parameters": {
          "width": 360,
          "height": 240,
          "content": "#### üí° Next Step Ideas\nUse a webhook to send data to another destination or use one of n8n's other nodes to send to Airtable, Notion, etc."
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "5d83e29e-caf0-4c3a-be04-9da966904a5a",
    "connections": {
      "Set: Fallback": {
        "main": [
          [
            {
              "node": "Set: Merged Values",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set: Scene Clips": {
        "main": [
          [
            {
              "node": "Set: Merged Values",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set: Scene Prompt": {
        "main": [
          [
            {
              "node": "Set: Merged Values",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set: Merged Values": {
        "main": [
          [
            {
              "node": "HTTP Request to Google",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set: Summarize Prompt": {
        "main": [
          [
            {
              "node": "Set: Merged Values",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request to Google": {
        "main": [
          [
            {
              "node": "Code: Merge data from prior nodes with HTTP Output",
              "type": "main",
              "index": 0
            },
            {
              "node": "If: Was an error detected?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set: Transcript Prompt": {
        "main": [
          [
            {
              "node": "Set: Merged Values",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set: Define Initial Variables": {
        "main": [
          [
            {
              "node": "Switch: What kind of question do we want to ask?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòTest workflow‚Äô": {
        "main": [
          [
            {
              "node": "Set: Define Initial Variables",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set: Transcript with Timestamps Prompt": {
        "main": [
          [
            {
              "node": "Set: Merged Values",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch: What kind of question do we want to ask?": {
        "main": [
          [
            {
              "node": "Set: Transcript Prompt",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set: Transcript with Timestamps Prompt",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set: Summarize Prompt",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set: Scene Prompt",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set: Scene Clips",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set: Fallback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code: Merge data from prior nodes with HTTP Output": {
        "main": [
          [
            {
              "node": "Set Fields: Define Outcome",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "cb484ba7b742928a2048bf8829668bed5b5ad9787579adea888f05980292a4a7"
    },
    "nodes": [
      {
        "id": "ea9ddb4c-af49-480c-8b73-221b3741069d",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          920,
          400
        ],
        "parameters": {
          "width": 389,
          "height": 265,
          "content": "## Scheduled posting \nWrite a tweet every 6 hours and randomize the minutes that it's posted at to make it seem natural.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "9650b047-7d5e-4ed2-948c-d5be77a94b5d",
        "name": "Post tweet",
        "type": "n8n-nodes-base.twitter",
        "position": [
          2940,
          520
        ],
        "parameters": {
          "text": "={{ $json.message.content.tweet }}",
          "additionalFields": {}
        },
        "credentials": {
          "twitterOAuth2Api": {
            "id": "b3qa9dBp2PxbufK3",
            "name": "X account"
          }
        },
        "typeVersion": 2
      },
      {
        "id": "fd7fc941-37de-4f88-87c0-f62ad1ebe2d6",
        "name": "Schedule posting every 6 hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          1140,
          500
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 6,
                "triggerAtMinute": "={{ Math.floor(Math.random() * 60) }}"
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "107fd741-5c17-4cd6-98aa-088bf8df523d",
        "name": "Trigger posting manually",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          1140,
          820
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "831cd431-56e5-482e-a8a5-e5c5ac078ba4",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1360,
          400
        ],
        "parameters": {
          "width": 389,
          "height": 265,
          "content": "## Configure influencer profile \nSet your target niche, writing style, and inspiration.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "791c0be9-6396-4768-ab6b-3ca7fe49fbea",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1800,
          400
        ],
        "parameters": {
          "width": 389,
          "height": 265,
          "content": "## Generate tweet\nGenerate a potentially viral tweet based on your configuration."
        },
        "typeVersion": 1
      },
      {
        "id": "3b2872cf-38f9-4cfd-befd-ad792219c313",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2240,
          400
        ],
        "parameters": {
          "width": 389,
          "height": 265,
          "content": "## Validate tweet\nIf the generated tweet does not meet length constraints, regenerate it."
        },
        "typeVersion": 1
      },
      {
        "id": "364310a1-0367-4ce2-a91b-9a9c4d9387a0",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2680,
          400
        ],
        "parameters": {
          "width": 389,
          "height": 265,
          "content": "## Post the tweet\nPost the tweet to your X account."
        },
        "typeVersion": 1
      },
      {
        "id": "c666ba9f-d28d-449b-8e20-65c0150cba5b",
        "name": "Verify tweet constraints",
        "type": "n8n-nodes-base.if",
        "position": [
          2480,
          500
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "0a6ebbb6-4b14-4c7e-9390-215e32921663",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                },
                "leftValue": "={{ $json.message.content.tweet.length }}",
                "rightValue": 280
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "9bf25238-98ba-4201-aecc-22be27f095c8",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          920,
          720
        ],
        "parameters": {
          "width": 389,
          "height": 265,
          "content": "## On-demand posting \nWrite a tweet on demand, when you manually run your workflow.\n"
        },
        "typeVersion": 1
      },
      {
        "id": "4b95c041-a70e-42f9-9467-26de2abe6b7a",
        "name": "Generate tweet content",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1900,
          500
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4-turbo-preview",
            "cachedResultName": "GPT-4-TURBO-PREVIEW"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "=You are a successful modern Twitter influencer. Your tweets always go viral. "
              },
              {
                "role": "system",
                "content": "=You have a specific writing style: {{ $json.style }}"
              },
              {
                "role": "system",
                "content": "=You follow the principles described in your inspiration sources closely and you write your tweets based on that: {{ $json.inspiration }}"
              },
              {
                "role": "system",
                "content": "=You have a very specific niche: {{ $json.niche }}"
              },
              {
                "role": "system",
                "content": "=Answer with the viral tweet and nothing else as a response. Keep the tweet within 280 characters. Current date and time are {{DateTime.now()}}. Add hashtags and emojis where relevant."
              },
              {
                "content": "Write a tweet that is certain to go viral. Take your time in writing it. Think. Use the vast knowledge you have."
              }
            ]
          },
          "jsonOutput": true
        },
        "credentials": {
          "openAiApi": {
            "id": "294",
            "name": "Alex's OpenAI Account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "18f1af3a-58b3-4a4d-a8ad-3657da9c41ba",
        "name": "Configure your influencer profile",
        "type": "n8n-nodes-base.set",
        "position": [
          1580,
          500
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "45268b04-68a1-420f-9ad2-950844d16af1",
                "name": "niche",
                "type": "string",
                "value": "Modern Stoicism. You tweet about the greatest stoics, their ideas, their quotes, and how their wisdom applies in today's modern life. You love sharing personal stories and experiences."
              },
              {
                "id": "d95f4a1c-ab1c-4eca-8732-3d7a087f82d8",
                "name": "style",
                "type": "string",
                "value": "All of your tweets are very personal. "
              },
              {
                "id": "1ee088f7-7021-48c0-bcb7-d1011eb0db3d",
                "name": "inspiration",
                "type": "string",
                "value": "Your inspiration comes from tens of books on stoicism, psychology, and how to influence people. Books such as \"Contagious\" by Jonah Bergen, \"How To Be Internet Famous\" by Brendan Cox, \"How to Win Friends and Influence People\" by Dale Carnegie, and \"Influencers and Creators\" by  Robert V Kozinets, Ulrike Gretzel, Rossella Gambetti strongly influence the way you write your tweets. "
              }
            ]
          }
        },
        "typeVersion": 3.3
      }
    ],
    "pinData": {},
    "connections": {
      "Generate tweet content": {
        "main": [
          [
            {
              "node": "Verify tweet constraints",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Trigger posting manually": {
        "main": [
          [
            {
              "node": "Configure your influencer profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verify tweet constraints": {
        "main": [
          [
            {
              "node": "Configure your influencer profile",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Post tweet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule posting every 6 hours": {
        "main": [
          [
            {
              "node": "Configure your influencer profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Configure your influencer profile": {
        "main": [
          [
            {
              "node": "Generate tweet content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "qVwL4UVRZaWLVZtQ",
    "meta": {
      "instanceId": "8a5440a5ddd0e75b8a9a2e3575b14d94d566aa1e1140eba5b0cc9b9eb91aaea3",
      "templateCredsSetupCompleted": true
    },
    "name": "ESPOLBot CALENDARIO|FAQS",
    "tags": [],
    "nodes": [
      {
        "id": "6d06b9e5-4027-4626-8315-2b02a3087727",
        "name": "Construir_Prompt_Gemini1",
        "type": "n8n-nodes-base.code",
        "position": [
          -1008,
          2448
        ],
        "parameters": {
          "jsCode": "const preguntaUsuario = $json.pregunta_usuario;\nconst faqsRelevantes = $json.contexto_faqs || [];\n\nlet contextoFAQs = '';\nif (faqsRelevantes.length > 0) {\n  contextoFAQs = 'Aqui hay informacion relevante de la base de datos:\\n\\n';\n  contextoFAQs += faqsRelevantes.map((faq, index) => {\n    return `${index + 1}. P: ${faq.pregunta}\\n   R: ${faq.respuesta}${faq.enlaces ? `\\n   Link: ${faq.enlaces}` : ''}`;\n  }).join('\\n\\n');\n} else {\n  contextoFAQs = 'No encontre informacion especifica en la base de datos para esta pregunta.';\n}\n\nconst prompt = `Eres un asistente de ESPOL. Un estudiante te pregunto:\n\n\"${preguntaUsuario}\"\n\n${contextoFAQs}\n\nIMPORTANTE:\n- La pregunta del usuario ES VALIDA y CLARA\n- Si hay informacion arriba, usala para responder\n- Si NO hay informacion especifica, di algo como: \"No tengo informacion especifica sobre [tema], pero puedes contactar a ESPOL\"\n- NUNCA digas \"no has hecho ninguna pregunta\"\n\nContactos generales:\n- Email: admision@espol.edu.ec\n- Telefono: (04) 2269-269\n- Web: https://www.espol.edu.ec\n\nResponde de forma COMPLETA, clara y util. Incluye TODOS los detalles necesarios:`;\n\nreturn [{\n  json: {\n    prompt: prompt\n  }\n}];"
        },
        "typeVersion": 2
      },
      {
        "id": "95fcc718-5c12-423d-b062-b9935d3f8506",
        "name": "Buscar_FAQs_Relevantes",
        "type": "n8n-nodes-base.code",
        "position": [
          -1264,
          2448
        ],
        "parameters": {
          "jsCode": "function limpiarTexto(texto) {\n  if (!texto) return '';\n  return texto\n    .toLowerCase()\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n    .replace(/[¬ø?¬°!.,;:]/g, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\n// Leer la pregunta del Telegram Trigger\n// En runOnceForAllItems, usar .all() para acceder al primer (y normalmente √∫nico) mensaje\nconst telegramInput = $('Telegram Trigger - Inicio').all()[0]?.json || {};\nconst preguntaUsuario = telegramInput.message?.text || '';\nconst chatId = telegramInput.message?.chat?.id || '';\n\n// Las FAQs vienen del input (MongoDB)\nconst todasLasFAQs = $input.all();\n\nconst preguntaLimpia = limpiarTexto(preguntaUsuario);\nconst palabrasUsuario = preguntaLimpia.split(' ').filter(p => p.length > 2);\n\nconst faqsRelevantes = [];\n\nconsole.log(`========================================`);\nconsole.log(`Pregunta usuario: \"${preguntaUsuario}\"`);\nconsole.log(`Chat ID: ${chatId}`);\nconsole.log(`Palabras clave: ${palabrasUsuario.join(', ')}`);\nconsole.log(`Total FAQs en MongoDB: ${todasLasFAQs.length}`);\n\nfor (const faq of todasLasFAQs) {\n  const preguntaFAQ = faq.json.PREGUNTA || faq.json.pregunta || '';\n  if (!preguntaFAQ) continue;\n  \n  const preguntaFAQLimpia = limpiarTexto(preguntaFAQ);\n  \n  let coincidencias = 0;\n  for (const palabra of palabrasUsuario) {\n    if (preguntaFAQLimpia.includes(palabra)) {\n      coincidencias++;\n    }\n  }\n  \n  if (coincidencias >= 2) {\n    const score = coincidencias / palabrasUsuario.length;\n    \n    faqsRelevantes.push({\n      pregunta: preguntaFAQ,\n      respuesta: faq.json.RESPUESTA || faq.json.respuesta || '',\n      enlaces: faq.json.ENLACES || faq.json.enlaces || null,\n      similitud: Math.round(score * 100) / 100,\n      coincidencias: coincidencias\n    });\n  }\n}\n\nfaqsRelevantes.sort((a, b) => b.coincidencias - a.coincidencias);\nconst top10 = faqsRelevantes.slice(0, 10);\n\nconsole.log(`FAQs encontradas: ${top10.length}`);\nif (top10.length > 0) {\n  console.log(`Top 5 candidatas:`);\n  top10.slice(0, 5).forEach((faq, i) => {\n    console.log(`  ${i+1}. \"${faq.pregunta.substring(0, 70)}...\" (${faq.coincidencias} palabras)`);\n  });\n} else {\n  console.log(`‚ö†Ô∏è NO SE ENCONTRARON FAQs`);\n}\nconsole.log(`========================================`);\n\nreturn [{\n  json: {\n    pregunta_usuario: preguntaUsuario,\n    contexto_faqs: top10,\n    total_encontradas: top10.length,\n    chat_id: chatId\n  }\n}];"
        },
        "typeVersion": 2
      },
      {
        "id": "d5e736d4-9d75-44d5-b1c8-dfe94b289e68",
        "name": "Respuesta Usuario1",
        "type": "n8n-nodes-base.switch",
        "position": [
          -1616,
          1184
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "3874c471-84a4-4058-8a35-0cc833b8617d",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.callback_query.data }}",
                      "rightValue": "feedback_yes"
                    }
                  ]
                }
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "a53cc39a-2efc-4196-9425-1afba6fc8d7d",
                      "operator": {
                        "name": "filter.operator.equals",
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $json.callback_query.data }}",
                      "rightValue": "feedback_no"
                    }
                  ]
                }
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.3
      },
      {
        "id": "d9139b9c-e970-4c60-88b8-47bd105ab0aa",
        "name": "S√≠ - Agradecimiento1",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -1264,
          1008
        ],
        "webhookId": "d64de90b-2449-4bcc-8815-f43c2e94c0b5",
        "parameters": {
          "text": "üéâ ¬°Genial! Me alegra mucho saber que pude ayudarte üí™ Si necesitas algo m√°s, estoy aqu√≠ para ti ü§ñ",
          "chatId": "={{ $json.result.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "9c41f1ef-12bf-4620-9719-821461334db6",
        "name": "No - Mensaje Feedback1",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -1264,
          1152
        ],
        "webhookId": "606e94b8-5fcd-4977-852e-d0030aacf8a6",
        "parameters": {
          "text": "=üòî Lamento que la informaci√≥n no te haya sido √∫til.\n¬øPodr√≠as contarme qu√© necesitabas exactamente para mejorar mi ayuda? ü§ñ",
          "chatId": "={{ $json.callback_query.message.chat.id }}",
          "forceReply": {
            "force_reply": true
          },
          "replyMarkup": "forceReply",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "cc0258e3-303c-44e5-8c96-80287ba1ab88",
        "name": "Comandos1",
        "type": "n8n-nodes-base.switch",
        "position": [
          -1248,
          1664
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "/help",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "62d19c71-6b1b-4d67-9a45-8aff710df07c",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json[\"message\"] && $json[\"message\"][\"text\"] === \"/help\" }}",
                      "rightValue": "/start"
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "/faqs",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "4a392957-3709-4c6e-a7ac-6f6004836860",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json[\"message\"] && $json[\"message\"][\"text\"] === \"/faqs\" }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "/contact",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "32b9b535-3e0a-4d3f-8691-fdc1e955a9ce",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json[\"message\"] && $json[\"message\"][\"text\"] === \"/contact\" }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "/events",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "9393b68b-7c44-48cf-b2d0-d23289673ff6",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json[\"message\"] && $json[\"message\"][\"text\"] === \"/events\" }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "/feedback",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "df2037b1-36f0-4428-bdd4-b5118f687d8f",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json[\"message\"] && $json[\"message\"][\"text\"] === \"/feedback\" }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "/start",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "58d0352b-c98a-4ac7-bf60-f6a6e6919744",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json[\"message\"] && $json[\"message\"][\"text\"] === \"/start\" }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {},
          "looseTypeValidation": true
        },
        "typeVersion": 3.3
      },
      {
        "id": "79a97506-c1e2-4049-a62a-e5820b681a0d",
        "name": "Inicio - Feedback",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -880,
          1312
        ],
        "webhookId": "c87b9628-09ed-468b-ab95-9b97e4c4f0ef",
        "parameters": {
          "text": "=üí¨ *Enviar Feedback*\n\n¬øTienes alguna sugerencia o comentario sobre el bot? \n\nüìù Escribe tu mensaje a continuaci√≥n y lo revisaremos.\n\nü§ñ *¬°Tu opini√≥n es importante!* \n\nüí° *Tip:* Los botones üëç üëé aparecen despu√©s de cada respuesta para que califiques la informaci√≥n.",
          "chatId": "={{ $json.message.chat.id }}",
          "replyMarkup": "inlineKeyboard",
          "inlineKeyboard": {
            "rows": [
              {
                "row": {
                  "buttons": [
                    {
                      "text": "üëç S√≠, me ayud√≥",
                      "additionalFields": {
                        "callback_data": "feedback_yes"
                      }
                    },
                    {
                      "text": "üëé No, no me ayud√≥",
                      "additionalFields": {
                        "callback_data": "feedback_no"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {
            "parse_mode": "Markdown",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "accfeb10-fcb6-4b1e-a1bb-a40ed82ebcdd",
        "name": "FAQs",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -880,
          784
        ],
        "webhookId": "04237280-d7f2-4b1e-96cf-37343b850b8b",
        "parameters": {
          "text": "üí¨ Secci√≥n de Consultas ‚Äì ChatBot ESPOL\n\nEst√°s en la secci√≥n de preguntas frecuentes.\nAqu√≠ puedes escribir cualquier duda o consulta sobre la universidad ‚Äîpor ejemplo, temas de matr√≠cula, eventos, horarios o servicios estudiantiles‚Äî y te responder√© enseguida.\n\n‚úçÔ∏è Escribe tu pregunta para continuar.\nPor ejemplo: ‚ÄúNecesito informaci√≥n sobre los eventos de esta semana‚Äù o ‚Äú¬øD√≥nde puedo comunicarme con admisiones?‚Äù",
          "chatId": "={{ $('Telegram Trigger - Inicio').item.json.message.chat.id }}",
          "additionalFields": {
            "parse_mode": "Markdown",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "ccd1f1ed-5aa2-402c-a40e-5650ee6066d7",
        "name": "Leer FAQs de MongoDB",
        "type": "n8n-nodes-base.mongoDb",
        "position": [
          -1520,
          2448
        ],
        "parameters": {
          "options": {},
          "collection": "espol_faqs"
        },
        "credentials": {
          "mongoDb": {
            "id": "gYgPeYFM9Twdvd1B",
            "name": "MongoDB account 2"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "6529ea5d-0af3-4acc-b81b-087730a484b6",
        "name": "Telegram Trigger - Inicio",
        "type": "n8n-nodes-base.telegramTrigger",
        "position": [
          -1872,
          1744
        ],
        "webhookId": "472c70d1-8362-4668-83dc-3e7c2985bc08",
        "parameters": {
          "updates": [
            "message",
            "callback_query",
            "*"
          ],
          "additionalFields": {}
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "5bfddfd3-92ac-432f-aa64-3f19ab58f30a",
        "name": "Respuesta Contact",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -880,
          960
        ],
        "webhookId": "57a49a16-8222-4da4-8df5-06b6325c4083",
        "parameters": {
          "text": "=üìû *Informaci√≥n de Contacto ESPOL*\n\nüåê Web: https://www.espol.edu.ec\nüìß Email: admision@espol.edu.ec\nüì± Tel√©fono: (04) 2269-269\n\nüìç Campus Gustavo Galindo Velasco\nKm. 30.5 V√≠a Perimetral\nGuayaquil, Ecuador\n\nüìß Otros contactos:\nComunicaci√≥n: comunicacion@espol.edu.ec\nRelaciones Externas y Vinculaci√≥n Corporativa:  relex@espol.edu.ec\nPostgrados: postgrad@espol.edu.ec\nTransparencia: transparencia@espol.edu.ec",
          "chatId": "={{ $('Telegram Trigger - Inicio').item.json.message.chat.id }}",
          "additionalFields": {
            "parse_mode": "Markdown",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "8aa3525d-815a-486a-92cb-9d9e5da991e5",
        "name": "Respuesta Events",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -880,
          1136
        ],
        "webhookId": "8688a44d-b766-45c4-b314-3ef4dc105e1d",
        "parameters": {
          "text": "=üìÖ *Pr√≥ximos Eventos Acad√©micos*\n\nPara ver el calendario completo de eventos, visita:\nhttps://www.espol.edu.ec/es/calendario-academico\n\nO preg√∫ntame sobre fechas espec√≠ficas, por ejemplo:\n\"¬øCu√°ndo son las vacaciones?\"\n\"¬øCu√°ndo es el examen de admisi√≥n?\"",
          "chatId": "={{ $json.message.chat.id }}",
          "additionalFields": {
            "parse_mode": "Markdown",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "767c3c89-dfb0-4505-8c87-a0208fe31aba",
        "name": "Limpiar texto Gemini",
        "type": "n8n-nodes-base.code",
        "position": [
          -480,
          2448
        ],
        "parameters": {
          "jsCode": "const geminiResponse = $input.first().json;\nconst chatId = $('Buscar_FAQs_Relevantes').first().json.chat_id;\n\nlet texto = '';\n\ntry {\n  if (geminiResponse.candidates && geminiResponse.candidates[0] && geminiResponse.candidates[0].content && geminiResponse.candidates[0].content.parts) {\n    texto = geminiResponse.candidates[0].content.parts[0].text;\n  } else if (geminiResponse.content && geminiResponse.content.parts) {\n    texto = geminiResponse.content.parts[0].text;\n  } else if (geminiResponse.text) {\n    texto = geminiResponse.text;\n  } else {\n    texto = \"Lo siento, hubo un problema al procesar la respuesta.\";\n  }\n} catch (error) {\n  texto = \"Lo siento, ocurrio un error.\";\n}\n\nif (texto && texto.length > 0) {\n  texto = texto.replace(/\\*\\*/g, '').replace(/`/g, '').trim();\n}\n\nreturn [{\n  json: {\n    texto_limpio: texto,\n    chat_id: chatId\n  }\n}];"
        },
        "typeVersion": 2
      },
      {
        "id": "7cabbbc4-e002-4c04-a4d9-b5c3633e98af",
        "name": "Get a chat",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -1488,
          1056
        ],
        "webhookId": "4540ece6-38eb-40ac-bb7c-862f2e198807",
        "parameters": {
          "chatId": "={{ $json.callback_query.message.chat.id }}",
          "resource": "chat"
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "b5cdf1bf-6f19-4e62-a812-022e5fe6073c",
        "name": "Switch_Que_BD_Leer",
        "type": "n8n-nodes-base.switch",
        "position": [
          -1856,
          2304
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "=Consultar Calendario",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "9404fad9-6063-443e-9a4c-80c86a20a6a9",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.es_consulta_calendario }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "typeVersion": 3.3
      },
      {
        "id": "09ddecdf-9223-4371-bd53-9d836315b7a3",
        "name": "Detector_Calendario_Pre",
        "type": "n8n-nodes-base.code",
        "position": [
          -2064,
          2304
        ],
        "parameters": {
          "jsCode": "// ===== DETECTOR PRE-LECTURA DE CALENDARIO =====\n\nfunction limpiarTexto(texto) {\n  if (!texto) return '';\n  return texto\n    .toLowerCase()\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n    .replace(/[¬ø?¬°!.,;:]/g, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\n// Procesar todos los items entrantes del Trigger\nconst inputItems = $('Telegram Trigger - Inicio').all();\nconst resultados = [];\n\nfor (const item of inputItems) {\n  const preguntaUsuario = item.json.message?.text || '';\n  const chatId = item.json.message?.chat?.id || '';\n  const preguntaLimpia = limpiarTexto(preguntaUsuario);\n\n  // ===== PALABRAS CLAVE DE CALENDARIO =====\n  const palabrasClaveCalendario = {\n    eventos: [\n      'matricula', 'matriculas', 'matriculacion',\n      'inicio de clases', 'fin de clases', 'clases',\n      'primer termino', 'segundo termino', 'tercer termino',\n      'examenes', 'examen', 'prueba', 'pruebas',\n      'evaluaciones', 'evaluacion',\n      'suspension', 'feriado', 'feriados',\n      'vacaciones', 'receso',\n      'cambio de carrera', 'cambio de materia',\n      'retiro', 'retiros',\n      'solicitudes', 'solicitud',\n      'inscripciones', 'inscripcion',\n      'graduacion', 'grado',\n      'titulacion',\n      'becas', 'beca',\n      'nivelacion'\n    ],\n    \n    tiempo: [\n      'cuando', 'fecha', 'fechas', 'dia', 'dias',\n      'plazo', 'plazos', 'periodo', 'periodos',\n      'termino', 'terminos', 'semestre', 'a√±o',\n      'inicio', 'fin', 'cierre', 'apertura',\n      'hasta cuando', 'desde cuando',\n      'calendario', 'cronograma',\n      'horario', 'horarios',\n      'proxima', 'proximo', 'siguiente'\n    ],\n    \n    terminos: [\n      '2024-2025', '2025-2026',\n      'PAO', 'PAOI', 'PAOII', 'IPAO', 'IIPAO', 'PAO1', 'PAO2',\n      'primer', 'segundo', 'tercer',\n      'trimestre', 'bimestre', 'semestral'\n    ]\n  };\n\n  // Combinar todas las palabras clave\n  const todasLasPalabrasClave = [\n    ...palabrasClaveCalendario.eventos,\n    ...palabrasClaveCalendario.tiempo,\n    ...palabrasClaveCalendario.terminos\n  ];\n\n  // ===== DETECCI√ìN =====\n  let palabrasEncontradas = [];\n  let puntuacion = 0;\n\n  for (const palabra of todasLasPalabrasClave) {\n    if (preguntaLimpia.includes(palabra)) {\n      palabrasEncontradas.push(palabra);\n      if (palabrasClaveCalendario.eventos.includes(palabra)) {\n        puntuacion += 2;\n      } else {\n        puntuacion += 1;\n      }\n    }\n  }\n\n  // Decisi√≥n: ¬øEs consulta de calendario?\n  const esConsultaCalendario = puntuacion >= 2 || palabrasEncontradas.length >= 2;\n\n  // LOGS\n  console.log(`========================================`);\n  console.log(`üîç DETECTOR PRE-LECTURA DE CALENDARIO`);\n  console.log(`Pregunta: \"${preguntaUsuario}\"`);\n  console.log(`Palabras encontradas: ${palabrasEncontradas.join(', ') || 'ninguna'}`);\n  console.log(`Puntuaci√≥n: ${puntuacion}`);\n  console.log(`¬øEs calendario? ${esConsultaCalendario ? '‚úÖ S√ç' : '‚ùå NO'}`);\n  console.log(`${esConsultaCalendario ? '‚Üí Ir√° a BD_Calendario' : '‚Üí Ir√° a FAQs (flujo normal)'}`);\n  console.log(`========================================`);\n\n  resultados.push({\n    json: {\n      pregunta_usuario: preguntaUsuario,\n      chat_id: chatId,\n      es_consulta_calendario: esConsultaCalendario,\n      palabras_encontradas: palabrasEncontradas,\n      puntuacion: puntuacion\n    }\n  });\n}\n\nreturn resultados;"
        },
        "typeVersion": 2
      },
      {
        "id": "81ea9f6c-121c-4bc5-99e4-e947dae8bf7a",
        "name": "Mensaje de Gemini",
        "type": "@n8n/n8n-nodes-langchain.googleGemini",
        "position": [
          -800,
          2448
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "models/gemini-2.5-flash-lite-preview-06-17",
            "cachedResultName": "models/gemini-2.5-flash-lite-preview-06-17"
          },
          "options": {
            "temperature": 0.3,
            "maxOutputTokens": 2000
          },
          "messages": {
            "values": [
              {
                "content": "={{ $json.prompt }}"
              }
            ]
          },
          "simplify": false
        },
        "credentials": {
          "googlePalmApi": {
            "id": "5akz9ZmFGR6TDmkP",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1,
        "alwaysOutputData": false
      },
      {
        "id": "8116c6c4-e4ca-4450-89ab-17df67b4b886",
        "name": "Enviar Respuesta sobre faqs",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -224,
          2448
        ],
        "webhookId": "0096bd46-0086-4c23-87a8-a63bfebca2d8",
        "parameters": {
          "text": "={{ $json.texto_limpio }}\n\nüí¨ ¬øDeseas revisar otra consulta o hacer una nueva pregunta?",
          "chatId": "={{ $json.chat_id }}",
          "replyMarkup": "inlineKeyboard",
          "inlineKeyboard": {
            "rows": [
              {
                "row": {
                  "buttons": [
                    {
                      "text": "üëç S√≠",
                      "additionalFields": {
                        "callback_data": "=feedback_yes"
                      }
                    },
                    {
                      "text": "üëé No",
                      "additionalFields": {
                        "callback_data": "=feedback_no"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {
            "parse_mode": "HTML",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "5f4eed47-a777-4d27-a80a-bcc145808f42",
        "name": "Guardado en cvs Feedback",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -1264,
          1296
        ],
        "parameters": {
          "columns": {
            "value": {
              "id": "={{ $json.message.chat.id }}",
              "Nombre": "={{ $json.message.reply_to_message.chat.first_name }}",
              "Comentario": "={{ $json.message.text }}"
            },
            "schema": [
              {
                "id": "id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "id",
                "defaultMatch": true,
                "canBeUsedToMatch": true
              },
              {
                "id": "Nombre",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Nombre",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Comentario",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Comentario",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "id"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1dcEsIPMMnjBtQ1YXy5Zc50OWwBVOcWXpxkJUJWZmE4E/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1dcEsIPMMnjBtQ1YXy5Zc50OWwBVOcWXpxkJUJWZmE4E",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1dcEsIPMMnjBtQ1YXy5Zc50OWwBVOcWXpxkJUJWZmE4E/edit?usp=drivesdk",
            "cachedResultName": "Feedback"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "uBrRRX1SVbzPprTl",
            "name": "Google Sheets account 6"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "cdf6ad08-7f31-467e-9feb-9d3a8e1c9ba6",
        "name": "Construir_Prompt_Calendario1",
        "type": "n8n-nodes-base.code",
        "position": [
          -1008,
          2160
        ],
        "parameters": {
          "jsCode": "const preguntaUsuario = $json.consulta || $json.pregunta_usuario || $json.pregunta || '';\nconst chatId = $json.chat_id;\n\n// Preferir el nuevo esquema del buscador\nlet eventos = Array.isArray($json.resultados) ? $json.resultados : [];\n\n// Compatibilidad con el arreglo antiguo { eventos_calendario: [...] }\nif ((!eventos || eventos.length === 0) && Array.isArray($json.eventos_calendario)) {\n  eventos = $json.eventos_calendario.map((e) => ({\n    PERIODO_FECHAS: e.periodo || e.PERIODO_FECHAS || '',\n    ACTIVIDADES_GRADO: e.actividades_grado || e.ACTIVIDADES_GRADO || '',\n    PROCESOS_GRADO: e.procesos_grado || e.PROCESOS_GRADO || '',\n    ACTIVIDADES_FORMACION: e.actividades_formacion || e.ACTIVIDADES_FORMACION || '',\n    fecha_inicio_ts: e.fecha_inicio_ts ?? null,\n    score: e.score ?? null,\n  }));\n}\n\n// Se√±al de ‚Äúdemasiadas coincidencias‚Äù y facetas sugeridas (si vienen del buscador)\nconst demasiadas = Boolean($json.demasiadas_coincidencias);\nconst filtros = $json.filtros_sugeridos || null;\n\n// === Funciones auxiliares ===\nfunction safe(v) { return (v == null ? '' : String(v)); }\n\nfunction fmtFecha(ts) {\n  if (ts == null) return '';\n  try {\n    const d = new Date(Number(ts));\n    if (isNaN(d.getTime())) return '';\n    const dd = String(d.getDate()).padStart(2, '0');\n    const mm = String(d.getMonth() + 1).padStart(2, '0');\n    const yyyy = d.getFullYear();\n    return `${yyyy}-${mm}-${dd}`;\n  } catch { return ''; }\n}\n\n// === Determinar PAO actual seg√∫n la fecha del sistema ===\nconst ahora = new Date();\nconst mesActual = ahora.getMonth() + 1;\nconst anioActual = ahora.getFullYear();\n\nlet paoActual = '';\nif (mesActual >= 5 && mesActual <= 9) paoActual = 'PAO I';\nelse if (mesActual >= 9 || mesActual <= 2) paoActual = 'PAO II';\nelse paoActual = 'Vacaciones o PAE';\n\nconst contextoTiempo = `üìÜ Fecha actual: ${anioActual}-${String(mesActual).padStart(2, '0')} (${paoActual} en curso)`;\n\n// === Ordenar eventos por relevancia y fecha ===\nconst eventosOrdenados = [...eventos].sort((a, b) => {\n  const sa = (a.score == null) ? -Infinity : Number(a.score);\n  const sb = (b.score == null) ? -Infinity : Number(b.score);\n  if (sb !== sa) return sb - sa;\n\n  const ta = (a.fecha_inicio_ts == null) ? Number.POSITIVE_INFINITY : Number(a.fecha_inicio_ts);\n  const tb = (b.fecha_inicio_ts == null) ? Number.POSITIVE_INFINITY : Number(b.fecha_inicio_ts);\n  return ta - tb;\n});\n\nlet contextoCalendario = '';\n\nif (eventosOrdenados.length > 0) {\n  contextoCalendario = 'üìÖ He encontrado estas coincidencias (ordenadas por relevancia):\\n\\n';\n\n  // Mostrar solo el top 10\n  const toShow = eventosOrdenados.slice(0, 10);\n\n  contextoCalendario += toShow.map((ev, idx) => {\n    const periodo = safe(ev.PERIODO_FECHAS || ev.periodo);\n    const ag = safe(ev.ACTIVIDADES_GRADO || ev.actividades_grado);\n    const pg = safe(ev.PROCESOS_GRADO || ev.procesos_grado);\n    const af = safe(ev.ACTIVIDADES_FORMACION || ev.actividades_formacion);\n    const fechaISO = fmtFecha(ev.fecha_inicio_ts);\n    const score = (ev.score != null) ? Number(ev.score).toFixed(3) : '';\n\n    let info = `${idx + 1}. üìå ${periodo || '(sin fecha)'}`;\n    if (fechaISO) info += `\\n   üóìÔ∏è Inicio (estimado): ${fechaISO}`;\n    if (ag.trim()) info += `\\n   üéì Actividades de Grado: ${ag}`;\n    if (pg.trim()) info += `\\n   üìã Procesos: ${pg}`;\n    if (af.trim()) info += `\\n   üîß Formaci√≥n T√©cnica: ${af}`;\n    if (score) info += `\\n   üîé score:${score}`;\n    return info;\n  }).join('\\n\\n');\n\n  // Sugerencias si hay demasiadas coincidencias\n  if (demasiadas) {\n    const tips = [];\n    if (filtros?.posibles_anios?.length) tips.push(`‚Ä¢ especifica a√±o: ${filtros.posibles_anios.slice(-3).join(' / ')}`);\n    if (filtros?.posibles_meses?.length) tips.push(`‚Ä¢ a√±ade mes: ${filtros.posibles_meses.slice(0, 4).join(' / ')}`);\n    if (filtros?.posibles_tipos_evaluacion?.length) tips.push(`‚Ä¢ tipo de evaluaci√≥n: ${filtros.posibles_tipos_evaluacion.join(' / ')}`);\n    if (filtros?.posibles_ciclos?.length) tips.push(`‚Ä¢ ciclo: ${filtros.posibles_ciclos.join(' / ')}`);\n\n    if (tips.length) {\n      contextoCalendario += '\\n\\n‚ö†Ô∏è Hay muchas coincidencias. Sugerencias para refinar:\\n' + tips.join('\\n');\n    }\n  }\n\n} else {\n  contextoCalendario = 'No encontr√© informaci√≥n espec√≠fica en el calendario acad√©mico para tu consulta.';\n}\n\n// === Reglas de interpretaci√≥n PAO/PAE ===\nconst reglasPAO = `\nREGLAS DE INTERPRETACI√ìN (PAO/PAE y feriados):\n‚Ä¢ Si un evento dice ‚Äúvacaciones‚Äù y la fecha cae ENTRE finales de febrero y los primeros d√≠as de mayo ‚áí corresponde a VACACIONES del PAO II.\n‚Ä¢ Desde inicios de mayo hasta inicios/mediados de septiembre ‚áí corresponde a PAO I.\n‚Ä¢ Si un evento cae entre finales de septiembre y la 1.¬™ o 2.¬™ semana de febrero ‚áí corresponde a PAO II (per√≠odo lectivo).\n‚Ä¢ En PAO II, si aparecen ‚Äúvacaciones estudiantiles‚Äù del 28 de diciembre al 1 de enero ‚áí son feriado (no vacaciones entre PAOs).\n‚Ä¢ PAE (Programa de Acompa√±amiento/Evaluaci√≥n) ocurre normalmente desde inicios de marzo hasta finales de abril o inicios de mayo.\n‚Ä¢ Si dentro de un PAO aparece ‚Äúvacaciones‚Äù, interpr√©talas como feriados espec√≠ficos, no como cambio de PAO.\n‚Ä¢ Si el evento no indica expl√≠citamente PAO I o II, infi√©relo con estas reglas. Si hay ambig√ºedad o la fecha cae fuera de rango, indica que no hay informaci√≥n espec√≠fica.\n`.trim();\n\n// === Construcci√≥n final del prompt ===\nconst prompt = `Eres un asistente de ESPOL especializado en calendario acad√©mico.\n\n${contextoTiempo}\n\nPregunta del estudiante:\n\"${preguntaUsuario}\"\n\n${contextoCalendario}\n\n${reglasPAO}\n\nINSTRUCCIONES IMPORTANTES (ESTRICTAS):\n1) Si existe la lista anterior, elige SOLO 1 evento que sea la MEJOR COINCIDENCIA para la pregunta.\n   ‚Ä¢ Considera intenci√≥n (evaluaci√≥n/vacaciones/inicio/fin), ordinal (primera/segunda/tercera),\n     y a√±o/mes impl√≠citos o expl√≠citos.\n   ‚Ä¢ Si ning√∫n evento es claramente pertinente, responde que NO hay informaci√≥n espec√≠fica.\n2) No inventes datos. No cites eventos que no est√©n arriba.\n3) Si das un resultado, pres√©ntalo claro y breve con emojis, destacando FECHA y ACTIVIDAD.\n4) Si NO hay informaci√≥n espec√≠fica, sugiere contactar a:\n   üìß Email: admision@espol.edu.ec\n   üìû Tel√©fono: (04) 2269-269\n   üåê Web: https://www.espol.edu.ec\n5) Si identificas el PAO (I o II) por las fechas, ind√≠calo entre par√©ntesis o nota breve (‚Äúseg√∫n fechas corresponde al PAO I/II‚Äù).\n6) Responde de forma clara, organizada y √∫til.`;\n\n// === Salida para el siguiente nodo (Gemini) ===\nreturn [{\n  json: {\n    prompt,\n    chat_id: chatId\n  }\n}];\n"
        },
        "typeVersion": 2
      },
      {
        "id": "728f012c-ceed-400d-a643-8f1353d9f8f1",
        "name": "Message a model1",
        "type": "@n8n/n8n-nodes-langchain.googleGemini",
        "position": [
          -800,
          2160
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "models/gemini-2.5-flash-preview-05-20",
            "cachedResultName": "models/gemini-2.5-flash-preview-05-20"
          },
          "options": {
            "temperature": 0.3,
            "maxOutputTokens": 200000000
          },
          "messages": {
            "values": [
              {
                "content": "={{ $json.prompt }}"
              }
            ]
          },
          "simplify": false
        },
        "credentials": {
          "googlePalmApi": {
            "id": "5akz9ZmFGR6TDmkP",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "4af01328-9345-4714-a79d-ea81b2a16a38",
        "name": "Limpiar_Texto_Gemini1",
        "type": "n8n-nodes-base.code",
        "position": [
          -480,
          2160
        ],
        "parameters": {
          "jsCode": "// ---- 1) Extracci√≥n robusta del texto de Gemini ----\nfunction extraerTextoGemini(payload) {\n  // Formato m√°s com√∫n: candidates[0].content.parts[*].text\n  try {\n    const parts = payload?.candidates?.[0]?.content?.parts;\n    if (Array.isArray(parts) && parts.length > 0) {\n      // Concatenar todos los parts .text\n      const textos = parts\n        .map(p => (typeof p?.text === 'string' ? p.text : ''))\n        .filter(Boolean);\n      if (textos.length) return textos.join('\\n').trim();\n    }\n  } catch {}\n\n  // Alternativos:\n  if (typeof payload?.text === 'string' && payload.text.trim()) {\n    return payload.text.trim();\n  }\n\n  if (Array.isArray(payload?.content?.parts) && payload.content.parts.length > 0) {\n    const textos2 = payload.content.parts\n      .map(p => (typeof p?.text === 'string' ? p.text : ''))\n      .filter(Boolean);\n    if (textos2.length) return textos2.join('\\n').trim();\n  }\n\n  // √öltimo recurso: stringify recortado\n  try {\n    const s = JSON.stringify(payload);\n    if (s && s.length) return s.substring(0, 8000);\n  } catch {}\n\n  return 'Lo siento, no pude procesar tu consulta.';\n}\n\nconst respuestaGemini = extraerTextoGemini($json);\n\n// ---- 2) Recuperar chat_id desde varios nodos/ubicaciones ----\nlet chatId = $json.chat_id;\n\nif (!chatId) {\n  // Tu prompt actual\n  try { chatId = $('Construir_Prompt_Calendario1').first()?.json?.chat_id; } catch {}\n}\nif (!chatId) {\n  // Nombre anterior\n  try { chatId = $('Construir_Prompt_Calendario').first()?.json?.chat_id; } catch {}\n}\nif (!chatId) {\n  try { chatId = $('Buscar_Eventos_Calendario').first()?.json?.chat_id; } catch {}\n}\nif (!chatId) {\n  try { chatId = $('Detector_Calendario_Pre').first()?.json?.chat_id; } catch {}\n}\nif (!chatId) {\n  // Telegram Trigger\n  try { chatId = $('Telegram Trigger - Inicio').first()?.json?.message?.chat?.id; } catch {}\n}\n\n// ---- 3) Limpieza / saneamiento para enviar por Telegram con parse_mode HTML ----\nfunction escapeHTML(s) {\n  // Evita que Telegram interprete etiquetas si usas parse_mode: \"HTML\"\n  return s.replace(/&/g, '&amp;')\n          .replace(/</g, '&lt;')\n          .replace(/>/g, '&gt;');\n}\n\nfunction limpiarRespuesta(texto) {\n  if (!texto) return 'Lo siento, no obtuve una respuesta v√°lida.';\n\n  // Eliminar bloques de c√≥digo ```...``` (incluye variantes con lenguaje)\n  texto = texto.replace(/```[\\s\\S]*?```/g, '');\n\n  // Eliminar comillas invertidas inline `\n  texto = texto.replace(/`+/g, '');\n\n  // Convertir enlaces markdown [texto](url) ‚Üí \"texto (url)\"\n  texto = texto.replace(/\\[([^\\]]+)\\]\\((https?:\\/\\/[^\\s)]+)\\)/g, '$1 ($2)');\n\n  // Quitar markdown simple de estilo: **negritas**, *it√°licas*, __subrayado__ _\n  texto = texto.replace(/\\*\\*(.*?)\\*\\*/g, '$1')\n               .replace(/\\*(.*?)\\*/g, '$1')\n               .replace(/__(.*?)__/g, '$1')\n               .replace(/_(.*?)_/g, '$1');\n\n  // Quitar encabezados markdown (##, ###, etc.)\n  texto = texto.replace(/^\\s{0,3}#{1,6}\\s+/gm, '');\n\n  // Normalizar saltos y espacios\n  texto = texto.replace(/\\r/g, '')\n               .replace(/\\n{3,}/g, '\\n\\n')\n               .replace(/[ \\t]+\\n/g, '\\n')\n               .trim();\n\n  // Escapar HTML para Telegram (parse_mode: \"HTML\")\n  texto = escapeHTML(texto);\n\n  // L√≠mite prudente para Telegram (4096 es el duro). Dejamos margen.\n  const LIMITE = 3500;\n  if (texto.length > LIMITE) {\n    texto = texto.substring(0, LIMITE - 20).trimEnd() + '‚Ä¶ (mensaje acortado)';\n  }\n\n  return texto;\n}\n\nconst textoLimpio = limpiarRespuesta(respuestaGemini);\n\n// ---- 4) Logs √∫tiles ----\nconsole.log(`========================================`);\nconsole.log(`üßπ LIMPIEZA DE TEXTO`);\nconsole.log(`Chat ID encontrado: ${chatId}`);\nconsole.log(`Texto original (100): ${String(respuestaGemini).substring(0, 100)}...`);\nconsole.log(`Texto limpio   (100): ${textoLimpio.substring(0, 100)}...`);\nconsole.log(`========================================`);\n\n// ---- 5) Salida ----\nreturn [{\n  json: {\n    texto_limpio: textoLimpio,\n    chat_id: chatId,\n    respuesta_original: respuestaGemini\n  }\n}];"
        },
        "typeVersion": 2
      },
      {
        "id": "84c7ffb2-d72d-432a-ac54-9892d31ac5b9",
        "name": "Enviar Respuesta sobre calendario1",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -240,
          2160
        ],
        "webhookId": "c4b9e9ad-3d55-4653-b1eb-e4621c6425d8",
        "parameters": {
          "text": "={{ $json.texto_limpio }}\n\nüí¨ ¬øDeseas revisar otra consulta o hacer una nueva pregunta?",
          "chatId": "={{ $json.chat_id }}",
          "replyMarkup": "inlineKeyboard",
          "inlineKeyboard": {
            "rows": [
              {
                "row": {
                  "buttons": [
                    {
                      "text": "üëç S√≠",
                      "additionalFields": {
                        "callback_data": "=feedback_yes"
                      }
                    },
                    {
                      "text": "üëé No",
                      "additionalFields": {
                        "callback_data": "=feedback_no"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {
            "parse_mode": "HTML",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "144e290f-5f0a-400b-b82b-269d90d5f32a",
        "name": "Calendario Acad√©mico",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -1520,
          2160
        ],
        "parameters": {
          "options": {
            "outputFormatting": {
              "values": {
                "date": "FORMATTED_STRING",
                "general": "UNFORMATTED_VALUE"
              }
            },
            "returnFirstMatch": false
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 1817620056,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit#gid=1817620056",
            "cachedResultName": "CALENDAR"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit?usp=drivesdk",
            "cachedResultName": "BASE-DATOS-FAQ_ESPOL"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "aXzbiC4KJQoHD5SM",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "21267be1-e42b-4362-aefc-42bf96705258",
        "name": "Buscar_Eventos_Calendario1",
        "type": "n8n-nodes-base.code",
        "position": [
          -1264,
          2160
        ],
        "parameters": {
          "jsCode": "const detectorItems = $('Detector_Calendario_Pre').all();\nconst detector =\n  Array.isArray(detectorItems) && detectorItems.length > 0\n    ? detectorItems[0].json\n    : {};\nconst preguntaUsuario = detector.pregunta_usuario || '';\nconst chatId = detector.chat_id ?? null;\nconst filas = $input.all().map(it => it.json || {});\n\nconst HOY = new Date();\nconst ANIO_ACTUAL = HOY.getFullYear();\nconst ANIO_SIG = ANIO_ACTUAL + 1;\n\n// ---------- helpers ----------\nfunction limpiarTexto(t) {\n  if (!t) return '';\n  return String(t)\n    .toLowerCase()\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n    .replace(/[^a-z0-9√±\\s]/gi, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nconst STOP = new Set([\n  \"de\",\"la\",\"que\",\"el\",\"en\",\"y\",\"a\",\"los\",\"del\",\"se\",\"las\",\"por\",\"un\",\"para\",\"con\",\"no\",\"una\",\n  \"su\",\"al\",\"lo\",\"como\",\"mas\",\"m√°s\",\"pero\",\"sus\",\"le\",\"ya\",\"o\",\"fue\",\"ha\",\"si\",\"s√≠\",\"porque\",\n  \"muy\",\"sin\",\"sobre\",\"tambien\",\"tambi√©n\",\"entre\",\"cuando\",\"todo\",\"esta\",\"est√°\",\"ser\",\"son\",\n  \"dos\",\"han\",\"hay\",\"donde\",\"quien\",\"qui√©n\",\"desde\",\"cada\",\"cual\",\"cu√°l\",\"cuales\",\"cu√°les\"\n]);\nfunction tokenizar(t) { return limpiarTexto(t).split(' ').filter(x => x && x.length > 2 && !STOP.has(x)); }\n\nfunction baseEs(w) {\n  w = limpiarTexto(w);\n  if (!w) return '';\n  w = w.replace(/\\b1(ra|era)\\b/g, 'primera')\n       .replace(/\\b2da\\b/g, 'segunda')\n       .replace(/\\b3ra\\b/g, 'tercera');\n  if (w.endsWith('es')) w = w.slice(0, -2);\n  else if (w.endsWith('s')) w = w.slice(0, -1);\n  w = w.replace(/evaluacione?$/,'evaluacion');\n  return w;\n}\nfunction matchToken(userTok, rowTok) {\n  const u = baseEs(userTok), r = baseEs(rowTok);\n  if (!u || !r) return false;\n  if (u === r) return true;\n  if (u.length >= 5 && (r.includes(u) || u.includes(r))) return true;\n  return false;\n}\n\nfunction detectarIntencion(pregunta) {\n  const p = limpiarTexto(pregunta);\n  if (/(vacaciones|receso|feriado|descanso)/.test(p)) return \"vacaciones\";\n  if (/(evaluacion|evaluaci√≥n|examen|parcial|prueba|evaluar|evaluaciones)/.test(p)) return \"evaluacion\";\n  if (/(inicio|empieza|matriculacion|matriculaci√≥n|induccion|inducci√≥n|apertura|arranque)/.test(p)) return \"inicio\";\n  if (/(final|fin|cierre|termina|culmina|conclusion|conclusi√≥n)/.test(p)) return \"fin\";\n  if (/(eleccion|elecci√≥n|votacion|votaci√≥n)/.test(p)) return \"elecciones\";\n  return \"otro\";\n}\nfunction detectarOrdinal(p) {\n  const t = limpiarTexto(p);\n  if (/\\b(primera|1ra|1era)\\b/.test(t) || /\\bevaluacion\\s*i\\b/.test(t)) return 1;\n  if (/\\b(segunda|2da)\\b/.test(t)     || /\\bevaluacion\\s*ii\\b/.test(t)) return 2;\n  if (/\\b(tercera|3ra)\\b/.test(t)     || /\\bevaluacion\\s*iii\\b/.test(t)) return 3;\n  return 0;\n}\n\nconst MESES = { ene:0, enero:0, feb:1, febrero:1, mar:2, marzo:2, abr:3, abril:3, may:4, mayo:4, jun:5, junio:5, jul:6, julio:6, ago:7, agosto:7, sep:8, sept:8, septiembre:8, oct:9, octubre:9, nov:10, noviembre:10, dic:11, diciembre:11 };\n\nfunction normalizarPeriodo(p) {\n  if (!p) return '';\n  return String(p).replace(/([0-9])([a-zA-Z])/g, '$1 $2').replace(/\\s*-\\s*/g, ' - ').replace(/\\s+/g, ' ').trim();\n}\nfunction parseFechaInicio(periodo) {\n  const txt = normalizarPeriodo(periodo).toLowerCase();\n\n  // \"13 - 17 julio 2026\"\n  let m = /(\\d{1,2})\\s*-\\s*(\\d{1,2})\\s+([a-z√°√©√≠√≥√∫√±]+)\\s+(\\d{4})/.exec(txt);\n  if (m) {\n    const d1 = parseInt(m[1], 10);\n    const mes = MESES[m[3].normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')];\n    const year = parseInt(m[4], 10);\n    if (mes != null) return new Date(year, mes, d1, 0, 0, 0, 0).getTime();\n  }\n\n  // \"30 marzo - 03 abril 2026\"\n  m = /(\\d{1,2})\\s+([a-z√°√©√≠√≥√∫√±]+)\\s*-\\s*(\\d{1,2})\\s+([a-z√°√©√≠√≥√∫√±]+)\\s+(\\d{4})/.exec(txt);\n  if (m) {\n    const d1 = parseInt(m[1], 10);\n    const mes1 = MESES[m[2].normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')];\n    const year = parseInt(m[5], 10);\n    if (mes1 != null) return new Date(year, mes1, d1, 0, 0, 0, 0).getTime();\n  }\n\n  // sin a√±o ‚Üí asume actual\n  m = /(\\d{1,2})\\s*-\\s*(\\d{1,2})\\s+([a-z√°√©√≠√≥√∫√±]+)/.exec(txt);\n  if (m) {\n    const d1 = parseInt(m[1], 10);\n    const mes1 = MESES[m[3].normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')];\n    if (mes1 != null) return new Date(ANIO_ACTUAL, mes1, d1, 0, 0, 0, 0).getTime();\n  }\n  m = /(\\d{1,2})\\s+([a-z√°√©√≠√≥√∫√±]+)\\s*-\\s*(\\d{1,2})\\s+([a-z√°√©√≠√≥√∫√±]+)/.exec(txt);\n  if (m) {\n    const d1 = parseInt(m[1], 10);\n    const mes1 = MESES[m[2].normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')];\n    if (mes1 != null) return new Date(ANIO_ACTUAL, mes1, d1, 0, 0, 0, 0).getTime();\n  }\n  return null;\n}\nfunction extraerAniosTexto(texto) {\n  const t = String(texto || '');\n  const m = t.match(/\\b(20\\d{2})\\b/g);\n  if (!m) return new Set();\n  return new Set(m.map(x => parseInt(x, 10)));\n}\nfunction extraerAniosPregunta(p) { return extraerAniosTexto(p); }\nfunction extraerMesesPregunta(p) {\n  const t = limpiarTexto(p);\n  const meses = new Set();\n  Object.keys(MESES).forEach(k => { if (new RegExp(`\\\\b${k}\\\\b`).test(t)) meses.add(MESES[k]); });\n  return meses;\n}\nfunction yearFromTs(ts) { if (ts == null) return null; try { return new Date(ts).getFullYear(); } catch { return null; } }\n\nconst intencion = detectarIntencion(preguntaUsuario);\nconst ordinalBuscado = detectarOrdinal(preguntaUsuario);\nconst tokensUsuario = tokenizar(preguntaUsuario);\nconst setTokens = new Set(tokensUsuario);\nconst aniosPregunta = extraerAniosPregunta(preguntaUsuario);\nconst mesesPregunta = extraerMesesPregunta(preguntaUsuario);\nconst HARD_FILTER_BY_YEAR = aniosPregunta.size > 0;\n\n// ---------- scoring ----------\nconst PESOS = { PERIODO_FECHAS: 0.8, ACTIVIDADES_GRADO: 1.0, PROCESOS_GRADO: 0.6, ACTIVIDADES_FORMACION: 0.9 };\nconst BONUS_INTENCION = 2.2;\nconst BONUS_FRASE_EXACTA = 1.0;\nconst BONUS_TIENE_EVALUACION = 0.7;\nconst BONUS_ORDINAL_MATCH = 1.5;\nconst PENALIZA_ORD_DISTINTO = 0.5;\nconst PENALIZA_SIN_EVAL_CON_ORD = 0.35;\n\nconst BONUS_ANIO_ACTUAL_STRONG = 1.1;\nconst PENALIZA_ANIO_NO_ACTUAL   = 0.6;\nconst BONUS_MATCH_ANIO_PREGUNTA = 1.2;\nconst BONUS_MATCH_MES_ACTUAL    = 0.6;\nconst BONUS_ANIO_EXPLICITO      = 0.3;\n\nconst UMBRAL_SCORE_MIN = 0;\nconst UMBRAL_DEMASIADAS = 25; // ‚Üê si hay m√°s que esto, sugerimos refinar\n\nif (!preguntaUsuario || !limpiarTexto(preguntaUsuario)) {\n  return [{ json: { ok:false, motivo:\"pregunta_vacia\", mensaje:\"No se recibi√≥ una pregunta (pregunta_usuario).\", chat_id:chatId } }];\n}\nif (!Array.isArray(filas) || filas.length === 0) {\n  return [{ json: { ok:false, motivo:\"sin_datos\", mensaje:\"No llegaron filas desde Google Sheets.\", chat_id:chatId } }];\n}\n\nfunction filaTokens(row) {\n  const F = (k) => { const v = row[k]; return (v == null) ? '' : String(v); };\n  const actTecKey = 'ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA';\n  const campos = {\n    row_number: row.row_number ?? null,\n    PERIODO_FECHAS: F('PERIODO_FECHAS'),\n    ACTIVIDADES_GRADO: F('ACTIVIDADES_GRADO'),\n    PROCESOS_GRADO: F('PROCESOS_GRADO'),\n    ACTIVIDADES_FORMACION: F(actTecKey) || F('ACTIVIDADES_FORMACION') || ''\n  };\n  const textoTotal = [campos.PERIODO_FECHAS, campos.ACTIVIDADES_GRADO, campos.PROCESOS_GRADO, campos.ACTIVIDADES_FORMACION].filter(Boolean).join(' | ');\n  const normTotal = limpiarTexto(textoTotal);\n  const toks = {\n    PERIODO_FECHAS: tokenizar(campos.PERIODO_FECHAS),\n    ACTIVIDADES_GRADO: tokenizar(campos.ACTIVIDADES_GRADO),\n    PROCESOS_GRADO: tokenizar(campos.PROCESOS_GRADO),\n    ACTIVIDADES_FORMACION: tokenizar(campos.ACTIVIDADES_FORMACION),\n    TOTAL: tokenizar(textoTotal)\n  };\n  const aniosTexto = extraerAniosTexto(textoTotal);\n  const tsInicio = parseFechaInicio(campos.PERIODO_FECHAS);\n  const anioTs = yearFromTs(tsInicio);\n  const aniosFila = new Set(aniosTexto);\n  if (anioTs != null) aniosFila.add(anioTs);\n  let mesInicio = null;\n  if (tsInicio != null) mesInicio = new Date(tsInicio).getMonth();\n\n  return { campos, textoTotal, normTotal, toks, aniosFila, tsInicio, mesInicio };\n}\nfunction filaTieneOrdinalEvaluacion(norm) {\n  const hasEval = /\\bevaluacion\\b/.test(norm);\n  const primera = hasEval && (/\\bprimera\\b/.test(norm) || /\\bevaluacion\\s*i\\b/.test(norm) || /\\bi\\s*evaluacion\\b/.test(norm));\n  const segunda = hasEval && (/\\bsegunda\\b/.test(norm) || /\\bevaluacion\\s*ii\\b/.test(norm) || /\\bii\\s*evaluacion\\b/.test(norm));\n  const tercera = hasEval && (/\\btercera\\b/.test(norm) || /\\bevaluacion\\s*iii\\b/.test(norm) || /\\biii\\s*evaluacion\\b/.test(norm));\n  return { hasEval, primera, segunda, tercera };\n}\nfunction intersect(setA, setB) { for (const x of setA) if (setB.has(x)) return true; return false; }\n\nfunction puntuar(row) {\n  const { campos, textoTotal, normTotal, toks, aniosFila, tsInicio, mesInicio } = filaTokens(row);\n  if (!normTotal) return null;\n\n  if (HARD_FILTER_BY_YEAR) {\n    if (aniosFila.size > 0 && !intersect(aniosFila, aniosPregunta)) return null;\n    // si no hay a√±o en la fila, la dejamos pasar con score bajo (puedes excluirla retornando null)\n  }\n\n  let score = 0, coincidencias = 0;\n  const matchPorCampo = { PERIODO_FECHAS: [], ACTIVIDADES_GRADO: [], PROCESOS_GRADO: [], ACTIVIDADES_FORMACION: [] };\n  const matchTokens = [];\n\n  for (const t of setTokens) {\n    let hit = false;\n    for (const campo of Object.keys(PESOS)) {\n      const arr = toks[campo];\n      if (arr && arr.some(rt => matchToken(t, rt))) {\n        score += PESOS[campo];\n        matchPorCampo[campo].push(t);\n        hit = true;\n      }\n    }\n    if (hit) { coincidencias++; matchTokens.push(t); }\n  }\n\n  const INTENT_TERMS = {\n    vacaciones: [\"vacaciones\",\"receso\",\"feriado\",\"descanso\",\"estudiantiles\"],\n    evaluacion: [\"evaluacion\",\"evaluaciones\",\"examen\",\"parcial\",\"prueba\",\"ciclo\",\"semana de evaluacion\"],\n    inicio: [\"inicio\",\"empieza\",\"apertura\",\"induccion\",\"matriculacion\",\"novatos\"],\n    fin: [\"final\",\"fin\",\"cierre\",\"termina\",\"culmina\",\"conclusion\",\"proceso final\"],\n    elecciones: [\"eleccion\",\"votacion\"]\n  };\n  if (intencion !== 'otro') {\n    const terms = INTENT_TERMS[intencion] || [];\n    if (terms.some(term => normTotal.includes(limpiarTexto(term)))) score += BONUS_INTENCION;\n  }\n\n  const ord = filaTieneOrdinalEvaluacion(normTotal);\n  if (intencion === 'evaluacion' && ord.hasEval) score += BONUS_TIENE_EVALUACION;\n  if (ordinalBuscado) {\n    const ok = (ordinalBuscado === 1 && ord.primera) || (ordinalBuscado === 2 && ord.segunda) || (ordinalBuscado === 3 && ord.tercera);\n    if (ok) score += BONUS_ORDINAL_MATCH;\n    else {\n      if (ord.primera || ord.segunda || ord.tercera) score -= PENALIZA_ORD_DISTINTO;\n      if (!ord.hasEval) score -= PENALIZA_SIN_EVAL_CON_ORD;\n    }\n  }\n\n  if (HARD_FILTER_BY_YEAR) {\n    if (aniosFila.size > 0 && intersect(aniosFila, aniosPregunta)) score += BONUS_MATCH_ANIO_PREGUNTA;\n  } else {\n    if (aniosFila.size > 0) {\n      if (aniosFila.has(ANIO_ACTUAL)) score += BONUS_ANIO_ACTUAL_STRONG;\n      else score -= PENALIZA_ANIO_NO_ACTUAL;\n    }\n  }\n\n  if (mesesPregunta.size > 0 && mesInicio != null) {\n    if (mesesPregunta.has(mesInicio)) {\n      if (!HARD_FILTER_BY_YEAR && (aniosFila.size === 0 || aniosFila.has(ANIO_ACTUAL))) score += BONUS_MATCH_MES_ACTUAL;\n      else score += BONUS_MATCH_MES_ACTUAL * 0.6;\n    }\n  }\n\n  if (/\\b20\\d{2}\\b/.test(normTotal)) score += BONUS_ANIO_EXPLICITO;\n\n  const frase = limpiarTexto(preguntaUsuario);\n  if (frase && normTotal.includes(frase)) score += BONUS_FRASE_EXACTA;\n\n  const len = normTotal.split(' ').length || 1;\n  score = score / Math.pow(len, 0.03);\n\n  return {\n    row_number: campos.row_number,\n    PERIODO_FECHAS: campos.PERIODO_FECHAS,\n    ACTIVIDADES_GRADO: campos.ACTIVIDADES_GRADO,\n    PROCESOS_GRADO: campos.PROCESOS_GRADO,\n    ACTIVIDADES_FORMACION: campos.ACTIVIDADES_FORMACION,\n    preview: textoTotal,\n    score: Number(score.toFixed(4)),\n    coincidencias,\n    match_tokens: matchTokens,\n    match_por_campo: matchPorCampo,\n    fecha_inicio_ts: tsInicio,\n    mes_inicio: mesInicio,\n    anios_fila: [...aniosFila]\n  };\n}\n\n// ---------- ejecutar y ordenar ----------\nconst evaluadas = [];\nfor (const row of filas) {\n  const r = puntuar(row);\n  if (!r) continue;\n  if (r.score > UMBRAL_SCORE_MIN || r.coincidencias > 0) evaluadas.push(r);\n}\n\nevaluadas.sort((a, b) => {\n  if (b.score !== a.score) return b.score - a.score;\n  if (b.coincidencias !== a.coincidencias) return b.coincidencias - a.coincidencias;\n  const ta = a.fecha_inicio_ts ?? Number.POSITIVE_INFINITY;\n  const tb = b.fecha_inicio_ts ?? Number.POSITIVE_INFINITY;\n  return ta - tb;\n});\n\n// chat_ids v√°lidos (si existen en la data)\nconst chatIds = $input.all()\n  .map(it => it.json?.CHAT_ID)\n  .filter(id => id !== undefined && id !== null && String(id).trim() !== '')\n  .map(id => String(id).trim());\nconst chat_ids_validos = [...new Set(chatIds)];\n\n// ---------- sin resultados ----------\nif (evaluadas.length === 0) {\n  const sugerencias = { email: \"admision@espol.edu.ec\", telefono: \"(04) 2269-269\", web: \"https://www.espol.edu.ec\" };\n  const yearInfo = aniosPregunta.size > 0 ? ` para el/los a√±o(s): ${[...aniosPregunta].join(', ')}` : ` para el a√±o ${ANIO_ACTUAL}`;\n  const mensaje = [\n    `üòï No encontr√© informaci√≥n espec√≠fica${yearInfo}.`,\n    \"Puedes comunicarte por:\",\n    `üìß ${sugerencias.email}`,\n    `üìû ${sugerencias.telefono}`,\n    `üåê ${sugerencias.web}`\n  ].join('\\n');\n\n  return [{ json: {\n    ok: false,\n    consulta: preguntaUsuario,\n    intencion_detectada: intencion,\n    mensaje,\n    sugerencias_contacto: sugerencias,\n    chat_id: chatId,\n    chat_ids_validos\n  }}];\n}\n\n// ---------- construir sugerencias si hay demasiadas coincidencias ----------\nfunction nombreMes(idx) {\n  const nombres = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];\n  return (idx >=0 && idx <=11) ? nombres[idx] : null;\n}\nfunction recolectarFacetas(rows) {\n  const anios = new Set();\n  const meses = new Set();\n  const tiposEval = new Set(); // primera/segunda/tercera\n  const ciclos = new Set();    // Ciclo 1/2/3\n\n  for (const r of rows) {\n    (r.anios_fila || []).forEach(y => anios.add(y));\n    if (typeof r.mes_inicio === 'number') meses.add(r.mes_inicio);\n\n    const norm = limpiarTexto(`${r.PERIODO_FECHAS} ${r.ACTIVIDADES_GRADO} ${r.PROCESOS_GRADO} ${r.ACTIVIDADES_FORMACION}`);\n    if (/\\bprimera\\b/.test(norm) || /\\bevaluacion\\s*i\\b/.test(norm)) tiposEval.add('primera');\n    if (/\\bsegunda\\b/.test(norm) || /\\bevaluacion\\s*ii\\b/.test(norm)) tiposEval.add('segunda');\n    if (/\\btercera\\b/.test(norm) || /\\bevaluacion\\s*iii\\b/.test(norm)) tiposEval.add('tercera');\n\n    const m = norm.match(/\\bciclo\\s*(1|2|3)\\b/);\n    if (m) ciclos.add(`Ciclo ${m[1]}`);\n  }\n\n  return {\n    anios: [...anios].sort((a,b)=>a-b),\n    meses: [...meses].sort((a,b)=>a-b).map(nombreMes).filter(Boolean),\n    tiposEval: [...tiposEval],\n    ciclos: [...ciclos]\n  };\n}\n\nlet sugerencia_reformulacion = null;\nlet filtros_sugeridos = null;\nconst DEMASIADAS = evaluadas.length > UMBRAL_DEMASIADAS;\n\nif (DEMASIADAS) {\n  const facetas = recolectarFacetas(evaluadas);\n  filtros_sugeridos = {\n    posibles_anios: facetas.anios,\n    posibles_meses: facetas.meses,\n    posibles_tipos_evaluacion: facetas.tiposEval,\n    posibles_ciclos: facetas.ciclos\n  };\n\n  const tips = [];\n  if (facetas.anios.length > 0) tips.push(`‚Ä¢ especifica a√±o: **${facetas.anios.slice(-3).join(' / ')}**`);\n  if (facetas.meses.length > 0) tips.push(`‚Ä¢ a√±ade mes: **${facetas.meses.slice(0,4).join(' / ')}**`);\n  if (facetas.tiposEval.length > 0) tips.push(`‚Ä¢ tipo de evaluaci√≥n: **${facetas.tiposEval.join(' / ')}**`);\n  if (facetas.ciclos.length > 0) tips.push(`‚Ä¢ ciclo: **${facetas.ciclos.join(' / ')}**`);\n\n  // ejemplo guiado\n  const ejemplo = [];\n  if (intencion === 'evaluacion') {\n    const ejA = facetas.anios[0] ?? ANIO_ACTUAL;\n    const ejMes = facetas.meses[0] ?? 'julio';\n    ejemplo.push(`Ej.: \"¬øCu√°ndo es la **primera evaluaci√≥n** de **${ejMes} ${ejA}** en PAE?\"`);\n  } else if (facetas.meses.length > 0 || facetas.anios.length > 0) {\n    const ejA = facetas.anios[0] ?? ANIO_ACTUAL;\n    const ejMes = facetas.meses[0] ?? 'abril';\n    ejemplo.push(`Ej.: \"Actividades formativas de **${ejMes} ${ejA}**\"`);\n  }\n\n  sugerencia_reformulacion =\n    `üîé He encontrado **${evaluadas.length}** coincidencias. ` +\n    `Para llegar m√°s r√°pido a lo que necesitas, prueba a refinar tu pregunta:\\n` +\n    (tips.length ? tips.join('\\n') + '\\n' : '') +\n    (ejemplo.length ? ejemplo.join('\\n') : '');\n}\n\n// ---------- mensaje formateado (todas las coincidencias) ----------\nconst encabezado = `üìÖ Encontr√© ${evaluadas.length} coincidencia(s) para:\\n‚Äú${preguntaUsuario}‚Äù`;\nconst cuerpo = evaluadas.map((e, i) => {\n  const partes = [];\n  partes.push(`${i+1}. üìå ${e.PERIODO_FECHAS || '(sin fecha)'}`);\n  if (e.ACTIVIDADES_GRADO?.trim()) partes.push(`   üéì Actividades de Grado: ${e.ACTIVIDADES_GRADO}`);\n  if (e.PROCESOS_GRADO?.trim())     partes.push(`   üìã Procesos: ${e.PROCESOS_GRADO}`);\n  if (e.ACTIVIDADES_FORMACION?.trim()) partes.push(`   üîß Formaci√≥n T√©cnica: ${e.ACTIVIDADES_FORMACION}`);\n  return partes.join('\\n');\n}).join('\\n\\n');\n\nconst mensaje_formateado = sugerencia_reformulacion\n  ? `${encabezado}\\n\\n${cuerpo}\\n\\n${sugerencia_reformulacion}`\n  : `${encabezado}\\n\\n${cuerpo}`;\n\nreturn [{\n  json: {\n    ok: true,\n    consulta: preguntaUsuario,\n    intencion_detectada: intencion,\n    ordinal_detectado: detectarOrdinal(preguntaUsuario) || null,\n    anios_detectados_en_pregunta: [...aniosPregunta],\n    meses_detectados_en_pregunta: [...mesesPregunta],\n    total_evaluadas: filas.length,\n    total_encontrados: evaluadas.length,\n    demasiadas_coincidencias: DEMASIADAS,\n    umbral_demasiadas: UMBRAL_DEMASIADAS,\n    filtros_sugeridos,                 // ‚Üê facetas para construir botones/quick-replies si quieres\n    resultados: evaluadas,             // ‚Üê TODAS las coincidencias ordenadas\n    mensaje_formateado,\n    chat_id: chatId,\n    chat_ids_validos: chat_ids_validos\n  }\n}];"
        },
        "typeVersion": 2
      },
      {
        "id": "2f04c332-95f8-4251-a7d8-c3183c3bf341",
        "name": "Mensaje Help",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -880,
          608
        ],
        "webhookId": "cec2b109-dbe4-4246-a86e-ab226fd460a7",
        "parameters": {
          "text": "=ü§ñ Bienvenido al ChatBot ESPOL\n\nüëã ¬°Hola! Soy ChatBot ESPOL, tu asistente virtual de la Escuela Superior Polit√©cnica del Litoral.\nEstoy aqu√≠ para responder tus preguntas sobre la universidad: matr√≠culas, eventos, horarios, docentes, servicios estudiantiles y mucho m√°s.\n\nüí¨ Solo escribe tu duda y te responder√© al instante.\nPor ejemplo:\n\n‚Äú¬øCu√°ndo empiezan las matr√≠culas?‚Äù\n‚Äú¬øQu√© eventos hay esta semana?‚Äù\n‚Äú¬øD√≥nde puedo contactar a Bienestar Estudiantil?‚Äù\n\nTambi√©n puedes usar estos comandos:\n\n/help ‚Äì Ver los comandos disponibles\n\n/faqs ‚Äì Acceder a la secci√≥n de consultas y preguntas frecuentes\n\n/contact ‚Äì Mostrar contactos y canales oficiales\n\n/events ‚Äì Ver pr√≥ximos eventos\n\n/feedback ‚Äì Enviar sugerencias o comentarios sobre el bot o los servicios\n\nüéì Tu informaci√≥n, siempre a un mensaje de distancia.\n¬øSobre qu√© te gustar√≠a consultar hoy?",
          "chatId": "={{ $json.message.chat.id }}",
          "additionalFields": {
            "parse_mode": "Markdown",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "58882226-f879-4ae5-b653-025ae55e833f",
        "name": "BIENVENIDA",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -880,
          1504
        ],
        "webhookId": "67736a18-8268-4b0b-a904-77b356cf3059",
        "parameters": {
          "text": "=üëãüèΩ ¬°Qu√© m√°s, polit√©cnico o futuro polit√©cnico! \n\nBienvenido al bot oficial de ayuda para toda la comunidad de la ESPOL üê¢üíõüíô.  \n\nAqu√≠ puedes preguntarme lo que necesites sobre tu vida polit√©cnica o lo que se viene en la U:  \nüìÖ Fechas importantes del calendario acad√©mico. \nüéì Preguntas frecuentes de todas las facultades ‚Äî tanto pregrado como postgrado. \nüéüÔ∏è Info sobre becas, clubes, cursos, eventos, transporte, servicios y m√°s.  \n\nY pilas üëÄ, porque cada semana te voy a mandar un recordatorio con lo m√°s relevante que se viene para que no se te pase nada ‚Äî ni matr√≠cula, ni retiro, ni feriado üòé.  As√≠ que tranqui, compa, pregunta nom√°s.\n\n¬°Vamos con todo, polit√©cnico! üöÄüí™",
          "chatId": "={{ $json.message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "5f1bf72a-e7f4-405f-a1fc-549008b73747",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          -672,
          1680
        ],
        "parameters": {
          "options": {},
          "modelName": "models/gemini-2.5-flash-lite"
        },
        "credentials": {
          "googlePalmApi": {
            "id": "5akz9ZmFGR6TDmkP",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "bef601ae-58f3-4785-a49e-4a7225c34ed9",
        "name": "BD_ESPOL",
        "type": "n8n-nodes-base.googleSheetsTool",
        "position": [
          -528,
          1712
        ],
        "parameters": {
          "options": {},
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Sheet', ``, 'string') }}"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit?usp=drivesdk",
            "cachedResultName": "BASE-DATOS-FAQ_ESPOL"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "aXzbiC4KJQoHD5SM",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "c925a437-914c-4e86-8619-2a670ee53c40",
        "name": "PREGUNTAS AL AZAR DE GUIA",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -672,
          1504
        ],
        "parameters": {
          "text": "=El usuario acaba de iniciar el bot con /start.\nNo le muestres un mensaje de bienvenida.\nS√≥lo sugi√©rele 5 preguntas al azar (diferentes cada vez) que podr√≠a hacerle al bot, relacionadas con la informaci√≥n que est√° guardada en BD_ESPOL (preguntas frecuentes de facultades, calendario acad√©mico, becas, clubes, cursos, eventos, etc.).\n\nEjemplo de formato esperado:\n\nüëãüèΩ ¬°Qu√© m√°s, futuro polit√©cnico! Bienvenido al bot de ayuda de la ESPOL üê¢üíõüíô\nAqu√≠ puedes preguntar lo que necesites sobre tu vida universitaria o lo que se viene en el semestre.\n\nPuedes empezar con algo como:\n‚Ä¢ ¬øCu√°ndo abren las matr√≠culas?\n‚Ä¢ ¬øQu√© clubes hay en la ESPOL?\n‚Ä¢ ¬øD√≥nde puedo ver las fechas de titulaci√≥n?\n‚Ä¢ ¬øQuien es el coordinador de la FIMCP?\n‚Ä¢ ¬øCuando empiezan las vacaciones del IIPAO 2025?\n¬°Dale nom√°s, pregunta lo que necesites que el bot te ayuda al instante! üòé",
          "options": {
            "systemMessage": "=Eres un asistente polit√©cnico amigable y juvenil, que habla con tono guayaco, relajado y positivo. Est√°s conectado a una base de datos llamada BD_ESPOL, que contiene informaci√≥n sobre preguntas frecuentes, calendario acad√©mico, becas, clubes, cursos, eventos, servicios, vida universitaria, transporte, titulaci√≥n y reglamentos.\n\nTu objetivo es ayudar a los estudiantes y futuros polit√©cnicos a orientarse en la ESPOL.\n\nCada vez que un usuario nuevo inicia conversaci√≥n, no debes volver a saludar, ya que el bot principal ya lo hizo. Solo debes explicarle brevemente c√≥mo puede usar el bot y mostrarle 5 preguntas aleatorias distintas cada vez que podr√≠a intentar para descubrir las funciones del bot.\n\nEl mensaje debe sonar natural, como si fueras un compa√±ero universitario de Guayaquil, usando expresiones relajadas pero respetuosas.\nEvita usar asteriscos, puntos o cualquier formato Markdown. Usa guiones (-) para enumerar las preguntas.\n\nLas preguntas deben cubrir temas variados: calendario acad√©mico, becas, facultades, servicios, transporte, vida universitaria, titulaci√≥n y eventos.\nCada vez que respondas, cambia el orden o tipo de preguntas para que no sean las mismas.\n\nEjemplo de estilo y estructura:\nAqu√≠ puedes preguntar sobre fechas, becas, clubes o eventos\nMira, puedes probar con algo como\n\n- ¬øCu√°ndo empiezan las clases?\n\n- ¬øQu√© becas hay disponibles?\n\n- ¬øD√≥nde veo los cursos extracurriculares?\n\n- ¬øQu√© eventos hay esta semana?\n\n- ¬øC√≥mo puedo unirme a un club estudiantil?\n\nTermina siempre con una frase motivadora tipo\n\n¬°Dale, pregunta nom√°s!\n\n¬°Pru√©balo y ve lo bac√°n que est√° esto!"
          },
          "promptType": "define"
        },
        "typeVersion": 3
      },
      {
        "id": "b74244ac-ed9a-4979-95ac-d15a620c7df4",
        "name": "Wait",
        "type": "n8n-nodes-base.wait",
        "position": [
          -368,
          1504
        ],
        "webhookId": "d38e8f38-68a5-4b15-b8c3-4dce9f102f38",
        "parameters": {},
        "typeVersion": 1.1
      },
      {
        "id": "3104667b-6c32-4a83-9627-23609865000e",
        "name": "GUIA DE COMO PREGUNTAR",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -208,
          1504
        ],
        "webhookId": "4e6cea20-85ce-4b9a-b931-8fa22d93b87b",
        "parameters": {
          "text": "={{ $json.output }}",
          "chatId": "={{ $('Telegram Trigger - Inicio').item.json.message.chat.id }}",
          "additionalFields": {
            "parse_mode": "HTML",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "dff25489-2b4d-49da-9398-9efa73bbe8f5",
        "name": "Google Gemini Chat Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          -3168,
          1840
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "googlePalmApi": {
            "id": "5akz9ZmFGR6TDmkP",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7e30adff-e90b-495b-af22-d82ab8a464a3",
        "name": "BD_CALENDARIO1",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -3872,
          1664
        ],
        "parameters": {
          "options": {},
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 1817620056,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit#gid=1817620056",
            "cachedResultName": "CALENDAR"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit?usp=drivesdk",
            "cachedResultName": "BASE-DATOS-FAQ_ESPOL"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "aXzbiC4KJQoHD5SM",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "6ee54764-d999-48bc-a498-d4ded389b2f9",
        "name": "GENERADOR DE ANUNCIOS1",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -3168,
          1664
        ],
        "parameters": {
          "text": "=Convierte el siguiente texto en un mensaje casual ecuatoriano:\n\nPeriodo: {{ $json[\"RESULTADOS[0].PERIODO_FECHAS\"] }}\nActividades: {{ $json[\"RESULTADOS[0].ACTIVIDADES_GRADO\"] }}\nProcesos: {{ $json[\"RESULTADOS[0].PROCESOS_GRADO\"] }}\nFormacion tecnica: {{ $json['RESULTADOS[0][\\'ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA\\']'] }}\n",
          "options": {
            "systemMessage": "=Eres un redactor ecuatoriano experto en comunicaci√≥n universitaria. Tu tarea es convertir los datos de tres semanas (anterior, actual y siguiente) en un solo mensaje casual, fresco y cercano, como si lo dijera un estudiante polit√©cnico.  \n\nSigue estas reglas:\n\n1. **Prioriza la semana del medio (la actual)**. Es la principal. Describe sus actividades con entusiasmo, usando un tono motivador y natural.\n2. Luego menciona brevemente lo ocurrido **la semana pasada (primer item)**, con frases tipo:  \n   ‚ÄúSi te lo perdiste la semana pasada‚Ä¶‚Äù o ‚ÄúPor si no te enteraste‚Ä¶‚Äù.\n3. Finalmente, habla de **la semana siguiente (√∫ltimo item)**, pero nunca digas ‚Äúla pr√≥xima semana‚Äù a secas.  \n   Siempre menciona expl√≠citamente **la fecha del periodo**, por ejemplo:  \n   ‚ÄúY para la semana del 17 al 21 de noviembre‚Ä¶‚Äù  \n   Usa frases como: ‚Äúprep√°rate para‚Äù, ‚Äúse viene‚Äù, ‚Äúatentos que en la semana del‚Ä¶‚Äù.\n4. Usa expresiones naturales de Ecuador como *pilas, √±a√±o, pana, de una, qu√© bestia, bac√°n, full, a romperla*.\n5. Separa las secciones con saltos de l√≠nea y mant√©n un estilo cercano y fluido, tipo mensaje de Telegram o redes.\n6. No inventes informaci√≥n fuera del JSON, solo reformula y organiza lo recibido.\n7. El resultado final debe ser un **solo texto en espa√±ol ecuatoriano**, sin etiquetas, ni formato JSON, ni comillas.\n\nEjemplo de estructura esperada:\n\n¬°Qu√© m√°s, mi gente polit√©cnica! Esta semana del 10 al 14 de noviembre se viene con todo üí™.  \nSeguimos a full con las actividades formativas y los panas de Formaci√≥n T√©cnica tambi√©n est√°n d√°ndole duro. ¬°Qu√© bestia la energ√≠a que se siente en el campus!  \n\nSi te lo perdiste la semana pasada, hubo evaluaciones y descansos para recargar pilas. ¬°Espero que hayas aprovechado! üòé  \n\nY atentos para la semana del 17 al 21 de noviembre, que llega la PRIMERA EVALUACI√ìN del grado. ¬°A romperla con todo el √±eque, panas! üìöüî•\n"
          },
          "promptType": "define"
        },
        "typeVersion": 3
      },
      {
        "id": "91ec2456-dae0-4a1c-9e19-883df9771bd8",
        "name": "Sticky Note20",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4208,
          1376
        ],
        "parameters": {
          "color": 5,
          "width": 2224,
          "height": 656,
          "content": "# üì¢ **SISTEMA GENERADOR DE ANUNCIOS** üß†\n"
        },
        "typeVersion": 1
      },
      {
        "id": "e145604d-3454-4370-847b-c88a46e7973f",
        "name": "Sticky Note21",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4176,
          1488
        ],
        "parameters": {
          "color": 5,
          "width": 256,
          "height": 368,
          "content": "## RECORDATORIO SEMANAL\nCADA DOMINGO A LAS 07:00PM SE NOTIFICAR√Å AL USUARIO SOBRE LOS ANUNCIOS IMPORTANTES DE LA  SEMANA ENTRANTE"
        },
        "typeVersion": 1
      },
      {
        "id": "bb5ecbad-5350-4010-a658-bd868d7bdcad",
        "name": "Sticky Note22",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3920,
          1488
        ],
        "parameters": {
          "color": 5,
          "width": 208,
          "height": 368,
          "content": "## CALENDARIO\nEL SISTEMA TENDR√Å A SU DISPOSICI√ìN A TIEMPO REAL CALENDARIO ACAD√âMICO DE ESPOL"
        },
        "typeVersion": 1
      },
      {
        "id": "1b0a4908-baec-4ce6-b482-ce5ac6707fbe",
        "name": "Sticky Note23",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3712,
          1488
        ],
        "parameters": {
          "color": 5,
          "width": 496,
          "height": 368,
          "content": "## AUTOMATIZACI√ìN\nEL SISTEMA COMPARAR√Å LA FECHA ACTUAL Y ENTREGAR√Å LAS ACTIVIDADES DE LA SEMANA ENTRANTE"
        },
        "typeVersion": 1
      },
      {
        "id": "ffcd4a54-58f6-4718-be90-678e020d12b8",
        "name": "Sticky Note24",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3216,
          1488
        ],
        "parameters": {
          "color": 5,
          "width": 368,
          "height": 496,
          "content": "## ANUNCIO AUTOM√ÅTICO\nUN AGENTE DE IA, TOMAR√Å LA INFORMACI√ìN DE LAS ACTIVIDADES DE LA SEMANA Y GENERAR√Å UN MENSAJE PERSONALIZADO AL USUARIO PARA MANTENERLO SIEMPE AL D√çA"
        },
        "typeVersion": 1
      },
      {
        "id": "65cf8025-fbd1-4c53-892c-3c39af419f6a",
        "name": "Sticky Note25",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2848,
          1456
        ],
        "parameters": {
          "color": 5,
          "width": 336,
          "height": 320,
          "content": "## GENERADOR DE AUDIO\nPARA MEJORAR LA EXPERIENCIA DEL USUARIO, EL TEXTO SE TRANSFORMA A VOZ "
        },
        "typeVersion": 1
      },
      {
        "id": "2010027d-9238-4bab-8025-0abcc28dd958",
        "name": "Sticky Note26",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2512,
          1408
        ],
        "parameters": {
          "color": 5,
          "width": 352,
          "height": 304,
          "content": "## ENVIO DE VOZ\nEL MENSAJE DE VOZ PERSONALIZADO SE ENV√çA AUTOMATICAMENTE CADA DOMINGO A LAS 07:00PM AL USUARIO V√çA TELEGRAM"
        },
        "typeVersion": 1
      },
      {
        "id": "8c041a63-8828-4f90-b670-85e018f73157",
        "name": "ENVIO DE MENSAJE DE VOZ1",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -2400,
          1536
        ],
        "webhookId": "ae4eba6e-2e6a-4a50-a4ec-6c527850b3c7",
        "parameters": {
          "file": "={{ $('GENERADOR DE MENSAJE DE VOZ').item.json.URL }}",
          "chatId": "={{ $json.chatId }}",
          "operation": "sendAudio",
          "additionalFields": {
            "caption": "={{ \n(() => {\n  const today = new Date();\n  const dayOfWeek = today.getDay(); // 0=domingo\n  const diffMonday = (dayOfWeek === 0 ? -6 : 1 - dayOfWeek) + 7; // +7 => pr√≥xima semana\n  const diffFriday = diffMonday + 4;\n\n  const monday = new Date(today);\n  monday.setDate(today.getDate() + diffMonday);\n\n  const friday = new Date(today);\n  friday.setDate(today.getDate() + diffFriday);\n\n  const fmt = d => `${d.getDate().toString().padStart(2, '0')}/${(d.getMonth() + 1).toString().padStart(2, '0')}`;\n\n  return `Anuncio Semanal - Semana del ${fmt(monday)} al ${fmt(friday)}`;\n})()\n}}\n"
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "9681b6de-a5db-443e-89a5-e6a927b92b89",
        "name": "ENVIO DE MENSAJE DE TEXTO1",
        "type": "n8n-nodes-base.telegram",
        "position": [
          -2384,
          1824
        ],
        "webhookId": "fc1657ce-66de-4cae-940f-86f0afae3ae5",
        "parameters": {
          "text": "={{ $json.text }}",
          "chatId": "={{ $json.chatId }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "ovdN9afPb1hJiiET",
            "name": "ESPOLBot"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "245f9062-c877-46f0-9df3-d722308dca44",
        "name": "Sticky Note27",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2512,
          1728
        ],
        "parameters": {
          "color": 5,
          "width": 352,
          "height": 272,
          "content": "## ENVIO DE TEXTO\nSE ENV√çA AUTOMATICAMENTE EL MENSAJE"
        },
        "typeVersion": 1
      },
      {
        "id": "67e74e9f-13b3-4f5f-80f4-e35e75558704",
        "name": "OPTIMIZADOR",
        "type": "n8n-nodes-base.code",
        "position": [
          -2800,
          1808
        ],
        "parameters": {
          "jsCode": "// Tu array de chat IDs\nconst chatIds = $('ACTIVIDADES DE LA SEMANA1').first().json.CHAT_IDS_VALIDOS; // reemplaza con tus IDs\n\n// Mensaje a enviar\nconst mensaje = $input.first().json.output;\n\n// Creamos un item por cada chat ID\nreturn chatIds.map(id => ({\n    json: {\n        chatId: id,\n        text: mensaje\n    }\n}));\n"
        },
        "typeVersion": 2
      },
      {
        "id": "23d73abe-5b2b-42c5-b50f-fea043f4cd1a",
        "name": "OPTIMIZADOR1",
        "type": "n8n-nodes-base.code",
        "position": [
          -2640,
          1584
        ],
        "parameters": {
          "jsCode": "// Tu array de chat IDs\nconst chatIds = $('ACTIVIDADES DE LA SEMANA1').first().json.CHAT_IDS_VALIDOS; // reemplaza con tus IDs\n\n// Mensaje a enviar\nconst mensaje = $input.first().json.output;\n\n// Creamos un item por cada chat ID\nreturn chatIds.map(id => ({\n    json: {\n        chatId: id,\n        text: mensaje\n    }\n}));\n"
        },
        "typeVersion": 2
      },
      {
        "id": "5dfc42b7-8684-4e92-95ca-7e1154345402",
        "name": "GENERADOR DE MENSAJE DE VOZ",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -2800,
          1584
        ],
        "parameters": {
          "url": "https://ttsmp3.com/makemp3_new.php",
          "method": "POST",
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          },
          "sendBody": true,
          "contentType": "form-urlencoded",
          "bodyParameters": {
            "parameters": [
              {
                "name": "msg",
                "value": "={{ $json.output }}"
              },
              {
                "name": "lang",
                "value": "Mia"
              },
              {
                "name": "source",
                "value": "ttsmp3"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "7008a1aa-c9fb-4777-aac2-63f51cb88d49",
        "name": "OBTENER_ID1",
        "type": "n8n-nodes-base.set",
        "position": [
          -880,
          1712
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "fc9b6408-8e37-4395-935f-33985719dae3",
                "name": "chat_id",
                "type": "number",
                "value": "={{ $json.message.chat.id }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "0310e05e-bc18-48de-952d-2c7e5163ab1f",
        "name": "AGREGA ID_UNICAS1",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -624,
          1856
        ],
        "parameters": {
          "columns": {
            "value": {
              "CHAT_ID": "={{ $json.chat_id }}"
            },
            "schema": [
              {
                "id": "PERIODO_FECHAS",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "PERIODO_FECHAS",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "ACTIVIDADES_GRADO",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "ACTIVIDADES_GRADO",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "PROCESOS_GRADO",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "PROCESOS_GRADO",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "CHAT_ID",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "CHAT_ID",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "CHAT_ID"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 1817620056,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit#gid=1817620056",
            "cachedResultName": "CALENDAR"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit?usp=drivesdk",
            "cachedResultName": "BASE-DATOS-FAQ_ESPOL"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "aXzbiC4KJQoHD5SM",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "c797bd9d-e22d-40af-b685-0ecff2c2e838",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -976,
          320
        ],
        "parameters": {
          "color": 5,
          "width": 1040,
          "height": 1712,
          "content": "# üè∑Ô∏è **SISTEMA DE TAGS - REFERENCIA R√ÅPIDA** ‚ú®\n\n## ESTE **SISTEMA DE TAGS** PERMITE ORGANIZAR Y CLASIFICAR LA INFORMACI√ìN. CADA TAG FACILITA FILTRAR, IDENTIFICAR Y ACCEDER R√ÅPIDAMENTE A LOS NODOS, MEJORANDO LA CLARIDAD Y EFICIENCIA."
        },
        "typeVersion": 1
      },
      {
        "id": "52455d30-745d-4373-a56e-770a643192b7",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -416,
          1680
        ],
        "parameters": {
          "color": 5,
          "width": 432,
          "height": 304,
          "content": "## üëã **BIENVENIDA AL USUARIO** üéâ\nAL INGRESAR UN NUEVO USUARIO SE ENVIA UN MENSAJE DE BIENVENIDA Y GU√çA DE USO DEL BOT.\n\n\n## üÜî **OBTENCI√ìN DE LAS IDs** üîç\nGUARDA EN UNA BASE DE DATOS LA ID DE CADA USUARIO NUEVO QUE INGRESE AL BOT "
        },
        "typeVersion": 1
      },
      {
        "id": "97535bd5-a38d-4d93-8eb8-11ea593ec658",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3328,
          416
        ],
        "parameters": {
          "color": 5,
          "width": 608,
          "height": 288,
          "content": "## MANIPULACI√ìN Y  ORGANIZACI√ìN DE DATOS\nUSO DE LOS NODOS HTML, SPLIT-OUT Y CODE PARA OBTENER LOS DATOS  REQUERIDOS Y MANTENER UN ORDEN DE SALIDA"
        },
        "typeVersion": 1
      },
      {
        "id": "6f2891fd-2874-4273-aeeb-5092191df6ec",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -3056,
          560
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "PERIODOS-FECHAS, ACTIVIDADES_GRADO, PROCESOS_GRADO, ACTIVIDADES_TECNICAS-TECNOL√ìGICAS"
        },
        "typeVersion": 1
      },
      {
        "id": "525e2001-f72e-4f12-b0b8-1773498e9298",
        "name": "HTML",
        "type": "n8n-nodes-base.html",
        "position": [
          -3248,
          560
        ],
        "parameters": {
          "options": {},
          "operation": "extractHtmlContent",
          "extractionValues": {
            "values": [
              {
                "key": "PERIODOS-FECHAS",
                "cssSelector": "table tbody tr td:first-child",
                "returnArray": true
              },
              {
                "key": "ACTIVIDADES_GRADO",
                "cssSelector": "table tbody tr td:nth-child(2)",
                "returnArray": true
              },
              {
                "key": "PROCESOS_GRADO",
                "cssSelector": "table tbody tr td:nth-child(3)",
                "returnArray": true
              },
              {
                "key": "ACTIVIDADES_TECNICAS-TECNOL√ìGICAS",
                "cssSelector": "table tbody tr td:nth-child(4)",
                "returnArray": true
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "bc233dd1-fa9b-4d75-ab77-4542eb14b535",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2720,
          416
        ],
        "parameters": {
          "color": 5,
          "width": 256,
          "height": 288,
          "content": "## BASE DE DATOS\nAGREGA Y ACTUALIZA LA BASE DE  DATOS CON LAS FECHAS Y ACTIVIDADES DEL CALENDARIO"
        },
        "typeVersion": 1
      },
      {
        "id": "f3e79e09-fe05-4b71-a2cd-5810a88e8252",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3552,
          416
        ],
        "parameters": {
          "color": 5,
          "width": 224,
          "height": 288,
          "content": "## SCRAPPING\nPARA LA OBTENCI√ìN DE FECHAS  Y ACTIVIDADES DE TODOS LOS PERIODOS LECTIVOS"
        },
        "typeVersion": 1
      },
      {
        "id": "6a1fe95d-ab71-42a9-8906-dca393412815",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3824,
          416
        ],
        "parameters": {
          "color": 5,
          "width": 272,
          "height": 288,
          "content": "## TEMPORIZADOR DE 7 D√çAS\nCADA SEMANA SE ACTUALIZAR√ÅN LAS BASES DE DATOS DEL CALENDARIO ACAD√âMICO"
        },
        "typeVersion": 1
      },
      {
        "id": "4fc9dc13-c0a9-424e-8fab-873ae62f7c09",
        "name": "BD-CALENDARIO",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -2656,
          560
        ],
        "parameters": {
          "columns": {
            "value": {
              "PERIODO_FECHAS": "={{ $json[\"PERIODOS-FECHAS\"] }}",
              "PROCESOS_GRADO": "={{ $json.PROCESOS_GRADO }}",
              "ACTIVIDADES_GRADO": "={{ $json.ACTIVIDADES_GRADO }}",
              "ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA": "={{ $json[\"ACTIVIDADES_TECNICAS-TECNOL√ìGICAS\"] }}"
            },
            "schema": [
              {
                "id": "PERIODO_FECHAS",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "PERIODO_FECHAS",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "ACTIVIDADES_GRADO",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "ACTIVIDADES_GRADO",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "PROCESOS_GRADO",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "PROCESOS_GRADO",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "CHAT_ID",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "CHAT_ID",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "PERIODO_FECHAS"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "appendOrUpdate",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 1817620056,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit#gid=1817620056",
            "cachedResultName": "CALENDAR"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit?usp=drivesdk",
            "cachedResultName": "BASE-DATOS-FAQ_ESPOL"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "aXzbiC4KJQoHD5SM",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.7
      },
      {
        "id": "3c9d1e36-949b-41c0-82d3-14fe677e407e",
        "name": "Sticky Note12",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4208,
          320
        ],
        "parameters": {
          "color": 5,
          "width": 2224,
          "height": 1056,
          "content": "# üìÖ **CALENDARIO (OBTENCI√ìN - V√çA SCRAPING WEB)** üîç\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "db4dfee5-023e-4736-8b12-4f62879a3907",
        "name": "SCRRAPPING",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -3488,
          560
        ],
        "parameters": {
          "url": "https://www.espol.edu.ec/es/vida-politecnica/calendario-grado",
          "options": {
            "timeout": 60000
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "User-Agent",
                "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "d23cb762-8460-41b9-b291-179baa9985d2",
        "name": "CORRECTOR DE FECHAS",
        "type": "n8n-nodes-base.code",
        "position": [
          -2880,
          560
        ],
        "parameters": {
          "jsCode": "// Recibir items\nconst itemsIn = $input.all();\nlet currentYear = '';\nconst results = [];\n\nfunction detectMonth(text) {\n  // Detecta el mes en el texto (min√∫sculas para evitar errores)\n  const months = {\n    enero: 1, febrero: 2, marzo: 3, abril: 4, mayo: 5, junio: 6,\n    julio: 7, agosto: 8, septiembre: 9, octubre: 10, noviembre: 11, diciembre: 12\n  };\n  const lower = text.toLowerCase();\n  for (const [month, num] of Object.entries(months)) {\n    if (lower.includes(month)) return num;\n  }\n  return null;\n}\n\nfor (const item of itemsIn) {\n  const data = item.json;\n  let period = data[\"PERIODOS-FECHAS\"] ? String(data[\"PERIODOS-FECHAS\"]).trim() : \"\";\n\n  // Detectar si hay un a√±o expl√≠cito\n  const yearMatch = period.match(/\\b(20\\d{2})\\b/);\n  if (yearMatch) {\n    currentYear = parseInt(yearMatch[1]);\n  }\n\n  // Si es encabezado, mantener igual\n  if (/^(VACACIONES|PAE|PAO)/i.test(period)) {\n    results.push({ json: { ...data } });\n    continue;\n  }\n\n  // Detectar meses del per√≠odo\n  const firstMonth = detectMonth(period.split('-')[0] || '');\n  const secondMonth = detectMonth(period.split('-')[1] || '');\n\n  // Si tenemos dos meses y el segundo es menor que el primero ‚Üí cambio de a√±o\n  if (firstMonth && secondMonth && secondMonth < firstMonth) {\n    currentYear++;\n  }\n\n  // Si no hay a√±o en el texto, agregar el actual\n  if (!/\\b20\\d{2}\\b/.test(period) && currentYear) {\n    period = `${period} ${currentYear}`;\n  }\n\n  results.push({\n    json: {\n      ...data,\n      \"PERIODOS-FECHAS\": period\n    }\n  });\n}\n\nreturn results;\n"
        },
        "typeVersion": 2
      },
      {
        "id": "d3138f0c-9007-4d94-ab5f-308ff5fca401",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4144,
          720
        ],
        "parameters": {
          "color": 5,
          "width": 1680,
          "height": 624,
          "content": "# üíæ **BASES DE DATOS** üóÇÔ∏è \n\n## - **FIMCP** (FACULTAD DE INGENIER√çA EN MEC√ÅNICA Y CIENCIAS DE LA PRODUCCI√ìN) ‚öôÔ∏è\n\n## - **FIEC** (FACULTAD DE INGENIER√çA EN ELECTRICIDAD Y COMPUTACI√ìN) üíª\n\n## - **FICT** (FACULTAD DE INGENIER√çA EN CIENCIAS DE LA TIERRA) üåé\n\n## - **FCNM** (FACULTAD DE CIENCIAS NATURALES Y MATEM√ÅTICAS) üî¨\n\n## - **FCSH** (FACULTAD DE CIENCIAS SOCIALES Y HUMAN√çSTICAS) üìö\n\n## - **FADCOM** (FACULTAD DE ARTE, DISE√ëO Y COMUNICACI√ìN AUDIOVISUAL) üé®\n\n## - **FIMCM** (FACULTAD DE INGENIER√çA MAR√çTIMA Y CIENCIAS DEL MAR) ‚öì\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "aae3673d-ab7d-421c-8955-2321e55717b1",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1968,
          320
        ],
        "parameters": {
          "color": 3,
          "width": 976,
          "height": 1136,
          "content": "# üí¨ FLUJO: RESPUESTAS DEL USUARIO & FEEDBACK\n\n## üéØ PROP√ìSITO\n\n## GESTIONAR LA **RESPUESTA DEL USUARIO** TRAS UNA INTERACCI√ìN CON EL BOT Y REGISTRAR SU **RETROALIMENTACI√ìN** EN UNA HOJA DE C√ÅLCULO.\n\n## üîó FLUJO RESUMIDO\n\n## 1. **RESPUESTA USUARIO1 (SWITCH):**\n   DETECTA SI EL USUARIO ELIGE CONTINUAR O ENVIAR FEEDBACK (POR EJEMPLO: ‚ÄúS√ç‚Äù O ‚ÄúNO‚Äù).\n\n## 2. **GET A CHAT:**\n   OBTIENE LOS DATOS DEL CHAT ACTUAL PARA MANTENER LA CONVERSACI√ìN ACTIVA.\n\n## 3. **NO ‚Äì MENSAJE FEEDBACK1:**\n   ENV√çA UN MENSAJE SOLICITANDO AL USUARIO QUE DESCRIBA SU EXPERIENCIA O MOTIVO DE LA RESPUESTA NEGATIVA.\n\n## 4. **GUARDADO FEEDBACK1:**\n   REGISTRA EL MENSAJE DE RETROALIMENTACI√ìN DIRECTAMENTE EN UNA **GOOGLE SHEET** PARA SU AN√ÅLISIS POSTERIOR.\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "4bccb5c4-73cf-413b-a8e9-494e8af81b71",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -672,
          592
        ],
        "parameters": {
          "color": 5,
          "width": 688,
          "height": 128,
          "content": "## üÜò **AYUDA (/HELP)** üí°\nMUESTRA UNA LISTA DE COMANDOS DISPONIBLES Y EXPLICA BREVEMENTE PARA QU√â SIRVE CADA UNO, AYUDANDO AL USUARIO A ENTENDER C√ìMO USAR EL BOT.\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "33fba8d9-8d5a-4328-9f3f-9a847cd1eafc",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -672,
          768
        ],
        "parameters": {
          "color": 5,
          "width": 688,
          "height": 128,
          "content": "## ‚ùì **CONSULTAS (/FAQS)** üí¨\nMANDA A LA SECCI√ìN DE PREGUNTAS FRECUENTES Y CONSULTAS. AQU√ç PUEDES CONSULTAR TEMAS DE MATR√çCULA, EVENTOS, HORARIOS O SERVICIOS ESTUDIANTILES Y RECIBIR RESPUESTAS INMEDIATAS.\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "ffb51e14-36fb-4cbf-98e1-7f507786aa3f",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -672,
          944
        ],
        "parameters": {
          "color": 5,
          "width": 688,
          "height": 128,
          "content": "## üìá **CONTACTOS (/CONTACT)** üìû\nMUESTRA CONTACTOS Y CANALES OFICIALES DE LA ESPOL.\n(WEBS - CORREOS - ENLACES - N√öMEROS - DIRECCI√ìN)\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "fced05c4-2d46-4083-98e7-d5e852cea1cd",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -672,
          1120
        ],
        "parameters": {
          "color": 5,
          "width": 688,
          "height": 128,
          "content": "## üìÖ **EVENTOS (/EVENTS)** üéâ\nMUESTRA PR√ìXIMOS EVENTOS ACAD√âMICOS DE ESPOL\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "85c34e8b-d150-493b-9e3c-6bdad3cdb2d9",
        "name": "Sticky Note13",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -672,
          1296
        ],
        "parameters": {
          "color": 5,
          "width": 688,
          "height": 128,
          "content": "## üìù **FEEDBACK (/FEEDBACK)** ‚≠ê\nPERMITE ENVIAR OPINIONES, SUGERENCIAS O COMENTARIOS SOBRE EL FUNCIONAMIENTO DEL BOT, FACILITANDO LA RETROALIMENTACI√ìN DE LOS USUARIOS CON EL FIN DE MEJORAR EL SERVICIO Y OPTIMIZAR LA EXPERIENCIA GENERAL DEL USUARIO.\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "f58f8a5d-646c-4ebd-9c43-dfe65a0c6514",
        "name": "Sticky Note14",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1968,
          1456
        ],
        "parameters": {
          "color": 3,
          "width": 976,
          "height": 576,
          "content": "# üöÄ **INICIO DE AUTOMATIZACI√ìN** ‚öôÔ∏è\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "dea1510f-eae5-4f48-9b9d-cf61ba080faa",
        "name": "Sticky Note15",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1936,
          1600
        ],
        "parameters": {
          "color": 3,
          "width": 224,
          "height": 304,
          "content": "## TRIGGER TELEGRAM\nSE ACTIVA EN CUALQUIER INTERACCI√ìN DEL USUARIO CON EL BOT\n"
        },
        "typeVersion": 1
      },
      {
        "id": "506b453a-061b-4644-b318-237fc1b660b9",
        "name": "Sticky Note16",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1712,
          1536
        ],
        "parameters": {
          "color": 3,
          "width": 384,
          "height": 400,
          "content": "## CLASIFICADOR DE MENSAJES\n### - 0: FEEDBACK \n### - 1: COMENTARIO\n### - 2: TAGS\n### - Fallback: MENSAJE \n"
        },
        "typeVersion": 1
      },
      {
        "id": "797b1458-c900-40af-89fb-866cf15e0ee8",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "position": [
          -1712,
          1712
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": false,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "0e1c1bb4-3315-4632-a9dc-5f917baf41da",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.callback_query !== undefined }}",
                      "rightValue": "0"
                    }
                  ]
                }
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": false,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "23c2e3a0-e7c8-46de-b504-2cabd445ed54",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      },
                      "leftValue": "={{ ($json.message?.reply_to_message?.text || '') }}",
                      "rightValue": "Lamento que la informaci√≥n no te haya sido √∫til"
                    }
                  ]
                }
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": false,
                    "typeValidation": "loose"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "318d7097-ff17-4636-b7bf-958de3da6788",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.message?.text?.startsWith('/') }}",
                      "rightValue": ""
                    }
                  ]
                }
              }
            ]
          },
          "options": {
            "ignoreCase": true,
            "fallbackOutput": "extra"
          },
          "looseTypeValidation": true
        },
        "typeVersion": 3.3
      },
      {
        "id": "d69dcc76-b210-4b80-893a-1649643e602d",
        "name": "Sticky Note17",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1328,
          1600
        ],
        "parameters": {
          "color": 3,
          "width": 320,
          "height": 304,
          "content": "\n##  CLASIFICADOR DE TAGS\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "76454d3f-9393-486c-a229-696c60ce324e",
        "name": "Sticky Note18",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3120,
          720
        ],
        "parameters": {
          "color": 5,
          "width": 528,
          "height": 624,
          "content": "## - **ADMISI√ìN** üìù\n\n## - **NIVELACI√ìN** üéØ\n\n## - **BECAS** üéì\n\n## - **MATR√çCULAS** üßæ\n\n## - **CERTIFICADOS Y TITULACI√ìN** üìÑ\n\n## - **VIDA UNIVERSITARIA** üè´\n\n## - **SERVICIOS DE SALUD Y BIENESTAR** ‚ù§Ô∏è\n\n## - **CULTURA Y DEPORTES** üèÜ\n\n## - **TRANSPORTE** üöå\n\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "f75dd036-9cc5-4c9d-92ae-34bb89bbf4cd",
        "name": "Sticky Note19",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2592,
          720
        ],
        "parameters": {
          "color": 5,
          "width": 560,
          "height": 624,
          "content": "## - **HISTORIA DE LA ESPOL** üèõÔ∏è\n\n## - **SOSTENIBILIDAD** üå±\n\n## - **CENTROS DE INVESTIGACI√ìN** üî¨\n\n## - **VINCULACI√ìN CON LA SOCIEDAD** ü§ù\n\n## - **REGLAMENTOS** üìò\n\n## - **PROGRAMAS INTERNACIONALES** üåç\n\n## - **VOLUNTARIADO** üôå\n\n## - SERVICIOS: **CELEX**, **CONDUESPOL** Y MAS üí¨\n\n## - **ALUMNI** Y **CIB** üß†"
        },
        "typeVersion": 1
      },
      {
        "id": "6a8a52db-c44d-4174-a92f-cd113b5a0d2a",
        "name": "Sticky Note28",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4208,
          -192
        ],
        "parameters": {
          "width": 2224,
          "height": 496,
          "content": "# ü§ñ **GRUPO #10 ‚Äì CHATBOT POLIT√âCNICO DE PREGUNTAS FRECUENTES Y CALENDARIO ACAD√âMICO EN TELEGRAM** üìÖüí¨\n\n# üß© **WORKFLOW CREADO POR:**\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# üßë‚Äçüè´ **MENTOR: JAREN** üåü\n\n\n\n\n\n\n\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "4602e289-d4d7-4dd0-9777-e148b1175a20",
        "name": "Sticky Note29",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3952,
          112
        ],
        "parameters": {
          "width": 1760,
          "height": 80,
          "content": "# ‚ú® **PROYECTO DE AUTOMATIZACI√ìN INTELIGENTE CON ENFOQUE EN ASISTENCIA UNIVERSITARIA ‚ú®**"
        },
        "typeVersion": 1
      },
      {
        "id": "0cde6cc8-dd35-4fb3-afc9-1ec73921b970",
        "name": "Sticky Note30",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2592,
          -16
        ],
        "parameters": {
          "width": 448,
          "height": 96,
          "content": "# üë©‚Äçüíª **NICOLE GUEVARA** üöÄ\n"
        },
        "typeVersion": 1
      },
      {
        "id": "08dc6029-171d-44d5-92b1-eaeb6cc57bc0",
        "name": "Sticky Note31",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3328,
          -16
        ],
        "parameters": {
          "width": 496,
          "height": 96,
          "content": "# üë©‚Äçüíª **DOM√âNICA AMORES** üí°"
        },
        "typeVersion": 1
      },
      {
        "id": "a35f356d-1afd-4aa9-bfbf-d43ac88909b7",
        "name": "Sticky Note32",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4048,
          -16
        ],
        "parameters": {
          "width": 464,
          "height": 96,
          "content": "# üë®‚Äçüíª **ADRI√ÅN VILLAMAR** ‚öôÔ∏è"
        },
        "typeVersion": 1
      },
      {
        "id": "e4d2da34-4840-4228-8d25-54cb5325a6f2",
        "name": "Sticky Note33",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1936,
          1024
        ],
        "parameters": {
          "color": 2,
          "width": 272,
          "height": 384,
          "content": "## üí° *ESTE FLUJO PERMITE RECOPILAR COMENTARIOS DE LOS USUARIOS Y ALMACENARLOS DE FORMA AUTOM√ÅTICA, MEJORANDO EL SEGUIMIENTO DE LA SATISFACCI√ìN Y LAS MEJORAS DEL BOT.*"
        },
        "typeVersion": 1
      },
      {
        "id": "107e8fe1-081d-4541-a73e-d7aac4e11c11",
        "name": "Sticky Note34",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4208,
          2048
        ],
        "parameters": {
          "width": 4272,
          "height": 672,
          "content": ""
        },
        "typeVersion": 1
      },
      {
        "id": "ae2d015b-3691-459b-b4c8-2ad948c176ba",
        "name": "Sticky Note35",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2192,
          2064
        ],
        "parameters": {
          "width": 2224,
          "height": 608,
          "content": "#      ü§ñ **SISTEMA DE GENERACI√ìN DE MENSAJES AUTOM√ÅTICOS Y PERSONALIZADOS** üí¨\n"
        },
        "typeVersion": 1
      },
      {
        "id": "090a8f45-775a-45be-afe5-ada7e40f426c",
        "name": "Sticky Note36",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4160,
          2064
        ],
        "parameters": {
          "width": 1904,
          "height": 608,
          "content": "# üß† **CEREBRO DE LA GENERACI√ìN DE MENSAJES AUTOM√ÅTICOS Y PERSONALIZADOS**\n\n## ü§ñ ESTE FLUJO EN N8N FUNCIONA COMO UN ASISTENTE INTELIGENTE QUE ANALIZA LOS MENSAJES DEL USUARIO Y ENV√çA RESPUESTAS AUTOM√ÅTICAS Y PERSONALIZADAS üí¨‚ö°.\n\n# üìÖ 1.- CONSULTA DE CALENDARIO ACAD√âMICO:\n\n## - CUANDO EL USUARIO PREGUNTA SOBRE FECHAS O EVENTOS DEL CALENDARIO, EL SISTEMA BUSCA LA INFORMACI√ìN EN UNA HOJA DE C√ÅLCULO üìñ, CREA UN PROMPT üß© Y GENERA UNA RESPUESTA CLARA QUE LUEGO SE ENV√çA POR TELEGRAM üì≤.\n\n# üí° 2.- CONSULTA DE PREGUNTAS FRECUENTES (FAQ):\n\n## - SI EL MENSAJE DEL USUARIO ES UNA DUDA GENERAL, EL SISTEMA CONECTA CON LA BASE DE DATOS MONGODB üçÉ, IDENTIFICA LAS RESPUESTAS RELEVANTES üîç Y ENV√çA UN MENSAJE AUTOM√ÅTICO CON LA INFORMACI√ìN SOLICITADA üí¨‚ú®.\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "876d72d2-2dbc-44a8-a3f3-98b6fdece7a4",
        "name": "Sticky Note37",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1968,
          -192
        ],
        "parameters": {
          "width": 2032,
          "height": 496,
          "content": "# üîó ENLACES DEL BOT Y BASE DE DATOS\n\n# ü§ñ BOT DE TELEGRAM: \n\n# https://web.telegram.org/k/#@ESPOLInfoBot\n\n\n\n# üìÇ BASE DE DATOS EN SHEETS DE FAQ Y CALENDARIO: \n\n# https://docs.google.com/spreadsheets/d/1WWE-eLP0g5M9Q2CeGpQZat56OhJrQyeYZJShjtETCgo/edit?gid=0#gid=0"
        },
        "typeVersion": 1
      },
      {
        "id": "207caeb2-0dad-4a90-8cb7-f943663ecfc6",
        "name": "Code in JavaScript1",
        "type": "n8n-nodes-base.code",
        "position": [
          -3360,
          1664
        ],
        "parameters": {
          "jsCode": "const semanas = $input.all();\n\n// Inicializamos un objeto vac√≠o\nconst combinado = {};\n\n// Recorremos todas las semanas y sus claves\nfor (const semana of semanas) {\n  const datos = semana.json;\n  for (const [clave, valor] of Object.entries(datos)) {\n    if (!combinado[clave]) combinado[clave] = [];\n    if (valor !== undefined && valor !== null && valor !== \"\")\n      combinado[clave].push(String(valor).trim());\n  }\n}\n\n// Unimos los valores repetidos en un solo string, separados por comas\nfor (const clave of Object.keys(combinado)) {\n  combinado[clave] = [...new Set(combinado[clave])].join(\", \");\n}\n\n// Devolvemos un solo item con todo unido\nreturn [{ json: combinado }];\n"
        },
        "typeVersion": 2
      },
      {
        "id": "2760029c-b039-4aab-95bd-005caeead0b6",
        "name": "Split Out2",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -3504,
          1664
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "RESULTADOS[0].PERIODO_FECHAS, RESULTADOS[0].ACTIVIDADES_GRADO, RESULTADOS[0].PROCESOS_GRADO, RESULTADOS[0]['ACTIVIDADES DE FORMACI√ìN T√âCNICA Y TECNOL√ìGICA']"
        },
        "typeVersion": 1
      },
      {
        "id": "9dff1b64-2d74-4de5-8dee-cfcebfcd3977",
        "name": "ACTIVIDADES DE LA SEMANA1",
        "type": "n8n-nodes-base.code",
        "position": [
          -3664,
          1664
        ],
        "parameters": {
          "jsCode": "// üóìÔ∏è FECHA ACTUAL Y A√ëO\nconst hoy = new Date();\nconst anioActual = hoy.getFullYear();\n\n// ‚úÖ FUNCI√ìN PARA CALCULAR EL LUNES DE UNA SEMANA RELATIVA\nfunction obtenerLunes(base, desplazamientoSemanas = 0) {\n  const dia = base.getDay(); // 0=domingo, 1=lunes...\n  const lunes = new Date(base);\n  const diff = (1 - dia + 7) % 7; // hasta lunes\n  lunes.setDate(base.getDate() + diff + desplazamientoSemanas * 7);\n  return lunes;\n}\n\n// üìÜ CALCULAR LAS TRES SEMANAS CLAVE\nconst lunesSemanaAnterior = obtenerLunes(hoy, -1);\nconst lunesProximaSemana = obtenerLunes(hoy, 0);\nconst lunesSemanaPosterior = obtenerLunes(hoy, 1);\n\n// üß† FUNCI√ìN PARA INTERPRETAR RANGOS TIPO ‚Äú09 - 13 NOVIEMBRE‚Äù O ‚Äú9-13nov‚Äù\nfunction parsearRango(rango) {\n  if (!rango || typeof rango !== \"string\") return null;\n\n  rango = rango\n    .replace(/([0-9])([a-zA-Z√±√ë])/g, \"$1 $2\")\n    .replace(/\\s+/g, \" \")\n    .trim()\n    .toLowerCase();\n\n  const match = rango.match(/(\\d{1,2})\\s*-\\s*(\\d{1,2})\\s*([a-z√±]+)/);\n  if (!match) return null;\n\n  const [, inicioStr, finStr, mesStr] = match;\n  const inicio = parseInt(inicioStr);\n  const fin = parseInt(finStr);\n\n  const meses = {\n    ene: 0, enero: 0,\n    feb: 1, febrero: 1,\n    mar: 2, marzo: 2,\n    abr: 3, abril: 3,\n    may: 4, mayo: 4,\n    jun: 5, junio: 5,\n    jul: 6, julio: 6,\n    ago: 7, agosto: 7,\n    sep: 8, sept: 8, septiembre: 8,\n    oct: 9, octubre: 9,\n    nov: 10, noviembre: 10,\n    dic: 11, diciembre: 11\n  };\n\n  const mesNum = meses[mesStr];\n  if (mesNum === undefined) return null;\n\n  let anioRango = anioActual;\n  if (mesNum === 0 && hoy.getMonth() === 11) {\n    anioRango = anioActual + 1;\n  }\n\n  const inicioFecha = new Date(anioRango, mesNum, inicio);\n  const finFecha = new Date(anioRango, mesNum, fin);\n  return { inicio: inicioFecha, fin: finFecha };\n}\n\n// üîç FUNCI√ìN PARA BUSCAR COINCIDENCIA DE SEMANA\nfunction filtrarPorSemana(items, lunesReferencia) {\n  const resultados = [];\n  for (const item of items) {\n    const rango = parsearRango(item.json.PERIODO_FECHAS);\n    if (!rango) continue;\n\n    const mismoInicio =\n      rango.inicio.getFullYear() === lunesReferencia.getFullYear() &&\n      rango.inicio.getDate() === lunesReferencia.getDate() &&\n      rango.inicio.getMonth() === lunesReferencia.getMonth();\n\n    if (mismoInicio) resultados.push(item);\n  }\n  return resultados;\n}\n\n// üìä OBTENER RESULTADOS PARA CADA SEMANA\nconst resultadosAnterior = filtrarPorSemana(items, lunesSemanaAnterior);\nconst resultadosActual = filtrarPorSemana(items, lunesProximaSemana);\nconst resultadosPosterior = filtrarPorSemana(items, lunesSemanaPosterior);\n\n// üßπ CHAT_IDS V√ÅLIDOS (√öNICOS)\nconst chatIds = items\n  .map(item => item.json.CHAT_ID)\n  .filter(id => id !== undefined && id !== null && String(id).trim() !== \"\")\n  .map(id => String(id).trim());\n\nconst uniqueChatIds = [...new Set(chatIds)];\n\n// üèÅ SALIDA FINAL\nreturn [\n  {\n    json: {\n      SEMANA: \"ANTERIOR\",\n      LUNES_SEMANA: lunesSemanaAnterior.toISOString().split(\"T\")[0],\n      RESULTADOS: resultadosAnterior.map(i => i.json),\n      CHAT_IDS_VALIDOS: uniqueChatIds\n    }\n  },\n  {\n    json: {\n      SEMANA: \"ACTUAL / PR√ìXIMA\",\n      LUNES_SEMANA: lunesProximaSemana.toISOString().split(\"T\")[0],\n      RESULTADOS: resultadosActual.map(i => i.json),\n      CHAT_IDS_VALIDOS: uniqueChatIds\n    }\n  },\n  {\n    json: {\n      SEMANA: \"POSTERIOR\",\n      LUNES_SEMANA: lunesSemanaPosterior.toISOString().split(\"T\")[0],\n      RESULTADOS: resultadosPosterior.map(i => i.json),\n      CHAT_IDS_VALIDOS: uniqueChatIds\n    }\n  }\n];\n"
        },
        "typeVersion": 2
      },
      {
        "id": "03a100d6-1492-4834-a638-653ff0a235ca",
        "name": "ANUNCIO SEMANAL",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -4096,
          1680
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "weeks",
                "triggerAtHour": 19
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "af582ce7-df08-42dc-b4e6-e04bbc086c21",
        "name": "ACTUALIZAR CALENDARIO",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -3728,
          560
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "daysInterval": 7
              }
            ]
          }
        },
        "typeVersion": 1.2
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "1f231775-d723-4123-a5cf-9178e15e246d",
    "connections": {
      "HTML": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "GUIA DE COMO PREGUNTAR",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Respuesta Usuario1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Guardado en cvs Feedback",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Comandos1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Detector_Calendario_Pre",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "BD_ESPOL": {
        "ai_tool": [
          [
            {
              "node": "PREGUNTAS AL AZAR DE GUIA",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Comandos1": {
        "main": [
          [
            {
              "node": "Mensaje Help",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "FAQs",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Respuesta Contact",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Respuesta Events",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Inicio - Feedback",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "BIENVENIDA",
              "type": "main",
              "index": 0
            },
            {
              "node": "OBTENER_ID1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "CORRECTOR DE FECHAS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "BIENVENIDA": {
        "main": [
          [
            {
              "node": "PREGUNTAS AL AZAR DE GUIA",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get a chat": {
        "main": [
          [
            {
              "node": "S√≠ - Agradecimiento1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SCRRAPPING": {
        "main": [
          [
            {
              "node": "HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out2": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OBTENER_ID1": {
        "main": [
          [
            {
              "node": "AGREGA ID_UNICAS1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OPTIMIZADOR": {
        "main": [
          [
            {
              "node": "ENVIO DE MENSAJE DE TEXTO1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OPTIMIZADOR1": {
        "main": [
          [
            {
              "node": "ENVIO DE MENSAJE DE VOZ1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "BD_CALENDARIO1": {
        "main": [
          [
            {
              "node": "ACTIVIDADES DE LA SEMANA1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ANUNCIO SEMANAL": {
        "main": [
          [
            {
              "node": "BD_CALENDARIO1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Message a model1": {
        "main": [
          [
            {
              "node": "Limpiar_Texto_Gemini1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Inicio - Feedback": {
        "main": [
          []
        ]
      },
      "Mensaje de Gemini": {
        "main": [
          [
            {
              "node": "Limpiar texto Gemini",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respuesta Usuario1": {
        "main": [
          [
            {
              "node": "Get a chat",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No - Mensaje Feedback1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch_Que_BD_Leer": {
        "main": [
          [
            {
              "node": "Calendario Acad√©mico",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Leer FAQs de MongoDB",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CORRECTOR DE FECHAS": {
        "main": [
          [
            {
              "node": "BD-CALENDARIO",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "GENERADOR DE ANUNCIOS1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Leer FAQs de MongoDB": {
        "main": [
          [
            {
              "node": "Buscar_FAQs_Relevantes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpiar texto Gemini": {
        "main": [
          [
            {
              "node": "Enviar Respuesta sobre faqs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ACTUALIZAR CALENDARIO": {
        "main": [
          [
            {
              "node": "SCRRAPPING",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calendario Acad√©mico": {
        "main": [
          [
            {
              "node": "Buscar_Eventos_Calendario1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpiar_Texto_Gemini1": {
        "main": [
          [
            {
              "node": "Enviar Respuesta sobre calendario1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Buscar_FAQs_Relevantes": {
        "main": [
          [
            {
              "node": "Construir_Prompt_Gemini1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GENERADOR DE ANUNCIOS1": {
        "main": [
          [
            {
              "node": "OPTIMIZADOR",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "No - Mensaje Feedback1": {
        "main": [
          []
        ]
      },
      "Detector_Calendario_Pre": {
        "main": [
          [
            {
              "node": "Switch_Que_BD_Leer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Construir_Prompt_Gemini1": {
        "main": [
          [
            {
              "node": "Mensaje de Gemini",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "PREGUNTAS AL AZAR DE GUIA",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Guardado en cvs Feedback": {
        "main": [
          []
        ]
      },
      "ACTIVIDADES DE LA SEMANA1": {
        "main": [
          [
            {
              "node": "Split Out2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "GENERADOR DE ANUNCIOS1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "PREGUNTAS AL AZAR DE GUIA": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Telegram Trigger - Inicio": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Buscar_Eventos_Calendario1": {
        "main": [
          [
            {
              "node": "Construir_Prompt_Calendario1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Enviar Respuesta sobre faqs": {
        "main": [
          []
        ]
      },
      "GENERADOR DE MENSAJE DE VOZ": {
        "main": [
          [
            {
              "node": "OPTIMIZADOR1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Construir_Prompt_Calendario1": {
        "main": [
          [
            {
              "node": "Message a model1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": 3,
    "name": "Orlen",
    "nodes": [
      {
        "name": "On clicking 'execute'",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          240,
          300
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "name": "Current date",
        "type": "n8n-nodes-base.function",
        "position": [
          1160,
          960
        ],
        "parameters": {
          "functionCode": "var today = new Date();\nvar year = today.getFullYear();\nvar month = today.getMonth() + 1;\nvar day = today.getDate();\n\nif(month < 10) {\n  month = \"0\" + month;\n}\n\nitems[0].json.year = year;\nitems[0].json.month = month;\nitems[0].json.day = day;\n\nreturn items;"
        },
        "typeVersion": 1
      },
      {
        "name": "Every 23:45",
        "type": "n8n-nodes-base.cron",
        "position": [
          960,
          960
        ],
        "parameters": {
          "triggerTimes": {
            "item": [
              {
                "hour": 23,
                "minute": 45
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "name": "Get Year folder",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1360,
          960
        ],
        "parameters": {
          "options": {
            "fields": [
              "id"
            ]
          },
          "operation": "list",
          "queryFilters": {
            "name": [
              {
                "value": "={{$json[\"year\"]}}",
                "operation": "is"
              }
            ],
            "mimeType": [
              {
                "mimeType": "application/vnd.google-apps.folder"
              }
            ]
          },
          "authentication": "oAuth2"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "7",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 1
      },
      {
        "name": "Get Month folder",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1560,
          960
        ],
        "parameters": {
          "options": {
            "fields": [
              "id"
            ]
          },
          "operation": "list",
          "queryString": "='{{$json[\"id\"]}}' in parents and name = '{{$node[\"Current date\"].json[\"month\"]}}'",
          "authentication": "oAuth2",
          "useQueryString": true
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "7",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 1
      },
      {
        "name": "Orlen Invoice",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1760,
          960
        ],
        "parameters": {
          "resource": "message",
          "operation": "getAll",
          "returnAll": true,
          "additionalFields": {
            "q": "from:(orlenpay@orlen.pl) has:attachment is:unread",
            "format": "resolved"
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "5",
            "name": "dbarwikowski Gmail account"
          }
        },
        "typeVersion": 1
      },
      {
        "name": "Upload Invoice to Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1960,
          960
        ],
        "parameters": {
          "name": "=Orlen {{$binary.attachment_0.directory}}.{{$binary.attachment_0.fileExtension}}",
          "options": {},
          "parents": [
            "={{$node[\"Get Month folder\"].json[\"id\"]}}"
          ],
          "binaryData": true,
          "resolveData": true,
          "authentication": "oAuth2",
          "binaryPropertyName": "attachment_0"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "7",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 1
      },
      {
        "name": "Mark as Read",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2160,
          960
        ],
        "parameters": {
          "labelIds": [
            "UNREAD"
          ],
          "resource": "messageLabel",
          "messageId": "={{$node[\"Orlen Invoice\"].json[\"id\"]}}",
          "operation": "remove"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "5",
            "name": "dbarwikowski Gmail account"
          }
        },
        "typeVersion": 1
      },
      {
        "name": "Merge",
        "type": "n8n-nodes-base.merge",
        "position": [
          2280,
          960
        ],
        "parameters": {
          "mode": "mergeByIndex"
        },
        "typeVersion": 1
      },
      {
        "name": "Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          860,
          540
        ],
        "parameters": {
          "text": "=Kapitanie!\nDodano fakturƒô {{$node[\"Orlen Invoice\"].binary.attachment_0.directory}} do Firma/{{$node[\"Current date\"].json[\"year\"]}}/{{$node[\"Current date\"].json[\"month\"]}}",
          "channel": "n8n",
          "attachments": [],
          "otherOptions": {},
          "authentication": "oAuth2"
        },
        "credentials": {
          "slackOAuth2Api": {
            "id": "6",
            "name": "Slack account"
          }
        },
        "typeVersion": 1
      }
    ],
    "active": true,
    "settings": {
      "timezone": "Europe/Warsaw",
      "saveExecutionProgress": "DEFAULT"
    },
    "createdAt": "2022-04-11T17:11:34.040Z",
    "updatedAt": "2022-04-11T21:59:45.898Z",
    "staticData": null,
    "connections": {
      "Merge": {
        "main": [
          [
            {
              "node": "Upload Invoice to Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Every 23:45": {
        "main": [
          [
            {
              "node": "Orlen Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Current date": {
        "main": [
          [
            {
              "node": "Get Year folder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mark as Read": {
        "main": [
          [
            {
              "node": "Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Orlen Invoice": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Get Year folder": {
        "main": [
          [
            {
              "node": "Get Month folder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Month folder": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On clicking 'execute'": {
        "main": [
          [
            {
              "node": "Orlen Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Invoice to Google Drive": {
        "main": [
          [
            {
              "node": "Mark as Read",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "abc123",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "c8481fc0-4cc2-4662-b008-e81eaeb4840b",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -340,
          0
        ],
        "parameters": {
          "simple": false,
          "filters": {
            "sender": "ray.thomas@charter.com",
            "readStatus": "unread"
          },
          "options": {
            "downloadAttachments": true,
            "dataPropertyAttachmentsPrefixName": "attachment_"
          },
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "egorWvqjkdIG2ovh",
            "name": "Gmail account - rthomascharter"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "fd82d244-dfab-46db-af8e-e674501db75d",
        "name": "Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          540,
          0
        ],
        "parameters": {
          "name": "={{ $binary.values()[0].fileName }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "0BwqhgrfUUaOuM2x1NXhxLUlGVEE",
            "cachedResultUrl": "https://drive.google.com/drive/folders/0BwqhgrfUUaOuM2x1NXhxLUlGVEE?resourcekey=0-fQoeO57wF_vlzIWPZAoNXg",
            "cachedResultName": "misc"
          },
          "inputDataFieldName": "={{ $binary.keys()[0] }}"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "fwkvLJni8GfLNqBZ",
            "name": "Google Drive account - rthomascharter"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "5686e523-e12c-41b1-818d-03545122ad6f",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -120,
          0
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "$binary"
        },
        "typeVersion": 1
      },
      {
        "id": "1774a0d8-2909-49e4-b0f7-1c3e343602b1",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          420,
          -360
        ],
        "parameters": {
          "width": 380,
          "height": 820,
          "content": "## Reference \"Single\" Binary Using Expressions\nThis contains examples of how to reference a single binary in each input item **regardless of its key name.**"
        },
        "typeVersion": 1
      },
      {
        "id": "204fe711-c5f3-4243-be3b-829419a07c82",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "position": [
          100,
          0
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "Large Files",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "operator": {
                        "type": "number",
                        "operation": "gt"
                      },
                      "leftValue": "={{ $binary.values()[0].fileSize.split(' ')[0].toNumber() }}",
                      "rightValue": 300
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "Medium Files",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "27a59343-5f2a-43b0-a74d-ddb0a988c0cb",
                      "operator": {
                        "type": "number",
                        "operation": "gt"
                      },
                      "leftValue": "={{ $binary.values()[0].fileSize.split(' ')[0].toNumber() }}",
                      "rightValue": 10
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "typeVersion": 3.2
      },
      {
        "id": "1e00cb68-fed2-4f88-be84-4860c26c8a3b",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -200,
          -240
        ],
        "parameters": {
          "width": 260,
          "height": 460,
          "content": "## Split Multiple Binary Files\nThis uses the `$binary` name (not expression var) to make individual items for each attachment binary.\n* Note: This still doesn't homogenize the name of each binary."
        },
        "typeVersion": 1
      },
      {
        "id": "1089eb84-51d3-4669-8a5a-fd1d0855ca41",
        "name": "Send \" Too Big\" Notification (for example)",
        "type": "n8n-nodes-base.noOp",
        "position": [
          540,
          -200
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "29c83742-72b6-40ec-a5fc-aab5ef1d5149",
        "name": "Ignore Little Graphics / Icons (for example)",
        "type": "n8n-nodes-base.noOp",
        "position": [
          540,
          220
        ],
        "parameters": {},
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Switch": {
        "main": [
          [
            {
              "node": "Send \" Too Big\" Notification (for example)",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Google Drive",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Ignore Little Graphics / Icons (for example)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "9nBQ1BfwxLhuzTcK",
    "meta": {
      "instanceId": "3378b0d68c3b7ebfc71b79896d94e1a044dec38e99a1160aed4e9c323910fbe2"
    },
    "name": "google drive to instagram, tiktok and youtube",
    "tags": [],
    "nodes": [
      {
        "id": "b6c1d2f5-a8de-42dc-a164-3b1e80b2f19d",
        "name": "Google Drive Trigger",
        "type": "n8n-nodes-base.googleDriveTrigger",
        "position": [
          220,
          320
        ],
        "parameters": {
          "event": "fileCreated",
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "triggerOn": "specificFolder",
          "folderToWatch": {
            "__rl": true,
            "mode": "list",
            "value": "18m0i341QLQuyWuHv_FBdz8-r-QDtofYm",
            "cachedResultUrl": "https://drive.google.com/drive/folders/18m0i341QLQuyWuHv_FBdz8-r-QDtofYm",
            "cachedResultName": "Influencersde"
          }
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "2TbhWtnbRfSloGxX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "1dda484a-f6f5-4677-85a3-09b2a47e69c4",
        "name": "Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          400,
          320
        ],
        "parameters": {
          "fileId": {
            "__rl": true,
            "mode": "",
            "value": "={{ $json.id || $json.data[0].id }}"
          },
          "options": {},
          "operation": "download",
          "authentication": "oAuth2"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "2TbhWtnbRfSloGxX",
            "name": "Google Drive account"
          }
        },
        "retryOnFail": true,
        "typeVersion": 1,
        "waitBetweenTries": 5000
      },
      {
        "id": "f9388923-b20e-40f0-ba10-fd00b463b1a7",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "position": [
          620,
          660
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "eda45ad6-d976-4665-9b6d-dae4c3212191",
        "name": "Telegram",
        "type": "n8n-nodes-base.telegram",
        "position": [
          960,
          640
        ],
        "webhookId": "f6729386-9905-45f1-800f-4fe01a06ac9c",
        "parameters": {
          "text": "=üîî ERROR SUBIENDO VIDEOS",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "retryOnFail": true,
        "typeVersion": 1.2,
        "waitBetweenTries": 5000
      },
      {
        "id": "7b1d6015-49b8-423c-be64-e905ff791574",
        "name": "If",
        "type": "n8n-nodes-base.if",
        "position": [
          760,
          660
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 1,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "9fadb3fd-2547-42bd-8f40-f410a97dcf57",
                "operator": {
                  "type": "string",
                  "operation": "notContains"
                },
                "leftValue": "={{ $json.trigger.error.message }}",
                "rightValue": "The DNS server returned an error, perhaps the server is offline"
              }
            ]
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "6e9882aa-b11f-4c1a-8600-eedda9d92046",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -220,
          0
        ],
        "parameters": {
          "width": 860,
          "height": 260,
          "content": "## Description\nThis automation allows you to upload a video to a configured Google Drive folder, and it will automatically create descriptions and upload it to Instagram and TikTok.\n\n## How to Use\n1. Generate an API token at upload-post.com and add to Upload to Tiktok and Upload to Instagram nodes\n2. Configure your Google Drive folder\n3. Customize the OpenAI prompt for your specific use case\n4. Optional: Configure Telegram for error notifications\n\n## Requirements\n- upload-post.com account\n- Google Drive account\n- OpenAI API key\n"
        },
        "typeVersion": 1
      },
      {
        "id": "b3eed1dc-8273-4593-ab07-8860fffa0907",
        "name": "Get Audio from Video",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "notes": "Extract the audio from video for generate the description",
        "position": [
          860,
          320
        ],
        "parameters": {
          "options": {},
          "resource": "audio",
          "operation": "transcribe"
        },
        "credentials": {
          "openAiApi": {
            "id": "XJdxgMSXFgwReSsh",
            "name": "n8n key"
          }
        },
        "notesInFlow": true,
        "retryOnFail": true,
        "typeVersion": 1,
        "waitBetweenTries": 5000
      },
      {
        "id": "b057fea0-087e-4c7f-b5ac-6d16ca658437",
        "name": "Read video from Google Drive",
        "type": "n8n-nodes-base.writeBinaryFile",
        "position": [
          580,
          320
        ],
        "parameters": {
          "options": {},
          "fileName": "={{ $json.originalFilename.replaceAll(\" \", \"_\") }}"
        },
        "typeVersion": 1
      },
      {
        "id": "f9296b8f-b631-4df4-b8b5-aa7139dd65cd",
        "name": "Generate Description for Videos  in Tiktok and Instagram",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "notes": "Request to OpenAi for generate description with the audio extracted from the video",
        "position": [
          1060,
          320
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o",
            "cachedResultName": "GPT-4O"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an expert assistant in creating engaging social media video titles."
              },
              {
                "content": "=I'm going to upload a video to social media. Here are some examples of descriptions that have worked well on Instagram:\n\nFollow and save for later. Discover InfluencersDe, the AI tool that automates TikTok creation and publishing to drive traffic to your website. Perfect for entrepreneurs and brands.\n#digitalmarketing #ugc #tiktok #ai #influencersde #contentcreation\n\nDiscover the video marketing revolution with InfluencersDe!\n.\n.\n.\n#socialmedia #videomarketing #ai #tiktok #influencersde #growthhacking\n\nDon't miss InfluencersDe, the tool that transforms your marketing strategy with just one click!\n.\n.\n.\n#ugc #ai #tiktok #digitalmarketing #influencersde #branding\n\nCan you create another title for the Instagram post based on this recognized audio from the video?\n\nAudio: {{ $('Get Audio from Video').item.json.text }}\n\nIMPORTANT: Reply only with the description, don't add anything else."
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "XJdxgMSXFgwReSsh",
            "name": "n8n key"
          }
        },
        "notesInFlow": true,
        "retryOnFail": true,
        "typeVersion": 1.4,
        "waitBetweenTries": 5000
      },
      {
        "id": "e80758fd-5532-48b0-b663-085629137fc0",
        "name": "Read Video from Google Drive",
        "type": "n8n-nodes-base.readBinaryFile",
        "position": [
          1620,
          100
        ],
        "parameters": {
          "filePath": "={{ $('Read video from Google Drive').item.json.originalFilename.replaceAll(\" \", \"_\") }}",
          "dataPropertyName": "datavideo"
        },
        "typeVersion": 1
      },
      {
        "id": "8f13c601-4282-4a44-8e8a-dc88e4165ee4",
        "name": "Read Video from Google Drive2",
        "type": "n8n-nodes-base.readBinaryFile",
        "position": [
          1620,
          400
        ],
        "parameters": {
          "filePath": "={{ $('Read video from Google Drive').item.json.originalFilename.replaceAll(\" \", \"_\") }}",
          "dataPropertyName": "datavideo"
        },
        "typeVersion": 1
      },
      {
        "id": "1b46976e-be37-49bd-b77b-e48d8e619954",
        "name": "Upload Video and Description to Tiktok",
        "type": "n8n-nodes-base.httpRequest",
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)",
        "position": [
          1880,
          100
        ],
        "parameters": {
          "url": "https://api.upload-post.com/api/upload",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "multipart-form-data",
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\") }}"
              },
              {
                "name": "platform[]",
                "value": "tiktok"
              },
              {
                "name": "video",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "datavideo"
              },
              {
                "name": "user",
                "value": "Add user generated in upload-post"
              }
            ]
          },
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "WNjAx7UqrEZ1JDrR",
            "name": "VituManco"
          }
        },
        "notesInFlow": true,
        "typeVersion": 4.2
      },
      {
        "id": "0404a57f-2c1a-4ccd-90df-893dd01acaa0",
        "name": "Upload Video and Description to Instagram",
        "type": "n8n-nodes-base.httpRequest",
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)",
        "position": [
          1880,
          400
        ],
        "parameters": {
          "url": "https://api.upload-post.com/api/upload",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "multipart-form-data",
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\") }}"
              },
              {
                "name": "platform[]",
                "value": "instagram"
              },
              {
                "name": "video",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "datavideo"
              },
              {
                "name": "user",
                "value": "Add user generated in upload-post"
              }
            ]
          },
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Header Auth account"
          }
        },
        "notesInFlow": true,
        "typeVersion": 4.2
      },
      {
        "id": "358da7b7-2d0a-475b-a10d-ffc499b5e99d",
        "name": "Read Video from Google Drive3",
        "type": "n8n-nodes-base.readBinaryFile",
        "position": [
          1620,
          660
        ],
        "parameters": {
          "filePath": "={{ $('Read video from Google Drive').item.json.originalFilename.replaceAll(\" \", \"_\") }}",
          "dataPropertyName": "datavideo"
        },
        "typeVersion": 1
      },
      {
        "id": "0e46ee9b-e466-4a5d-8916-3836eed4fc2d",
        "name": "Upload Video and Description to Youtube",
        "type": "n8n-nodes-base.httpRequest",
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)",
        "position": [
          1880,
          660
        ],
        "parameters": {
          "url": "https://api.upload-post.com/api/upload",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "multipart-form-data",
          "authentication": "genericCredentialType",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\").substring(0, 70) }}\n"
              },
              {
                "name": "platform[]",
                "value": "youtube"
              },
              {
                "name": "video",
                "parameterType": "formBinaryData",
                "inputDataFieldName": "datavideo"
              },
              {
                "name": "user",
                "value": "test2"
              }
            ]
          },
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "47dO31ED0WIaJkR6",
            "name": "Header Auth account"
          }
        },
        "notesInFlow": true,
        "typeVersion": 4.2
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "13975e04-a6c4-42d0-887c-e6c4ff219f42",
    "connections": {
      "If": {
        "main": [
          [
            {
              "node": "Telegram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Drive": {
        "main": [
          [
            {
              "node": "Read video from Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Audio from Video": {
        "main": [
          [
            {
              "node": "Generate Description for Videos  in Tiktok and Instagram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Drive Trigger": {
        "main": [
          [
            {
              "node": "Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Video from Google Drive": {
        "main": [
          [
            {
              "node": "Upload Video and Description to Tiktok",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read video from Google Drive": {
        "main": [
          [
            {
              "node": "Get Audio from Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Video from Google Drive2": {
        "main": [
          [
            {
              "node": "Upload Video and Description to Instagram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Video from Google Drive3": {
        "main": [
          [
            {
              "node": "Upload Video and Description to Youtube",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Description for Videos  in Tiktok and Instagram": {
        "main": [
          [
            {
              "node": "Read Video from Google Drive",
              "type": "main",
              "index": 0
            },
            {
              "node": "Read Video from Google Drive2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Read Video from Google Drive3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "CNOMivCLJRGfZnUM",
    "meta": {
      "instanceId": "31e69f7f4a77bf465b805824e303232f0227212ae922d12133a0f96ffeab4fef",
      "templateCredsSetupCompleted": true
    },
    "name": "ü¶ú‚ú®Use OpenAI to Transcribe Audio + Summarize with AI + Save to Google Drive",
    "tags": [],
    "nodes": [
      {
        "id": "3918995a-a587-40c1-828c-97e75b988a9f",
        "name": "Gmail User for Approval",
        "type": "n8n-nodes-base.gmail",
        "disabled": true,
        "position": [
          360,
          -20
        ],
        "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e",
        "parameters": {
          "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ",
          "message": "=A new was just created in the Audio Recordings folder on Google Drive.  Would you like to continue the workflow and Transcribe the audio file and generate reports.",
          "options": {
            "limitWaitTime": {
              "values": {
                "resumeUnit": "minutes",
                "resumeAmount": 45
              }
            }
          },
          "subject": "=üí°New Audio File Created - Approve Transcription Service",
          "operation": "sendAndWait",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "1xpVDEQ1yx8gV022",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "44aa6e99-9b4a-4af4-93e3-4b1a50fc7628",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -320,
          680
        ],
        "parameters": {
          "color": 3,
          "width": 260,
          "height": 280,
          "content": "## 3Ô∏è‚É£ Transcribe Audio"
        },
        "typeVersion": 1
      },
      {
        "id": "cbf765b5-b888-4e22-b4a2-1d430b557109",
        "name": "Set Config",
        "type": "n8n-nodes-base.set",
        "position": [
          0,
          780
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "2f5cef95-a26b-46ff-ab9a-501187ce4211",
                "name": "text",
                "type": "string",
                "value": "={{ $json.text }}"
              },
              {
                "id": "ac623698-1263-4b83-8c59-159863d950b9",
                "name": "datetime",
                "type": "string",
                "value": "={{ $now }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "bd9cd4aa-6afc-4875-a487-df4f0d3a4a29",
        "name": "Transcribe with OpenAI",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          -240,
          780
        ],
        "parameters": {
          "options": {},
          "resource": "audio",
          "operation": "transcribe"
        },
        "credentials": {
          "openAiApi": {
            "id": "jEMSvKmtYfzAkhe6",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "4d91f6f7-a89e-44d9-9433-4d9a1df368a2",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          180,
          580
        ],
        "parameters": {
          "color": 5,
          "width": 1560,
          "height": 280,
          "content": "## 4Ô∏è‚É£ Process Transcript and Generate Structured JSON Report"
        },
        "typeVersion": 1
      },
      {
        "id": "64421d13-0aff-46f8-bf3e-5fac89ec9c46",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          180,
          900
        ],
        "parameters": {
          "color": 6,
          "width": 1560,
          "height": 280,
          "content": "## 5Ô∏è‚É£ Process Transcript and Generate Structured JSON -> Markdown Report"
        },
        "typeVersion": 1
      },
      {
        "id": "769ca5a4-2a54-4ed8-85af-4359b97755bc",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1000,
          1220
        ],
        "parameters": {
          "color": 2,
          "width": 460,
          "height": 280,
          "content": "## 6Ô∏è‚É£ Save Raw Transcript to Google Drive"
        },
        "typeVersion": 1
      },
      {
        "id": "aa612f37-f7cd-4cf7-919c-87564f03eef1",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -100,
          240
        ],
        "parameters": {
          "color": 4,
          "width": 300,
          "height": 300,
          "content": "## 1Ô∏è‚É£ Start Transcription Service"
        },
        "typeVersion": 1
      },
      {
        "id": "1e520267-6275-4d07-bba8-9ebaf0afbc68",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -100,
          -140
        ],
        "parameters": {
          "width": 700,
          "height": 340,
          "content": "## Wait for Google Drive Trigger and Send for User Approval to Proceed (Human in the Loop)\n(optional)"
        },
        "typeVersion": 1
      },
      {
        "id": "1f07fa9c-ecfc-4534-a0b2-569eca1a3092",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          680,
          240
        ],
        "parameters": {
          "color": 2,
          "width": 880,
          "height": 300,
          "content": "## 2Ô∏è‚É£ Search and Download Audio File from Google Drive\nüí°Note:  Adjust Filter and Limit settings for your needs"
        },
        "typeVersion": 1
      },
      {
        "id": "b769d523-6b1f-45f2-98b1-4d0f8eb2d7f4",
        "name": "Filter by .m4a extension",
        "type": "n8n-nodes-base.filter",
        "position": [
          980,
          340
        ],
        "parameters": {
          "options": {
            "ignoreCase": true
          },
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": false,
              "typeValidation": "loose"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "420e1a9c-2145-4845-b4b0-31a82855a78c",
                "operator": {
                  "type": "string",
                  "operation": "endsWith"
                },
                "leftValue": "={{ $json.name }}",
                "rightValue": ".m4a"
              }
            ]
          },
          "looseTypeValidation": true
        },
        "typeVersion": 2.2
      },
      {
        "id": "5a67182e-4f13-4b6f-a3e2-863e18af31b0",
        "name": "Limit to last file",
        "type": "n8n-nodes-base.limit",
        "position": [
          1180,
          340
        ],
        "parameters": {
          "keep": "lastItems"
        },
        "typeVersion": 1
      },
      {
        "id": "f42b4efc-6e04-49a1-8bd8-252ebd3dbf42",
        "name": "Download audio file",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1380,
          340
        ],
        "parameters": {
          "fileId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.id }}"
          },
          "options": {},
          "operation": "download"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "4313e19f-ca7a-4982-b3b4-1680c674e696",
        "name": "Search Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          780,
          340
        ],
        "parameters": {
          "filter": {
            "folderId": {
              "__rl": true,
              "mode": "list",
              "value": "1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
              "cachedResultUrl": "https://drive.google.com/drive/folders/1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
              "cachedResultName": "Audio Recordings"
            },
            "whatToSearch": "files"
          },
          "options": {},
          "resource": "fileFolder"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "e25655b0-9d30-40d4-9051-bffe38fb41e0",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2020,
          700
        ],
        "parameters": {
          "width": 660,
          "height": 480,
          "content": "## 7Ô∏è‚É£ Send Transcription Report Links to User"
        },
        "typeVersion": 1
      },
      {
        "id": "38ff9906-41af-430a-9de9-0500577826a5",
        "name": "Send Telegram Message",
        "type": "n8n-nodes-base.telegram",
        "position": [
          2460,
          980
        ],
        "webhookId": "bb40ede7-03cf-493d-b051-196b96725925",
        "parameters": {
          "text": "=Audio Transcribed and Reports Generated\n{{ $json.id_json.webViewLink }}\n{{ $json.id_markdown.webViewLink }}",
          "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
          "additionalFields": {
            "parse_mode": "HTML",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "pAIFhguJlkO3c7aQ",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "5b6aedaa-897f-4b76-84d8-3ca18d06cc5c",
        "name": "Send Gmail Message",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2460,
          800
        ],
        "webhookId": "0a81b95a-cd82-465d-8450-cf38518a4cbb",
        "parameters": {
          "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ",
          "message": "={{ $json.message.content }}",
          "options": {
            "appendAttribution": false
          },
          "subject": "Audio Transcribed and Reports Generated"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "1xpVDEQ1yx8gV022",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "4500efdb-7a70-40da-97b6-e4668af21a19",
        "name": "Email Content Formatter",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2100,
          800
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Prapare this HTML template using the following: \n{{ $json.id_json.toJsonString() }}\n{{ $json.id_markdown.toJsonString() }}\n\nEnsure that the 'webViewLink' is always provided.\n\nRespond only with HTML and avoid any preamble or further explanation.  Remove all ``` or ```html from final response.\n\n<style type=\"text/css\">\n    /* Reset styles */\n    body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }\n    .wrapper { max-width: 600px; margin: 0 auto; }\n    .content { padding: 30px; line-height: 1.6; color: #333333; }\n    .divider { border-top: 1px solid #eeeeee; margin: 25px 0; }\n    .button { display: inline-block; padding: 12px 24px; background-color: #2563eb; color: white; text-decoration: none; border-radius: 6px; }\n</style>\n</head>\n<body>\n    <div class=\"wrapper\">\n        <div class=\"content\">\n            <h2 style=\"color: #1f2937; margin-bottom: 20px;\">Your Documents</h2>\n            \n            <div style=\"margin-bottom: 30px;\">\n                <h3 style=\"color: #374151; margin-bottom: 12px;\">[name]</h3>\n                <a href=\"[webViewLink]\" class=\"button\" style=\"color: white;\">View Document</a>\n            </div>\n\n            <div class=\"divider\"></div>\n\n            [continue the pattern ...]\n\n        </div>\n    </div>\n</body>"
              },
              {
                "role": "system"
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "jEMSvKmtYfzAkhe6",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "287fcc26-69be-43d8-a855-c57658e92ac4",
        "name": "Summarize to Structured JSON",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          240,
          660
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=\"Today is \" {{ $now }}  \"Transcript: \" {{  $json.text }}"
              },
              {
                "role": "system",
                "content": "## ROLE\nYou are an expert at summarizing long transcripts.\n\n## TASK\nSummarize the provided transcript into a structured JSON format.\n\n## RULES\nReturn only valid JSON in this example format:\n\"transcript_report\": {\n\"title\": \"Notion Buttons\",\n\"summary\": \"A collection of buttons for Notion\",\n\"main_points\": [\"item 1\", \"item 2\", \"item 3\"],\n\"action_items\": [\"item 1\", \"item 2\", \"item 3\"],\n\"follow_up\": [\"item 1\", \"item 2\", \"item 3\"],\n\"stories\": [\"item 1\", \"item 2\", \"item 3\"],\n\"references\": [\"item 1\", \"item 2\", \"item 3\"],\n\"arguments\": [\"item 1\", \"item 2\", \"item 3\"],\n\"related_topics\": [\"item 1\", \"item 2\", \"item 3\"],\n\"sentiment\": \"positive\"\n}"
              }
            ]
          },
          "jsonOutput": true
        },
        "credentials": {
          "openAiApi": {
            "id": "jEMSvKmtYfzAkhe6",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7b5b751f-a7fa-4983-a0e4-1a79e5c4286c",
        "name": "Summarize to JSON",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          240,
          980
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Transcript: {{  $json.text }}"
              },
              {
                "role": "system",
                "content": "=## ROLE: Expert Transcript Analyst\n**Current Date:** {{ $now }}\n**Specialization:** Technical documentation, executive reporting, and information architecture\n\n\n## TASK: Create Structured Transcript Summary\nTransform verbose transcripts into well-organized technical documents using this 3-step process:\n1. Extract key information\n2. Identify natural thematic groupings\n3. Structure for optimal scannability\n\n\n## FORMAT REQUIREMENTS\n[Document Title] - {{ $now }}\n\nExecutive Summary (3-5 sentences)\n- Core purpose of discussion\n- Key decision points\n- Actionable outcomes\n\nDetailed Analysis\n[Topic 1: Clear Section Name]\n- Key statements\n- Supporting data points\n- Action items\n\n[Topic 2: Specific Category]\n-Decision rationale\n-Contradictions/agreements\n-Follow-up requirements\n\n(...continue pattern...)\n\nAdditional Observations\n- Unresolved questions\n- Technical terminology glossary\n- Participant sentiment trends\n\n\n## RULES\n1. **Content Fidelity**\n   - Never add external knowledge\n   - Preserve quantitative data exactly\n   - Maintain speaker intent through paraphrasing\n\n2. **Structural Requirements**\n   - Use H2/H3 headers only\n   - Apply consistent tense (prefer present)\n   - Include timestamps for critical points [00:00]\n\n3. **Style Guidelines**\n   - Technical > conversational tone\n   - Active voice required\n   - Bullet points for lists\n   - **Bold** key decisions\n\n4. **Validation**\n   - Self-check for topic overlap\n   - Verify chronological accuracy\n   - Confirm all action items are highlighted"
              }
            ]
          },
          "jsonOutput": true
        },
        "credentials": {
          "openAiApi": {
            "id": "jEMSvKmtYfzAkhe6",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "e92d8de3-8287-4ecd-9ca6-6f8d18b8942e",
        "name": "Convert JSON to Markdown",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          620,
          980
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Today is: {{ $now }}\nTranscript: {{ $json.message.content.toJsonString() }}"
              },
              {
                "role": "system",
                "content": "Convert this transcript summary to a markdown document.  Only respond with text and remove all ``` or ```markdown."
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "jEMSvKmtYfzAkhe6",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "419e050f-3a9b-4fc0-99f2-2e478f080e06",
        "name": "Get Filename for JSON",
        "type": "n8n-nodes-base.set",
        "position": [
          980,
          660
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "a0c31c80-87c9-41e5-ae07-8639bf52870c",
                "name": "filename",
                "type": "string",
                "value": "={{ $('Download audio file').item.json.id }}-{{ $('Download audio file').item.json.name }}-{{ $('Set Config').item.json.datetime }}.json"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "1307431e-80ea-404c-925f-d3ad5bdaa27c",
        "name": "Get Filename for Markdown",
        "type": "n8n-nodes-base.set",
        "position": [
          980,
          980
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "a0c31c80-87c9-41e5-ae07-8639bf52870c",
                "name": "filename",
                "type": "string",
                "value": "={{ $('Download audio file').item.json.id }} - {{ $('Download audio file').item.json.name }}- {{ $('Set Config').item.json.datetime }}.md"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "c87a9dcb-3edb-47ba-a059-6e7a6c63c287",
        "name": "Save JSON file to Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1180,
          660
        ],
        "parameters": {
          "name": "={{ $json.filename }}",
          "content": "={{ $('Summarize to Structured JSON').item.json.message.content.toJsonString() }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultName": "Audio Recordings"
          },
          "operation": "createFromText"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "2f0c30b5-1c99-4c06-9c1b-8a18033e6921",
        "name": "Save Markdown file to Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1180,
          980
        ],
        "parameters": {
          "name": "={{ $json.filename }}",
          "content": "={{ $('Convert JSON to Markdown').item.json.message.content }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultName": "Audio Recordings"
          },
          "operation": "createFromText"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "abc070ee-c276-410b-a3cf-a8504bf992a1",
        "name": "Get JSON File Meta",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1380,
          660
        ],
        "parameters": {
          "filter": {
            "whatToSearch": "files"
          },
          "options": {
            "fields": [
              "id",
              "webViewLink",
              "name"
            ]
          },
          "resource": "fileFolder",
          "queryString": "={{ $('Get Filename for JSON').item.json.filename }}"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "0961424a-f3a3-4469-962b-6b2a7affd66d",
        "name": "Get Markdown File Meta",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1380,
          980
        ],
        "parameters": {
          "filter": {
            "whatToSearch": "files"
          },
          "options": {
            "fields": [
              "id",
              "webViewLink",
              "name"
            ]
          },
          "resource": "fileFolder",
          "queryString": "={{ $('Get Filename for Markdown').item.json.filename }}"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "bddd4298-7570-48df-a16b-5352909f6530",
        "name": "Prepare Response JSON",
        "type": "n8n-nodes-base.set",
        "position": [
          1580,
          660
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "c89d0613-9b1e-4906-a4d2-ecc5fe585f5b",
                "name": "id_json",
                "type": "object",
                "value": "={{ $json }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "d3a77222-96ac-4d2e-a98c-b185524bebe0",
        "name": "Prepare Response Markdown",
        "type": "n8n-nodes-base.set",
        "position": [
          1580,
          980
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "9e23ce26-bdf5-46c8-9099-02179cd29fc5",
                "name": "id_markdown",
                "type": "object",
                "value": "={{ $json }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "41e6a279-426e-4fcd-ad6d-182fbc111d28",
        "name": "Merge All Paths",
        "type": "n8n-nodes-base.merge",
        "position": [
          1840,
          980
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "combineBy": "combineByPosition",
          "numberInputs": 3
        },
        "typeVersion": 3
      },
      {
        "id": "e2bb4ed5-f9cd-4807-950c-8f9a4bef1a24",
        "name": "Save Raw Transcript to Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          1180,
          1300
        ],
        "parameters": {
          "name": "={{ $('Download audio file').item.json.id }} - {{ $('Download audio file').item.json.name }}- {{ $('Set Config').item.json.datetime }}.txt",
          "content": "={{  $('Transcribe with OpenAI').item.json.text }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultName": "Audio Recordings"
          },
          "operation": "createFromText"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "fb2cced9-8c42-43de-b4a3-5dd66ddd24b3",
        "name": "Start Workflow",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          0,
          340
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "c2ef200f-4e45-42ba-a5f2-f7eb47df8f2f",
        "name": "On File Created Trigger",
        "type": "n8n-nodes-base.googleDriveTrigger",
        "disabled": true,
        "position": [
          0,
          -20
        ],
        "parameters": {
          "event": "fileCreated",
          "options": {
            "fileType": "application/vnd.google-apps.audio"
          },
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "triggerOn": "specificFolder",
          "folderToWatch": {
            "__rl": true,
            "mode": "list",
            "value": "1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1Wqd4zEEb847gFYKoDBbNnXsWEc-kCAm2",
            "cachedResultName": "Audio Recordings"
          }
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "a477e29e-d516-439c-ac41-16281dcca559",
    "connections": {
      "Set Config": {
        "main": [
          [
            {
              "node": "Summarize to JSON",
              "type": "main",
              "index": 0
            },
            {
              "node": "Summarize to Structured JSON",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Raw Transcript to Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start Workflow": {
        "main": [
          [
            {
              "node": "Search Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge All Paths": {
        "main": [
          [
            {
              "node": "Send Telegram Message",
              "type": "main",
              "index": 0
            },
            {
              "node": "Email Content Formatter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize to JSON": {
        "main": [
          [
            {
              "node": "Convert JSON to Markdown",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get JSON File Meta": {
        "main": [
          [
            {
              "node": "Prepare Response JSON",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limit to last file": {
        "main": [
          [
            {
              "node": "Download audio file",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download audio file": {
        "main": [
          [
            {
              "node": "Transcribe with OpenAI",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Search Google Drive": {
        "main": [
          [
            {
              "node": "Filter by .m4a extension",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Filename for JSON": {
        "main": [
          [
            {
              "node": "Save JSON file to Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Response JSON": {
        "main": [
          [
            {
              "node": "Merge All Paths",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Markdown File Meta": {
        "main": [
          [
            {
              "node": "Prepare Response Markdown",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcribe with OpenAI": {
        "main": [
          [
            {
              "node": "Set Config",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email Content Formatter": {
        "main": [
          [
            {
              "node": "Send Gmail Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail User for Approval": {
        "main": [
          [
            {
              "node": "Search Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On File Created Trigger": {
        "main": [
          [
            {
              "node": "Gmail User for Approval",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert JSON to Markdown": {
        "main": [
          [
            {
              "node": "Get Filename for Markdown",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter by .m4a extension": {
        "main": [
          [
            {
              "node": "Limit to last file",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Filename for Markdown": {
        "main": [
          [
            {
              "node": "Save Markdown file to Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Response Markdown": {
        "main": [
          [
            {
              "node": "Merge All Paths",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Summarize to Structured JSON": {
        "main": [
          [
            {
              "node": "Get Filename for JSON",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save JSON file to Google Drive": {
        "main": [
          [
            {
              "node": "Get JSON File Meta",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Markdown file to Google Drive": {
        "main": [
          [
            {
              "node": "Get Markdown File Meta",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Raw Transcript to Google Drive": {
        "main": [
          [
            {
              "node": "Merge All Paths",
              "type": "main",
              "index": 2
            }
          ]
        ]
      }
    }
  },
  {
    "id": "JoBrqIuKn4cnNOJ0",
    "meta": {
      "instanceId": "fcb622cbd5234c565b9b78babeaf0ea2455df9d2aad0d1adff7c1ef99583e685"
    },
    "name": "Personal Appointment Booking",
    "tags": [],
    "nodes": [
      {
        "id": "d55eb539-6cdf-423a-b50b-62b9f10bf252",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "position": [
          620,
          620
        ],
        "webhookId": "6e9d32dc-f5ad-4101-9512-c1adb5b455d1",
        "parameters": {
          "path": "appointment-webhook",
          "options": {},
          "httpMethod": "POST",
          "responseMode": "responseNode"
        },
        "typeVersion": 2
      },
      {
        "id": "5e8f1544-74c1-40a9-a1db-c9e67295317b",
        "name": "Respond to Webhook",
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          1320,
          620
        ],
        "parameters": {
          "options": {}
        },
        "typeVersion": 1.2
      },
      {
        "id": "b07a2c6d-a08c-4b03-942e-b7c7ab749dbd",
        "name": "Check available slot in Cal.com",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1040,
          520
        ],
        "parameters": {
          "url": "https://api.cal.com/v1/slots",
          "options": {},
          "sendQuery": true,
          "authentication": "predefinedCredentialType",
          "queryParameters": {
            "parameters": [
              {
                "name": "startTime",
                "value": "={{ $json.body.startTime }}"
              },
              {
                "name": "endTime",
                "value": "={{DateTime.fromISO($json.body.startTime, { zone: 'Asia/Kolkata' })\n  .set({ hour: 18, minute: 0, second: 0 })\n.format(\"yyyy-MM-dd'T'HH:mm:ssZZ\")}}"
              },
              {
                "name": "eventTypeId",
                "value": "event_type_id"
              },
              {
                "name": "timeZone",
                "value": "Asia/Kolkata"
              }
            ]
          },
          "nodeCredentialType": "calApi"
        },
        "credentials": {
          "calApi": {
            "id": "VmW9lgWo1nXe8zQF",
            "name": "Cal account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "1fabd0b8-542b-48ac-b95a-993972cebe88",
        "name": "Book an Appointment",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1040,
          720
        ],
        "parameters": {
          "url": "https://api.cal.com/v1/bookings",
          "method": "POST",
          "options": {},
          "jsonBody": "={\n  \"eventTypeId\": event_type_id,\n  \"start\": \"{{ $json.body.startTime }}\",\n  \"end\": \"{{ DateTime.fromISO($json.body.startTime).plus({ minutes: 30 }).format(\"yyyy-MM-dd'T'HH:mm:ssZZ\") }}\",\n  \"responses\": {\n    \"name\": \"{{ $json.body.name }}\",\n    \"email\": \"{{ $json.body.email }}\"\n  },\n  \"timeZone\": \"Asia/Kolkata\",\n  \"language\": \"en\",\n  \"title\": \"Test\",\n\"metadata\":{}\n} ",
          "sendBody": true,
          "specifyBody": "json",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "calApi"
        },
        "credentials": {
          "calApi": {
            "id": "VmW9lgWo1nXe8zQF",
            "name": "Cal account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "61f129f5-0102-4055-9c9e-7eb6e004a403",
        "name": "Check Is Request For Available Slot",
        "type": "n8n-nodes-base.if",
        "position": [
          820,
          620
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "249d32bd-5a1d-44fe-8b33-975827cef795",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.body.tool }}",
                "rightValue": "checkAvailableSlot"
              }
            ]
          }
        },
        "typeVersion": 2.2
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "e50b589e-7cf1-424a-b518-5877eee50050",
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Check Is Request For Available Slot",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Book an Appointment": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check available slot in Cal.com": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Is Request For Available Slot": {
        "main": [
          [
            {
              "node": "Check available slot in Cal.com",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Book an Appointment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "45e293393b5dd8437fb351e5b1ef5511ef67e6e0826a1c10b9b68be850b67593",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "618c19de-7259-46f7-a02f-d8a4fc140bf3",
        "name": "Structured Output Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          700,
          380
        ],
        "parameters": {
          "jsonSchemaExample": "{\n\t\"response\": \"N\"\n}"
        },
        "typeVersion": 1.2
      },
      {
        "id": "7dae5a0e-353b-4a7b-a773-4bcc4ce580ed",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          540,
          380
        ],
        "parameters": {
          "options": {
            "baseURL": "https://api.openai.com/v1"
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "htEWFtfoajtuKpAT",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "bab7f1c9-25a8-4c64-b963-ea684afc2380",
        "name": "Text Email",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1480,
          180
        ],
        "webhookId": "da6bb30b-cd00-47ee-8383-d39dcba33ca1",
        "parameters": {
          "text": "=Email ID: {{ $('New Email Received').item.json.id }}\nThread ID: {{ $('New Email Received').item.json.threadId }}\nFrom: {{ $('New Email Received').item.json.from.value[0].name }}\nEmail: {{ $('New Email Received').item.json.from.value[0].address }}\nSubject: {{ $('New Email Received').item.json.subject }}\n\n{{ $('New Email Received').item.json.text.replace(/_/g, '\\\\_')\n        .replace(/\\*/g, '\\\\*')\n        .replace(/\\[/g, '\\\\[')\n        .replace(/\\]/g, '\\\\]')\n        .replace(/\\(/g, '\\\\(')\n        .replace(/\\)/g, '\\\\)')\n        .replace(/~/g, '\\\\~')\n        .replace(/`/g, '\\\\`')\n        .replace(/>/g, '\\\\>')\n        .replace(/#/g, '\\\\#')\n        .replace(/\\+/g, '\\\\+')\n        .replace(/-/g, '\\\\-')\n        .replace(/=/g, '\\\\=')\n        .replace(/\\|/g, '\\\\|')\n        .replace(/\\{/g, '\\\\{')\n        .replace(/\\}/g, '\\\\}')\n        .replace(/\\./g, '\\\\.')\n        .replace(/!/g, '\\\\!')\n        .replace(/\\\\/g, '\\\\\\\\').substring(0, 100) + '...'; }}",
          "chatId": "={{ $json.chat_id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "iwigkJVzQ94wd6zp",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "0d2490f2-96be-46f2-aa1f-fd63e49c81f4",
        "name": "OpenAI",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          800,
          820
        ],
        "parameters": {
          "options": {},
          "resource": "audio",
          "operation": "transcribe"
        },
        "credentials": {
          "openAiApi": {
            "id": "htEWFtfoajtuKpAT",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.5
      },
      {
        "id": "1911c739-07a4-42d4-aeb9-d90bb2cb2828",
        "name": "New Email Received",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -100,
          220
        ],
        "parameters": {
          "simple": false,
          "filters": {},
          "options": {},
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          }
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "aXTuNMJaYuKFOKTa",
            "name": "Gmail account"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "e37d6747-a63f-4aee-bd3d-30c02b6fdc15",
        "name": "In the Inbox?",
        "type": "n8n-nodes-base.if",
        "position": [
          120,
          220
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "3f7094d8-2756-493d-8721-be7d4c83297b",
                "operator": {
                  "type": "array",
                  "operation": "contains",
                  "rightType": "any"
                },
                "leftValue": "={{ $json.labelIds }}",
                "rightValue": "INBOX"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "c6eaa6bf-aa92-4dc2-93b9-9695b79c3047",
        "name": "Needs a response?",
        "type": "n8n-nodes-base.if",
        "position": [
          900,
          200
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "8aa9d41a-a218-456c-8b46-70b2e4a1af03",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.output.response }}",
                "rightValue": "Y"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "44369d4b-6271-4f01-af9b-3b022ab50fb0",
        "name": "Telegram Bot Message Received",
        "type": "n8n-nodes-base.telegramTrigger",
        "position": [
          -100,
          840
        ],
        "webhookId": "5dfd3832-9606-4b68-904c-0c3e9ef3d7a0",
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {}
        },
        "credentials": {
          "telegramApi": {
            "id": "iwigkJVzQ94wd6zp",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "f487f113-da38-41ab-8d1a-c6296fedb91e",
        "name": "It needs to be an audio message + a reply!",
        "type": "n8n-nodes-base.telegram",
        "position": [
          320,
          940
        ],
        "webhookId": "1d9ee2f9-fbdf-4929-b149-c537ddcde290",
        "parameters": {
          "text": "=Sorry, I didn't catch that! \n\nTo send your email for you, I need you to respond with a voice note in reply to one of my other messages.",
          "chatId": "={{ $json.message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "iwigkJVzQ94wd6zp",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "215fd988-7e02-4bae-9b57-284e59a7a467",
        "name": "Get Audio File",
        "type": "n8n-nodes-base.telegram",
        "position": [
          620,
          820
        ],
        "webhookId": "2a804883-546e-410d-bfef-ff91f9ce0b4a",
        "parameters": {
          "fileId": "={{ $json.message.voice.file_id }}",
          "resource": "file"
        },
        "credentials": {
          "telegramApi": {
            "id": "iwigkJVzQ94wd6zp",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "a8b83c7a-442a-445a-a55b-2ad7fdd1674b",
        "name": "Create Email Draft",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1400,
          820
        ],
        "webhookId": "66db4f27-f871-4600-b4a9-fb8bbbd0c8c8",
        "parameters": {
          "message": "={{ $json.text }}",
          "options": {
            "sendTo": "={{$('Telegram Bot Message Received').item.json.message.reply_to_message.text.match(/Email:\\s(.+?@.+?\\.\\w+)/i)[1]}}",
            "threadId": "={{$('Telegram Bot Message Received').item.json.message.reply_to_message.text.match(/Thread ID:\\s([a-f0-9]+)/i)[1]}}"
          },
          "subject": "=RE:  {{ $('Telegram Bot Message Received').item.json.message.reply_to_message.text.match(/Subject:\\s(.+)/i)[1] }}",
          "resource": "draft"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "aXTuNMJaYuKFOKTa",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "cf942bba-201b-4135-bac9-a5cdbd516749",
        "name": "Direct to Draft",
        "type": "n8n-nodes-base.telegram",
        "position": [
          1560,
          820
        ],
        "webhookId": "a49b47f9-994a-485d-86e4-1222bc192565",
        "parameters": {
          "text": "=Draft Created:\n\n{{ $('Write Polished Reply').item.json.output }}\n\n[View here](https://mail.google.com/mail/#all/{{ $json.message.threadId }})",
          "chatId": "={{ $('Telegram Bot Message Received').item.json.message.reply_to_message.chat.id }}",
          "additionalFields": {
            "appendAttribution": false,
            "reply_to_message_id": "={{ $('Telegram Bot Message Received').item.json.message.message_id }}"
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "iwigkJVzQ94wd6zp",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "b21f66c4-544c-4401-96b6-b7e0239702e4",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -160,
          -20
        ],
        "parameters": {
          "color": 7,
          "width": 560,
          "height": 580,
          "content": "## 1. New Email Received\n\nOur workflow is triggered when a new email comes in. \n\nWe use an IF node here to only run the automation on incoming emails to the INBOX - not in the SENT folder."
        },
        "typeVersion": 1
      },
      {
        "id": "595b7700-97b9-400a-a96b-516452c3db86",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          460,
          -20
        ],
        "parameters": {
          "color": 7,
          "width": 740,
          "height": 580,
          "content": "## 2. Check If Email Needs a Response\n\nWe use ChatGPT to check if the email needs a reply. Anything sent with an \"unsubscribe\" button or \"manage preferences\" is ignored. Anything that comes from a company (e.g. sent from \"noreply@example.com\"), or has the format of a newsletter doesn't need a response.\n\nWe use an output parser so that we can use an IF node on the output."
        },
        "typeVersion": 1
      },
      {
        "id": "42551c14-0b70-42b7-a7ca-0bab580e050a",
        "name": "Does Email Need a Response?",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          520,
          200
        ],
        "parameters": {
          "text": "=Do you think the following email requires me to create a response or not? Your answer should be Y if yes, or N if not. Format your answer as a JSON as either { response: Y } or { response: N } Do not add anything else to your answer at all.\n\nCriteria for emails that require a reply:\n- Direct questions or requests for information, action, or confirmation.\n- Messages seeking clarification or feedback.\n- Invitations to meetings or events that need a confirmation or rejection.\n- Emails indicating follow-up is expected or explicitly asking for a reply.\n- Client/customer queries or feedback that require acknowledgment.\n- Personal emails from somebody who might be my friend\n\nCriteria for emails that do not require a reply:\n- The email address contains \"no-reply\" or \"noreply\"!\n- Informational or update emails with no explicit call for action or response.\n- Automated notifications (e.g., system alerts, newsletters, etc.).\n- CC/BCC emails where no direct response is expected.\nReplies that only acknowledge receipt (e.g., \"Thank you,\" \"Noted\").\n\nExamples:\n\nInput:\nFrom - \"Nutricals Men's Wellness\" <store+67435528508@g.shopifyemail.com>\nSubject - Copy of British Men Swear By This\nBody: Are You Ready to Try? üöÄ\\n‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè‚ÄáÕè¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠ \\nFree Next Day Delivery Available In The UK\\n\\nBanner with 15% text\\n[https://cdn.shopify.com/s/files/1/0674/3552/8508/files/15OFF_Banner.jpg?v=1728477865]\\nhttps://nutricalsupps.co.uk/_t/c/A1020005-17FCCB1E01B626BC-1AA5C384?l=AADVDennHNHTkxTcdbVb1tb0k0%2FTC%2Fc8r1oThucVEB90pLLtSPl7AIQ1Pb9xXOddTdS0LwJxcVWIvdCayYts30R9tSMtSJ%2BPvLGsZZseeSGN2rHePGVqDYgtLuJsY2HI69JX6WbRq1iYUlXSq%2BKNxtXanpxs7nnIJ3ZdkE13y0A15nlmHP9acPNXhMWS%2Bd9u6XHdQbNswPaahUU63LHAoPKnTC0%2BtsAtcEkCjy66DsXK6OI%2B5MIqszqgzLgeIZYZtJh6Y4WGQMYmTICOGiL3tMSKvfgo3H8UTK9vRVt2%2Bcb86vq9sMXwQuPQYYvuX7jlv0C5IHUH%2BTOSY80eeAAbFD0%2FqFQjHyHarU6SLBXX5UbqPRcTXVPYbNQVXuSQ02WHvKV3689adUNADNX6bg%3D%3D&c=AAB%2FvMTPfjPPwDmVhyk7kEi4pC%2FYi72OVsQsQVTXGWGtSevCqIphtQsYobAeSojbmQlyXUwnlrcaJnu4Dnbct%2BKoO94xvzo6cayXi3YxC90%2FoNS%2BjkilKKRWFCvt4li9bhq5f6GrnmCKm9EQq%2B3mZq%2FHl8NJIMVmoSdIlCLXcjlI2GUzp3JGBEJH2H1MFq67GlXN9iA2ZpwkPo%2BbqSD2HsGfmPQYaudt4kwI6lB5p9%2F08RLniPfvqPmWgkaIkWVmDfbOTTKGl0g%2FNaxSr6oisLnymr%2Bw37cjcBuyRjUhaspoj2weQ9XZbTzzpfkhpfJ3U0C0Roen1nozHk9o32hSefxSUVzGGXMtNSKzSmNVeolJZL9jggSV5NJDIALxxwF0kB1WlEyLGfwbwvTgfbDMH5Ql04aKTolL4K%2Bez10V9R2quqannt35jRahLJZy5cVMWAzPEwleOePSqwD%2BW9sjQcvyuGX%2F23JVrS2chinfmVdCCXWxpYvso3PbtYcgjZ2oAuUaxqhQRYYDxzfe0GZjzqqRmDeP%2BV78FAJESLRAeRoA23tCmQk7FASAY3FjmfbJXnB6%2B40JMthwQKAURDAbBO1ekx1tDdYd3OXZnFk3fDYQwzICVIo3MZah3e3cjRobzS2SSJlAVA%3D%3D\\nAs Seen on Nutricals\\n[https://cdn.shopify.com/s/files/1/0674/3552/8508/files/as-seen-on-Nutricals-MOBILE.png?v=1692371484]\\n\\n\\n\\n\\n\\n\\n\\nNutricals¬Æ UK\\n\\n128 City Road\\nLondon\\nEC1V 2NX\\nUnited Kingdom\\n\\n+442037288889\\nhello@nutricalsupps.co.uk\\n\\n\\n\\nUnsubscribe\\n[https://nutricalsupps.co.uk/account/unsubscribe?token=vkf5H_6XoktnfEKt8qUMcTJEZip6rqyFKGzuFs7BriPM7YFaHIHssoxhRIHW7iJqfzvyVTShmV7_NBTJ2ufoY41w69Mmx4mQ3uR6XBMx06s%3D&se_activity_id=183600415036&utm_source=shopify_email&utm_medium=email&utm_campaign=Copy+of+British+Men+Swear+By+This_183600415036]\\n\\n¬© 2023 Nutricals¬Æ UK\\n\\n[https://cdn.shopify.com/shopify-email/ivc5fufdfucnxibnsh0qhjn9b2ua.png]\\n\\n[https://nutricalsupps.co.uk/_t/open/A1020005-17FCCB1E01B626BC-1AA5C384?en=AABXSr%2BWjAgDVQvPeN2wSOJLFNs1iBRZX%2FfKuzaUN3%2BpO6e9HC0oI9UQmUc2wVl%2F57dDk19OAdrS8hSegwp59%2B7vlk4odUc4YXTSf%2B5RHsfE2HlcuPcEpb9DiMUs7NDW67v2L9CiwR6%2FEZVFbTcCJhd0Gh5EYv%2BBeEwn6zXVIpzWpzWKhLMvA8YYxzZk%2BDxdPCI7%2F5vBO34YytHAupYfHYaj%2B2%2B7clAPN%2BYQHs9AzFfu0IHdXTWLAbdVcPA%2B1X71sJwwJMOvPaaLS60yJyYGuqha3qehHCQxTfPCeEGoCjTruLjdrFDOPr80jHate0BKUTEXxG%2FTXSdnnMJWQz%2F15NG%2FliPNXM9CTVFa%2Be3XMsMp2ZYpdPzqQ8YSuXNc6jZsRJm2oxTjqUoIT8Cd2DubOf7ZATCR5Aj%2FKUYoCLEydg7U7atW5ghJTJbtYmTLatPcPOqgGpyaZRygBarsNpZ%2B%2FACUGYLoIuSzYuKJGd%2B5I3CQAsY7POqE4FP%2BE6lk1wUSaSCl7GNEegZ0JaJ0e5QsMZQnpANFLNt3dAhYQdu0mPldxD6U0DmszqPsqJAJ80E7Z0jg9pb8BgYHi72QyqXMbjrzww%3D%3D]\n\nAnswer: \n{\n\t\"response\": \"N\"\n}\n\n-----\n\nInput:\nFrom - {{ $json.from.value[0].name }} <{{ $json.from.value[0].address }}>\nSubject - {{ $json.subject }}\nBody: {{ $json.text }}",
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 1.4
      },
      {
        "id": "ac18470f-4884-43ca-80b5-c8936fc4d4cd",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1240,
          -20
        ],
        "parameters": {
          "color": 7,
          "width": 520,
          "height": 580,
          "content": "## 3. Send Email to Telegram\n\nWe use a VoicerEmailer bot to send the email over a Telegram message to our account on Telegram."
        },
        "typeVersion": 1
      },
      {
        "id": "be53cc8e-c5dd-4b82-aa78-c7870bf7de7b",
        "name": "Is Type Audio Message + Reply?",
        "type": "n8n-nodes-base.if",
        "position": [
          100,
          840
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "860f30dc-bfa7-46f5-a45d-b12c13194c41",
                "operator": {
                  "type": "object",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.message.reply_to_message }}",
                "rightValue": ""
              },
              {
                "id": "9647524d-e0f2-4fff-9287-7e3752488343",
                "operator": {
                  "type": "object",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $json.message.voice }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "280d69b3-4cf5-4515-8ae8-c499b21e4d99",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -160,
          600
        ],
        "parameters": {
          "color": 7,
          "width": 680,
          "height": 580,
          "content": "## 4. Telegram Reply Received\n\nThis workflow is triggered when the Telegram bot receives a message. \n\nWe check that the message is a reply to a previous email message, and that the reply is an audio message. \n\nIf not, we send a message back telling them what they did wrong."
        },
        "typeVersion": 1
      },
      {
        "id": "168f9296-8ff4-4598-91ab-81967cf36dd2",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          560,
          600
        ],
        "parameters": {
          "color": 7,
          "width": 440,
          "height": 580,
          "content": "## 5. Audio Transcription\n\nWe get the audio file from the Telegram message and send it to OpenAI's Whisper API to get a transcription of the message."
        },
        "typeVersion": 1
      },
      {
        "id": "8e2731c6-c4ca-40f3-8c26-6421b57f95e2",
        "name": "OpenAI Chat Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          1120,
          1000
        ],
        "parameters": {
          "options": {
            "baseURL": "https://api.openai.com/v1"
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "htEWFtfoajtuKpAT",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7c350b3d-1cad-4ae9-8330-8bb55fbcea15",
        "name": "Write Polished Reply",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          1100,
          820
        ],
        "parameters": {
          "text": "=Received Email:\n{{ $('Telegram Bot Message Received').item.json.message.reply_to_message.text }}\n\nVoice Note Response:\n{{ $json.text }}",
          "messages": {
            "messageValues": [
              {
                "message": "=You are a helpful assistant who translates rough voicemail messages into polished emails.\n\nYou will be given an email which is expecting a reply, as well as a voice message transcription which address the email. You should output a reply.\n\nDon't include the subject line. Only include a rephrasing of the answer given in the voice note. Do not make up an answer to fit any questions in the original email. \n\nUse the same tone, and broadly the same phrasing, as the voice note. Include a sign-off.\n\nDon't include any other padding or explanation in your answer.\n\nExamples:\n\nUSER INPUT:\n\nReceived Email:\nEmail ID: 19272309c9c81678\nThread ID: 19272309c9c81678\nFrom: ulrike roesler (via tibet-core Mailing List)\nEmail: tibet-core@maillist.ox.ac.uk\nSubject: Pre-term gathering this Friday, 7pm\n\nDear Adam,\n\nJust a brief reminder that the Tibetan & Himalayan Studies pre\\\\-term\ngathering will take place \\*this Friday from 7pm at the Royal Oak \\\\(Woodstock\nRoad\\\\)\\*\\\\. I have reserved a table for \"Tibetan Studies\"\\\\.\n\nWe will start by discussing the timetable, and those attending classes this\ncoming term are therefore asked to arrive at 7pm\\\\. Everyone else is welcome\nto join anytime during the evening\\\\.\n\nI attach a draft timetable, but please note that there may still be some\nsmall adjustments to the class times\\\\. The final version of the timetable\nwill be circulated after our meeting\\\\.\n\nI look forward to seeing you soon,\n\nUlrike\n\n\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\nUlrike Roesler\nProfessor of Tibetan and Himalayan Studies\nOriental Institute\nPusey Lane\nOxford, OX1 2LE\n\\\\+44\\\\-1865\\\\-278236\n\nVoice Note Response:\nHey Ulrike, sorry, I won't be there because I'm currently in San Marcos La Laguna in Guatemala So I can't be there for the Tibetan Studies gathering This coming Friday, I'm sorry\n\n---\n\nASSISTANT RESPONSE:\n\nHi Ulrike,\n\nThanks for letting me know about the pre-term gathering this Friday. \n\nUnfortunately, I won‚Äôt be able to attend, as I'm currently in San Marcos La Laguna, Guatemala. \n\nI'm sorry to miss out on the discussion.\n\nThanks,\n\nAdam"
              }
            ]
          },
          "promptType": "define",
          "hasOutputParser": true
        },
        "typeVersion": 1.4
      },
      {
        "id": "37905767-3cca-4789-b016-2fec4f21e45b",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1040,
          600
        ],
        "parameters": {
          "color": 7,
          "width": 720,
          "height": 580,
          "content": "## 5. Create Email Draft\n\nFinally, we get ChatGPT to write up a response, given the original email for context and our voice note reply. \n\nWe create a new draft in Gmail, which shows up in the same email thread. We sent a link to the newly created draft to the user via Telegram."
        },
        "typeVersion": 1
      },
      {
        "id": "a9942f9d-8896-45cd-b715-1228d8e3295c",
        "name": "Set Chat ID",
        "type": "n8n-nodes-base.set",
        "position": [
          1300,
          180
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "d2980bdf-c0c2-47a7-885c-6a1aea58396c",
                "name": "chat_id",
                "type": "string",
                "value": "=6963887105"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "5a60bcd6-da89-4892-9a3f-1b04a2238ab6",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1280,
          340
        ],
        "parameters": {
          "width": 160,
          "height": 120,
          "content": "## Edit here\nAdd in your Chat ID here."
        },
        "typeVersion": 1
      }
    ],
    "pinData": {
      "Telegram Bot Message Received": [
        {
          "message": {
            "chat": {
              "id": 1981391864,
              "type": "private",
              "username": "clairebaker0",
              "last_name": "Baker",
              "first_name": "Claire"
            },
            "date": 1728670178,
            "from": {
              "id": 1981391864,
              "is_bot": false,
              "username": "clairebaker0",
              "last_name": "Baker",
              "first_name": "Claire",
              "is_premium": true,
              "language_code": "en"
            },
            "voice": {
              "file_id": "AwACAgQAAxkBAANSZwlp4lXETIQffnMjGYNf_9KBCHEAAnwZAAKYI1FQZmfPK4JXJl82BA",
              "duration": 84,
              "file_size": 326514,
              "mime_type": "audio/ogg",
              "file_unique_id": "AgADfBkAApgjUVA"
            },
            "message_id": 82,
            "reply_to_message": {
              "chat": {
                "id": 1981391864,
                "type": "private",
                "username": "clairebaker0",
                "last_name": "Baker",
                "first_name": "Claire"
              },
              "date": 1728632446,
              "from": {
                "id": 7199424210,
                "is_bot": true,
                "username": "Email12345Bot",
                "first_name": "EmailBot"
              },
              "text": "Email ID: 1927a85634ae8e72\nThread ID: 1927a85634ae8e72\nFrom: Hannah Brown\nEmail: hannahbrown82@googlemail.com\nSubject: Re: October Updates ‚ù§Ô∏è\n\nHello lovelies\n\nThanks for these updates\\\\.\n\nSo interested in your decision to change the elemental ...",
              "entities": [
                {
                  "type": "email",
                  "length": 28,
                  "offset": 81
                }
              ],
              "message_id": 74
            }
          },
          "update_id": 408806372
        }
      ]
    },
    "connections": {
      "OpenAI": {
        "main": [
          [
            {
              "node": "Write Polished Reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Chat ID": {
        "main": [
          [
            {
              "node": "Text Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "In the Inbox?": {
        "main": [
          [
            {
              "node": "Does Email Need a Response?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Audio File": {
        "main": [
          [
            {
              "node": "OpenAI",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs a response?": {
        "main": [
          [
            {
              "node": "Set Chat ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Does Email Need a Response?",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Create Email Draft": {
        "main": [
          [
            {
              "node": "Direct to Draft",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "New Email Received": {
        "main": [
          [
            {
              "node": "In the Inbox?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Write Polished Reply",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Write Polished Reply": {
        "main": [
          [
            {
              "node": "Create Email Draft",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Does Email Need a Response?",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Does Email Need a Response?": {
        "main": [
          [
            {
              "node": "Needs a response?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Telegram Bot Message Received": {
        "main": [
          [
            {
              "node": "Is Type Audio Message + Reply?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Type Audio Message + Reply?": {
        "main": [
          [
            {
              "node": "Get Audio File",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "It needs to be an audio message + a reply!",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "1083afcb-1257-45a3-b331-d93fb8769548",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -840,
          0
        ],
        "parameters": {
          "rule": {
            "interval": [
              {}
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "c3ec0759-a3d1-4866-978a-bfe4f49ee81d",
        "name": "Get Hash of Contents",
        "type": "n8n-nodes-base.crypto",
        "position": [
          380,
          0
        ],
        "parameters": {
          "value": "={{ $json.data }}",
          "dataPropertyName": "hash"
        },
        "typeVersion": 1
      },
      {
        "id": "4ad92ad3-6f99-43a5-9a61-374adb3b28f7",
        "name": "Notify of Change",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1220,
          0
        ],
        "webhookId": "cc4cbee1-ad57-48fb-810a-b21880357ab0",
        "parameters": {
          "sendTo": "jim@example.com",
          "message": "=site: {{ $('Variables').first().json.url }}\ndate: {{ $now.toISO() }}\nhash: {{ $json.hash }}\ncontents: {{ $json.gdrive }}",
          "options": {},
          "subject": "=Change detected for {{ $('Variables').first().json.url }}",
          "emailType": "text"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "Sf5Gfl9NiFTNXFWb",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "9385242a-86b1-4624-ada9-949851b68054",
        "name": "Markdown",
        "type": "n8n-nodes-base.markdown",
        "position": [
          200,
          0
        ],
        "parameters": {
          "html": "={{ $json.content.trim() }}",
          "options": {}
        },
        "typeVersion": 1
      },
      {
        "id": "663b6ba2-cbf9-44ea-a062-f88ccb0640c1",
        "name": "Variables",
        "type": "n8n-nodes-base.set",
        "position": [
          -460,
          0
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "fa706ed3-7425-4f0e-9590-d9478b4e6692",
                "name": "url",
                "type": "string",
                "value": "https://x.com/en/tos"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "2ef69fff-4d7a-439a-b317-ea5fa3ce7869",
        "name": "Only New Hashes",
        "type": "n8n-nodes-base.removeDuplicates",
        "position": [
          560,
          0
        ],
        "parameters": {
          "options": {
            "historySize": 1
          },
          "operation": "removeItemsSeenInPreviousExecutions",
          "dedupeValue": "={{ $json.hash }}"
        },
        "typeVersion": 2
      },
      {
        "id": "93e13d80-a26f-408f-be4e-b582ab9fd9bd",
        "name": "Log Record",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1040,
          0
        ],
        "parameters": {
          "columns": {
            "value": {
              "hash": "={{ $('Get Hash of Contents').first().json.hash }}",
              "gdrive": "=https://drive.google.com/file/d/{{ $json.id }}/view?usp=sharing",
              "website": "={{ $('Variables').first().json.url }}",
              "date of change": "={{ $now.toISO() }}"
            },
            "schema": [
              {
                "id": "website",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "website",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "hash",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "hash",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "date of change",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "date of change",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "gdrive",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "gdrive",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "operation": "append",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K13OBMicH-ebhvJRYo4sHiOuHd1KIX2jiFxBLWy2UOk/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1K13OBMicH-ebhvJRYo4sHiOuHd1KIX2jiFxBLWy2UOk",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1K13OBMicH-ebhvJRYo4sHiOuHd1KIX2jiFxBLWy2UOk/edit?usp=drivesdk",
            "cachedResultName": "86. Webpage Changes Tracker"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "XHvC7jIRR8A2TlUl",
            "name": "Google Sheets account"
          }
        },
        "typeVersion": 4.5
      },
      {
        "id": "dea15963-61de-4371-b716-7683e0e703a9",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -540,
          -160
        ],
        "parameters": {
          "color": 7,
          "width": 620,
          "height": 380,
          "content": "## 1. Fetch a Webpage Contents\n[Read more about the HTTP request node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest)"
        },
        "typeVersion": 1
      },
      {
        "id": "bcb1c0b1-fc77-4417-a9c0-6299ce8ca33e",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          100,
          -160
        ],
        "parameters": {
          "color": 7,
          "width": 640,
          "height": 400,
          "content": "## 2. Use Hashing to Detect Changes\n[Learn more about the cryptography node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.crypto/)"
        },
        "typeVersion": 1
      },
      {
        "id": "eda51de6-80a2-42b1-83ba-66c551911c45",
        "name": "Fetch Webpage",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -280,
          0
        ],
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {},
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "User-Agent",
                "value": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "8aa998f1-1558-4b54-a95a-7be9360a819a",
        "name": "Extract Contents",
        "type": "n8n-nodes-base.html",
        "position": [
          -100,
          0
        ],
        "parameters": {
          "options": {},
          "operation": "extractHtmlContent",
          "extractionValues": {
            "values": [
              {
                "key": "content",
                "cssSelector": ".ct07",
                "returnValue": "html"
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "ecb60054-563c-4c0b-949c-abdcd3896f6b",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          760,
          -160
        ],
        "parameters": {
          "color": 7,
          "width": 660,
          "height": 400,
          "content": "## 3. Notify when Changes Occur\n[Read more about the Gmail node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.gmail)\n"
        },
        "typeVersion": 1
      },
      {
        "id": "30774606-5e63-4d73-9894-ba14d5b1fc46",
        "name": "Take a Snapshot",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          860,
          0
        ],
        "parameters": {
          "name": "={{\n$('Variables').item.json.url\n  .extractDomain()\n  .replace('.','_')\n  + $json.hash\n  + '.md'\n}}",
          "content": "={{ $json.data }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "1BbP5HRnjNkCvcDRFFg1bm0sNYBGZM6AU",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1BbP5HRnjNkCvcDRFFg1bm0sNYBGZM6AU",
            "cachedResultName": "86. Monitor Webpage Changes"
          },
          "operation": "createFromText"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "yOwz41gMQclOadgu",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "9ae563ea-49a3-4dcc-9190-8746650018aa",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1040,
          -760
        ],
        "parameters": {
          "width": 440,
          "height": 980,
          "content": "## Try it out\n### This n8n template can monitor and detect changes to a webpage's contents and notify you only when a change occurs.\n\nGreat to keep an eye on and track publicly available documents such as  company TOS, government policy or competitor pages.\n\n### How it works\n* A scheduled trigger is used so we can run everyday to automate this process.\n* A website page is then fetched with the HTTP request node and the contents we want to track are extracted using the HTML node.\n* To detect changes, we generate a hash on the contents with the cryptography node and compare it with previously seen hashes using the \"remove duplicates\" node. If the hash was seen before, the workflow stops here.\n* Finally, when new changes are detected a copy of the contents are uploaded to Google Drive and a logged into a Google sheet. A notification email can also be sent if action is required.\n\n### How to use\n* Update the URL you want to track in the node named \"variables\" and ensure the HTML node has updated selectors to get the content you want.\n* Ensure the timezone is set correctly when using the Scheduled Trigger node.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Markdown": {
        "main": [
          [
            {
              "node": "Get Hash of Contents",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Variables": {
        "main": [
          [
            {
              "node": "Fetch Webpage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Record": {
        "main": [
          [
            {
              "node": "Notify of Change",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Webpage": {
        "main": [
          [
            {
              "node": "Extract Contents",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Only New Hashes": {
        "main": [
          [
            {
              "node": "Take a Snapshot",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Take a Snapshot": {
        "main": [
          [
            {
              "node": "Log Record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Contents": {
        "main": [
          [
            {
              "node": "Markdown",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Variables",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Hash of Contents": {
        "main": [
          [
            {
              "node": "Only New Hashes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "c2589fa234defe76e8a1321c3a7d0a73579d0120d64d927e88f5e3be584ae8d4"
    },
    "nodes": [
      {
        "id": "634f2fc5-0ba7-42ad-bdf5-ade3415dd288",
        "name": "Landing Page Url",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -200,
          580
        ],
        "webhookId": "afe067a5-4878-4c9d-b746-691f77190f54",
        "parameters": {
          "options": {},
          "formTitle": "Website Security Scanner",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Landing Page Url",
                "placeholder": "https://example.com",
                "requiredField": true
              }
            ]
          },
          "formDescription": "Check your website for security vulnerabilities and get a detailed report"
        },
        "typeVersion": 2.2
      },
      {
        "id": "6cee63ca-d0f6-444a-b882-22da1a9fd70c",
        "name": "Scrape Website",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          0,
          580
        ],
        "parameters": {
          "url": "={{ $json['Landing Page Url'] }}",
          "options": {
            "redirect": {
              "redirect": {
                "maxRedirects": 5
              }
            },
            "response": {
              "response": {
                "fullResponse": true,
                "responseFormat": "text"
              }
            }
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "0d5d1e76-e627-4565-a1ee-6a610f4b2028",
        "name": "OpenAI Headers Analysis",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          340,
          600
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "yZ0AIg9abV8HJadB",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "04427ef7-515d-4a1a-88d2-ade10aeefc87",
        "name": "OpenAI Content Analysis",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          340,
          980
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "yZ0AIg9abV8HJadB",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "d4ee4db8-aa04-4068-9b97-d16acf98c027",
        "name": "Security Vulnerabilities Audit",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          360,
          780
        ],
        "parameters": {
          "text": "=You are an elite cybersecurity expert specializing in web application security.\n\nIn this task, you will analyze the HTML and visible content of the webpage to identify potential security vulnerabilities.\n\nAudit Structure\nYou will review all client-side security aspects of the page and present your findings in three sections:\n- Critical Vulnerabilities ‚Äì Issues that could lead to immediate compromise\n- Information Leakage ‚Äì Sensitive data exposed in page source\n- Client-Side Weaknesses ‚Äì JavaScript vulnerabilities, XSS opportunities, etc.\n\nFor each issue found, provide:\n1. A clear description of the vulnerability\n2. The potential impact\n3. A specific recommendation to fix it\n\nIf you find no issues in a particular section, explicitly state that no issues were found in that category.\n\nEnsure the output is properly formatted, clean, and highly readable. Focus only on issues that can be detected from the client-side code.\n\nHere is the content of the webpage: {{ $json.data }}",
          "options": {},
          "promptType": "define"
        },
        "typeVersion": 1.7
      },
      {
        "id": "c9702f2b-845b-464d-9c32-3d5be308ef77",
        "name": "Security Configuration Audit",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          360,
          380
        ],
        "parameters": {
          "text": "=You are an elite web security expert specializing in secure configurations.\n\nIn this task, you will analyze the HTTP headers, cookies, and overall configuration of a webpage to identify security misconfigurations.\n\nAudit Structure\nYou will begin by listing ALL security headers that ARE present and properly configured.\n\nBe very clear and explicit about which headers are present and which are missing. For each header, clearly state whether it is present or missing, and if present, what its value is.\n\nThen, present your findings in three sections:\n- Header Security ‚Äì Missing or misconfigured security headers\n- Cookie Security ‚Äì Insecure cookie configurations\n- Content Security ‚Äì CSP issues, mixed content, etc.\n\nFor each finding, provide:\n1. A clear description of the misconfiguration\n2. The security implications\n3. The recommended secure configuration with example code\n\nIf you find no issues in a particular section, explicitly state that no issues were found.\n\nUse proper formatting with code blocks for configuration examples. Only include issues that can be detected from client-side inspection.\nHere are the response headers: {{ $json.formattedHeaders }}\n\nPlease Respond like this\n\n### [any section heading that includes \"Headers]\n\n1. **[Header Title]**\n   - **Present?** Yes/No\n   - **Value:** `actual-header-value`\n",
          "options": {},
          "promptType": "define"
        },
        "typeVersion": 1.7
      },
      {
        "id": "3b43be75-c35c-44e4-8ecc-a29c48e3625c",
        "name": "Merge Security Results",
        "type": "n8n-nodes-base.merge",
        "position": [
          860,
          580
        ],
        "parameters": {},
        "typeVersion": 3,
        "alwaysOutputData": true
      },
      {
        "id": "da134256-d7fa-4a3f-ba24-acc320a944a2",
        "name": "Aggregate Audit Results",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          1060,
          580
        ],
        "parameters": {
          "options": {},
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "output"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "aef1da93-0b01-4a7f-9439-1f74c2af12d6",
        "name": "Process Audit Results",
        "type": "n8n-nodes-base.code",
        "position": [
          1240,
          580
        ],
        "parameters": {
          "jsCode": "// ‚úÖ Updated extractSecurityHeaders and related logic remains unchanged\n\nfunction extractSecurityHeaders(rawHeaders = {}, configOutput = '') {\n  const securityHeaders = [\n    'Content-Security-Policy',\n    'Strict-Transport-Security',\n    'X-Content-Type-Options',\n    'X-Frame-Options',\n    'Referrer-Policy',\n    'Permissions-Policy',\n    'X-XSS-Protection',\n    'Cross-Origin-Embedder-Policy',\n    'Cross-Origin-Opener-Policy',\n    'X-Permitted-Cross-Domain-Policies'\n  ];\n\n  const headerStatus = {};\n  for (const header of securityHeaders) {\n    headerStatus[header] = { present: false, value: '' };\n  }\n\n  for (const header in rawHeaders) {\n    const norm = header.trim().toLowerCase();\n    for (const standard of securityHeaders) {\n      if (norm === standard.toLowerCase()) {\n        headerStatus[standard].present = true;\n        headerStatus[standard].value = rawHeaders[header];\n      }\n    }\n  }\n\n  const presentSection = configOutput.match(/(?:###|##|\\*\\*)[^\\n]*?\\bheaders?\\b[\\s\\S]*?(?=###|##|\\*\\*|$)/i);\n  if (presentSection) {\n    const section = presentSection[0];\n    for (const header of securityHeaders) {\n      const title = header.replace(/-/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n      const regex = new RegExp(`\\\\*\\\\*${title}\\\\*\\\\*[^\\\\n]*?\\\\*\\\\*Present\\\\?\\\\*\\\\*\\\\s*Yes[^\\\\n]*?\\\\*\\\\*Value:\\\\*\\\\*\\\\s*\\`([^\\\\\\`]+)\\``, 'is');\n      const match = section.match(regex);\n      if (match && match[1]) {\n        headerStatus[header].present = true;\n        headerStatus[header].value = match[1].trim();\n      }\n    }\n  }\n\n  return headerStatus;\n}\n\nfunction hasUnsafeInline(value) {\n  return value && value.includes('unsafe-inline');\n}\n\nfunction determineGrade(headerStatus) {\n  const critical = [\n    'Content-Security-Policy',\n    'Strict-Transport-Security',\n    'X-Content-Type-Options',\n    'X-Frame-Options'\n  ];\n  const important = ['Referrer-Policy', 'Permissions-Policy'];\n  const additional = [\n    'X-XSS-Protection',\n    'Cross-Origin-Embedder-Policy',\n    'Cross-Origin-Opener-Policy',\n    'X-Permitted-Cross-Domain-Policies'\n  ];\n\n  let criticalCount = 0;\n  let importantCount = 0;\n  let hasCSPIssue = false;\n\n  for (const h of critical) {\n    if (headerStatus[h]?.present) {\n      criticalCount++;\n      if (h === 'Content-Security-Policy' && hasUnsafeInline(headerStatus[h].value)) {\n        hasCSPIssue = true;\n      }\n    }\n  }\n\n  for (const h of important) {\n    if (headerStatus[h]?.present) importantCount++;\n  }\n\n  if (criticalCount === critical.length) {\n    if (importantCount === important.length) return hasCSPIssue ? 'A-' : 'A+';\n    if (importantCount >= 1) return hasCSPIssue ? 'B+' : 'A-';\n    return hasCSPIssue ? 'B' : 'B+';\n  } else if (criticalCount >= critical.length - 1) {\n    return importantCount >= 1 ? 'B' : 'C+';\n  } else if (criticalCount >= 2) {\n    return 'C';\n  } else if (criticalCount >= 1) {\n    return 'D';\n  } else {\n    return 'F';\n  }\n}\n\nfunction formatHeadersForDisplay(headerStatus) {\n  const present = Object.keys(headerStatus).filter(h => headerStatus[h].present);\n  return present.length > 0 ? present.join(', ') : 'No security headers detected';\n}\n\nfunction processSecurityHeaders(items) {\n  try {\n    const json = items[0].json || items[0];\n\n    // ‚õèÔ∏è Try to grab from originalHeaders if available\n    const rawHeaders =\n      json?.originalHeaders ||\n      $('Extract Headers for Debug')?.first()?.json?.originalHeaders ||\n      json?.headers ||\n      {};\n\n    const configOutput = json.configOutput || json.output?.[0] || '';\n    const vulnOutput = json.vulnOutput || json.output?.[1] || '';\n\n    const headerStatus = extractSecurityHeaders(rawHeaders, configOutput);\n    const presentHeaders = formatHeadersForDisplay(headerStatus);\n    const grade = determineGrade(headerStatus);\n\n    const timestamp = new Date().toLocaleString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n\n    const url =\n      json?.formValues?.url ||\n      json?.['Landing Page Url'] ||\n      $('Landing Page Url')?.first()?.json?.['Landing Page Url'] ||\n      json?.Landing_Page_Url ||\n      json?.landingPageUrl ||\n      json?.url ||\n      'https://example.com';\n\n    return [\n      {\n        json: {\n          ...json,\n          auditData: {\n            url,\n            timestamp,\n            grade,\n            criticalCount:\n              headerStatus['Content-Security-Policy'].present &&\n              hasUnsafeInline(headerStatus['Content-Security-Policy'].value)\n                ? 1\n                : 0,\n            warningCount: Object.keys(headerStatus).filter(\n              h =>\n                !headerStatus[h].present &&\n                !['Strict-Transport-Security', 'Content-Security-Policy'].includes(h)\n            ).length,\n            presentHeaders,\n            configOutput,\n            vulnOutput,\n            headerStatus,\n            originalHeaders: rawHeaders\n          }\n        }\n      }\n    ];\n  } catch (err) {\n    return [{ json: { ...items[0].json, error: err.message } }];\n  }\n}\n\nreturn processSecurityHeaders(items);\n"
        },
        "typeVersion": 2
      },
      {
        "id": "ced29b26-474c-4d62-808a-3284103c9d60",
        "name": "Send Security Report",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1580,
          580
        ],
        "webhookId": "2979e4dc-1689-447e-8cd4-eb907b4eedf4",
        "parameters": {
          "sendTo": "=example@here.com",
          "message": "={{ $json.emailHtml }}",
          "options": {},
          "subject": "=Website Security Audit - {{ $json.auditData.url }}"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "9CEpbF4jIWb2OETv",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "918c0fc4-2f02-4594-bfc9-e36035f2d802",
        "name": "Sticky Note - Setup Instructions",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -820,
          400
        ],
        "parameters": {
          "width": 500,
          "height": 440,
          "content": "## Quick Setup Guide\n\n1. **Add OpenAI API Credentials**\n   - Go to Settings ‚Üí Credentials ‚Üí New ‚Üí OpenAI API\n   - Enter your API key from platform.openai.com\n\n2. **Add Gmail Credentials**\n   - Go to Settings ‚Üí Credentials ‚Üí New ‚Üí Gmail OAuth2 API\n   - Complete the OAuth setup process\n\n3. **Update Email Configuration**\n   - Open the 'Send Security Report' node\n   - Change the recipient email address from the default\n\n4. **Activate and Deploy Workflow**\n   - Click 'Active' toggle in the top right\n   - Copy the form URL to share with others or use yourself"
        },
        "typeVersion": 1
      },
      {
        "id": "6e31b9b8-ae02-4da4-a75e-5d784b210c64",
        "name": "Sticky Note - OpenAI Analysis",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          300,
          120
        ],
        "parameters": {
          "color": 3,
          "width": 420,
          "height": 240,
          "content": "## OpenAI Security Analysis\n\n- Add your OpenAI credentials (required)\n- Using GPT-4o models provides more detailed security analysis\n- Analyzes for XSS, information disclosure, CSRF, and more\n- Each agent scans different aspects of website security\n- Consider upgrading to GPT-4o (not mini) for production use"
        },
        "typeVersion": 1
      },
      {
        "id": "590b1f1c-024d-4002-a8eb-d9dc81528f89",
        "name": "Sticky Note - Email Configuration",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1480,
          220
        ],
        "parameters": {
          "color": 3,
          "width": 360,
          "height": 200,
          "content": "## Send Security Report\n\n- Connects securely to Gmail for sending detailed reports\n- Report is sent as HTML formatted email\n- Subject line includes the scanned URL\n- Requires Gmail OAuth credentials to be set up"
        },
        "typeVersion": 1
      },
      {
        "id": "dc6223f8-a98c-497a-97c9-af39e80e6d66",
        "name": "Sticky Note - Audit Process",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -200,
          780
        ],
        "parameters": {
          "color": 2,
          "width": 420,
          "height": 300,
          "content": "## Security Audit Process\n\n- This workflow performs two parallel security analyses\n- Top path: Checks headers, cookies, and security configurations\n- Bottom path: Analyzes HTML/JavaScript for client-side vulnerabilities\n- Results are merged and formatted into a comprehensive report\n- Analysis is non-invasive and only examines client-side content"
        },
        "typeVersion": 1
      },
      {
        "id": "cbda16d4-f1f4-491c-b38c-43d7544e129b",
        "name": "Sticky Note - How To Use",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -240,
          240
        ],
        "parameters": {
          "color": 4,
          "width": 400,
          "height": 280,
          "content": "## How To Use This Workflow\n\n1. **Deploy the workflow** and activate it\n2. **Access the form** via the provided URL\n3. **Enter any website URL** to scan (must include http:// or https://)\n4. **Submit the form** to trigger the analysis\n5. **Check your email** for the detailed security report\n6. **Share the results** with your development team to implement fixes"
        },
        "typeVersion": 1
      },
      {
        "id": "4859416f-4de3-43ea-9461-3ead8a38db6e",
        "name": "Sticky Note - Report Formatting",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1160,
          220
        ],
        "parameters": {
          "color": 5,
          "width": 300,
          "height": 280,
          "content": "## Report Formatting\n\n- Creates beautiful, professional HTML email report\n- Visual grade indicator (A-F) based on findings\n- Includes count of critical issues and warnings\n- Color-coded sections for easy readability\n- Mobile-friendly responsive design"
        },
        "typeVersion": 1
      },
      {
        "id": "a02db4c7-2cad-41ff-b5ad-e1b19604a699",
        "name": "Sticky Note - Results Processing",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          840,
          240
        ],
        "parameters": {
          "width": 300,
          "height": 240,
          "content": "## Results Processing\n\n- Analyzes AI output to determine security grade\n- Counts critical issues and warnings\n- Extracts present security headers\n- Prepares data for the email report template\n- Generates timestamp for the report"
        },
        "typeVersion": 1
      },
      {
        "id": "41b834c8-62f7-47e7-9d9d-e0e1244faecb",
        "name": "Extract Headers for Debug",
        "type": "n8n-nodes-base.code",
        "position": [
          200,
          460
        ],
        "parameters": {
          "jsCode": "// Format headers into a readable string\nlet formattedHeaders = '';\nif (items[0].json.headers) {\n  for (const key in items[0].json.headers) {\n    formattedHeaders += `${key}: ${items[0].json.headers[key]}\\n`;\n  }\n}\n\n// Return both the original data and the formatted headers\nreturn [{\n  json: {\n    ...items[0].json,\n    formattedHeaders: formattedHeaders,\n    originalHeaders: items[0].json.headers // Keep the original headers too\n  }\n}];"
        },
        "typeVersion": 2
      },
      {
        "id": "0b76b396-fc96-41fc-a095-30971dd88271",
        "name": "convert to HTML",
        "type": "n8n-nodes-base.code",
        "position": [
          1400,
          580
        ],
        "parameters": {
          "jsCode": "// Create a direct HTML template with improved styling\nconst auditData = items[0].json.auditData;\n\nfunction formatConfigurationIssues() {\n  if (!auditData.configOutput || auditData.configOutput.trim() === '') {\n    return '<p>No specific configuration issues detected.</p>';\n  }\n\n  try {\n    const config = auditData.configOutput.trim();\n    let html = '';\n    const renderedKeys = new Set();\n\n    const renderBlock = (title, description, impact, recommendation) => `\n      <div style=\"border-left: 4px solid #3498DB; padding: 10px; margin-bottom: 15px;\">\n        <div style=\"font-weight: bold; color: #3498DB;\">${title}</div>\n        ${description ? `<div style=\"margin-top: 5px;\">${description}</div>` : ''}\n        ${impact ? `<div style=\"margin-top: 5px; font-style: italic; color: #7F8C8D;\">Impact: ${impact}</div>` : ''}\n        ${recommendation ? `<div style=\"margin-top: 5px;\"><strong>Recommendation:</strong></div>\n          <pre style=\"background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-family: monospace;\">${recommendation}</pre>` : ''}\n      </div>`;\n\n    const sections = config.split(/(?=^###\\s+)/gm).filter(Boolean);\n\n    for (const section of sections) {\n      const sectionTitleMatch = section.match(/^###\\s+(.*)/);\n      const sectionTitle = sectionTitleMatch?.[1]?.trim() || 'Unnamed Section';\n      const sectionKey = sectionTitle.toLowerCase();\n\n      // Skip \"no issues found\" sections\n      if (/no issues? (found|were found)/i.test(section)) continue;\n\n      const lines = section.split(/\\n+/).filter(line => line.trim() !== '');\n\n      let currentTitle = '';\n      let description = '';\n      let impact = '';\n      let recommendation = '';\n\n      for (let i = 0; i < lines.length; i++) {\n        const line = lines[i].trim();\n\n        // Start of a new numbered or bolded issue\n        const numberedTitle = line.match(/^\\d+\\.\\s+\\*\\*(.*?)\\*\\*/);\n        const bulletTitle = line.match(/^\\*\\*(.*?)\\*\\*/);\n\n        if (numberedTitle || (!currentTitle && bulletTitle)) {\n          // Flush last block\n          if (currentTitle && !renderedKeys.has(`${sectionKey}::${currentTitle.toLowerCase()}`)) {\n            html += renderBlock(currentTitle, description, impact, recommendation);\n            renderedKeys.add(`${sectionKey}::${currentTitle.toLowerCase()}`);\n          }\n\n          currentTitle = (numberedTitle || bulletTitle)[1].trim();\n          description = '';\n          impact = '';\n          recommendation = '';\n          continue;\n        }\n\n        const valueMatch = line.match(/- \\*\\*Value:\\*\\*\\s*`?(.*?)`?$/i);\n        const presentMatch = line.match(/- \\*\\*Present\\?\\*\\*.*?(Yes|No)/i);\n        const descMatch = line.match(/- \\*\\*Description:\\*\\*\\s*(.*)/i);\n        const impactMatch = line.match(/- \\*\\*(?:Impact|Security Implication|Potential Impact):\\*\\*\\s*(.*)/i);\n        const recMatch = line.match(/```(?:\\w*)?\\n([\\s\\S]*?)```/i);\n\n        if (descMatch) {\n          description = descMatch[1].trim();\n        } else if (valueMatch || presentMatch) {\n          const present = presentMatch?.[1]?.trim() || 'Unknown';\n          const value = valueMatch?.[1]?.trim() || '[Not provided]';\n          description = `This header is ${present.toLowerCase()}. Value: ${value}.`;\n        }\n\n        if (impactMatch) {\n          impact = impactMatch[1].trim();\n        }\n\n        if (recMatch) {\n          recommendation = recMatch[1].trim();\n        }\n      }\n\n      // Final block in section\n      if (currentTitle && !renderedKeys.has(`${sectionKey}::${currentTitle.toLowerCase()}`)) {\n        html += renderBlock(currentTitle, description, impact, recommendation);\n        renderedKeys.add(`${sectionKey}::${currentTitle.toLowerCase()}`);\n      }\n    }\n\n    return html || '<p>No configuration issues detected.</p>';\n  } catch (e) {\n    console.error('Error in formatConfigurationIssues:', e);\n    return `<p>Error processing configuration issues: ${e.message}</p>`;\n  }\n}\n\n\n\n// Create header badge HTML\nfunction createHeaderBadge(headerName, isWarning = false) {\n  const isPresent = auditData.headerStatus && \n                   auditData.headerStatus[headerName] && \n                   auditData.headerStatus[headerName].present;\n  \n  const color = isWarning && isPresent ? \"#F39C12\" : (isPresent ? \"#27AE60\" : \"#E74C3C\");\n  const icon = isPresent ? \"‚úì\" : \"‚úó\";\n  \n  return `<span style=\"display: inline-block; margin: 2px; padding: 4px 8px; background-color: ${color}; color: white; border-radius: 4px; font-size: 12px;\">${icon} ${headerName}</span>`;\n}\n\n// Format warnings section\nfunction formatWarningsSection() {\n  if (!auditData.warningCount || auditData.warningCount === 0 || !auditData.headerStatus) {\n    return '<p>No warnings detected.</p>';\n  }\n\n  const csp = Object.entries(auditData.headerStatus).find(([k]) => k.toLowerCase() === 'content-security-policy');\n  const hsts = Object.entries(auditData.headerStatus).find(([k]) => k.toLowerCase() === 'strict-transport-security');\n  const xss = Object.entries(auditData.headerStatus).find(([k]) => k.toLowerCase() === 'x-xss-protection');\n\n  let warnings = '';\n\n  if (csp && csp[1].value && csp[1].value.includes('unsafe-inline')) {\n    warnings += `\n      <div style=\"margin-top: 15px;\">\n        <div style=\"border-left: 4px solid #F39C12; padding: 10px;\">\n          <strong style=\"color: #F39C12;\">Content-Security-Policy: unsafe-inline</strong>\n          <p>The use of 'unsafe-inline' allows potentially malicious scripts to execute.</p>\n        </div>\n      </div>`;\n  }\n\n  if (hsts && hsts[1].value) {\n    const match = hsts[1].value.match(/max-age=(\\d+)/);\n    const age = match ? parseInt(match[1]) : 0;\n    if (age < 2592000) {\n      warnings += `\n        <div style=\"margin-top: 15px;\">\n          <div style=\"border-left: 4px solid #F39C12; padding: 10px;\">\n            <strong style=\"color: #F39C12;\">Strict-Transport-Security</strong>\n            <p>max-age is too low (${age}). Should be at least 2592000 (30 days).</p>\n          </div>\n        </div>`;\n    }\n  }\n\n  if (xss && !xss[1].present) {\n    warnings += `\n      <div style=\"margin-top: 15px;\">\n        <div style=\"border-left: 4px solid #F39C12; padding: 10px;\">\n          <strong style=\"color: #F39C12;\">Missing X-XSS-Protection</strong>\n          <p>This header enables the browser's XSS filter. Lack of it increases XSS risks.</p>\n        </div>\n      </div>`;\n  }\n\n  if (!warnings) {\n    warnings = `\n      <div style=\"margin-top: 15px;\">\n        <div style=\"border-left: 4px solid #F39C12; padding: 10px;\">\n          <strong style=\"color: #F39C12;\">${auditData.warningCount} warnings detected</strong>\n          <p>See the Configuration Issues section below for more info.</p>\n        </div>\n      </div>`;\n  }\n\n  return warnings;\n}\n\nfunction formatLongValue(value) {\n  if (!value || typeof value !== 'string') return '[empty]';\n\n  // Convert URLs into clickable links\n  value = value.replace(/(https?:\\/\\/[^\\s]+)/g, '<a href=\"$1\" style=\"color: #3498DB; text-decoration: none;\" target=\"_blank\">$1</a>');\n\n  // Add line breaks after commas or semicolons for readability\n  if (value.length > 100) {\n    value = value.replace(/([,;])\\s*/g, '$1<br>');\n  }\n\n  return value;\n}\n\nfunction formatDetailedRawHeaders() {\n  const allHeaders = [];\n  const seen = new Set();\n\n  const addHeader = (name, value) => {\n    const key = name.toLowerCase();\n    if (seen.has(key)) return;\n    seen.add(key);\n\n    const status = Object.entries(auditData.headerStatus || {}).find(\n      ([k]) => k.toLowerCase() === name.toLowerCase()\n    );\n    const present = status ? status[1].present : !!value;\n\n    allHeaders.push({\n      name: name.trim(),\n      present,\n      value: value || '[empty]'\n    });\n  };\n\n  Object.entries(auditData.originalHeaders || {}).forEach(([key, value]) => {\n    if (key) addHeader(key, value);\n  });\n\n  const securityHeaders = [\n    'content-security-policy',\n    'strict-transport-security',\n    'x-content-type-options',\n    'x-frame-options',\n    'referrer-policy',\n    'permissions-policy',\n    'x-xss-protection'\n  ];\n\n  const isWarningHeader = (name, value) => {\n    const lower = name.toLowerCase();\n    if (lower === 'strict-transport-security') {\n      const match = value.match(/max-age=(\\d+)/);\n      return match && parseInt(match[1]) < 2592000;\n    }\n    if (lower === 'content-security-policy') return value.includes(\"'unsafe-inline'\");\n    return false;\n  };\n\n  const tableRows = allHeaders.map(header => {\n    const isSecurity = securityHeaders.includes(header.name.toLowerCase());\n    const warning = isSecurity && isWarningHeader(header.name, header.value);\n    const missing = isSecurity && !header.present;\n\n    let bgColor = '#F8F9FA';\n    let textColor = '#333';\n\n    if (isSecurity) {\n      if (missing) {\n        bgColor = '#FFEBEE';\n        textColor = '#C62828';\n      } else if (warning) {\n        bgColor = '#FFF9C4';\n        textColor = '#F57F17';\n      } else {\n        bgColor = '#E8F5E9';\n        textColor = '#2E7D32';\n      }\n    }\n\n    return `\n      <tr style=\"background-color: ${bgColor}; color: ${textColor};\">\n        <td title=\"${isSecurity ? (missing ? 'Missing' : (warning ? 'Needs review' : 'Secure')) : 'Informational'}\" style=\"padding: 8px; font-weight: bold;\">${header.name}</td>\n        <td style=\"padding: 8px; text-align: center;\">${header.present ? 'present' : 'absent'}</td>\n        <td style=\"padding: 8px; word-break: break-word; font-family: monospace;\">${formatLongValue(header.value)}</td>\n      </tr>`;\n  }).join('');\n\n  return `\n    <table style=\"width: 100%; border-collapse: collapse; margin-top: 10px;\">\n      <thead>\n        <tr style=\"background-color: #E0E0E0;\">\n          <th style=\"padding: 10px;\">Header</th>\n          <th style=\"padding: 10px;\">Status</th>\n          <th style=\"padding: 10px;\">Value</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${tableRows}\n      </tbody>\n    </table>`;\n}\n\n// Format additional information section\nfunction formatAdditionalInfo() {\n  const headers = [\n    {\n      name: 'access-control-allow-origin',\n      description: 'This is a very lax CORS policy. Such a policy should only be used on a public CDN.'\n    },\n    {\n      name: 'strict-transport-security',\n      description: 'HTTP Strict Transport Security is an excellent feature to support on your site and strengthens your implementation of TLS by getting the User Agent to enforce the use of HTTPS.'\n    },\n    {\n      name: 'content-security-policy',\n      description: 'Content Security Policy is an effective measure to protect your site from XSS attacks. By whitelisting sources of approved content, you can prevent the browser from loading malicious assets. Analyse this policy in more detail. You can sign up for a free account on Report URI to collect reports about problems on your site.'\n    },\n    {\n      name: 'permissions-policy',\n      description: 'Permissions Policy is a new header that allows a site to control which features and APIs can be used in the browser.'\n    },\n    {\n      name: 'referrer-policy',\n      description: 'Referrer Policy is a new header that allows a site to control how much information the browser includes with navigations away from a document and should be set by all sites.'\n    },\n    {\n      name: 'x-content-type-options',\n      description: 'X-Content-Type-Options stops a browser from trying to MIME-sniff the content type and forces it to stick with the declared content-type. The only valid value for this header is \"X-Content-Type-Options: nosniff\".'\n    },\n    {\n      name: 'x-frame-options',\n      description: 'X-Frame-Options tells the browser whether you want to allow your site to be framed or not. By preventing a browser from framing your site you can defend against attacks like clickjacking.'\n    },\n    {\n      name: 'report-to',\n      description: 'Report-To enables the Reporting API. This allows a website to collect reports from the browser about various errors that may occur. You can sign up for a free account on Report URI to collect these reports.'\n    },\n    {\n      name: 'nel',\n      description: 'Network Error Logging is a new header that instructs the browser to send reports during various network or application errors. You can sign up for a free account on Report URI to collect these reports.'\n    },\n    {\n      name: 'server',\n      description: 'Server value has been changed. Typically you will see values like \"Microsoft-IIS/8.0\" or \"nginx 1.7.2\".'\n    }\n  ];\n  \n  let rows = '';\n  \n  for (const header of headers) {\n    const isSecurityHeader = ['content-security-policy', 'strict-transport-security', 'x-content-type-options', 'x-frame-options', 'referrer-policy', 'permissions-policy'].includes(header.name);\n    const headerColor = isSecurityHeader ? '#27AE60' : '#3498DB';\n    \n    rows += `\n      <tr>\n        <td style=\"padding: 8px; border-bottom: 1px solid #eee; color: ${headerColor}; font-weight: bold;\">${header.name}</td>\n        <td style=\"padding: 8px; border-bottom: 1px solid #eee;\">${header.description}</td>\n      </tr>\n    `;\n  }\n  \n  return `\n    <table style=\"width: 100%; border-collapse: collapse; margin-top: 10px;\">\n      <tbody>\n        ${rows}\n      </tbody>\n    </table>\n  `;\n}\n\nfunction formatSecurityGrade() {\n  const gradeColors = {\n    'A+': '#27AE60',\n    'A': '#27AE60',\n    'A-': '#27AE60',\n    'B+': '#3498DB',\n    'B': '#3498DB',\n    'B-': '#3498DB',\n    'C+': '#F39C12',\n    'C': '#F39C12',\n    'C-': '#F39C12',\n    'D+': '#E74C3C',\n    'D': '#E74C3C',\n    'D-': '#E74C3C',\n    'F': '#E74C3C'\n  };\n  \n  return `<div class=\"grade\" style=\"font-size: 64px; font-weight: bold; width: 100px; height: 100px; line-height: 100px; text-align: center; background-color: ${gradeColors[auditData.grade] || '#E74C3C'}; color: white; border-radius: 5px; margin: 0 auto;\">${auditData.grade}</div>`;\n}\n\nfunction formatCriticalVulnerabilities() {\n  if (!auditData.vulnOutput || auditData.vulnOutput.trim() === '') {\n    return '<p>No vulnerabilities detected.</p>';\n  }\n\n  try {\n    const vuln = auditData.vulnOutput.trim();\n    let html = '';\n    const renderedTitles = new Set();\n\n    // Match sections like ## Category (e.g., ## Critical Vulnerabilities)\n    const categories = vuln.split(/(?=^##\\s+)/gm).filter(Boolean);\n\n    for (const categoryBlock of categories) {\n      const categoryMatch = categoryBlock.match(/^##\\s+(.*)/);\n      const categoryTitle = categoryMatch?.[1]?.trim() || 'Uncategorized';\n\n      // Find numbered items: 1. **Title**\n      const vulns = categoryBlock.split(/(?=^\\d+\\.\\s+\\*\\*)/gm).filter(Boolean);\n\n      for (const vulnBlock of vulns) {\n        const titleMatch = vulnBlock.match(/^\\d+\\.\\s+\\*\\*(.*?)\\*\\*/);\n        const title = titleMatch?.[1]?.trim() || 'Unnamed Vulnerability';\n        const key = `${categoryTitle}::${title}`.toLowerCase();\n        if (renderedTitles.has(key)) continue;\n\n        const descriptionMatch = vulnBlock.match(/\\*\\*Description\\*\\*:?\\s*([\\s\\S]*?)(?=\\n\\*\\*|\\n$)/i);\n        const impactMatch = vulnBlock.match(/\\*\\*(?:Impact|Potential Impact)\\*\\*:?\\s*([\\s\\S]*?)(?=\\n\\*\\*|\\n$)/i);\n        const recommendationMatch = vulnBlock.match(/\\*\\*(?:Recommendation|Mitigation|Fix)\\*\\*:?\\s*([\\s\\S]*?)(?=\\n\\*\\*|\\n$)/i);\n\n        const description = descriptionMatch?.[1]?.trim() || '';\n        const impact = impactMatch?.[1]?.trim() || '';\n        const recommendation = recommendationMatch?.[1]?.trim() || '';\n\n        if (description || impact || recommendation) {\n          html += `\n            <div style=\"border-left: 4px solid #E74C3C; padding: 10px; margin-bottom: 15px;\">\n              <div style=\"font-weight: bold; color: #E74C3C;\">${title}</div>\n              ${description ? `<div style=\"margin-top: 5px;\">${description}</div>` : ''}\n              ${impact ? `<div style=\"margin-top: 5px; font-style: italic; color: #7F8C8D;\">Impact: ${impact}</div>` : ''}\n              ${recommendation ? `<div style=\"margin-top: 5px;\"><strong>Recommendation:</strong> ${recommendation}</div>` : ''}\n            </div>`;\n          renderedTitles.add(key);\n        }\n      }\n    }\n\n    return html || '<p>No vulnerabilities parsed from output.</p>';\n  } catch (e) {\n    console.error('Error in formatCriticalVulnerabilities:', e);\n    return `<p>Error processing vulnerabilities: ${e.message}</p>`;\n  }\n}\n\n\n// Generate all security header badges\nfunction generateAllHeaderBadges() {\n  // Only include the necessary security headers\n  const securityHeaders = [\n    'Content-Security-Policy',\n    'Strict-Transport-Security',\n    'X-Content-Type-Options',\n    'X-Frame-Options',\n    'Referrer-Policy',\n    'Permissions-Policy'\n  ];\n  \n  let badges = '';\n  securityHeaders.forEach(header => {\n                      \n    const isWarning = header === 'Strict-Transport-Security' &&\n                  auditData.headerStatus?.[header]?.value &&\n                  parseInt(auditData.headerStatus[header].value.match(/max-age=(\\d+)/)?.[1] || 0) < 2592000;\n    \n    badges += createHeaderBadge(header, isWarning);\n  });\n  \n  return badges;\n}\n\n<!-- Modify the HTML to directly access auditData.originalHeaders or allHeaders -->\nconst html = `<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Website Security Audit Report</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f9f9f9; }\n        .container { max-width: 950px; margin: 0 auto; }\n        .header { background-color: #2c3e50; color: white; padding: 25px 20px; text-align: center; }\n        .header h1 { color: white; font-size: 28px; margin: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }\n        .content { padding: 20px; }\n        .summary-box { background-color: #EBF5FB; padding: 15px; margin-bottom: 20px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n        .warning-box { background-color: #FEF5E7; padding: 15px; margin-bottom: 20px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n        .headers-box { background-color: #F5F7FA; padding: 15px; margin-bottom: 20px; border-radius: 5px; }\n        .findings-box { background-color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n        .raw-headers-box { background-color: #F5F7FA; padding: 15px; margin-bottom: 20px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n        .additional-info-box { background-color: #F5F7FA; padding: 15px; margin-bottom: 20px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n        .details-table { width: 100%; border-collapse: collapse; }\n        .details-table th { text-align: left; padding: 8px; background-color: #f2f2f2; }\n        .details-table td { padding: 8px; border-bottom: 1px solid #eee; }\n        .header-badges { margin-top: 10px; }\n        h1, h2, h3 { color: #2c3e50; }\n        .critical-item { border-left: 4px solid #E74C3C; padding: 10px; margin-bottom: 15px; }\n        .critical-title { font-weight: bold; color: #E74C3C; }\n        .config-item { border-left: 4px solid #3498DB; padding: 10px; margin-bottom: 15px; }\n        .config-title { font-weight: bold; color: #3498DB; }\n        pre { background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-family: monospace; margin-top: 5px; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Report Header -->\n        <div class=\"header\">\n            <h1 style=\"color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);\">Website Security Audit Report</h1>\n        </div>\n        \n        <div class=\"content\">\n            <!-- Security Report Summary -->\n            <div class=\"summary-box\">\n                <h2>Security Report Summary</h2>\n                <table style=\"width: 100%;\">\n                    <tr>\n                        <td style=\"width: 120px;\" valign=\"top\">\n                            ${formatSecurityGrade()}\n                        </td>\n                        <td valign=\"top\">\n                            <table style=\"width: 100%;\">\n                                <tr>\n                                    <td><strong>Site:</strong></td>\n                                    <td><a href=\"${auditData.url}\" style=\"color: #3498db;\">${auditData.url}</a></td>\n                                </tr>\n                                <tr>\n                                    <td><strong>Report Time:</strong></td>\n                                    <td>${auditData.timestamp}</td>\n                                </tr>\n                                <tr>\n                                    <td valign=\"top\"><strong>Headers:</strong></td>\n                                    <td>\n                                        <div class=\"header-badges\">\n                                            ${generateAllHeaderBadges()}\n                                        </div>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td><strong>Critical Issues:</strong></td>\n                                    <td>${auditData.criticalCount || 0}</td>\n                                </tr>\n                                <tr>\n                                    <td><strong>Warnings:</strong></td>\n                                    <td>${auditData.warningCount || 0}</td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n\n            <!-- Warnings Section -->\n            <div class=\"warning-box\">\n                <h2>Warnings</h2>\n                ${formatWarningsSection()}\n            </div>\n\n            <!-- Raw Headers Section -->\n            <div class=\"raw-headers-box\">\n                <h2>Raw Headers</h2>\n                ${formatDetailedRawHeaders()}\n            </div>\n\n            <!-- Security Findings -->\n            <div class=\"findings-box\">\n                <h2>Security Findings</h2>\n                \n                <!-- Vulnerabilities -->\n                <h3>Vulnerabilities</h3>\n                ${formatCriticalVulnerabilities()}\n                \n                <!-- Configuration Issues -->\n                <h3>Configuration Issues</h3>\n                ${formatConfigurationIssues()}\n            </div>\n            \n            <div class=\"additional-info-box\">\n              <h2>Additional Information</h2>\n              ${formatAdditionalInfo()}\n            </div>\n            \n            <!-- Implementation Guide -->\n            <div class=\"findings-box\">\n                <h2>Implementation Guide</h2>\n                <p>This report highlights security issues detected through client-side analysis. For a comprehensive security assessment, consider engaging a professional penetration tester.</p>\n                \n                <div style=\"background-color: #eafaf1; padding: 15px; margin-top: 15px; border-left: 4px solid #2ecc71; border-radius: 3px;\">\n                    <p><strong>To implement the fixes above:</strong></p>\n                    <ol style=\"padding-left: 20px; margin-top: 10px;\">\n                        <li>Work with your development team to address each issue in order of criticality</li>\n                        <li>Retest after implementing each fix</li>\n                        <li>Consider implementing a web application firewall for additional protection</li>\n                    </ol>\n                </div>\n            </div>\n            \n            <!-- Footer -->\n            <div style=\"text-align: center; padding: 20px; font-size: 12px; color: #777;\">\n                <p>This report was automatically generated and represents an automated assessment of publicly accessible aspects of your website. For a more comprehensive security assessment, consider engaging with a professional security consultant.</p>\n                <p>&copy; 2025 Website Security Scanner | Generated on ${auditData.timestamp}</p>\n            </div>\n        </div>\n    </div>\n</body>\n</html>`;\n\nreturn [{\n  json: {\n    ...items[0].json,\n    emailHtml: html\n  }\n}];"
        },
        "typeVersion": 2
      }
    ],
    "pinData": {},
    "connections": {
      "Scrape Website": {
        "main": [
          [
            {
              "node": "Security Vulnerabilities Audit",
              "type": "main",
              "index": 0
            },
            {
              "node": "Extract Headers for Debug",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "convert to HTML": {
        "main": [
          [
            {
              "node": "Send Security Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Landing Page Url": {
        "main": [
          [
            {
              "node": "Scrape Website",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Audit Results": {
        "main": [
          [
            {
              "node": "convert to HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Security Results": {
        "main": [
          [
            {
              "node": "Aggregate Audit Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Audit Results": {
        "main": [
          [
            {
              "node": "Process Audit Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Content Analysis": {
        "ai_languageModel": [
          [
            {
              "node": "Security Vulnerabilities Audit",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Headers Analysis": {
        "ai_languageModel": [
          [
            {
              "node": "Security Configuration Audit",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Extract Headers for Debug": {
        "main": [
          [
            {
              "node": "Security Configuration Audit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Security Configuration Audit": {
        "main": [
          [
            {
              "node": "Merge Security Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Security Vulnerabilities Audit": {
        "main": [
          [
            {
              "node": "Merge Security Results",
              "type": "main",
              "index": 1
            }
          ]
        ]
      }
    }
  },
  {
    "id": "6zSE618gr9fDtAfF",
    "meta": {
      "instanceId": "31e69f7f4a77bf465b805824e303232f0227212ae922d12133a0f96ffeab4fef",
      "templateCredsSetupCompleted": true
    },
    "name": "ü§ñüßë‚Äçüíª AI Agent  for Top n8n Creators Leaderboard Reporting",
    "tags": [],
    "nodes": [
      {
        "id": "5b9537db-41d3-4d8a-bf41-f875e4044224",
        "name": "stats_aggregate_creators",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -1240,
          1300
        ],
        "parameters": {
          "url": "={{ $json.path }}{{ $json['creators-filename'] }}.json",
          "options": {}
        },
        "typeVersion": 4.2
      },
      {
        "id": "feb2328b-57b0-4280-98d8-6b946db0c947",
        "name": "stats_aggregate_workflows",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -1240,
          1500
        ],
        "parameters": {
          "url": "={{ $json.path }}{{ $json['workflows-filename'] }}.json",
          "options": {}
        },
        "typeVersion": 4.2
      },
      {
        "id": "53f8b825-b030-4541-b12b-6df6702f7d1b",
        "name": "Global Variables",
        "type": "n8n-nodes-base.set",
        "position": [
          -1660,
          1460
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "4bcb91c6-d250-4cb4-8ee1-022df13550e1",
                "name": "path",
                "type": "string",
                "value": "https://raw.githubusercontent.com/teds-tech-talks/n8n-community-leaderboard/refs/heads/main/"
              },
              {
                "id": "a910a798-0bfe-41b1-a4f1-41390c7f6997",
                "name": "workflows-filename",
                "type": "string",
                "value": "=stats_aggregate_workflows"
              },
              {
                "id": "e977e816-dc1e-43ce-9393-d6488e6832ca",
                "name": "creators-filename",
                "type": "string",
                "value": "=stats_aggregate_creators"
              },
              {
                "id": "14233ab4-3fa4-4e26-8032-6ffe26cb601e",
                "name": "datetime",
                "type": "string",
                "value": "={{ $now.format('yyyy-MM-dd') }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "202026ea-054f-45ae-84f6-59ec58794f1c",
        "name": "Parse Workflow Data",
        "type": "n8n-nodes-base.set",
        "position": [
          -880,
          1540
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "76f4b20e-519e-4d46-aeac-c6c3f98a69fd",
                "name": "data",
                "type": "array",
                "value": "={{ $json.data }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "54ecfc96-0f5e-4275-a53b-f87850926d7f",
        "name": "Parse Creators Data",
        "type": "n8n-nodes-base.set",
        "position": [
          -880,
          1200
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "76f4b20e-519e-4d46-aeac-c6c3f98a69fd",
                "name": "data",
                "type": "array",
                "value": "={{ $json.data }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "e590677e-a8ff-4b76-8527-e5bdc0076610",
        "name": "Aggregate",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          -680,
          1820
        ],
        "parameters": {
          "options": {},
          "aggregate": "aggregateAllItemData"
        },
        "typeVersion": 1
      },
      {
        "id": "7d7ef0f2-dbca-4b24-b2e5-c1236c4beb81",
        "name": "gpt-4o-mini",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -1880,
          780
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {
            "temperature": 0.1
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "jEMSvKmtYfzAkhe6",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "59e7066f-da3b-4461-9a52-0f8754b696ae",
        "name": "When Executed by Another Workflow",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "position": [
          -1980,
          1460
        ],
        "parameters": {
          "inputSource": "jsonExample",
          "jsonExample": "{\n  \"query\": \n    {\n      \"username\": \n      \"joe\"\n    }\n}"
        },
        "typeVersion": 1.1
      },
      {
        "id": "18734480-3520-4e37-af19-977ec3bfb260",
        "name": "Workflow Tool",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          -1540,
          780
        ],
        "parameters": {
          "name": "n8n_creator_stats",
          "workflowId": "={{ $workflow.id }}",
          "description": "Call this tool to get n8n Creator Stats.",
          "jsonSchemaExample": "{\n  \"username\": \"n8n creator username\"\n}",
          "specifyInputSchema": true
        },
        "typeVersion": 1
      },
      {
        "id": "4b2195bd-d506-4cd5-bb9d-37cf84c8cebf",
        "name": "creator-summary",
        "type": "n8n-nodes-base.convertToFile",
        "position": [
          -1140,
          60
        ],
        "parameters": {
          "options": {
            "fileName": "=creators-report"
          },
          "operation": "toText",
          "sourceProperty": "output"
        },
        "typeVersion": 1.1
      },
      {
        "id": "ca25473a-0e19-45e0-8de5-00601c95fdf9",
        "name": "Workflow Response",
        "type": "n8n-nodes-base.set",
        "position": [
          -480,
          1820
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "eeff1310-2e1c-4ea4-9107-a14b1979f74f",
                "name": "response",
                "type": "string",
                "value": "={{ $json.data }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "c45c9bc8-e0d9-496a-bf8d-71c806c330de",
        "name": "Save creator-summary.md",
        "type": "n8n-nodes-base.readWriteFile",
        "position": [
          -940,
          60
        ],
        "parameters": {
          "options": {
            "append": true
          },
          "fileName": "=C:\\\\Users\\\\joe\\Downloads\\\\{{ $binary.data.fileName }}-{{ $now.format('yyyy-MM-dd-hh-mm-ss') }}.md",
          "operation": "write"
        },
        "typeVersion": 1
      },
      {
        "id": "0cddb18b-7924-41f6-b429-a00e4c904b47",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2060,
          240
        ],
        "parameters": {
          "color": 5,
          "width": 780,
          "height": 740,
          "content": "## AI Agent for n8n Creator Leaderboard Stats\nhttps://github.com/teds-tech-talks/n8n-community-leaderboard"
        },
        "typeVersion": 1
      },
      {
        "id": "6e1a7ffe-bac6-43d8-b7e8-866eb5fcb9f7",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1640,
          620
        ],
        "parameters": {
          "width": 280,
          "height": 300,
          "content": "## Tool Call for n8n Creators Stats\nhttps://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.toolworkflow/"
        },
        "typeVersion": 1
      },
      {
        "id": "892ac156-a276-4697-9b25-768301991996",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1980,
          620
        ],
        "parameters": {
          "color": 7,
          "width": 300,
          "height": 300,
          "content": "## OpenAI LLM\nhttps://platform.openai.com/api-keys"
        },
        "typeVersion": 1
      },
      {
        "id": "1e3cdf04-b33f-4a64-83c8-f24c424380b2",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1240,
          -60
        ],
        "parameters": {
          "width": 540,
          "height": 320,
          "content": "## Save n8n Creators & Workflows Report Locally\n(optional for local install)"
        },
        "typeVersion": 1
      },
      {
        "id": "a01adc65-9425-460b-85ed-fac4c82f1e78",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1760,
          1340
        ],
        "parameters": {
          "width": 300,
          "height": 320,
          "content": "## Global Workflow Variables\n\n"
        },
        "typeVersion": 1
      },
      {
        "id": "f7523185-7d36-4839-bfd3-d101fc1164fa",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1800,
          1100
        ],
        "parameters": {
          "color": 3,
          "width": 780,
          "height": 640,
          "content": "## Daily n8n Leaderboard Stats\nhttps://github.com/teds-tech-talks/n8n-community-leaderboard\n\n### n8n Leaderboard\nhttps://teds-tech-talks.github.io/n8n-community-leaderboard/"
        },
        "typeVersion": 1
      },
      {
        "id": "79381486-6caf-4629-94ac-d7cfef44c437",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -980,
          1100
        ],
        "parameters": {
          "color": 6,
          "width": 1120,
          "height": 300,
          "content": "## n8n Creators Stats"
        },
        "typeVersion": 1
      },
      {
        "id": "6099f718-37d2-45a6-806c-2196dbf6736b",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -980,
          1440
        ],
        "parameters": {
          "color": 4,
          "width": 1120,
          "height": 300,
          "content": "## n8n Workflow Stats"
        },
        "typeVersion": 1
      },
      {
        "id": "1270338c-1a9f-4a90-a5f1-7efd7547de4e",
        "name": "Creators Data",
        "type": "n8n-nodes-base.set",
        "position": [
          -60,
          1200
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "02b02023-c5a2-4e22-bcf9-2284c434f5d3",
                "name": "name",
                "type": "string",
                "value": "={{ $json.user.name }}"
              },
              {
                "id": "4582435b-3c76-45e7-a251-12055efa890a",
                "name": "username",
                "type": "string",
                "value": "={{ $json.user.username }}"
              },
              {
                "id": "b713a971-ce29-43cf-8f42-c426a38c6582",
                "name": "bio",
                "type": "string",
                "value": "={{ $json.user.bio }}"
              },
              {
                "id": "19a06510-802e-4bd5-9552-7afa7355ff92",
                "name": "sum_unique_weekly_inserters",
                "type": "number",
                "value": "={{ $json.sum_unique_weekly_inserters }}"
              },
              {
                "id": "e436533a-5170-47c2-809b-7d79502eb009",
                "name": "sum_unique_monthly_inserters",
                "type": "number",
                "value": "={{ $json.sum_unique_monthly_inserters }}"
              },
              {
                "id": "198fef5d-86b8-4009-b187-6d3e6566d137",
                "name": "sum_unique_inserters",
                "type": "number",
                "value": "={{ $json.sum_unique_inserters }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "3fd50542-2067-4dd4-a3ae-006aa4f9b030",
        "name": "Workflows Data",
        "type": "n8n-nodes-base.set",
        "position": [
          -60,
          1540
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "3bc3cd11-904d-4315-974d-262c0bd5fea7",
                "name": "template_url",
                "type": "string",
                "value": "={{ $json.template_url }}"
              },
              {
                "id": "c846c523-f077-40cd-b548-32460124ffb9",
                "name": "wf_detais.name",
                "type": "string",
                "value": "={{ $json.wf_detais.name }}"
              },
              {
                "id": "f330de47-56fb-4657-8a30-5f5e5cfa76d7",
                "name": "wf_detais.createdAt",
                "type": "string",
                "value": "={{ $json.wf_detais.createdAt }}"
              },
              {
                "id": "f7ed7e51-a7cf-4f2e-8819-f33115c5ad51",
                "name": "wf_detais.description",
                "type": "string",
                "value": "={{ $json.wf_detais.description }}"
              },
              {
                "id": "02b02023-c5a2-4e22-bcf9-2284c434f5d3",
                "name": "name",
                "type": "string",
                "value": "={{ $json.user.name }}"
              },
              {
                "id": "4582435b-3c76-45e7-a251-12055efa890a",
                "name": "username",
                "type": "string",
                "value": "={{ $json.user.username }}"
              },
              {
                "id": "f952cad3-7e62-46b7-aeb7-a5cbf4d46c0d",
                "name": "unique_weekly_inserters",
                "type": "number",
                "value": "={{ $json.unique_weekly_inserters }}"
              },
              {
                "id": "6123302b-5bda-48f4-9ef2-71ff52a5f3ba",
                "name": "unique_monthly_inserters",
                "type": "number",
                "value": "={{ $json.unique_monthly_inserters }}"
              },
              {
                "id": "92dca169-e03f-42ad-8790-ebb55c1a7272",
                "name": "unique_weekly_visitors",
                "type": "number",
                "value": "={{ $json.unique_weekly_visitors }}"
              },
              {
                "id": "ee640389-d396-4d65-8110-836372a51fb0",
                "name": "unique_monthly_visitors",
                "type": "number",
                "value": "={{ $json.unique_monthly_visitors }}"
              },
              {
                "id": "9f1c5599-3672-4f4e-9742-d7cc564f6714",
                "name": "user.avatar",
                "type": "string",
                "value": "={{ $json.user.avatar }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "6ad04027-1df9-402d-b98c-de7ec7e62cae",
        "name": "Merge Creators & Workflows",
        "type": "n8n-nodes-base.merge",
        "position": [
          240,
          1540
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "joinMode": "enrichInput1",
          "fieldsToMatchString": "username"
        },
        "typeVersion": 3
      },
      {
        "id": "fdf56c84-804a-46e2-8058-8a4374ba21b7",
        "name": "Split Out Creators",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -680,
          1200
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "data"
        },
        "typeVersion": 1
      },
      {
        "id": "cac2e121-f0a9-4142-86c7-5549b8b3631d",
        "name": "Split Out Workflows",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -680,
          1540
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "data"
        },
        "typeVersion": 1
      },
      {
        "id": "4a32eb8c-07d2-4a71-bb60-9e2c2eeda7f6",
        "name": "Sort By Top Weekly Creator Inserts",
        "type": "n8n-nodes-base.sort",
        "position": [
          -480,
          1200
        ],
        "parameters": {
          "options": {},
          "sortFieldsUi": {
            "sortField": [
              {
                "order": "descending",
                "fieldName": "sum_unique_weekly_inserters"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "f39b2e87-cc3a-4e90-84dc-18ae663608d6",
        "name": "Sort By Top Weekly Workflow Inserts",
        "type": "n8n-nodes-base.sort",
        "position": [
          -480,
          1540
        ],
        "parameters": {
          "options": {},
          "sortFieldsUi": {
            "sortField": [
              {
                "order": "descending",
                "fieldName": "unique_weekly_inserters"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "85ae9c6b-50bd-40df-bebd-e7522df61f3c",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2060,
          1020
        ],
        "parameters": {
          "color": 7,
          "width": 2510,
          "height": 1000,
          "content": "## Workflow for n8n Creators Stats"
        },
        "typeVersion": 1
      },
      {
        "id": "7aaf6f1b-a42b-49e6-a9bd-27c8ee2b6e83",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1340,
          1140
        ],
        "parameters": {
          "color": 7,
          "width": 280,
          "height": 560,
          "content": "## GET n8n Stats from GitHub repo\nhttps://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/"
        },
        "typeVersion": 1
      },
      {
        "id": "5aa6990b-c764-4d5a-ab68-c6f12b3d3b70",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -2260,
          380
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 22
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "160fa10e-9697-4c84-ba13-d701baaee782",
        "name": "Take Top 10 Creators",
        "type": "n8n-nodes-base.limit",
        "position": [
          -260,
          1200
        ],
        "parameters": {
          "maxItems": 10
        },
        "typeVersion": 1
      },
      {
        "id": "09d8cc25-7ea7-4793-a891-90f8b577df81",
        "name": "Take Top 50 Workflows",
        "type": "n8n-nodes-base.limit",
        "position": [
          -260,
          1540
        ],
        "parameters": {
          "maxItems": 50
        },
        "typeVersion": 1
      },
      {
        "id": "c3ebbc08-151e-4f18-848f-ddec2a720edc",
        "name": "Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          -1040,
          460
        ],
        "parameters": {
          "name": "=n8n Creator Stats Report - {{ $now.format('yyyy-MM-dd:hh:mm:ss') }}",
          "content": "={{ $json.output }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "root",
            "cachedResultName": "/ (Root folder)"
          },
          "operation": "createFromText"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "0a2ff2ea-6120-49e2-adda-547830b4f9f8",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -320,
          1060
        ],
        "parameters": {
          "width": 220,
          "height": 720,
          "content": "## Settings\nChange these settings to suit your needs"
        },
        "typeVersion": 1
      },
      {
        "id": "f5db76e5-8058-4771-8a3b-0116f0abb6a3",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1240,
          300
        ],
        "parameters": {
          "color": 6,
          "width": 540,
          "height": 340,
          "content": "## Save n8n Creator & Workflows Report to Google Drive\nhttps://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googledrive/"
        },
        "typeVersion": 1
      },
      {
        "id": "4594d952-8d21-40ac-8654-4a050c96a686",
        "name": "Sticky Note12",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1240,
          680
        ],
        "parameters": {
          "color": 4,
          "width": 540,
          "height": 300,
          "content": "## Email n8n Creators & Workflows Report\nhttps://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.gmail/"
        },
        "typeVersion": 1
      },
      {
        "id": "784b5047-9fdf-40db-ab07-436c12d749d0",
        "name": "Convert Markdown to HTML",
        "type": "n8n-nodes-base.markdown",
        "position": [
          -1140,
          780
        ],
        "parameters": {
          "mode": "markdownToHtml",
          "options": {},
          "markdown": "={{ $json.output }}"
        },
        "typeVersion": 1
      },
      {
        "id": "cab1978f-9aa0-4cd8-901c-f6ad615936c6",
        "name": "n8n Creators Stats Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -1800,
          380
        ],
        "parameters": {
          "text": "=Prepare a report about the n8n creators",
          "options": {
            "systemMessage": "=You are tasked with generating a **comprehensive Markdown report** about n8n community workflows and contributors using the provided tools. Your report should include meaningful insights about the contributors positive impact on the n8n community. Follow the structure below:\n\n## Detailed Summary\n- Provide a thorough summary of ALL contributor's workflows.\n- Highlight unique features, key use cases, and notable technical components for each workflow.\n- Include hyperlinks for each workflow.\n\n## Workflows\nCreate a well-formatted markdown table with these columns:\n- **Workflow Name**: The name of the workflow.  Keep the emojies of they exist.  Include hyperlinks for each workflow.\n- **Description**: A brief overview of its purpose and functionality.\n- **Unique Weekly Visitors**: The number of unique users who visited this workflow weekly.\n- **Unique Monthly Visitors**: The number of unique users who visited this workflow monthly.\n- **Unique Weekly Inserters**: The number of unique users who inserted this workflow weekly.\n- **Unique Monthly Inserters**: The number of unique users who inserted this workflow monthly.\n- **Why It‚Äôs Popular**: Explain what makes this workflow stand out (e.g., innovative features, ease of use, specific use cases).\n\n## Community Analysis\n- Analyze why these workflows are popular and valued by the n8n community.\n- Discuss any trends, patterns, or feedback that highlight their significance.\n\n## Additional Insights\n- If available, provide extra information about the contributor's overall impact, such as their engagement in community forums or other notable contributions.\n\n## Formatting Guidelines\n- Use Markdown formatting exclusively (headers, lists, and tables) for clarity and organization.\n- Ensure your response is concise yet comprehensive, structured for easy navigation.\n\n## Error Handling\n- If data is unavailable or incomplete, clearly state this in your response and suggest possible reasons or next steps.\n\n## TOOLS\n\n### n8n_creator_stats  \n- Use this tool to retrieve detailed statistics about the n8n creators.\n\n\n \n"
          },
          "promptType": "define"
        },
        "typeVersion": 1.7
      },
      {
        "id": "f94de0ba-4d27-4b00-8f6c-b15ea2f37af7",
        "name": "Sticky Note13",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -80,
          280
        ],
        "parameters": {
          "width": 320,
          "height": 340,
          "content": "## Telegram \n(Optional)\nhttps://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.telegram/"
        },
        "typeVersion": 1
      },
      {
        "id": "f50913c0-6615-4a5d-a4d4-2522280bc978",
        "name": "Google Gemini Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          -440,
          720
        ],
        "parameters": {
          "options": {
            "temperature": 0.2
          },
          "modelName": "models/gemini-2.0-flash-exp"
        },
        "credentials": {
          "googlePalmApi": {
            "id": "L9UNQHflYlyF9Ngd",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "137b191e-9dae-4396-a536-dd77126ef176",
        "name": "Create Top 10 Workflows List",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          -520,
          380
        ],
        "parameters": {
          "text": "=Create a list with hyperlinks of the top 10 workflows by weekly instertions from this report: {{ $json.output }}\n\nDo not include any preamble or further explanation.  ",
          "promptType": "define"
        },
        "typeVersion": 1.5
      },
      {
        "id": "6249b1e5-2f47-469a-8bcc-16f41ee1da12",
        "name": "Sticky Note14",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -660,
          280
        ],
        "parameters": {
          "color": 5,
          "width": 540,
          "height": 700,
          "content": "## Create Top 10 Workflows List\n"
        },
        "typeVersion": 1
      },
      {
        "id": "9564db34-8b19-474e-812c-8a9d2cd028cb",
        "name": "Sticky Note15",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -540,
          600
        ],
        "parameters": {
          "color": 7,
          "width": 300,
          "height": 280,
          "content": "## Google Gemini LLM\nhttps://aistudio.google.com/apikey"
        },
        "typeVersion": 1
      },
      {
        "id": "065624e9-7f45-4607-94e9-2bf5a4f983ef",
        "name": "Sticky Note16",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -80,
          680
        ],
        "parameters": {
          "color": 4,
          "width": 520,
          "height": 300,
          "content": "## Email Top 10 Workflows List\nhttps://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.gmail/"
        },
        "typeVersion": 1
      },
      {
        "id": "532c071f-3ae0-4afd-9569-2ecc2ccebb02",
        "name": "Convert Top 10 Markdown to HTML",
        "type": "n8n-nodes-base.markdown",
        "position": [
          20,
          780
        ],
        "parameters": {
          "mode": "markdownToHtml",
          "options": {},
          "markdown": "={{ $json.text }}"
        },
        "typeVersion": 1
      },
      {
        "id": "f3aa0206-4449-41b1-aa4e-1fec6c948250",
        "name": "Gmail Creators & Workflows Report",
        "type": "n8n-nodes-base.gmail",
        "position": [
          -940,
          780
        ],
        "webhookId": "2bad33f7-38f8-40ca-9bcd-2f51179c8db5",
        "parameters": {
          "sendTo": "joe@example.com",
          "message": "={{ $json.data }}",
          "options": {},
          "subject": "n8n Creator Stats"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "1xpVDEQ1yx8gV022",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "2521435a-ad6e-4724-a07c-7762860b3f55",
        "name": "Telegram Top 10  Workflows List",
        "type": "n8n-nodes-base.telegram",
        "onError": "continueRegularOutput",
        "position": [
          20,
          420
        ],
        "webhookId": "8406b3d2-5ac6-452d-847f-c0886c8cd058",
        "parameters": {
          "text": "=n8n Creators Report - Top 10 Workflows\n{{ $now }}\n----------------------------------------------------\n{{ $json.text }}",
          "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
          "additionalFields": {
            "parse_mode": "HTML",
            "appendAttribution": false
          }
        },
        "credentials": {
          "telegramApi": {
            "id": "pAIFhguJlkO3c7aQ",
            "name": "Telegram account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "f234a3c1-18ba-488e-a88d-4a05be9eb9f4",
        "name": "Gmail Top 10 Workflows List",
        "type": "n8n-nodes-base.gmail",
        "position": [
          220,
          780
        ],
        "webhookId": "2bad33f7-38f8-40ca-9bcd-2f51179c8db5",
        "parameters": {
          "sendTo": "joe@example.com",
          "message": "={{ $json.data }}",
          "options": {},
          "subject": "n8n Top 10 Workflows"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "1xpVDEQ1yx8gV022",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "1267b550-5c8a-4fa3-8f0a-4d18f16a57c4",
        "name": "Sticky Note17",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2640,
          580
        ],
        "parameters": {
          "width": 540,
          "height": 900,
          "content": "# n8n Top Creators Leaderboard Reporting Workflow\n\n## Why This Workflow is Important\nThis workflow is a powerful tool for reporting on the n8n community's creators and workflows. It provides valuable insights into the most popular workflows, top contributors, and community trends. By automating data aggregation, processing, and report generation, it saves time and effort while fostering collaboration and inspiration within the n8n ecosystem.\n\n### Key Benefits:\n- **Discover Trends**: Identify top workflows based on unique visitors and inserters.\n- **Recognize Contributors**: Highlight impactful creators driving community engagement.\n- **Save Time**: Automates the entire reporting process, from data retrieval to report creation.\n\n## How to Use It\n1. **Set Up Prerequisites**: Ensure your n8n instance is running, GitHub data files are accessible, Google Gmail/Drive and OpenAI credentials are configured and Google Gemini credentials are configured.\n\n2. **Trigger the Workflow**:\n   - Schedule the workflow to run daily or as needed.\n\n3. **Review Reports**:\n   - The workflow generates a detailed Markdown report with summaries, tables, and insights.\n   - Reports are saved locally or shared via email, Google Drive, or Telegram.\n\n\nThis workflow is ideal for creators, community managers, and new users looking to explore or optimize workflows within the n8n platform.\n"
        },
        "typeVersion": 1
      }
    ],
    "active": true,
    "pinData": {},
    "settings": {
      "timezone": "America/Vancouver",
      "callerPolicy": "workflowsFromSameOwner",
      "executionOrder": "v1"
    },
    "versionId": "619db74b-3f91-4d3b-b85d-e7e6bb972aca",
    "connections": {
      "Aggregate": {
        "main": [
          [
            {
              "node": "Workflow Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "gpt-4o-mini": {
        "ai_languageModel": [
          [
            {
              "node": "n8n Creators Stats Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Creators Data": {
        "main": [
          [
            {
              "node": "Merge Creators & Workflows",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Workflow Tool": {
        "ai_tool": [
          [
            {
              "node": "n8n Creators Stats Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Workflows Data": {
        "main": [
          [
            {
              "node": "Merge Creators & Workflows",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "creator-summary": {
        "main": [
          [
            {
              "node": "Save creator-summary.md",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Global Variables": {
        "main": [
          [
            {
              "node": "stats_aggregate_creators",
              "type": "main",
              "index": 0
            },
            {
              "node": "stats_aggregate_workflows",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "n8n Creators Stats Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Creators": {
        "main": [
          [
            {
              "node": "Sort By Top Weekly Creator Inserts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Creators Data": {
        "main": [
          [
            {
              "node": "Split Out Creators",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Workflow Data": {
        "main": [
          [
            {
              "node": "Split Out Workflows",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Workflows": {
        "main": [
          [
            {
              "node": "Sort By Top Weekly Workflow Inserts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Take Top 10 Creators": {
        "main": [
          [
            {
              "node": "Creators Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Take Top 50 Workflows": {
        "main": [
          [
            {
              "node": "Workflows Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert Markdown to HTML": {
        "main": [
          [
            {
              "node": "Gmail Creators & Workflows Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Create Top 10 Workflows List",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "n8n Creators Stats Agent": {
        "main": [
          [
            {
              "node": "creator-summary",
              "type": "main",
              "index": 0
            },
            {
              "node": "Google Drive",
              "type": "main",
              "index": 0
            },
            {
              "node": "Convert Markdown to HTML",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create Top 10 Workflows List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "stats_aggregate_creators": {
        "main": [
          [
            {
              "node": "Parse Creators Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "stats_aggregate_workflows": {
        "main": [
          [
            {
              "node": "Parse Workflow Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Creators & Workflows": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Top 10 Workflows List": {
        "main": [
          [
            {
              "node": "Convert Top 10 Markdown to HTML",
              "type": "main",
              "index": 0
            },
            {
              "node": "Telegram Top 10  Workflows List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert Top 10 Markdown to HTML": {
        "main": [
          [
            {
              "node": "Gmail Top 10 Workflows List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Global Variables",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sort By Top Weekly Creator Inserts": {
        "main": [
          [
            {
              "node": "Take Top 10 Creators",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sort By Top Weekly Workflow Inserts": {
        "main": [
          [
            {
              "node": "Take Top 50 Workflows",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "09423a3357ff64bdcc082268b9d577001317edbe377a3ccfb0b131ffb9554b30"
    },
    "nodes": [
      {
        "id": "99d822b5-2f86-4dee-94f2-8e0948a8d93e",
        "name": "Get all contacts",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          656,
          192
        ],
        "parameters": {
          "operation": "getAll",
          "returnAll": true,
          "authentication": "oAuth2",
          "additionalFields": {
            "propertiesCollection": {
              "propertiesValues": {
                "properties": [
                  "hs_v2_date_entered_lead"
                ],
                "propertyMode": "valueOnly"
              }
            }
          }
        },
        "credentials": {
          "hubspotOAuth2Api": {
            "id": "Vxqd8oQJmbtNmpRz",
            "name": "HubSpot account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "bad7066e-ec34-495d-a83a-ab88afef0b98",
        "name": "Filter leads added last week",
        "type": "n8n-nodes-base.filter",
        "position": [
          880,
          192
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "fd0fe4fb-9957-4ba0-9fc8-2eaccb02ef5e",
                "operator": {
                  "type": "dateTime",
                  "operation": "before"
                },
                "leftValue": "={{ $json.properties.hs_v2_date_entered_lead.value.toDateTime('ms') }}",
                "rightValue": "={{ $today }}"
              },
              {
                "id": "31eeb628-0bdf-4fa5-be83-05eb496c7d85",
                "operator": {
                  "type": "dateTime",
                  "operation": "after"
                },
                "leftValue": "={{ $json.properties.hs_v2_date_entered_lead.value.toDateTime('ms') }}",
                "rightValue": "={{ $today.minus(7, 'days') }}"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "ec02e91b-4f2e-4112-8a4f-0c6e3f8d43f4",
        "name": "Count leads",
        "type": "n8n-nodes-base.summarize",
        "position": [
          1104,
          192
        ],
        "parameters": {
          "options": {},
          "fieldsToSummarize": {
            "values": [
              {
                "field": "vid"
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "b3763fb5-90aa-44f4-80e0-cdb4e068bf13",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -208,
          16
        ],
        "parameters": {
          "color": 5,
          "width": 512,
          "height": 528,
          "content": "## Weekly HubSpot ‚ÄúNew Leads‚Äù ‚Üí Slack\n\n### How it works\n1. **Schedule** runs weekly.\n2. **HubSpot (contacts):** fetch all contacts.\n3. **Filter:** `hs_v2_date_entered_lead` within last 7 days.\n4. **Count** the leads.\n5. **Slack:** post ‚ÄúLast week we generated X leads.‚Äù\n6. *(Optional)* **Deals branch:** filter **Closed Won** last week and sum value.\n\n### Setup\n* [ ] Connect **HubSpot** (contacts & deals if using the optional branch)\n* [ ] Connect **Slack** and pick a channel\n* [ ] Set the weekly day/time on **Schedule Trigger**\n\n### Customize\n* **Lifecycle Stage:** switch to other lifecycle properties or custom fields.\n* **Slack Message:** add emojis, include the optional deals total, or mention owners.\n* **Deals:** sum a monetary field (e.g., `amount`) and include currency in the Slack text."
        },
        "typeVersion": 1
      },
      {
        "id": "f4572a98-acc0-4ca8-b777-e8632ab28729",
        "name": "Send report to a Slack channel",
        "type": "n8n-nodes-base.slack",
        "position": [
          1312,
          192
        ],
        "webhookId": "fbb3f4e8-43e5-42c4-8d5b-33832fb0e9fd",
        "parameters": {
          "text": "=Last week we generated a total of {{ $json.count_vid }} leads.",
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "otherOptions": {},
          "authentication": "oAuth2"
        },
        "credentials": {
          "slackOAuth2Api": {
            "id": "w28i2ZnlVpKE1xDv",
            "name": "Slack account"
          }
        },
        "typeVersion": 2.3
      },
      {
        "id": "b3f3fe78-6d15-43b7-a633-33d58a30ca16",
        "name": "Schedule the report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          432,
          192
        ],
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "weeks",
                "triggerAtDay": [
                  1
                ],
                "triggerAtHour": 7
              }
            ]
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "ca6981d1-1741-4adc-a4d7-302375a0692c",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          624,
          432
        ],
        "parameters": {
          "color": 7,
          "width": 656,
          "height": 240,
          "content": "You can use this for deals too"
        },
        "typeVersion": 1
      },
      {
        "id": "fee5c81d-5b90-4725-82da-c6130dbb3863",
        "name": "Get all deals",
        "type": "n8n-nodes-base.hubspot",
        "disabled": true,
        "position": [
          656,
          496
        ],
        "parameters": {
          "filters": {
            "properties": [
              "hs_is_closed_won",
              "hs_closed_won_date"
            ]
          },
          "resource": "deal",
          "operation": "getAll",
          "returnAll": true,
          "authentication": "oAuth2"
        },
        "typeVersion": 2.1
      },
      {
        "id": "91303c21-d105-4b2d-afe2-682e13091100",
        "name": "Filter won deals last week",
        "type": "n8n-nodes-base.filter",
        "position": [
          880,
          496
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "31eeb628-0bdf-4fa5-be83-05eb496c7d85",
                "operator": {
                  "type": "dateTime",
                  "operation": "after"
                },
                "leftValue": "={{ $json.properties.hs_closed_won_date.value.toDateTime('ms') }}",
                "rightValue": "={{ $today.minus(7, 'days')}}"
              },
              {
                "id": "2fc45c0d-c105-4ada-ad35-9336507757cf",
                "operator": {
                  "type": "dateTime",
                  "operation": "before"
                },
                "leftValue": "={{ $json.properties.hs_closed_won_date.value.toDateTime('ms') }}",
                "rightValue": "={{ $today }}"
              },
              {
                "id": "9be6ae28-501d-457b-a80c-aedd051c3a05",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.properties.hs_is_closed_won.value }}",
                "rightValue": "true"
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "6df7a16f-a3ae-4428-b900-2604f142d252",
        "name": "Sum deal value",
        "type": "n8n-nodes-base.summarize",
        "position": [
          1104,
          496
        ],
        "parameters": {
          "options": {},
          "fieldsToSummarize": {
            "values": [
              {
                "field": "vid",
                "aggregation": "sum"
              }
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "fb9890a6-e524-44dd-84c5-ae25815df9e6",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          384,
          144
        ],
        "parameters": {
          "color": 7,
          "width": 1120,
          "height": 224,
          "content": ""
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Count leads": {
        "main": [
          [
            {
              "node": "Send report to a Slack channel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get all deals": {
        "main": [
          [
            {
              "node": "Filter won deals last week",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get all contacts": {
        "main": [
          [
            {
              "node": "Filter leads added last week",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule the report": {
        "main": [
          [
            {
              "node": "Get all contacts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter won deals last week": {
        "main": [
          [
            {
              "node": "Sum deal value",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter leads added last week": {
        "main": [
          [
            {
              "node": "Count leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "InxpOwOAX7qfXIvX",
    "meta": {
      "instanceId": "9c8f658dbece48b519a8ad7757c7d7db7a30c5f3fd29c9dc8afae32fe0c7711a",
      "templateCredsSetupCompleted": true
    },
    "name": "WhatsApp RAG Chatbot with Supabase, Gemini 2.5 Flash, and OpenAI Embeddings",
    "tags": [],
    "nodes": [
      {
        "id": "d02befa0-18c6-4aa6-8c94-e84f6993a406",
        "name": "Retrieve Context from Supabase",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "position": [
          480,
          496
        ],
        "parameters": {
          "mode": "retrieve-as-tool",
          "options": {},
          "tableName": {
            "__rl": true,
            "mode": "list",
            "value": "documents",
            "cachedResultName": "documents"
          },
          "toolDescription": "call this tool to reach the goal"
        },
        "credentials": {
          "supabaseApi": {
            "id": "QkeJlJh5cCiuLpvg",
            "name": "Supabase account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "0a1543fa-c9ce-4d7a-8466-c778bb532cf9",
        "name": "New WhatsApp Message",
        "type": "n8n-nodes-base.whatsAppTrigger",
        "position": [
          -304,
          560
        ],
        "webhookId": "ec046705-b8f2-4b88-9b98-4fd99975f432",
        "parameters": {
          "options": {},
          "updates": [
            "messages"
          ]
        },
        "credentials": {
          "whatsAppTriggerApi": {
            "id": "yVPQQ9GPjNKE9nkZ",
            "name": "whatsApp_OAuth_api"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "79a849a1-da91-4af8-9ba4-7e6e504e4eeb",
        "name": "Check if Query or Document",
        "type": "n8n-nodes-base.switch",
        "position": [
          -48,
          560
        ],
        "parameters": {
          "rules": {
            "values": [
              {
                "outputKey": "query",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "dcd448ce-72f0-4c83-b721-3417a746473e",
                      "operator": {
                        "type": "object",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.messages[0].text }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              },
              {
                "outputKey": "document",
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "8b2b9810-08c7-452f-a2e0-ba1453586919",
                      "operator": {
                        "type": "object",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.messages[0].document }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true
              }
            ]
          },
          "options": {}
        },
        "typeVersion": 3.2
      },
      {
        "id": "50a072f5-e8ce-4eae-adf9-8fbf4fd494da",
        "name": "Convert File to Text",
        "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
        "position": [
          1008,
          1216
        ],
        "parameters": {
          "options": {},
          "dataType": "binary"
        },
        "typeVersion": 1.1
      },
      {
        "id": "3932f7f3-524e-40b1-87dd-c9ff1e85d95e",
        "name": "Generate OpenAI Embeddings",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "position": [
          816,
          1216
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "GVGOwCYLGI5SaqsK",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "75f6cdb9-ef4f-43cd-83ae-b8ceb602b876",
        "name": "Store Embeddings in Supabase",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "position": [
          896,
          928
        ],
        "parameters": {
          "mode": "insert",
          "options": {},
          "tableName": {
            "__rl": true,
            "mode": "list",
            "value": "documents",
            "cachedResultName": "documents"
          }
        },
        "credentials": {
          "supabaseApi": {
            "id": "QkeJlJh5cCiuLpvg",
            "name": "Supabase account"
          }
        },
        "typeVersion": 1.3
      },
      {
        "id": "d569775f-c2d0-4c12-bb89-fe36667de6ce",
        "name": "Google Gemini LLM",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "position": [
          352,
          496
        ],
        "parameters": {
          "options": {}
        },
        "credentials": {
          "googlePalmApi": {
            "id": "SuWwLWBsAfrDFgCm",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "ee2b82a8-cd95-4ff0-8e42-3d67eedd848d",
        "name": "RAG Query Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          368,
          272
        ],
        "parameters": {
          "text": "={{ $json.messages[0].text }}",
          "options": {},
          "promptType": "define"
        },
        "typeVersion": 2.1
      },
      {
        "id": "8eeb7e2c-11de-4ea5-8287-3ef026427f3d",
        "name": "Send WhatsApp Reply",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          912,
          272
        ],
        "webhookId": "e5e2f982-af07-4274-8937-88ef5109e71b",
        "parameters": {
          "textBody": "={{ $json.output }}",
          "operation": "send",
          "phoneNumberId": "768049963047541",
          "additionalFields": {},
          "recipientPhoneNumber": "={{ $('New WhatsApp Message').item.json.contacts[0].wa_id }}"
        },
        "credentials": {
          "whatsAppApi": {
            "id": "LV22R0NzX9vZLEp9",
            "name": "whatsapp_reply"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "a73408a1-1ea2-4867-9c3d-8b6d54989d7d",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          240,
          736
        ],
        "parameters": {
          "color": 7,
          "width": 960,
          "height": 384,
          "content": "## Document Flow:\n\n* Fetch file URL from WhatsApp message\n* Download and convert file to readable text\n* Generate embeddings with OpenAI\n* Store embeddings in Supabase for future queries"
        },
        "typeVersion": 1
      },
      {
        "id": "1281e915-20c7-462e-9416-c980a14790c6",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          240,
          80
        ],
        "parameters": {
          "color": 7,
          "width": 560,
          "height": 544,
          "content": "## Query Flow:\n\n- Convert user query into embeddings (OpenAI)\n- Match embeddings with Supabase vectors to find context\n- Send retrieved context to Gemini 2.5 Flash for answer\n- Return concise response to WhatsApp user"
        },
        "typeVersion": 1
      },
      {
        "id": "9a40bc48-1dbe-4ed9-9a7e-d6bf86b2e935",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -112,
          432
        ],
        "parameters": {
          "color": 7,
          "height": 304,
          "content": "## Message Check: \n- Determines if the message is a query(text) or a document upload. "
        },
        "typeVersion": 1
      },
      {
        "id": "72e122e4-f577-43ef-bf2e-e51712ef7bd9",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1168,
          208
        ],
        "parameters": {
          "width": 800,
          "height": 832,
          "content": "## Try It Out!\n### This n8n template demonstrates how to build a WhatsApp-based AI chatbot using **document retrieval (RAG)**.It stores documents in **Supabase** with **OpenAI embeddings** and generates user-friendly answers using **Gemini 2.5 Flash LLM**.\n\nUse cases: Turn your WhatsApp into a **knowledge assistant** for FAQs, customer support, or internal team knowledge.\n\n### How it works\n\n* **Trigger:** A WhatsApp webhook activates on every new message.\n* **Message Check:** Detects if the message is a document upload or a query.\n* **Document Handling:** File URL ‚Üí text conversion ‚Üí embeddings with OpenAI ‚Üí stored in Supabase.\n* **Query Handling:** Query embeddings ‚Üí retrieve context ‚Üí Gemini 2.5 Flash generates response.\n* **Reply:** Sends the answer back to the user via WhatsApp.\n\n### How to use\n\n* Configure **WhatsApp Business API**, **Supabase**, and **OpenAI credentials** in n8n‚Äôs credential manager.\n* Upload documents via WhatsApp to populate the vector database.\n* Ask questions directly on WhatsApp ‚Äî the bot retrieves context and replies instantly.\n\n### Requirements\n\n* WhatsApp Business API (or Twilio sandbox)\n* Supabase account (vector storage)\n* OpenAI API key (embeddings)\n* Gemini API access (LLM responses)\n\n### Need Help?\n\nDM me on [X (formerly Twitter)](https://x.com/manav170303) or email [titanfactz@gmail.com](mailto:titanfactz@gmail.com).\n\nAlways open to feedback and improvements!"
        },
        "typeVersion": 1
      },
      {
        "id": "7698302b-cba7-43ed-abbb-c6c036cd1380",
        "name": "Get Document URL",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          288,
          928
        ],
        "webhookId": "39934341-fa40-46c5-8c26-9aa2f2b3ffcf",
        "parameters": {
          "resource": "media",
          "operation": "mediaUrlGet",
          "mediaGetId": "={{ $json.messages[0].document.id }}"
        },
        "credentials": {
          "whatsAppApi": {
            "id": "LV22R0NzX9vZLEp9",
            "name": "whatsapp_reply"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "9eb653ec-15c8-4854-b841-7151efe2cf9d",
        "name": "Download WhatsApp Document",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          560,
          928
        ],
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {},
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "credentials": {
          "httpHeaderAuth": {
            "id": "y4by5K1yYvLIIf84",
            "name": "whatsapp"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "e0621b81-844e-4427-bee2-38ebbe0bd734",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1296,
          736
        ],
        "parameters": {
          "width": 336,
          "height": 832,
          "content": "## Document Upload Flow\n\nExample: Shows how a document is uploaded and detected in the workflow.  \n\n![Document Upload Example](https://github.com/Manav54321/WhatsApp-RAG-Chatbot-with-Supabase-Gemini-2.5-Flash-OpenAI-Embeddings/raw/main/screenshots/4956396C-F927-4308-9B7C-7F1CDEFE88F4_1_101_o.jpeg)\n"
        },
        "typeVersion": 1
      },
      {
        "id": "001539b5-1ea9-4656-ad10-bf07cb77393b",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1104,
          -192
        ],
        "parameters": {
          "width": 336,
          "height": 848,
          "content": "## Contextual Answer Flow\n\nExample: Demonstrates how the bot retrieves context from Supabase and responds with Gemini 2.5 Flash.  \n\n![Contextual Answer Example](https://github.com/Manav54321/WhatsApp-RAG-Chatbot-with-Supabase-Gemini-2.5-Flash-OpenAI-Embeddings/raw/main/screenshots/5FB5C957-2435-4FA1-93BA-9C9E0A749BF2_1_101_o.jpeg)\n"
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {},
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "daa23c09-b671-4bb3-b3c3-f84193cf0ad6",
    "connections": {
      "RAG Query Agent": {
        "main": [
          [
            {
              "node": "Send WhatsApp Reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Document URL": {
        "main": [
          [
            {
              "node": "Download WhatsApp Document",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini LLM": {
        "ai_languageModel": [
          [
            {
              "node": "RAG Query Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Convert File to Text": {
        "ai_document": [
          [
            {
              "node": "Store Embeddings in Supabase",
              "type": "ai_document",
              "index": 0
            }
          ]
        ]
      },
      "New WhatsApp Message": {
        "main": [
          [
            {
              "node": "Check if Query or Document",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check if Query or Document": {
        "main": [
          [
            {
              "node": "RAG Query Agent",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Document URL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download WhatsApp Document": {
        "main": [
          [
            {
              "node": "Store Embeddings in Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate OpenAI Embeddings": {
        "ai_embedding": [
          [
            {
              "node": "Store Embeddings in Supabase",
              "type": "ai_embedding",
              "index": 0
            },
            {
              "node": "Retrieve Context from Supabase",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Store Embeddings in Supabase": {
        "main": [
          []
        ]
      },
      "Retrieve Context from Supabase": {
        "ai_tool": [
          [
            {
              "node": "RAG Query Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "meta": {
      "instanceId": "408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9",
      "templateCredsSetupCompleted": true
    },
    "nodes": [
      {
        "id": "8eaf0925-1394-4771-bf43-281ad14fefb4",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          540,
          880
        ],
        "parameters": {
          "color": 4,
          "width": 301.3874093724939,
          "height": 371.765663140765,
          "content": "## Data check"
        },
        "typeVersion": 1
      },
      {
        "id": "ab31ac7c-6bd4-44f6-8c0c-8e41463a3983",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          560,
          940
        ],
        "parameters": {
          "color": 7,
          "width": 272.8190508599808,
          "height": 80,
          "content": "Checks that the data returned by OpenAI is correct"
        },
        "typeVersion": 1
      },
      {
        "id": "306ffdb5-d6b6-4e49-a26d-a256e32f7c67",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1940,
          880
        ],
        "parameters": {
          "color": 5,
          "width": 302,
          "height": 392,
          "content": "## Draft on WordPress"
        },
        "typeVersion": 1
      },
      {
        "id": "928da5f9-194c-461d-a5dd-7fd5c8563345",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1960,
          960
        ],
        "parameters": {
          "color": 7,
          "width": 254.77269221373095,
          "height": 80,
          "content": "The article is posted as a draft on WordPress"
        },
        "typeVersion": 1
      },
      {
        "id": "271f6b4d-cf7c-49b8-9479-dd753d7c5199",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2260,
          880
        ],
        "parameters": {
          "color": 3,
          "width": 678,
          "height": 389,
          "content": "## Featured image"
        },
        "typeVersion": 1
      },
      {
        "id": "efb047c4-b835-4706-af6a-b40c6cd76757",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2280,
          960
        ],
        "parameters": {
          "color": 7,
          "width": 517.9195082760601,
          "height": 80,
          "content": "The image is generated with Dall-E, uploaded to WordPress, and then connected to the post as its featured image"
        },
        "typeVersion": 1
      },
      {
        "id": "4f78eb2c-a501-4774-b5ab-29d7aa83817d",
        "name": "Sticky Note12",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          160,
          940
        ],
        "parameters": {
          "color": 7,
          "width": 287.370178643191,
          "height": 80,
          "content": "Starting from the given keywords, generates the article title, subtitle, chapters, and image prompt"
        },
        "typeVersion": 1
      },
      {
        "id": "536d265a-1c0b-4262-adab-96edd5924530",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          140,
          880
        ],
        "parameters": {
          "color": 6,
          "width": 360,
          "height": 371,
          "content": "## Article structure"
        },
        "typeVersion": 1
      },
      {
        "id": "8b4b7cf6-4809-44e7-af9a-c72919981698",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -400,
          880
        ],
        "parameters": {
          "color": 7,
          "width": 239.97343293577688,
          "height": 370.512611879577,
          "content": "## User form"
        },
        "typeVersion": 1
      },
      {
        "id": "734b8ac2-2148-4d56-ab04-84f12991cf44",
        "name": "Sticky Note13",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -380,
          940
        ],
        "parameters": {
          "color": 7,
          "width": 199.7721486302032,
          "height": 80,
          "content": "The user triggers the post creation"
        },
        "typeVersion": 1
      },
      {
        "id": "c54f91a7-ac3d-4029-a19f-3fa3794d581a",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2960,
          880
        ],
        "parameters": {
          "color": 7,
          "width": 220,
          "height": 391,
          "content": "## User feedback"
        },
        "typeVersion": 1
      },
      {
        "id": "509e89e7-8916-4228-91ae-baae25a75be7",
        "name": "Sticky Note14",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2980,
          960
        ],
        "parameters": {
          "color": 7,
          "width": 183.38125554060056,
          "height": 80,
          "content": "Final confirmation to the user"
        },
        "typeVersion": 1
      },
      {
        "id": "5c6e90c4-9714-43db-a82c-54fcbf43a26c",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          880,
          1280
        ],
        "parameters": {
          "color": 7,
          "width": 281.2716777103785,
          "height": 288.4116890365125,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nUser is notified to try again since some data is missing"
        },
        "typeVersion": 1
      },
      {
        "id": "54e10057-b300-475b-8280-cb761acc303a",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          140,
          1280
        ],
        "parameters": {
          "color": 7,
          "width": 340,
          "height": 275,
          "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWikipedia is used to write the article"
        },
        "typeVersion": 1
      },
      {
        "id": "5f5b9ad9-1da5-4321-b6b4-e1985ff257ca",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -120,
          880
        ],
        "parameters": {
          "color": 2,
          "width": 226.71615243495023,
          "height": 370.512611879577,
          "content": "## Settings"
        },
        "typeVersion": 1
      },
      {
        "id": "6e298414-634f-45fb-b931-2abcae9c6db1",
        "name": "Sticky Note15",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -100,
          940
        ],
        "parameters": {
          "color": 7,
          "width": 179.37633247508526,
          "height": 80,
          "content": "Set the URL of your WordPress here"
        },
        "typeVersion": 1
      },
      {
        "id": "94b09f31-31aa-4284-936e-c37fb3088acc",
        "name": "Sticky Note16",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          880,
          880
        ],
        "parameters": {
          "color": 2,
          "width": 225.47038972308582,
          "height": 370.512611879577,
          "content": "## Chapters split"
        },
        "typeVersion": 1
      },
      {
        "id": "633cba39-ec92-410c-b010-083048487b2b",
        "name": "Sticky Note17",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          900,
          940
        ],
        "parameters": {
          "color": 7,
          "width": 185.6051460344073,
          "height": 80,
          "content": "Splits out chapter contents from the previous node"
        },
        "typeVersion": 1
      },
      {
        "id": "4c9fd35f-d69d-4ced-a759-175336f43c8a",
        "name": "Sticky Note18",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1160,
          940
        ],
        "parameters": {
          "color": 7,
          "width": 287.370178643191,
          "height": 80,
          "content": "Writes the text for each chapter"
        },
        "typeVersion": 1
      },
      {
        "id": "0d751d84-117a-4bf4-a9a7-d5ad1b557fec",
        "name": "Sticky Note19",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1140,
          880
        ],
        "parameters": {
          "color": 6,
          "width": 333.40108076977657,
          "height": 370.512611879577,
          "content": "## Chapters text"
        },
        "typeVersion": 1
      },
      {
        "id": "ce36a500-136b-4082-988c-5f9b6dd6d971",
        "name": "Sticky Note21",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1500,
          880
        ],
        "parameters": {
          "color": 4,
          "width": 420.4253447940705,
          "height": 514.2177254645992,
          "content": "## Content preparation"
        },
        "typeVersion": 1
      },
      {
        "id": "9da83dc4-9e99-42a4-88a1-27ef87df6d09",
        "name": "Sticky Note22",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1520,
          960
        ],
        "parameters": {
          "color": 7,
          "width": 368.1523541074699,
          "height": 80,
          "content": "Merges the content and prepare it before sending it to WordPress"
        },
        "typeVersion": 1
      },
      {
        "id": "8591f4cb-edc4-4582-96b4-bcb2214a27a7",
        "name": "On form submission",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -340,
          1080
        ],
        "webhookId": "080f8376-cc82-49cc-8dd0-6db36bb887ab",
        "parameters": {
          "options": {
            "path": "create-wordpress-post"
          },
          "formTitle": "Create a WordPress post with AI",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Keywords (comma-separated)",
                "requiredField": true
              },
              {
                "fieldType": "dropdown",
                "fieldLabel": "Number of chapters",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "1"
                    },
                    {
                      "option": "2"
                    },
                    {
                      "option": "3"
                    },
                    {
                      "option": "4"
                    },
                    {
                      "option": "5"
                    },
                    {
                      "option": "6"
                    },
                    {
                      "option": "7"
                    },
                    {
                      "option": "8"
                    },
                    {
                      "option": "9"
                    },
                    {
                      "option": "10"
                    }
                  ]
                },
                "requiredField": true
              },
              {
                "fieldType": "number",
                "fieldLabel": "Max words count",
                "requiredField": true
              }
            ]
          },
          "responseMode": "lastNode",
          "formDescription": "Fill this form with the required information to create a draft post on WordPress"
        },
        "typeVersion": 2.2
      },
      {
        "id": "59619ea3-ac29-4188-9050-a6711c3f0921",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          940,
          1080
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "message.content.chapters"
        },
        "typeVersion": 1
      },
      {
        "id": "728b7e4c-7b4a-46d9-ac86-98c23bda6c98",
        "name": "OpenAI",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1180,
          1080
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Write a chapter for the article: {{ $('Create post title and structure').item.json.message.content.title }}, {{ $('Create post title and structure').item.json.message.content.subtitle  }}, that talks about {{ $('Settings').item.json[\"keywords\"] }}\n\nThis is the prompt for the chapter titled {{ $json.title }}: {{ $json.prompt }}.\n\nGuidelines:\n- Just return the plain text for each chapter (no JSON structure).\n- Don't use markdown for formatting.\n- Use HTML for formatting, but limited to bold, italic and lists.\n- Don't add internal titles or headings.\n- The length of each chapther should be around {{ Math.round(($('Settings').item.json.words - 120)/ $('Settings').item.json.chapters) }} words long\n- Go deep in the topic you treat, don't just throw some superficial info\n{{ $itemIndex > 0 ? \"- The previous chapter talks about \" + $input.all()[$itemIndex-1].json.title : \"\" }}\n{{ $itemIndex > 0 ? \"- The promt for the previous chapter is \" + $input.all()[$itemIndex-1].json.prompt : \"\" }}\n{{ $itemIndex < $input.all().length ? \"- The following chapter will talk about \" + $input.all()[$itemIndex+1].json.title: \"\" }}\n{{ $itemIndex < $input.all().length ? \"- The prompt for the following chapter is \" + $input.all()[$itemIndex+1].json.prompt : \"\" }}\n- Consider the previous and following chapters what writing the text for this chapter. The text must be coherent with the previous and following chapters.\n- This chapter should not repeat the concepts already exposed in the previous chapter.\n- This chapter is a part of a larger article so don't include an introduction or conclusions. This chapter should merge with the rest of the article.\n"
              }
            ]
          }
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "85007abe-b4b1-4263-a7e6-62f0a2ebd7c3",
        "name": "Settings",
        "type": "n8n-nodes-base.set",
        "position": [
          -60,
          1080
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "c07386d7-9f51-4052-a62d-500e9aff9336",
                "name": "wordpress_url",
                "type": "string",
                "value": "https://you-wordpress-url-here.com/"
              },
              {
                "id": "2bbdd88a-3d66-4407-9b77-32af63f44e11",
                "name": "keywords",
                "type": "string",
                "value": "={{ $json['Keywords (comma-separated)'] }}"
              },
              {
                "id": "4a199e44-1033-446a-a019-e2e1a694009e",
                "name": "chapters",
                "type": "string",
                "value": "={{ $json['Number of chapters'] }}"
              },
              {
                "id": "312d2e97-d1b6-46d9-b2ae-35f7234b5404",
                "name": "words",
                "type": "string",
                "value": "={{ $json['Max words count'] }}"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "d87b4460-1bf1-4c7f-8f5a-51993c1b7cd0",
        "name": "Create post title and structure",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          180,
          1080
        ],
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "options": {},
          "messages": {
            "values": [
              {
                "content": "=Write the title, the subtitle, the chapters details, the introduction, the conclusions, and an image prompt for a SEO-friendly article about these topics:\n{{ $json.keywords }}.\n\nInstructions:\n- Place the article title in a JSON field called `title`\n- Place the subtitle in a JSON field called `subtitle`\n- Place the introduction in a JSON field called `introduction`\n- In the introduction introduce the topic that is then explored in depth in the rest of the text\n- The introduction should be around 60 words\n- Place the conclusions in a JSON field called `conclusions`\n- The conclusions should be around 60 words\n- Use the conclusions to sum all said in the article and offer a conclusion to the reader\n- The image prompt will be used to produce a photographic cover image for the article and should depict the topics discussed in the article\n- Place the image prompt in a JSON field called `imagePrompt`\n- There should be {{ $json.chapters.toString() }} chapters.\n- For each chapter provide a title and an exaustive prompt that will be used to write the chapter text.\n- Place the chapters in an array field called `chapters`\n- For each chapter provide the fields `title` and `prompt`\n- The chapters should follow a logical flow and not repeat the same concepts.\n- The chapters should be one related to the other and not isolated blocks of text. The text should be fluent and folow a linear logic.\n- Don't start the chapters with \"Chapter 1\", \"Chapter 2\", \"Chapter 3\"... just write the title of the chapter\n- For the title and the capthers' titles don't use colons (`:`)\n- For the text, use HTML for formatting, but limited to bold, italic and lists.\n- Don't use markdown for formatting.\n- Always search on Wikipedia for useful information or verify the accuracy of what you write.\n- Never mention it if you don't find information on Wikipedia or the web\n- Go deep in the topic you treat, don't just throw some superficial info"
              }
            ]
          },
          "jsonOutput": true
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "57f5811a-e82e-4dd3-8d53-0559b2716dac",
        "name": "Wikipedia",
        "type": "@n8n/n8n-nodes-langchain.toolWikipedia",
        "position": [
          280,
          1360
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "1987ab2c-4b6e-451d-a831-0817004be72b",
        "name": "Check data consistency",
        "type": "n8n-nodes-base.if",
        "position": [
          620,
          1080
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "9523cb70-8467-4e65-9ecf-65cb91c29cb7",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json.message.content.title }}",
                "rightValue": ""
              },
              {
                "id": "d754869d-10fe-4348-807f-2e1bc82a7b41",
                "operator": {
                  "type": "array",
                  "operation": "lengthGt",
                  "rightType": "number"
                },
                "leftValue": "={{ $json.message.content.chapters }}",
                "rightValue": 0
              },
              {
                "id": "79a60fc1-66f8-4cfc-a61b-de528dfb7978",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json.message.content.subtitle }}",
                "rightValue": ""
              },
              {
                "id": "c0c44d88-1c3d-44ba-9030-6e8fa9f2860f",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json.message.content.introduction }}",
                "rightValue": ""
              },
              {
                "id": "338cd7e0-d2b8-40f4-838d-3aaf618268d2",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json.message.content.conclusions }}",
                "rightValue": ""
              },
              {
                "id": "76eb9ba1-7675-403c-9287-ac1319791ffe",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                },
                "leftValue": "={{ $json.message.content.imagePrompt }}",
                "rightValue": ""
              }
            ]
          }
        },
        "typeVersion": 2.2
      },
      {
        "id": "6b22ae14-80c9-48ac-9a03-9266bc3a9aa4",
        "name": "Form",
        "type": "n8n-nodes-base.form",
        "position": [
          940,
          1340
        ],
        "webhookId": "691e1010-7083-46be-9e6e-4e77fb853a9a",
        "parameters": {
          "operation": "completion",
          "respondWith": "showText",
          "responseText": "There was a problem creating the article, please refresh the form and try again!"
        },
        "typeVersion": 1
      },
      {
        "id": "5a22467a-6835-4a62-951f-e8cd43bef3af",
        "name": "Merge chapters title and text",
        "type": "n8n-nodes-base.merge",
        "position": [
          1580,
          1200
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "combineBy": "combineByPosition"
        },
        "typeVersion": 3
      },
      {
        "id": "f4609858-7f65-4f2d-b222-f03ee207f166",
        "name": "Final article text",
        "type": "n8n-nodes-base.code",
        "position": [
          1760,
          1080
        ],
        "parameters": {
          "jsCode": "let article = \"\";\n\n// Introduction\narticle += $('Create post title and structure').first().json.message.content.introduction;\narticle += \"<br><br>\";\n\nfor (const item of $input.all()) {\n  article += \"<strong>\" + item.json.title + \"</strong>\";\n  article += \"<br><br>\";\n  article += item.json.message.content;\n  article += \"<br><br>\";\n}\n\n// Conclusions\narticle += \"<strong>Conclusions</strong>\";\narticle += \"<br><br>\";\narticle += $('Create post title and structure').first().json.message.content.conclusions;\n\n\nreturn [\n  {\n    \"article\": article\n  }\n];"
        },
        "typeVersion": 2
      },
      {
        "id": "e21a5519-315b-442e-97d0-8ee745138652",
        "name": "Post on Wordpress",
        "type": "n8n-nodes-base.wordpress",
        "position": [
          2040,
          1080
        ],
        "parameters": {
          "title": "={{ $('Create post title and structure').first().json.message.content.title }}",
          "additionalFields": {
            "status": "draft",
            "content": "={{ $json.article }}"
          }
        },
        "credentials": {
          "wordpressApi": {
            "id": "YMW8mGrekjfxKJUe",
            "name": "Wordpress account"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "7d7de1e3-cff2-41f2-a8ae-123441d9b18c",
        "name": "Generate featured image",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2340,
          1080
        ],
        "parameters": {
          "prompt": "=Generate a photographic image to be used as the cover image for the article titled: {{ $('Create post title and structure').first().json.message.content.title }}. This is the prompt for the image: {{ $('Create post title and structure').first().json.message.content.imagePrompt }}, photography, realistic, sigma 85mm f/1.4",
          "options": {
            "size": "1792x1024",
            "style": "natural",
            "quality": "hd"
          },
          "resource": "image"
        },
        "credentials": {
          "openAiApi": {
            "id": "8gccIjcuf3gvaoEr",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.8
      },
      {
        "id": "edbd0658-0edf-43e8-8428-3fea52639d62",
        "name": "Upload media",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2560,
          1080
        ],
        "parameters": {
          "url": "https://wp-demo.mondo.surf/wp-json/wp/v2/media",
          "method": "POST",
          "options": {},
          "sendBody": true,
          "contentType": "binaryData",
          "sendHeaders": true,
          "authentication": "predefinedCredentialType",
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Disposition",
                "value": "attachment; filename=\"example.jpg\""
              }
            ]
          },
          "inputDataFieldName": "data",
          "nodeCredentialType": "wordpressApi"
        },
        "credentials": {
          "wordpressApi": {
            "id": "YMW8mGrekjfxKJUe",
            "name": "Wordpress account"
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "e2cd720b-03e6-4cee-8901-a6a06e4bd1ec",
        "name": "Set image ID for the post",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2780,
          1080
        ],
        "parameters": {
          "url": "=https://wp-demo.mondo.surf/wp-json/wp/v2/posts/{{ $('Post on Wordpress').first().json.id }}",
          "method": "POST",
          "options": {},
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "featured_media",
                "value": "={{ $json.id }}"
              }
            ]
          }
        },
        "typeVersion": 4.2
      },
      {
        "id": "daddda39-db6a-4266-b823-8ae9080ca1a8",
        "name": "Form1",
        "type": "n8n-nodes-base.form",
        "position": [
          3020,
          1080
        ],
        "webhookId": "a9bf2986-4c9d-4d89-b5bf-ef6e93130b60",
        "parameters": {
          "options": {},
          "operation": "completion",
          "completionTitle": "Created Successfully!",
          "completionMessage": "=The article {{ $json.title.rendered }} was correctly created as a draft on WordPress!"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "OpenAI": {
        "main": [
          [
            {
              "node": "Merge chapters title and text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Settings": {
        "main": [
          [
            {
              "node": "Create post title and structure",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "OpenAI",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge chapters title and text",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Wikipedia": {
        "ai_tool": [
          [
            {
              "node": "Create post title and structure",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Upload media": {
        "main": [
          [
            {
              "node": "Set image ID for the post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Post on Wordpress": {
        "main": [
          [
            {
              "node": "Generate featured image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Final article text": {
        "main": [
          [
            {
              "node": "Post on Wordpress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On form submission": {
        "main": [
          [
            {
              "node": "Settings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check data consistency": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Form",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate featured image": {
        "main": [
          [
            {
              "node": "Upload media",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set image ID for the post": {
        "main": [
          [
            {
              "node": "Form1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge chapters title and text": {
        "main": [
          [
            {
              "node": "Final article text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create post title and structure": {
        "main": [
          [
            {
              "node": "Check data consistency",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "AccountCraft WhatsApp Automation - Infridet",
    "nodes": [
      {
        "id": "1",
        "name": "Webhook - Lead Capture",
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          300
        ],
        "parameters": {
          "path": "lead-capture",
          "responseMode": "onReceived"
        },
        "typeVersion": 1
      },
      {
        "id": "2",
        "name": "Google Sheets - Backup Log",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          500,
          200
        ],
        "parameters": {
          "range": "Leads!A1",
          "options": {},
          "sheetId": "your_google_sheet_id_here",
          "valueInputMode": "USER_ENTERED"
        },
        "credentials": {
          "googleApi": "Google Account"
        },
        "typeVersion": 1
      },
      {
        "id": "3",
        "name": "FluentCRM - Add Contact",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          500,
          400
        ],
        "parameters": {
          "url": "https://your-crm-domain.com/wp-json/fluent-crm/v2/contacts",
          "method": "POST",
          "options": {},
          "jsonParameters": true,
          "bodyParametersJson": "{\n  \"email\": \"{{$json[\"email\"]}}\",\n  \"first_name\": \"{{$json[\"name\"]}}\",\n  \"tags\": [\"New Lead\"]\n}"
        },
        "credentials": {
          "httpBasicAuth": {
            "user": "your_crm_api_user",
            "password": "your_crm_api_key"
          }
        },
        "typeVersion": 1
      },
      {
        "id": "4",
        "name": "Send Warmup Email",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          750,
          200
        ],
        "parameters": {
          "text": "Hey {{$json[\"name\"]}},\n\nThanks for joining Account Craft! We‚Äôll help you build your YouTube channel and earn like a pro. Stay tuned. üî•\n\nCheers,\nGyan",
          "subject": "Welcome to Account Craft üöÄ",
          "toEmail": "={{$json[\"email\"]}}",
          "fromEmail": "your@email.com"
        },
        "credentials": {
          "smtp": "SMTP Account"
        },
        "typeVersion": 1
      },
      {
        "id": "5",
        "name": "Send WhatsApp via Whinta",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1000,
          200
        ],
        "parameters": {
          "url": "https://api.whinta.com/send",
          "method": "POST",
          "options": {},
          "jsonParameters": true,
          "bodyParametersJson": "{\n  \"phone\": \"{{$json[\"phone\"]}}\",\n  \"message\": \"Hey {{$json[\"name\"]}}, Gyan here from Account Craft üëã Just saw your form ‚Äì want help starting your YouTube channel?\"\n}"
        },
        "typeVersion": 1
      },
      {
        "id": "6",
        "name": "Update CRM Tag to Customer",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1250,
          200
        ],
        "parameters": {
          "url": "https://your-crm-domain.com/wp-json/fluent-crm/v2/contacts/update",
          "method": "POST",
          "options": {},
          "jsonParameters": true,
          "bodyParametersJson": "{\n  \"email\": \"{{$json[\"email\"]}}\",\n  \"tags\": [\"Customer\"]\n}"
        },
        "credentials": {
          "httpBasicAuth": {
            "user": "your_crm_api_user",
            "password": "your_crm_api_key"
          }
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "settings": {},
    "versionId": "1",
    "connections": {
      "Send Warmup Email": {
        "main": [
          [
            {
              "node": "Send WhatsApp via Whinta",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook - Lead Capture": {
        "main": [
          [
            {
              "node": "Google Sheets - Backup Log",
              "type": "main",
              "index": 0
            },
            {
              "node": "FluentCRM - Add Contact",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send WhatsApp via Whinta": {
        "main": [
          [
            {
              "node": "Update CRM Tag to Customer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets - Backup Log": {
        "main": [
          [
            {
              "node": "Send Warmup Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "id": "d23vz3qcBf6KfuZA",
    "meta": {
      "instanceId": "31e69f7f4a77bf465b805824e303232f0227212ae922d12133a0f96ffeab4fef",
      "templateCredsSetupCompleted": true
    },
    "name": "üé¶üöÄ YouTube Video Comment Analysis Agent",
    "tags": [],
    "nodes": [
      {
        "id": "6661e7c3-ec1e-43b0-8bc6-44abbefbbcea",
        "name": "When Executed by Another Workflow",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "disabled": true,
        "position": [
          -160,
          80
        ],
        "parameters": {
          "inputSource": "jsonExample",
          "jsonExample": "{\n  \"query\": {\n\t\"videoId\": \"YouTube video id\"\n  }\n}"
        },
        "typeVersion": 1.1
      },
      {
        "id": "729edcc9-7eda-4ad0-b168-5e5a57cdbf6a",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -300,
          -80
        ],
        "parameters": {
          "color": 7,
          "width": 1730,
          "height": 760,
          "content": "## üõ†Ô∏èYouTube Video Details & Comments Processing Tool"
        },
        "typeVersion": 1
      },
      {
        "id": "454c3494-9808-475d-ad53-decd54d99783",
        "name": "Create YouTube API URL",
        "type": "n8n-nodes-base.code",
        "position": [
          500,
          100
        ],
        "parameters": {
          "jsCode": "// Define the base URL for the YouTube Data API\nconst BASE_URL = 'https://www.googleapis.com/youtube/v3/videos';\n\n// Get the first input item\nconst item = $input.first();\n\n// Extract the videoId and google_api_key from the input JSON\nconst VIDEO_ID = item.json.VIDEO_ID;\nconst GOOGLE_API_KEY = item.json.GOOGLE_API_KEY; // Dynamically retrieve API key\n\nif (!VIDEO_ID) {\n  throw new Error('The video ID parameter is empty.');\n}\n\nif (!GOOGLE_API_KEY) {\n  throw new Error('The Google API Key is missing.');\n}\n\n// Construct the API URL with the video ID and dynamically retrieved API key\nconst youtubeUrl = `${BASE_URL}?part=snippet,contentDetails,status,statistics,player,topicDetails&id=${VIDEO_ID}&key=${GOOGLE_API_KEY}`;\n\n// Return the constructed URL\nreturn [\n  {\n    json: {\n      youtubeUrl: youtubeUrl,\n    },\n  },\n];\n"
        },
        "typeVersion": 2
      },
      {
        "id": "d715b012-7842-498c-8fda-1b2812b7bc1e",
        "name": "Get YouTube Video Details",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          700,
          100
        ],
        "parameters": {
          "url": "={{ $json.youtubeUrl }}",
          "options": {}
        },
        "typeVersion": 4.2
      },
      {
        "id": "2c6598c4-11d1-4952-929e-2d08c439dee3",
        "name": "Merge YouTube Details & Transcript",
        "type": "n8n-nodes-base.merge",
        "position": [
          1200,
          120
        ],
        "parameters": {
          "mode": "combine",
          "options": {},
          "combineBy": "combineByPosition"
        },
        "typeVersion": 3
      },
      {
        "id": "60eea409-6744-4415-b9e8-e505f6406cd7",
        "name": "Create One JSON Object",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          1200,
          440
        ],
        "parameters": {
          "options": {},
          "aggregate": "aggregateAllItemData"
        },
        "typeVersion": 1
      },
      {
        "id": "666e5a60-3c0e-4f70-8689-a1fdfb688ca4",
        "name": "Workflow Variables",
        "type": "n8n-nodes-base.set",
        "position": [
          160,
          260
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "e656b8ef-4266-4f50-bd41-703b4bdb04df",
                "name": "GOOGLE_API_KEY",
                "type": "string",
                "value": "[YOUR_GOOGLE_API_KEY_GOES_HERE]"
              },
              {
                "id": "32db428d-a2e2-48a0-92c6-3880e744d140",
                "name": "VIDEO_ID",
                "type": "string",
                "value": "=c5dw_jsGNBk"
              }
            ]
          }
        },
        "typeVersion": 3.4
      },
      {
        "id": "a3d12a1c-8d9f-4afa-83a2-e61aaddc3977",
        "name": "Sticky Note12",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          60,
          20
        ],
        "parameters": {
          "width": 300,
          "height": 460,
          "content": "## üí° Workflow Variables\nhttps://cloud.google.com/docs/get-started/access-apis\n\n- GOOGLE_API_KEY\n- VIDEO_ID - üñêÔ∏èCHANGE THIS!!!"
        },
        "typeVersion": 1
      },
      {
        "id": "fa87b1d0-368c-4d14-9138-2102df8fd285",
        "name": "Sticky Note14",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          -20
        ],
        "parameters": {
          "color": 3,
          "width": 500,
          "height": 300,
          "content": "## YouTube Video Details\nhttps://developers.google.com/youtube/v3/docs\nhttps://www.googleapis.com/youtube/v3/videos"
        },
        "typeVersion": 1
      },
      {
        "id": "846dc463-f989-4834-ab67-fc9d911b7cbd",
        "name": "Sticky Note15",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          320
        ],
        "parameters": {
          "color": 5,
          "width": 700,
          "height": 320,
          "content": "## YouTube Video Comments\nhttps://developers.google.com/youtube/v3/docs\nhttps://www.googleapis.com/youtube/v3/commentThreads"
        },
        "typeVersion": 1
      },
      {
        "id": "321c7aba-d22c-428c-ba0c-20852d80ad39",
        "name": "Combine Comments",
        "type": "n8n-nodes-base.summarize",
        "position": [
          900,
          440
        ],
        "parameters": {
          "options": {},
          "fieldsToSummarize": {
            "values": [
              {
                "field": "comments",
                "aggregation": "concatenate"
              }
            ]
          }
        },
        "typeVersion": 1
      },
      {
        "id": "28cc7f86-bd17-41a6-bf75-fc0a72b37b79",
        "name": "Split Out Comments",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          700,
          440
        ],
        "parameters": {
          "options": {},
          "fieldToSplitOut": "comments"
        },
        "typeVersion": 1
      },
      {
        "id": "3a62fd7f-9185-4243-b9fd-34e0ad2046e6",
        "name": "Get YouTube Video Comments",
        "type": "n8n-nodes-base.httpRequest",
        "disabled": true,
        "position": [
          1200,
          820
        ],
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {}
        },
        "typeVersion": 4.2
      },
      {
        "id": "4698558c-c50a-43b0-a027-fbbf37a69092",
        "name": "When clicking ‚ÄòTest workflow‚Äô",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -160,
          400
        ],
        "parameters": {},
        "typeVersion": 1
      },
      {
        "id": "ad68e98c-b870-4b7a-af3c-7d09c6bff29f",
        "name": "Create YouTube API URL for Comments",
        "type": "n8n-nodes-base.code",
        "disabled": true,
        "position": [
          980,
          820
        ],
        "parameters": {
          "jsCode": "// Define the base URL for the YouTube Data API\nconst BASE_URL = 'https://www.googleapis.com/youtube/v3/commentThreads';\n\n// Get the first input item\nconst item = $input.first();\n\n// Extract the videoId and google_api_key from the input JSON\nconst VIDEO_ID = item.json.VIDEO_ID;\nconst GOOGLE_API_KEY = item.json.GOOGLE_API_KEY; // Dynamically retrieve API key\nconst MAX_RESULTS = 100;  //item.json.MAX_RESULTS;\n\nconst url = `${BASE_URL}?part=snippet&videoId=${encodeURIComponent(VIDEO_ID)}&key=${encodeURIComponent(GOOGLE_API_KEY)}&maxResults=${encodeURIComponent(MAX_RESULTS)}`;\n\n// Now you can send this URL to the HTTP node for the GET request.\nreturn { json: { url } };\n"
        },
        "typeVersion": 2
      },
      {
        "id": "ccb00ab2-07cb-4f61-84ce-f51a45a6d2e9",
        "name": "Gmail Report",
        "type": "n8n-nodes-base.gmail",
        "position": [
          520,
          800
        ],
        "webhookId": "2bad33f7-38f8-40ca-9bcd-2f51179c8db5",
        "parameters": {
          "sendTo": "joe@example.com",
          "message": "={{ $json.html }}",
          "options": {
            "appendAttribution": false
          },
          "subject": "YouTube Video Report"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "1xpVDEQ1yx8gV022",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "74b921e3-0a72-4af8-9b10-2488e479f999",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -300,
          720
        ],
        "parameters": {
          "color": 6,
          "width": 1100,
          "height": 500,
          "content": "## üìΩÔ∏è YouTube Video Comment Reporting Agent"
        },
        "typeVersion": 1
      },
      {
        "id": "511827aa-aa4a-4e39-9795-cc5d8c21e661",
        "name": "gpt-4o-mini",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -120,
          1040
        ],
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "credentials": {
          "openAiApi": {
            "id": "jEMSvKmtYfzAkhe6",
            "name": "OpenAi account"
          }
        },
        "typeVersion": 1.2
      },
      {
        "id": "006d50a7-33a1-4ca1-969e-a266b2567452",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -240,
          320
        ],
        "parameters": {
          "color": 4,
          "width": 260,
          "height": 260,
          "content": "## üëç Try Me!"
        },
        "typeVersion": 1
      },
      {
        "id": "1c054aa7-9b97-464b-a0d6-b514e4a2c7df",
        "name": "Markdown to HTML",
        "type": "n8n-nodes-base.markdown",
        "position": [
          280,
          860
        ],
        "parameters": {
          "mode": "markdownToHtml",
          "options": {},
          "markdown": "={{ $json.output }}",
          "destinationKey": "html"
        },
        "typeVersion": 1
      },
      {
        "id": "b84a52db-01d0-4711-8014-743b90b6c1b4",
        "name": "YouTube Video Report Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -100,
          860
        ],
        "parameters": {
          "text": "=This is the YouTube video detals and comments: {{ $json.data.toJsonString() }}",
          "agent": "conversationalAgent",
          "options": {
            "systemMessage": "**Objective:**  \nAnalyze the provided YouTube video data and comments to generate a **comprehensive and detailed report**. The report should help YouTube creators identify trends, viewer interests, and actionable insights for creating similar or related content that resonates with audiences. The report must provide **in-depth explanations, examples, and recommendations** to guide creators in producing engaging content.\n\n**Instructions for AI:**  \nYou are an advanced AI agent tasked with analyzing YouTube video details and comments. Your goal is to produce a **detailed and insightful report** based on the following structure. Use the provided data to extract meaningful insights, trends, and actionable recommendations. Ensure each section is thorough, well-explained, and includes examples where applicable.\n\n---\n\n### Report Structure\n\n#### 1. Video Overview\n   - Provide a summary of the video's title, description, and key topics.\n   - Highlight the video‚Äôs performance metrics (e.g., views, likes, comments) and explain what these metrics suggest about its success.\n   - Identify the primary themes or subjects discussed in the video. Explain why these themes might have resonated with viewers (e.g., relevance to current trends, novelty of the topic).\n\n#### 2. Comment Analysis\n   - **Sentiment Analysis:**  \n     Perform sentiment analysis on the comments to determine the overall tone (e.g., positive, negative, neutral). Provide percentages or counts for each sentiment category. Include examples of representative comments for each sentiment type.\n   - **Common Themes:**  \n     Identify recurring topics or questions in the comments (e.g., viewers asking for tutorials, expressing excitement, or suggesting improvements). Explain why these themes are significant and how they reflect viewer interests or needs.\n   - **Engagement Drivers:**  \n     Highlight specific aspects of the video that generated high engagement (e.g., unique features, clear explanations). Provide detailed examples of what viewers appreciated most.\n   - **Viewer Pain Points:**  \n     Extract comments that express confusion, issues, or requests for clarification. For example:\n       - Questions about technical aspects or processes covered in the video.\n       - Requests for additional details or resources.\n       - Critiques or suggestions for improvement.\n\n#### 3. Content Opportunities\n   - Based on comment analysis, suggest topics for future videos:\n     - Tutorials addressing unresolved questions (e.g., step-by-step guides on complex tasks).\n     - Deep dives into related tools or concepts mentioned in comments.\n     - Solutions for specific use cases requested by viewers.\n   - Highlight any niche interests or emerging trends observed in viewer feedback. Explain why these opportunities are valuable and how they align with audience preferences.\n   - Provide examples of potential video titles or formats (e.g., \"Top 5 Tools for Web Scraping Beginners\" or \"How to Scrape Dynamic Pages Without Coding\").\n\n#### 4. Audience Profile\n   - Infer characteristics of the audience based on their comments:\n     - Level of expertise (e.g., beginners asking basic questions vs. advanced users discussing technical details).\n     - Interests (e.g., AI tools, web scraping techniques).\n     - Geographic or cultural indicators if applicable (e.g., language used in comments).\n   - Explain how understanding this audience profile can help creators tailor their content.\n\n#### 5. Actionable Recommendations\n   - Provide a list of actionable steps for content creators with detailed explanations:\n     1. Create follow-up videos addressing common questions raised in comments. Explain how addressing these questions can build trust and engagement with viewers.\n     2. Develop content around highly praised aspects of the video. For example, if viewers appreciated a particular tool demonstration, suggest creating a series exploring similar tools.\n     3. Explore collaborations with other creators in similar niches to expand reach and tap into overlapping audiences.\n     4. Promote ethical practices (if relevant) to build credibility and trust with viewers.\n   - Include specific strategies for improving engagement (e.g., encouraging viewers to comment their questions or ideas for future videos).\n\n#### 6. Keywords and Tags\n   - Extract frequently mentioned terms from comments to suggest keywords/tags for optimization.\n   - Provide a list of suggested tags based on both video content and comment analysis.\n   - Explain how these tags can improve discoverability on YouTube.\n\n#### 7. Potential Collaborations\n   - Identify opportunities for partnerships based on viewer suggestions or related channels/topics mentioned in comments.\n   - Suggest creators or channels that align with the video's themes and audience interests.\n\n#### 8. Detailed Suggestions for Similar Content\n   - Analyze what made this video engaging (e.g., storytelling techniques, visuals, pacing) and explain how these elements can be replicated in future videos.\n   - Suggest new angles or formats that build on this video's success (e.g., live Q&A sessions, behind-the-scenes content).\n   - Recommend experimenting with different styles or approaches based on viewer feedback (e.g., shorter videos for quick tips vs. longer deep-dive tutorials).\n\n---\n\n**Data Input Format:**  \nProvide the AI with structured data containing:\n- Video details: title, description, tags, views, likes, comments.\n- Comment data: text of each comment, timestamp, likes/replies on each comment.\n\n**Output Requirements:**  \nThe AI should generate a well-organized report in natural language formatted with Markdown with clear headings and bullet points where appropriate. Ensure all insights are actionable and relevant to YouTube creators aiming to replicate the video's success. Each suggestion should include detailed explanations and examples to guide creators effectively.\n"
          },
          "promptType": "define"
        },
        "typeVersion": 1.7
      },
      {
        "id": "55ff5bae-1939-46e1-afe3-76bfeab98243",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          840,
          720
        ],
        "parameters": {
          "color": 5,
          "width": 580,
          "height": 320,
          "content": "## YouTube Video Comments (Alternate)\nGet latest 100 comments without pagination"
        },
        "typeVersion": 1
      },
      {
        "id": "347ff6dd-db5c-4d3a-8552-fb24cdd371e0",
        "name": "Get Video Comments with Pagination",
        "type": "n8n-nodes-base.code",
        "position": [
          500,
          440
        ],
        "parameters": {
          "jsCode": "// Define a helper function to build a query string from an object\nfunction buildQueryString(params) {\n\treturn Object.keys(params)\n\t\t.map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\n\t\t.join('&');\n}\n\n// Define the base URL for the YouTube Data API\nconst BASE_URL = \"https://www.googleapis.com/youtube/v3/commentThreads\";\n\n// Get the first input item\nconst item = $input.first();\n\n// Extract the videoId and google_api_key from the input JSON\nconst videoId = item.json.VIDEO_ID;\nconst apiKey = item.json.GOOGLE_API_KEY; // Dynamically retrieve API key\n\nconst comments = [];\nlet nextPageToken = undefined;\n\nwhile (true) {\n    // Construct URL parameters using an object literal\n    const params = {\n        part: \"snippet\",\n        videoId: videoId,\n        key: apiKey\n    };\n\n    if (nextPageToken) {\n        params.pageToken = nextPageToken;\n    }\n\n    // Build the full URL without using URLSearchParams\n    const queryString = buildQueryString(params);\n    const url = `${BASE_URL}?${queryString}`;\n    \n    // Set up the options for the HTTP request helper\n    const options = {\n        method: \"GET\",\n        uri: url,\n        json: true\n    };\n\n    // Use n8n's built-in HTTP request helper instead of fetch\n    const data = await this.helpers.request(options);\n\n    // console.log(data.items)\n\n    // Process each comment in the response\n    data.items.forEach(item => {\n        comments.push(item.snippet.topLevelComment.snippet.textOriginal);\n    });\n\n    // console.log(data.nextPageToken)\n\n    // Exit loop if no further pages exist\n    if (!data.nextPageToken) {\n        break;\n    }\n    nextPageToken = data.nextPageToken;\n}\n\n// Return the collected comments as an item output for n8n\nreturn [{ json: { comments } }];\n"
        },
        "typeVersion": 2
      },
      {
        "id": "91869f81-8d98-4221-9205-44e18c1ff9b8",
        "name": "Save Report to Google Drive",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          520,
          1000
        ],
        "parameters": {
          "name": "=YouTube Video Report - {{ $('Merge YouTube Details & Transcript').item.json.items.first().snippet.title }}",
          "content": "={{ $json.output }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "options": {},
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "root",
            "cachedResultName": "/ (Root folder)"
          },
          "operation": "createFromText"
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "UhdXGYLTAJbsa0xX",
            "name": "Google Drive account"
          }
        },
        "typeVersion": 3
      },
      {
        "id": "3629f058-7034-4530-a6a1-f30f611a05bf",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -860,
          -80
        ],
        "parameters": {
          "width": 520,
          "height": 760,
          "content": "# YouTube Video Comment Analysis Agent\n\nThis agent is designed to analyze YouTube video details and comments to generate a **comprehensive and actionable report** for content creators. The report provides insights into:\n\n- **Video performance**: Metrics such as views, likes, and comments.\n- **Audience engagement**: Identifying what resonates with viewers.\n- **Viewer feedback**: Highlighting trends, interests, and areas for improvement.\n\n### Key Features:\n1. **Sentiment Analysis**: Evaluates the tone of comments (positive, negative, neutral) to understand audience sentiment.\n2. **Recurring Themes**: Identifies common topics or questions in comments.\n3. **Engagement Drivers**: Highlights video elements that sparked high engagement.\n4. **Actionable Recommendations**: Offers specific strategies for improving content and addressing viewer needs.\n5. **Keyword Suggestions**: Extracts frequently mentioned terms for better discoverability.\n6. **Collaboration Opportunities**: Suggests potential partnerships based on viewer feedback or related channels.\n7. **Audience Profiling**: Infers audience characteristics such as expertise level and interests.\n\n### Objective:\nThe goal is to empower YouTube creators with **data-driven insights** to create engaging content that resonates with their audience while addressing viewer needs and preferences."
        },
        "typeVersion": 1
      }
    ],
    "active": false,
    "pinData": {
      "When Executed by Another Workflow": [
        {
          "json": {
            "query": {
              "videoId": "JWfNLF_g_V0"
            }
          }
        }
      ]
    },
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "929375b3-ca7e-49c3-9e7b-241864d27f62",
    "connections": {
      "gpt-4o-mini": {
        "ai_languageModel": [
          [
            {
              "node": "YouTube Video Report Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Combine Comments": {
        "main": [
          [
            {
              "node": "Merge YouTube Details & Transcript",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Markdown to HTML": {
        "main": [
          [
            {
              "node": "Gmail Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Report to Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Comments": {
        "main": [
          [
            {
              "node": "Combine Comments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Workflow Variables": {
        "main": [
          [
            {
              "node": "Create YouTube API URL",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Video Comments with Pagination",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create One JSON Object": {
        "main": [
          [
            {
              "node": "YouTube Video Report Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create YouTube API URL": {
        "main": [
          [
            {
              "node": "Get YouTube Video Details",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get YouTube Video Details": {
        "main": [
          [
            {
              "node": "Merge YouTube Details & Transcript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get YouTube Video Comments": {
        "main": [
          []
        ]
      },
      "YouTube Video Report Agent": {
        "main": [
          [
            {
              "node": "Markdown to HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Workflow Variables",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòTest workflow‚Äô": {
        "main": [
          [
            {
              "node": "Workflow Variables",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Video Comments with Pagination": {
        "main": [
          [
            {
              "node": "Split Out Comments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge YouTube Details & Transcript": {
        "main": [
          [
            {
              "node": "Create One JSON Object",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create YouTube API URL for Comments": {
        "main": [
          [
            {
              "node": "Get YouTube Video Comments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "nodes": [
      {
        "id": "db39e47c-df1f-4fec-86e5-fc391cce68da",
        "name": "Add Log in History",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1360,
          540
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [
              {
                "id": "price",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "price",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "name",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "link",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "link",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "update",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "update",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "autoMapInputData",
            "matchingColumns": [
              "update"
            ]
          },
          "options": {},
          "operation": "appendOrUpdate",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": 440562612,
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit#gid=440562612",
            "cachedResultName": "Pricing History"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit?usp=drivesdk",
            "cachedResultName": "Zalando Links"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "1nTQmlgxR0AJJDGA",
            "name": "n8ninja - Sheet"
          }
        },
        "typeVersion": 4.3
      },
      {
        "id": "56733bdb-8dc7-4c78-9df2-5ee147afe061",
        "name": "Update Products Infos",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1360,
          360
        ],
        "parameters": {
          "columns": {
            "value": {},
            "schema": [
              {
                "id": "link",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "link",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "price",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "price",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": true,
                "required": false,
                "displayName": "row_number",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "autoMapInputData",
            "matchingColumns": [
              "link"
            ]
          },
          "options": {},
          "operation": "update",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit#gid=0",
            "cachedResultName": "Links"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit?usp=drivesdk",
            "cachedResultName": "Zalando Links"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "1nTQmlgxR0AJJDGA",
            "name": "n8ninja - Sheet"
          }
        },
        "typeVersion": 4.3
      },
      {
        "id": "f87196d7-26ec-41d6-af04-c4b57f3ea899",
        "name": "If price below price alert",
        "type": "n8n-nodes-base.if",
        "position": [
          1360,
          740
        ],
        "parameters": {
          "options": {},
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "0466f2d9-de7a-4017-933a-acda8fb84191",
                "operator": {
                  "type": "number",
                  "operation": "lte"
                },
                "leftValue": "={{ parseFloat($json.price) }}",
                "rightValue": "={{ parseFloat($('List Products').item.json.price_alert) }}"
              }
            ]
          }
        },
        "typeVersion": 2
      },
      {
        "id": "2663fb7a-08ab-45b7-b6d3-4eea495185c4",
        "name": "List Products",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          600,
          540
        ],
        "parameters": {
          "options": {},
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit#gid=0",
            "cachedResultName": "Links"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit?usp=drivesdk",
            "cachedResultName": "Zalando Links"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "1nTQmlgxR0AJJDGA",
            "name": "n8ninja - Sheet"
          }
        },
        "typeVersion": 4.3
      },
      {
        "id": "5ae11ccd-ed5e-4e08-8f42-b3a1c45323df",
        "name": "Format Product",
        "type": "n8n-nodes-base.set",
        "position": [
          1060,
          540
        ],
        "parameters": {
          "options": {},
          "assignments": {
            "assignments": [
              {
                "id": "77ef948b-e4a4-4695-a5e6-bbb21b99f177",
                "name": "price",
                "type": "string",
                "value": "={{ parseFloat($json.data.split('\"twitter:data1\" content=\"')[1].split('\"')[0].split('&nbsp;')[1]) }}"
              },
              {
                "id": "cf241232-d85d-40d7-bf5c-6d49336d6ce1",
                "name": "name",
                "type": "string",
                "value": "={{ $json.data.split('<title>')[1].split('</title>')[0].split('-')[0] }} {{ $json.data.split('<title>')[1].split('</title>')[0].split('-')[1] }} {{ $json.data.split('<title>')[1].split('</title>')[0].split('-')[2] }}"
              },
              {
                "id": "ca07eca0-8bad-4997-a124-e8636eb07bd5",
                "name": "link",
                "type": "string",
                "value": "={{ $('List Products').item.json.link }}"
              },
              {
                "id": "c2d92a0f-56cc-4b74-bbd3-d8a1bb0d6cd7",
                "name": "update",
                "type": "string",
                "value": "={{ $now.format('D') }}"
              },
              {
                "id": "af33b7f1-8367-4f05-bc7e-03d119c3ac76",
                "name": "",
                "type": "string",
                "value": ""
              }
            ]
          }
        },
        "typeVersion": 3.3
      },
      {
        "id": "ae11877a-e83e-44c9-b6f2-b5cd0c8a3c1e",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          380,
          540
        ],
        "parameters": {
          "rule": {
            "interval": [
              {}
            ]
          }
        },
        "typeVersion": 1.1
      },
      {
        "id": "8361e609-0185-4939-92c4-07ec7826bdab",
        "name": "Scrap Product",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          820,
          540
        ],
        "parameters": {
          "url": "={{ $json.link }}",
          "options": {}
        },
        "typeVersion": 4.1
      },
      {
        "id": "6a98aad8-9475-4243-948a-b904cde4687a",
        "name": "Notify Price Reduction",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1600,
          720
        ],
        "parameters": {
          "sendTo": "n8n.ninja@gmail.com",
          "message": "=<h3>Price reduction alert for {{ $('Format Product').item.json[\"name\"] }}</h3>\n\n<p>New price {{ $('Format Product').item.json[\"price\"] }} CHF is bellow {{ $('List Products').item.json[\"price_alert\"] }} CHF</p>\n\nView product: {{ $('List Products').item.json[\"link\"] }}\n\n\n",
          "options": {},
          "subject": "=‚ö†Ô∏è Price Reduction: {{ $('Format Product').item.json.name }}\n"
        },
        "credentials": {
          "gmailOAuth2": {
            "id": "DMcPDN0IHPwGmI7f",
            "name": "Gmail account"
          }
        },
        "typeVersion": 2.1
      },
      {
        "id": "427f51a9-7ebf-42df-bb97-e0a17a37d2cb",
        "name": "Monitor Zalando Product",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          380,
          280
        ],
        "webhookId": "6da9a655-b46b-454d-bb96-32e203627a20",
        "parameters": {
          "path": "6da9a655-b46b-454d-bb96-32e203627a20",
          "options": {},
          "formTitle": "Add Product",
          "formFields": {
            "values": [
              {
                "fieldLabel": "link",
                "requiredField": true
              },
              {
                "fieldType": "number",
                "fieldLabel": "price_alert",
                "requiredField": true
              }
            ]
          },
          "formDescription": "Past in a Zalando URL and the price bellow you would like to be notified"
        },
        "typeVersion": 2
      },
      {
        "id": "39711d6f-d699-415b-9a1b-3971839e7e8a",
        "name": "Add Product",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          580,
          280
        ],
        "parameters": {
          "columns": {
            "value": {
              "link": "={{ $json.link }}",
              "price_alert": "={{ $json.price_alert }}"
            },
            "schema": [
              {
                "id": "link",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "link",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "price_alert",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "price_alert",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "price",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "price",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "name",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "update",
                "type": "string",
                "display": true,
                "removed": true,
                "required": false,
                "displayName": "update",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "link"
            ]
          },
          "options": {},
          "operation": "appendOrUpdate",
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit#gid=0",
            "cachedResultName": "Links"
          },
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit?usp=drivesdk",
            "cachedResultName": "Zalando Links"
          }
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "1nTQmlgxR0AJJDGA",
            "name": "n8ninja - Sheet"
          }
        },
        "typeVersion": 4.3,
        "alwaysOutputData": true
      },
      {
        "id": "881acff3-1736-4d53-8c3b-3354ec2da07b",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          -191
        ],
        "parameters": {
          "color": 6,
          "width": 275.01592825011585,
          "height": 439.37809705210145,
          "content": "# Setup\n### 1/ Add Your credentials\n[Google SHeet](https://docs.n8n.io/integrations/builtin/credentials/google/)\n\n### 2/ Create a Google Spreadsheet that will be your database.\nCopy this template: \nhttps://docs.google.com/spreadsheets/d/1sM66Rk10ZOhQKbawVB-xZ2WYhBeSr6wnJqvX6Aspbkg/edit?usp=sharing\n\n### 3/ Add products to monitor from this form \n# üëá"
        },
        "typeVersion": 1
      },
      {
        "id": "92ae590a-bf1d-4c17-a654-f281379fcee6",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1620,
          600
        ],
        "parameters": {
          "color": 6,
          "width": 275.01592825011585,
          "height": 93.37809705210145,
          "content": "### Fill with your email\n# üëá"
        },
        "typeVersion": 1
      },
      {
        "id": "8834da7f-7ca1-4cad-98b9-2335bfc81b8f",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          40,
          580
        ],
        "parameters": {
          "color": 6,
          "width": 275.01592825011585,
          "height": 136.37809705210145,
          "content": "### Change frequency üëâüèª\n\n(don't put less than once a day, or you will need to also add the hour in the format product node)\n"
        },
        "typeVersion": 1
      },
      {
        "id": "b1838412-6c3e-4519-8946-f6aeff0c9e8d",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          900,
          340
        ],
        "parameters": {
          "color": 7,
          "width": 202.64787116404852,
          "height": 85.79488430601403,
          "content": "### Crafted by the\n## [ü•∑ n8n.ninja](n8n.ninja)"
        },
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Add Product": {
        "main": [
          [
            {
              "node": "List Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "List Products": {
        "main": [
          [
            {
              "node": "Scrap Product",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scrap Product": {
        "main": [
          [
            {
              "node": "Format Product",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Product": {
        "main": [
          [
            {
              "node": "Add Log in History",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Products Infos",
              "type": "main",
              "index": 0
            },
            {
              "node": "If price below price alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "List Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Monitor Zalando Product": {
        "main": [
          [
            {
              "node": "Add Product",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If price below price alert": {
        "main": [
          [
            {
              "node": "Notify Price Reduction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  }
]